<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual Onboarding Architecture - UnifiedBeez</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #FFFBF5;
            min-height: 100vh;
        }

        .header-bar {
            background: linear-gradient(135deg, #1A4D2E 0%, #2D6A4F 50%, #52B788 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .header-bar h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .header-bar p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .controls-bar {
            background: white;
            padding: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 80px;
            z-index: 999;
        }

        .control-btn {
            padding: 10px 20px;
            background: #1A4D2E;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: #2D6A4F;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.4);
        }

        .zoom-level {
            padding: 10px 20px;
            background: #E8F5E9;
            color: #1A4D2E;
            border-radius: 8px;
            font-weight: 700;
        }

        .diagram-container {
            padding: 40px 20px;
            overflow-x: auto;
            background: white;
        }

        .diagram-wrapper {
            min-width: 1920px;
            width: max-content;
            transform-origin: top left;
            transition: transform 0.1s ease;
            margin: 0 auto;
        }

        /* FRAME STRUCTURE */
        .frame {
            background: white;
            border: 3px solid #1A4D2E;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
            width: 1920px;
        }

        .frame-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1A4D2E;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #E8F5E9 0%, #B7E4C7 100%);
            border-radius: 8px;
            margin-bottom: 30px;
            border: 2px solid #2D6A4F;
        }

        .frame-subtitle {
            font-size: 1.2rem;
            color: #2C3E50;
            text-align: center;
            margin-bottom: 30px;
        }

        /* LEGEND */
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .legend-box {
            width: 30px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid rgba(0, 0, 0, 0.2);
        }

        /* SWIM LANES */
        .swim-lane {
            margin: 20px 0;
            border: 3px solid #1A4D2E;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.2);
        }

        .lane-header {
            padding: 20px;
            font-weight: 700;
            font-size: 1.3rem;
            color: #1A4D2E;
            border-bottom: 3px solid #1A4D2E;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .lane-content {
            padding: 20px;
            min-height: auto;
        }

        /* LANE BACKGROUNDS - Using UnifiedBeez UI Palette */
        .lane-user { background: #E8F5E9; } /* Light mint green */
        .lane-backend { background: #D4E9E2; } /* Soft mint */
        .lane-aws { background: #FFF9E6; } /* Light cream/yellow */
        .lane-data { background: #B7E4C7; } /* Medium mint */
        .lane-gdpr { background: #E8F5E9; } /* Light mint green */

        /* CARDS AND BOXES */
        .step-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            align-items: stretch;
        }

        .step-box {
            background: white;
            border: 3px solid #2D6A4F;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.15);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .step-box:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(45, 106, 79, 0.3);
            border-color: #1A4D2E;
        }

        .step-box h3 {
            font-size: 1.05rem;
            color: #1A4D2E;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .step-box ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .step-box li {
            padding: 4px 0;
            color: #2C3E50;
            font-size: 0.9rem;
        }

        .step-box li:before {
            content: "‚Ä¢ ";
            color: #2D6A4F;
            font-weight: bold;
            margin-right: 5px;
        }

        .arrow {
            display: none; /* Remove arrows in grid layout */
        }

        /* SERVICE CARDS */
        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .service-card {
            background: white;
            border: 3px solid #2D6A4F;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.15);
        }

        .service-card h3 {
            font-size: 1.2rem;
            color: #1A4D2E;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .service-icon {
            font-size: 1.5rem;
        }

        .service-card .section {
            margin: 12px 0;
        }

        .section-title {
            font-weight: 700;
            color: #2C3E50;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .section-content {
            color: #2C3E50;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* AWS INFRASTRUCTURE BOXES */
        .aws-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        .aws-box {
            background: white;
            border: 3px solid #FB9C1D;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(251, 156, 29, 0.2);
        }

        .aws-box h4 {
            font-size: 1.1rem;
            color: #1A4D2E;
            margin-bottom: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .aws-icon {
            width: 32px;
            height: 32px;
            object-fit: contain;
        }

        /* DATABASE TABLE */
        .db-table {
            background: white;
            border: 3px solid #1A4D2E;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.15);
        }

        .table-header {
            background: linear-gradient(135deg, #1A4D2E 0%, #2D6A4F 50%, #52B788 100%);
            color: white;
            padding: 15px 20px;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .table-body {
            padding: 20px;
        }

        .table-row {
            display: grid;
            grid-template-columns: 200px 150px 250px 350px;
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.9rem;
        }

        .table-row:last-child {
            border-bottom: none;
        }

        .table-row.header-row {
            background: #E8F5E9;
            font-weight: 700;
            color: #1A4D2E;
        }

        .pk {
            color: #FB9C1D;
            font-weight: 700;
        }

        /* GDPR BOXES */
        .gdpr-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
        }

        .gdpr-box {
            background: white;
            border: 3px solid #1A4D2E;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.15);
        }

        .gdpr-box h3 {
            color: #1A4D2E;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .gdpr-box .check {
            color: #2D6A4F;
            font-size: 1.2rem;
            margin-right: 5px;
        }

        .gdpr-section {
            margin: 12px 0;
            padding: 12px;
            background: #FFF9E6;
            border-radius: 6px;
        }

        .gdpr-section strong {
            color: #FB9C1D;
            display: block;
            margin-bottom: 8px;
        }

        .reference {
            background: #E8F5E9;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            color: #1A4D2E;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
        }

        /* FLOW ARROWS */
        .flow-arrow-down {
            text-align: center;
            font-size: 2.5rem;
            color: #2D6A4F;
            margin: 10px 0;
            line-height: 1;
        }

        /* NOTE BOX */
        .note-box {
            background: #E8F5E9;
            border-left: 6px solid #2D6A4F;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }

        .note-box h3 {
            color: #1A4D2E;
            margin-bottom: 10px;
        }

        .note-box ul {
            margin-left: 20px;
            color: #2C3E50;
        }

        .note-box li {
            margin: 8px 0;
        }

        .note-box p {
            color: #2C3E50;
        }

        /* FRAME NAVIGATION */
        .frame-navigation {
            background: white;
            padding: 15px 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 160px;
            z-index: 999;
            overflow-x: auto;
        }

        .frame-nav-scroll {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .frame-nav-btn {
            padding: 10px 20px;
            background: #E8F5E9;
            color: #1A4D2E;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            white-space: nowrap;
        }

        .frame-nav-btn:hover {
            background: #1A4D2E;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.3);
        }

        @media print {
            .header-bar, .controls-bar {
                position: static;
            }
        }
    </style>
    <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
    <!-- NAVIGATION BAR -->
    <nav class="architecture-nav">
        <a href="index.html">Home</a>
        <a href="manual-onboarding.html" class="active">Manual Onboarding</a>
        <a href="beezaro-copilot.html">Beezaro Copilot</a>
        <a href="side-by-side-comparison.html">Side-by-Side</a>
    </nav>

    <!-- BREADCRUMB -->
    <div class="breadcrumb">
        <a href="index.html">Home</a> <span>/</span> <span>Manual Onboarding</span>
    </div>

    <div class="header-bar">
        <h1>UnifiedBeez Backend Architecture - Visual Diagrams</h1>
        <p>Screenshot-Ready Miro Board Diagrams | Zoom & Pan Enabled</p>
    </div>

    <div class="controls-bar">
        <button class="control-btn" onclick="zoomIn()">üîç Zoom In</button>
        <button class="control-btn" onclick="zoomOut()">üîç Zoom Out</button>
        <button class="control-btn" onclick="resetZoom()">‚Ü∫ Reset</button>
        <span class="zoom-level" id="zoomLevel">100%</span>
        <button class="control-btn" onclick="exportScreenshot()">üì∏ Prepare Screenshot</button>
    </div>

    <!-- FRAME NAVIGATION -->
    <div class="frame-navigation">
        <div class="frame-nav-scroll">
            <a href="#frame1" class="frame-nav-btn">Step 0: User Journey</a>
            <a href="#frame2" class="frame-nav-btn">Step 1: Plan Selection</a>
            <a href="#frame3" class="frame-nav-btn">Step 2: Business Info</a>
            <a href="#frame4" class="frame-nav-btn">Step 3: Team Setup</a>
            <a href="#frame5" class="frame-nav-btn">Step 4: AI Assistant</a>
            <a href="#frame6" class="frame-nav-btn">Step 5: Channel Integration</a>
            <a href="#frame7" class="frame-nav-btn">Step 6: Channel Config</a>
            <a href="#frame8" class="frame-nav-btn">Step 7: Web Chat</a>
            <a href="#frame9" class="frame-nav-btn">Step 8: Automation Templates</a>
        </div>
    </div>

    <div class="diagram-container" id="diagramContainer">
        <div class="diagram-wrapper" id="diagramWrapper">

            <!-- FRAME 1: USER JOURNEY & DATA FLOW -->
            <div class="frame" id="frame1">
                <div class="frame-title">
                    DIAGRAM 1: USER JOURNEY & DATA FLOW
                </div>
                <div class="frame-subtitle">
                    How Onboarding Maps to Backend Services - STEP 0: Sign Up & Verification
                </div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #D4E9E2;"></div>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FFF9E6;"></div>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #B7E4C7;"></div>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">
                        üë§ SWIM LANE 1: USER ACTIONS
                    </div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Sign Up</h3>
                                <ul>
                                    <li>Email input</li>
                                    <li>Password creation</li>
                                    <li>OR OAuth (Google/Apple/Microsoft)</li>
                                    <li>Privacy policy consent checkbox</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Email Verification</h3>
                                <ul>
                                    <li>6-digit OTP sent to email</li>
                                    <li>OTP input field</li>
                                    <li>Expiry: 10 minutes</li>
                                    <li>Resend option available</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Phone Verification</h3>
                                <ul>
                                    <li>Phone number input</li>
                                    <li>SMS OTP via Twilio</li>
                                    <li>6-digit verification code</li>
                                    <li>International format support</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Basic Info</h3>
                                <ul>
                                    <li>Full name input</li>
                                    <li>Phone number confirmation</li>
                                    <li>Profile initialization</li>
                                    <li>Account activation</li>
                                </ul>
                            </div>

                            <div class="step-box">
                                <h3>5. Password Reset (Forgot Password)</h3>
                                <ul>
                                    <li>Click "Forgot Password" link</li>
                                    <li>Enter email address</li>
                                    <li>Receive reset link via email</li>
                                    <li>Click link ‚Üí New password form</li>
                                    <li>Set new password</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">
                        ‚öôÔ∏è SWIM LANE 2: BACKEND SERVICES TRIGGERED
                    </div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">
                            <div class="service-card">
                                <h3><span class="service-icon">üîê</span> Authentication Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /auth/signup<br>
                                        ‚Ä¢ POST /auth/verify-email<br>
                                        ‚Ä¢ POST /auth/login
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ OAuth handlers (Google, Apple, Microsoft)<br>
                                        ‚Ä¢ Password hashing (bcrypt)<br>
                                        ‚Ä¢ JWT token generation<br>
                                        ‚Ä¢ Session creation
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üìß</span> Email Service</h3>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ OTP generation (6-digit)<br>
                                        ‚Ä¢ Email dispatch via Sendy + AWS SES<br>
                                        ‚Ä¢ Template: verification-email<br>
                                        ‚Ä¢ Expiry: 10 minutes
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Integration:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Sendy (self-hosted) + AWS SES<br>
                                        ‚Ä¢ Rate limit: 10 emails/minute per user
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üì±</span> SMS Service (Twilio)</h3>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ SMS OTP via Twilio API<br>
                                        ‚Ä¢ Phone number verification<br>
                                        ‚Ä¢ International support
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">API Call:</div>
                                    <div class="section-content">
                                        POST /2010-04-01/Accounts/{AccountSid}/Messages.json
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Rate Limit:</div>
                                    <div class="section-content">100 SMS/sec</div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üîë</span> Password Reset Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /auth/forgot-password<br>
                                        ‚Ä¢ POST /auth/reset-password<br>
                                        ‚Ä¢ POST /auth/verify-reset-token
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Generate secure reset tokens (UUID)<br>
                                        ‚Ä¢ Send reset link via Sendy + AWS SES<br>
                                        ‚Ä¢ Token expiry (1 hour)<br>
                                        ‚Ä¢ One-time use tokens<br>
                                        ‚Ä¢ Rate limiting (5 requests/hour per email)
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Security:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Token hashing (SHA-256)<br>
                                        ‚Ä¢ IP address logging<br>
                                        ‚Ä¢ Email verification before reset<br>
                                        ‚Ä¢ Automatic token cleanup after use
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Email Template:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Subject: "Reset Your UnifiedBeez Password"<br>
                                        ‚Ä¢ Reset link: {FRONTEND_URL}/reset-password?token={TOKEN}<br>
                                        ‚Ä¢ Expiry warning: "This link expires in 1 hour"
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">
                        ‚òÅÔ∏è SWIM LANE 3: AWS INFRASTRUCTURE USED
                    </div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">
                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate
                                </h4>
                                <div class="section-content">
                                    <strong>Service:</strong><br>
                                    ‚Ä¢ NestJS Auth Service<br><br>
                                    <strong>Configuration:</strong><br>
                                    ‚Ä¢ Tasks: 2-10<br>
                                    ‚Ä¢ CPU: 2 vCPU<br>
                                    ‚Ä¢ RAM: 4GB<br>
                                    ‚Ä¢ Port: 3000
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL
                                </h4>
                                <div class="section-content">
                                    <strong>Configuration:</strong><br>
                                    ‚Ä¢ Multi-AZ<br>
                                    ‚Ä¢ db.t4g.medium<br>
                                    ‚Ä¢ 100GB storage<br><br>
                                    <strong>Table:</strong><br>
                                    ‚Ä¢ users<br><br>
                                    <strong>Port:</strong> 5432
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    ‚Ä¢ Session store<br>
                                    ‚Ä¢ OTP cache<br>
                                    ‚Ä¢ Rate limiting<br><br>
                                    <strong>Type:</strong><br>
                                    ‚Ä¢ cache.t4g.micro<br>
                                    ‚Ä¢ Multi-AZ (2 nodes: Primary + Replica)<br><br>
                                    <strong>Port:</strong> 6379
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Secrets-Manager.svg" alt="Secrets Manager" class="aws-icon">
                                    Secrets Manager
                                </h4>
                                <div class="section-content">
                                    <strong>Stored:</strong><br>
                                    ‚Ä¢ OAuth secrets<br>
                                    ‚Ä¢ Twilio creds<br>
                                    ‚Ä¢ Sendy + AWS SES credentials<br>
                                    ‚Ä¢ JWT secret<br><br>
                                    <strong>Encryption:</strong><br>
                                    ‚Ä¢ KMS encrypted
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px; border: 2px solid #FB9C1D;">
                            <h4 style="color: #1A4D2E; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                                <img src="https://icon.icepanel.io/AWS/svg/Management-Governance/CloudWatch.svg" alt="CloudWatch" class="aws-icon">
                                CloudWatch Logs
                            </h4>
                            <div class="section-content">
                                <strong>Log Groups:</strong><br>
                                ‚Ä¢ /aws/ecs/unifiedbeez-auth-service (all auth events)<br>
                                ‚Ä¢ /aws/rds/postgresql/unifiedbeez-db (query logs)<br><br>
                                <strong>Retention:</strong> 30 days (cost optimization)
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">
                        üóÑÔ∏è SWIM LANE 4: DATA STORAGE (PostgreSQL Schema)
                    </div>
                    <div class="lane-content lane-data">
                        <div class="db-table">
                            <div class="table-header">TABLE: users</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique user identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>email</div>
                                    <div>VARCHAR(255)</div>
                                    <div>UNIQUE, NOT NULL</div>
                                    <div>User email (encrypted)</div>
                                </div>
                                <div class="table-row">
                                    <div>phone</div>
                                    <div>VARCHAR(20)</div>
                                    <div>UNIQUE, NULLABLE</div>
                                    <div>User phone (encrypted)</div>
                                </div>
                                <div class="table-row">
                                    <div>passwordHash</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Bcrypt hashed password</div>
                                </div>
                                <div class="table-row">
                                    <div>emailVerified</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Email verification status</div>
                                </div>
                                <div class="table-row">
                                    <div>phoneVerified</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Phone verification status</div>
                                </div>
                                <div class="table-row">
                                    <div>oauthProvider</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NULLABLE</div>
                                    <div>google|apple|microsoft</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Account creation time</div>
                                </div>
                                <div class="table-row">
                                    <div>consentTimestamp</div>
                                    <div>TIMESTAMP</div>
                                    <div>NOT NULL</div>
                                    <div>GDPR: Consent recorded</div>
                                </div>
                                <div class="table-row">
                                    <div>consentIpAddress</div>
                                    <div>VARCHAR(45)</div>
                                    <div>NOT NULL</div>
                                    <div>GDPR: IP when consented</div>
                                </div>
                                <div class="table-row">
                                    <div>privacyPolicyVersion</div>
                                    <div>VARCHAR(10)</div>
                                    <div>NOT NULL</div>
                                    <div>GDPR: Policy version</div>
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 20px; padding: 20px; background: white; border-radius: 8px; border: 2px solid #1A4D2E;">
                            <h4 style="color: #1A4D2E; margin-bottom: 15px;">üîë Indexes</h4>
                            <div class="section-content">
                                ‚Ä¢ idx_email ON users(email)<br>
                                ‚Ä¢ idx_oauth ON users(oauthProvider, oauthId)
                            </div>
                            <h4 style="color: #1A4D2E; margin: 15px 0 10px;">üîê Encryption</h4>
                            <div class="section-content">
                                ‚Ä¢ email: AES-256 (at rest via RDS encryption)<br>
                                ‚Ä¢ phone: AES-256 (at rest via RDS encryption)<br>
                                ‚Ä¢ passwordHash: bcrypt with salt rounds = 10
                            </div>
                        </div>

                        <div class="db-table" style="margin-top: 20px;">
                            <div class="table-header">TABLE: password_reset_tokens</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Token record identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>userId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí users(id)</div>
                                    <div>User requesting password reset</div>
                                </div>
                                <div class="table-row">
                                    <div>token</div>
                                    <div>VARCHAR(255)</div>
                                    <div>UNIQUE, NOT NULL</div>
                                    <div>SHA-256 hashed reset token</div>
                                </div>
                                <div class="table-row">
                                    <div>expiresAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NOT NULL</div>
                                    <div>1 hour from creation</div>
                                </div>
                                <div class="table-row">
                                    <div>used</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>One-time use flag</div>
                                </div>
                                <div class="table-row">
                                    <div>usedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When token was consumed</div>
                                </div>
                                <div class="table-row">
                                    <div>ipAddress</div>
                                    <div>VARCHAR(45)</div>
                                    <div>NOT NULL</div>
                                    <div>Request origin (security audit)</div>
                                </div>
                                <div class="table-row">
                                    <div>userAgent</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Browser/device info</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Token generation time</div>
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 20px; padding: 20px; background: white; border-radius: 8px; border: 2px solid #1A4D2E;">
                            <h4 style="color: #1A4D2E; margin-bottom: 15px;">üîë Password Reset Token Features</h4>
                            <div class="section-content">
                                <strong>Security Measures:</strong><br>
                                ‚Ä¢ Tokens are hashed with SHA-256 before storage<br>
                                ‚Ä¢ 1-hour expiration window<br>
                                ‚Ä¢ One-time use only (marked as used after consumption)<br>
                                ‚Ä¢ Rate limiting: 5 reset requests per hour per email<br>
                                ‚Ä¢ IP address logging for security audits<br><br>

                                <strong>Cleanup Strategy:</strong><br>
                                ‚Ä¢ Expired tokens deleted daily via Lambda cron job<br>
                                ‚Ä¢ Used tokens deleted after 7 days<br>
                                ‚Ä¢ Prevents table bloat
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">
                        üõ°Ô∏è SWIM LANE 5: GDPR COMPLIANCE REFERENCES
                    </div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">
                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> GDPR CHECKPOINT #1</h3>
                                <div class="gdpr-section">
                                    <strong>Privacy Policy Consent Collected</strong>
                                    <strong style="color: #333; font-weight: 400;">What:</strong> User must check "I agree to Privacy Policy & Terms" before signup<br>
                                    <strong style="color: #333; font-weight: 400;">When:</strong> Before account creation<br>
                                    <strong style="color: #333; font-weight: 400;">How:</strong> Checkbox + timestamp + IP address recorded
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Public Privacy Policy" (Line 1596-1689)
                                </div>
                                <div style="margin-top: 15px; padding: 12px; background: white; border-radius: 6px;">
                                    <strong style="color: #1A4D2E;">Database Storage:</strong><br>
                                    ‚Üí users.consentTimestamp<br>
                                    ‚Üí users.consentIpAddress<br>
                                    ‚Üí users.privacyPolicyVersion
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> GDPR CHECKPOINT #2</h3>
                                <div class="gdpr-section">
                                    <strong>Article 7: Conditions for Consent</strong>
                                    <strong style="color: #333; font-weight: 400;">Requirement:</strong> Consent must be freely given, specific, informed, unambiguous<br><br>
                                    <strong style="color: #333; font-weight: 400;">Our Implementation:</strong><br>
                                    ‚Ä¢ Freely Given: User can choose not to sign up<br>
                                    ‚Ä¢ Specific: Clear what data is collected<br>
                                    ‚Ä¢ Informed: Privacy policy link provided<br>
                                    ‚Ä¢ Unambiguous: Active checkbox, not pre-checked
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Legal Requirements" (Line 269-288)
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> GDPR CHECKPOINT #3</h3>
                                <div class="gdpr-section">
                                    <strong>Audit Log Created (10-Year Retention)</strong>
                                    <strong style="color: #333; font-weight: 400;">What:</strong> Every signup attempt logged (success or failure)<br><br>
                                    <strong style="color: #333; font-weight: 400;">Audit Log Entry Example:</strong>
                                    <pre style="background: white; padding: 10px; border-radius: 4px; font-size: 0.85rem; overflow-x: auto;">
{
  eventType: "USER_SIGNUP",
  userId: 123,
  email: "user@example.com",
  ipAddress: "192.168.1.1",
  timestamp: "2025-10-21T10:30:00Z",
  consentGiven: true,
  privacyPolicyVersion: "v1.0"
}</pre>
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Layer 4: Audit & Monitoring" (Line 720-808)
                                </div>
                                <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 6px;">
                                    <strong style="color: #1A4D2E;">Storage:</strong> PostgreSQL table "gdpr_audit_logs"<br>
                                    <strong style="color: #1A4D2E;">Retention:</strong> 10 years (regulatory requirement)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- NOTE BOX -->
                <div class="note-box">
                    <h3>üìù NOTE: This is STEP 0 (Sign Up & Verification) only</h3>
                    <p style="margin: 10px 0;">The complete diagram continues with:</p>
                    <ul>
                        <li><strong>STEP 1:</strong> Plan Selection & Payment (Billing Service + Stripe)</li>
                        <li><strong>STEP 2:</strong> Business Information (Organization Service + S3 file uploads)</li>
                        <li><strong>STEP 3:</strong> Team Setup (Team Management Service)</li>
                        <li><strong>STEP 4:</strong> AI Assistant Creation (AI Service + OpenAI)</li>
                        <li><strong>STEP 5:</strong> Channel Integration (Channel Service + WhatsApp/Twilio/etc.)</li>
                        <li><strong>STEP 6:</strong> Channel Configuration (Per-channel settings)</li>
                        <li><strong>STEP 7:</strong> Web Chat Setup (Widget configuration)</li>
                        <li><strong>STEP 8:</strong> Automation Templates (Automation Service)</li>
                    </ul>
                    <p style="margin-top: 15px; color: #1A4D2E; font-weight: 600;">
                        Each step follows this exact 5-lane swim lane structure.
                    </p>
                </div>

            </div>
            <!-- END FRAME 1: STEP 0 -->

            <!-- FRAME 2: STEP 1 - PLAN SELECTION & PAYMENT -->
            <div class="frame" id="frame2">
                <div class="frame-title">
                    STEP 1: PLAN SELECTION & PAYMENT
                </div>
                <div class="frame-subtitle">
                    Billing Service + Stripe Integration + Organization Setup
                </div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #D4E9E2;"></div>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FFF9E6;"></div>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #B7E4C7;"></div>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">
                        üë§ SWIM LANE 1: USER ACTIONS
                    </div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Select Plan</h3>
                                <ul>
                                    <li>Individual: ¬£19/month</li>
                                    <li>Business: ¬£99/month</li>
                                    <li>Premium: ¬£299/month</li>
                                    <li>Organisation: ¬£499/month</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Add-Ons Selection (Optional)</h3>
                                <ul>
                                    <li>Click "Add-on available" on plan card</li>
                                    <li>Browse add-on marketplace</li>
                                    <li>Select add-ons with quantity</li>
                                    <li>View add-on checkout summary</li>
                                    <li>Add to cart or skip</li>
                                </ul>
                                <div style="margin-top: 10px; font-size: 0.85em; color: #555;">
                                    <strong>Available Add-ons:</strong><br>
                                    ‚Ä¢ Seats (¬£7/month each, up to 50)<br>
                                    ‚Ä¢ AI Assistant (¬£25/month, unlimited)<br>
                                    ‚Ä¢ Twilio WhatsApp Channel (¬£25/month, 3 per 5k msgs)<br>
                                    ‚Ä¢ Twilio Message Pack (¬£20/month, 1k msgs)<br>
                                    ‚Ä¢ Twilio Voice Call (¬£20/month, 2 numbers)<br>
                                    ‚Ä¢ Multi-language AI (¬£10/month, 5 languages)<br>
                                    ‚Ä¢ Priority Support (¬£25/month)<br>
                                    ‚Ä¢ White-Label Portal (¬£99/month, 5 portals)<br>
                                    ‚Ä¢ Reseller/Agency Portal (¬£149/month)<br>
                                    ‚Ä¢ CRM/Calendar Sync (¬£20/month)<br>
                                    ‚Ä¢ Ecommerce Pack (¬£25/month, 50/period)
                                </div>
                            </div>
                            <div class="step-box">
                                <h3>3. Billing Cycle</h3>
                                <ul>
                                    <li>Monthly billing</li>
                                    <li>Yearly (15% discount)</li>
                                    <li>30-day free trial</li>
                                    <li>View price breakdown</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Payment</h3>
                                <ul>
                                    <li>Enter card details</li>
                                    <li>Billing address</li>
                                    <li>Stripe checkout</li>
                                    <li>Confirm purchase</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">
                        ‚öôÔ∏è SWIM LANE 2: BACKEND SERVICES TRIGGERED
                    </div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">
                            <div class="service-card">
                                <h3><span class="service-icon">üí≥</span> Billing Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /billing/plans<br>
                                        ‚Ä¢ GET /billing/plans/:id<br>
                                        ‚Ä¢ POST /billing/subscribe<br>
                                        ‚Ä¢ POST /billing/addons
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Plan configuration<br>
                                        ‚Ä¢ Pricing calculation<br>
                                        ‚Ä¢ 15% yearly discount<br>
                                        ‚Ä¢ 30-day trial handling<br>
                                        ‚Ä¢ Add-on management
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Business Logic:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Individual: 1 seat, 10k credits<br>
                                        ‚Ä¢ Business: 3 seats, 2 AI bots<br>
                                        ‚Ä¢ Premium: 30 seats, unlimited AI<br>
                                        ‚Ä¢ Organisation: 50 seats, all features
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üí∞</span> Stripe Integration</h3>
                                <div class="section">
                                    <div class="section-title">Stripe API Calls:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /v1/customers<br>
                                        ‚Ä¢ POST /v1/subscriptions<br>
                                        ‚Ä¢ POST /v1/payment_methods<br>
                                        ‚Ä¢ POST /v1/invoices
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Webhooks Received:</div>
                                    <div class="section-content">
                                        ‚Ä¢ customer.subscription.created<br>
                                        ‚Ä¢ customer.subscription.updated<br>
                                        ‚Ä¢ invoice.payment_succeeded<br>
                                        ‚Ä¢ invoice.payment_failed<br>
                                        ‚Ä¢ customer.subscription.deleted
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Security:</div>
                                    <div class="section-content">
                                        ‚Ä¢ No PCI data stored locally<br>
                                        ‚Ä¢ Tokenized payment methods<br>
                                        ‚Ä¢ HTTPS only<br>
                                        ‚Ä¢ Webhook signing secret
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üõí</span> Add-on Marketplace Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ GET /addons - List all available add-ons<br>
                                        ‚Ä¢ GET /addons/:id - Get add-on details<br>
                                        ‚Ä¢ POST /addons/purchase - Purchase add-ons<br>
                                        ‚Ä¢ GET /addons/my-addons - User's active add-ons<br>
                                        ‚Ä¢ DELETE /addons/:id - Cancel add-on<br>
                                        ‚Ä¢ PATCH /addons/:id/quantity - Update quantity
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Add-on catalog management<br>
                                        ‚Ä¢ Plan-specific add-on availability<br>
                                        ‚Ä¢ Quantity validation (min/max limits)<br>
                                        ‚Ä¢ Real-time price calculation<br>
                                        ‚Ä¢ Add-on checkout summary<br>
                                        ‚Ä¢ Stripe subscription item creation<br>
                                        ‚Ä¢ Usage tracking and limits enforcement
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Add-on Types:</div>
                                    <div class="section-content">
                                        <strong>Seats:</strong> ¬£7/month each (max 50)<br>
                                        <strong>AI Assistant:</strong> ¬£25/month (unlimited)<br>
                                        <strong>WhatsApp Channel:</strong> ¬£25/month (3 per 5k msgs)<br>
                                        <strong>Message Pack:</strong> ¬£20/month (1k msgs)<br>
                                        <strong>Voice Call:</strong> ¬£20/month (2 numbers)<br>
                                        <strong>Multi-language AI:</strong> ¬£10/month (5 languages)<br>
                                        <strong>Priority Support:</strong> ¬£25/month<br>
                                        <strong>White-Label Portal:</strong> ¬£99/month (5 portals)<br>
                                        <strong>Reseller Portal:</strong> ¬£149/month<br>
                                        <strong>CRM Sync:</strong> ¬£20/month<br>
                                        <strong>Ecommerce Pack:</strong> ¬£25/month (50/period)
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Business Logic:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Validate add-on compatibility with plan<br>
                                        ‚Ä¢ Enforce quantity limits per add-on<br>
                                        ‚Ä¢ Calculate prorated charges<br>
                                        ‚Ä¢ Apply VAT (if applicable)<br>
                                        ‚Ä¢ Create Stripe subscription items<br>
                                        ‚Ä¢ Update organization feature flags<br>
                                        ‚Ä¢ Send confirmation emails
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üè¢</span> Organization Service</h3>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Organization creation<br>
                                        ‚Ä¢ Plan limits enforcement<br>
                                        ‚Ä¢ Feature flags setup<br>
                                        ‚Ä¢ Seat allocation
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /organizations<br>
                                        ‚Ä¢ PATCH /organizations/:id/plan
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">
                        ‚òÅÔ∏è SWIM LANE 3: AWS INFRASTRUCTURE USED
                    </div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">
                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate
                                </h4>
                                <div class="section-content">
                                    <strong>Service:</strong><br>
                                    ‚Ä¢ Billing Service<br><br>
                                    <strong>Configuration:</strong><br>
                                    ‚Ä¢ Tasks: 2-5<br>
                                    ‚Ä¢ CPU: 2 vCPU<br>
                                    ‚Ä¢ RAM: 4GB<br>
                                    ‚Ä¢ Port: 3000
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL
                                </h4>
                                <div class="section-content">
                                    <strong>Tables:</strong><br>
                                    ‚Ä¢ organizations<br>
                                    ‚Ä¢ subscriptions<br>
                                    ‚Ä¢ payment_methods<br>
                                    ‚Ä¢ invoices<br><br>
                                    <strong>Encryption:</strong><br>
                                    ‚Ä¢ At rest (KMS)<br>
                                    ‚Ä¢ Port: 5432
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Storage/Simple-Storage-Service.svg" alt="S3" class="aws-icon">
                                    S3 Bucket
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    ‚Ä¢ Invoice PDFs<br>
                                    ‚Ä¢ Receipt storage<br><br>
                                    <strong>Bucket:</strong><br>
                                    ‚Ä¢ unifiedbeez-invoices-prod<br><br>
                                    <strong>Versioning:</strong> ON
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Compute/Lambda.svg" alt="Lambda" class="aws-icon">
                                    Lambda
                                </h4>
                                <div class="section-content">
                                    <strong>Function:</strong><br>
                                    ‚Ä¢ Stripe webhook handler<br><br>
                                    <strong>Trigger:</strong><br>
                                    ‚Ä¢ API Gateway POST<br>
                                    ‚Ä¢ /webhooks/stripe<br><br>
                                    <strong>Timeout:</strong> 30s
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px; border: 2px solid #FB9C1D;">
                            <h4 style="color: #1A4D2E; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                                <img src="https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Secrets-Manager.svg" alt="Secrets Manager" class="aws-icon">
                                Secrets Manager
                            </h4>
                            <div class="section-content">
                                <strong>Stored Secrets:</strong><br>
                                ‚Ä¢ Stripe API Key (sk_live_...)<br>
                                ‚Ä¢ Stripe Webhook Signing Secret<br>
                                ‚Ä¢ Encryption: KMS encrypted
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">
                        üóÑÔ∏è SWIM LANE 4: DATA STORAGE (PostgreSQL Schema)
                    </div>
                    <div class="lane-content lane-data">
                        <div class="db-table">
                            <div class="table-header">TABLE: organizations</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Organization identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>ownerId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí users(id)</div>
                                    <div>Organization owner</div>
                                </div>
                                <div class="table-row">
                                    <div>planTier</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>individual|business|premium|organisation</div>
                                </div>
                                <div class="table-row">
                                    <div>billingCycle</div>
                                    <div>VARCHAR(20)</div>
                                    <div>NOT NULL</div>
                                    <div>monthly|yearly</div>
                                </div>
                                <div class="table-row">
                                    <div>planStartDate</div>
                                    <div>TIMESTAMP</div>
                                    <div>NOT NULL</div>
                                    <div>Plan activation date</div>
                                </div>
                                <div class="table-row">
                                    <div>trialEndsAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>30 days from signup</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Organization creation time</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table" style="margin-top: 20px;">
                            <div class="table-header">TABLE: subscriptions</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Subscription identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí organizations(id)</div>
                                    <div>Linked organization</div>
                                </div>
                                <div class="table-row">
                                    <div>stripeSubscriptionId</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Stripe subscription ID</div>
                                </div>
                                <div class="table-row">
                                    <div>stripeCustomerId</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Stripe customer ID</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>active|trial|cancelled|past_due</div>
                                </div>
                                <div class="table-row">
                                    <div>currentPeriodStart</div>
                                    <div>TIMESTAMP</div>
                                    <div>NOT NULL</div>
                                    <div>Billing period start</div>
                                </div>
                                <div class="table-row">
                                    <div>currentPeriodEnd</div>
                                    <div>TIMESTAMP</div>
                                    <div>NOT NULL</div>
                                    <div>Billing period end</div>
                                </div>
                                <div class="table-row">
                                    <div>addOns</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>{seats: 5, aiAssistants: 2}</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Subscription creation time</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table" style="margin-top: 20px;">
                            <div class="table-header">TABLE: payment_methods</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Payment method identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí organizations(id)</div>
                                    <div>Linked organization</div>
                                </div>
                                <div class="table-row">
                                    <div>stripePaymentMethodId</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Tokenized (from Stripe)</div>
                                </div>
                                <div class="table-row">
                                    <div>last4</div>
                                    <div>VARCHAR(4)</div>
                                    <div>NOT NULL</div>
                                    <div>Last 4 card digits</div>
                                </div>
                                <div class="table-row">
                                    <div>brand</div>
                                    <div>VARCHAR(20)</div>
                                    <div>NOT NULL</div>
                                    <div>visa|mastercard|amex</div>
                                </div>
                                <div class="table-row">
                                    <div>expiryMonth</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL</div>
                                    <div>Card expiry month</div>
                                </div>
                                <div class="table-row">
                                    <div>expiryYear</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL</div>
                                    <div>Card expiry year</div>
                                </div>
                                <div class="table-row">
                                    <div>isDefault</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Default payment method flag</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table" style="margin-top: 20px;">
                            <div class="table-header">TABLE: addon_definitions</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Add-on catalog identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>name</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NOT NULL, UNIQUE</div>
                                    <div>Add-on name (e.g., "Seats")</div>
                                </div>
                                <div class="table-row">
                                    <div>slug</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NOT NULL, UNIQUE</div>
                                    <div>URL-friendly identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>description</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>Add-on description text</div>
                                </div>
                                <div class="table-row">
                                    <div>category</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>capacity|feature|channel|support</div>
                                </div>
                                <div class="table-row">
                                    <div>pricePerUnit</div>
                                    <div>DECIMAL(10,2)</div>
                                    <div>NOT NULL</div>
                                    <div>Price in GBP (e.g., 7.00)</div>
                                </div>
                                <div class="table-row">
                                    <div>stripePriceId</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Stripe Price ID for billing</div>
                                </div>
                                <div class="table-row">
                                    <div>billingInterval</div>
                                    <div>VARCHAR(20)</div>
                                    <div>NOT NULL</div>
                                    <div>month|year</div>
                                </div>
                                <div class="table-row">
                                    <div>minQuantity</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 1</div>
                                    <div>Minimum purchase quantity</div>
                                </div>
                                <div class="table-row">
                                    <div>maxQuantity</div>
                                    <div>INTEGER</div>
                                    <div>NULLABLE</div>
                                    <div>Maximum allowed (NULL=unlimited)</div>
                                </div>
                                <div class="table-row">
                                    <div>usageLimit</div>
                                    <div>INTEGER</div>
                                    <div>NULLABLE</div>
                                    <div>Per-period usage limit</div>
                                </div>
                                <div class="table-row">
                                    <div>usageLimitType</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NULLABLE</div>
                                    <div>messages|calls|seats|languages</div>
                                </div>
                                <div class="table-row">
                                    <div>availableForPlans</div>
                                    <div>VARCHAR[]</div>
                                    <div>NOT NULL</div>
                                    <div>['business','premium','organisation']</div>
                                </div>
                                <div class="table-row">
                                    <div>isActive</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Availability status</div>
                                </div>
                                <div class="table-row">
                                    <div>displayOrder</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Sort order in marketplace</div>
                                </div>
                                <div class="table-row">
                                    <div>iconUrl</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>Add-on icon/image URL</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Catalog entry creation time</div>
                                </div>
                                <div class="table-row">
                                    <div>updatedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last updated timestamp</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table" style="margin-top: 20px;">
                            <div class="table-header">TABLE: organization_addons</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Organization add-on record ID</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí organizations(id)</div>
                                    <div>Owning organization</div>
                                </div>
                                <div class="table-row">
                                    <div>addonId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí addon_definitions(id)</div>
                                    <div>Purchased add-on type</div>
                                </div>
                                <div class="table-row">
                                    <div>quantity</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL, DEFAULT 1</div>
                                    <div>Number of units purchased</div>
                                </div>
                                <div class="table-row">
                                    <div>stripeSubscriptionItemId</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Stripe subscription item ID</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>active|cancelled|paused</div>
                                </div>
                                <div class="table-row">
                                    <div>currentPeriodStart</div>
                                    <div>TIMESTAMP</div>
                                    <div>NOT NULL</div>
                                    <div>Billing period start</div>
                                </div>
                                <div class="table-row">
                                    <div>currentPeriodEnd</div>
                                    <div>TIMESTAMP</div>
                                    <div>NOT NULL</div>
                                    <div>Billing period end</div>
                                </div>
                                <div class="table-row">
                                    <div>usageCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Current period usage tracker</div>
                                </div>
                                <div class="table-row">
                                    <div>purchasedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Initial purchase timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>cancelledAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>Cancellation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>updatedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last modification time</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table" style="margin-top: 20px;">
                            <div class="table-header">TABLE: addon_usage_logs</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Usage log entry ID</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationAddonId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí organization_addons(id)</div>
                                    <div>Related add-on subscription</div>
                                </div>
                                <div class="table-row">
                                    <div>usageType</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>message|call|seat|language</div>
                                </div>
                                <div class="table-row">
                                    <div>usageAmount</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL, DEFAULT 1</div>
                                    <div>Units consumed</div>
                                </div>
                                <div class="table-row">
                                    <div>metadata</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Additional usage context</div>
                                </div>
                                <div class="table-row">
                                    <div>timestamp</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Usage occurrence time</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">
                        üõ°Ô∏è SWIM LANE 5: GDPR COMPLIANCE REFERENCES
                    </div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">
                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> No PCI Data Stored Locally</h3>
                                <div class="gdpr-section">
                                    <strong>Stripe Tokenization</strong>
                                    <strong style="color: #333; font-weight: 400;">What:</strong> Credit card details never touch our servers<br>
                                    <strong style="color: #333; font-weight: 400;">How:</strong> Stripe.js tokenizes card on client-side<br>
                                    <strong style="color: #333; font-weight: 400;">Stored:</strong> Only stripePaymentMethodId (token) + last4 digits
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Public Privacy Policy - Billing" (Line 1678)
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> Billing Email Confirmation</h3>
                                <div class="gdpr-section">
                                    <strong>User Receives Confirmation</strong>
                                    <strong style="color: #333; font-weight: 400;">Content Includes:</strong><br>
                                    ‚Ä¢ Plan selected<br>
                                    ‚Ä¢ Price breakdown<br>
                                    ‚Ä¢ How to cancel<br>
                                    ‚Ä¢ Refund policy
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Legal Requirements" (Line 269)
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> Audit Log</h3>
                                <div class="gdpr-section">
                                    <strong>Events Logged</strong>
                                    ‚Ä¢ PLAN_SELECTED<br>
                                    ‚Ä¢ PAYMENT_INITIATED<br>
                                    ‚Ä¢ PAYMENT_COMPLETED<br>
                                    ‚Ä¢ SUBSCRIPTION_CREATED
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "GdprAuditLog Table" (Line 729)
                                </div>
                                <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 6px;">
                                    <strong style="color: #1A4D2E;">Retention:</strong> 10 years (regulatory requirement)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 2: STEP 1 -->

            <!-- FRAME 3: STEP 2 - BUSINESS INFORMATION & KNOWLEDGE BASE -->
            <div class="frame" id="frame3">
                <div class="frame-title">
                    STEP 2: BUSINESS INFORMATION & KNOWLEDGE BASE
                </div>
                <div class="frame-subtitle">
                    Organization Service + File Upload + Knowledge Base Processing + AI Enhancement
                </div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #D4E9E2;"></div>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FFF9E6;"></div>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #B7E4C7;"></div>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">
                        üë§ SWIM LANE 1: USER ACTIONS
                    </div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Business Name & Industry</h3>
                                <ul>
                                    <li>Enter business name</li>
                                    <li>Select industry (E-commerce, Healthcare, etc.)</li>
                                    <li>Business description (500 chars)</li>
                                    <li>AI enhancement option</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Upload Logo</h3>
                                <ul>
                                    <li>Upload company logo</li>
                                    <li>Max size: 5MB</li>
                                    <li>Formats: PNG, JPG, SVG</li>
                                    <li>Auto CDN distribution</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Business Objectives</h3>
                                <ul>
                                    <li>Select objectives (multi-select)</li>
                                    <li>Sales, Support, Retention</li>
                                    <li>Lead Generation, Customer Service</li>
                                    <li>Custom objectives</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Knowledge Base Upload</h3>
                                <ul>
                                    <li>Upload PDFs, DOCX files</li>
                                    <li>Add website URLs for scraping</li>
                                    <li>Upload images with text (OCR)</li>
                                    <li>Max 10MB per file</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">
                        ‚öôÔ∏è SWIM LANE 2: BACKEND SERVICES TRIGGERED
                    </div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">
                            <div class="service-card">
                                <h3><span class="service-icon">üè¢</span> Organization Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ PATCH /organizations/:id/business-info<br>
                                        ‚Ä¢ POST /organizations/:id/logo<br>
                                        ‚Ä¢ PATCH /organizations/:id/objectives
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Business profile creation<br>
                                        ‚Ä¢ Industry classification<br>
                                        ‚Ä¢ Objectives configuration<br>
                                        ‚Ä¢ Logo URL management
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üìÅ</span> File Upload Service</h3>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ S3 multipart upload<br>
                                        ‚Ä¢ File validation (type, size 10MB)<br>
                                        ‚Ä¢ Virus scanning (ClamAV)<br>
                                        ‚Ä¢ CloudFront CDN distribution
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /files/upload<br>
                                        ‚Ä¢ GET /files/:id<br>
                                        ‚Ä¢ DELETE /files/:id
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üìö</span> Knowledge Base Service</h3>
                                <div class="section">
                                    <div class="section-title">Processing Pipeline:</div>
                                    <div class="section-content">
                                        ‚Ä¢ PDF ‚Üí text extraction<br>
                                        ‚Ä¢ OCR for images (AWS Textract)<br>
                                        ‚Ä¢ Website scraping (Puppeteer)<br>
                                        ‚Ä¢ Text chunking for vector DB<br>
                                        ‚Ä¢ Embedding generation (OpenAI)<br>
                                        ‚Ä¢ pgvector storage
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /knowledge-base/upload<br>
                                        ‚Ä¢ POST /knowledge-base/scrape-url<br>
                                        ‚Ä¢ GET /knowledge-base/status/:id
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">‚ú®</span> AI Enhancement Service</h3>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ "Enhance with Beebot" for business description<br>
                                        ‚Ä¢ OpenAI API call for text improvement<br>
                                        ‚Ä¢ Grammar and clarity enhancement<br>
                                        ‚Ä¢ Professional tone optimization
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /ai/enhance-description
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">
                        ‚òÅÔ∏è SWIM LANE 3: AWS INFRASTRUCTURE USED
                    </div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">
                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate
                                </h4>
                                <div class="section-content">
                                    <strong>Services:</strong><br>
                                    ‚Ä¢ Knowledge Base Processing Service<br>
                                    ‚Ä¢ File Upload Service<br><br>
                                    <strong>Configuration:</strong><br>
                                    ‚Ä¢ Tasks: 3-10<br>
                                    ‚Ä¢ CPU: 4 vCPU<br>
                                    ‚Ä¢ RAM: 8GB
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Storage/Simple-Storage-Service.svg" alt="S3" class="aws-icon">
                                    S3 Buckets
                                </h4>
                                <div class="section-content">
                                    <strong>Buckets:</strong><br>
                                    ‚Ä¢ unifiedbeez-knowledge-base/<br>
                                    ‚Ä¢ unifiedbeez-logos/<br>
                                    ‚Ä¢ unifiedbeez-documents/<br><br>
                                    <strong>Features:</strong><br>
                                    ‚Ä¢ Versioning enabled<br>
                                    ‚Ä¢ Lifecycle policies (30 days)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Networking-Content-Delivery/CloudFront.svg" alt="CloudFront" class="aws-icon">
                                    CloudFront
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    ‚Ä¢ Logo CDN distribution<br>
                                    ‚Ä¢ File CDN caching<br><br>
                                    <strong>Configuration:</strong><br>
                                    ‚Ä¢ Origin: S3 buckets<br>
                                    ‚Ä¢ Cache TTL: 24 hours
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Compute/Lambda.svg" alt="Lambda" class="aws-icon">
                                    Lambda
                                </h4>
                                <div class="section-content">
                                    <strong>Functions:</strong><br>
                                    ‚Ä¢ Document processing trigger<br>
                                    ‚Ä¢ S3 event handler<br><br>
                                    <strong>Trigger:</strong><br>
                                    ‚Ä¢ S3 PUT events<br>
                                    ‚Ä¢ Timeout: 5 minutes
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Machine-Learning/Textract.svg" alt="Textract" class="aws-icon">
                                    Textract
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    ‚Ä¢ OCR for scanned documents<br>
                                    ‚Ä¢ Image text extraction<br><br>
                                    <strong>API:</strong><br>
                                    ‚Ä¢ DetectDocumentText<br>
                                    ‚Ä¢ AnalyzeDocument
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Queue-Service.svg" alt="SQS" class="aws-icon">
                                    SQS Queue
                                </h4>
                                <div class="section-content">
                                    <strong>Queue:</strong><br>
                                    ‚Ä¢ document-processing-queue<br><br>
                                    <strong>Purpose:</strong><br>
                                    ‚Ä¢ Async document processing<br>
                                    ‚Ä¢ Visibility timeout: 5 min
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">
                        üóÑÔ∏è SWIM LANE 4: DATA STORAGE (PostgreSQL Schema)
                    </div>
                    <div class="lane-content lane-data">
                        <div class="db-table">
                            <div class="table-header">TABLE: organizations (Updated Columns)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>businessName</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Company/Business name</div>
                                </div>
                                <div class="table-row">
                                    <div>industry</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NOT NULL</div>
                                    <div>E-commerce, Healthcare, etc.</div>
                                </div>
                                <div class="table-row">
                                    <div>logoUrl</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>S3 CDN path to logo</div>
                                </div>
                                <div class="table-row">
                                    <div>businessDescription</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>500 char description (AI enhanced)</div>
                                </div>
                                <div class="table-row">
                                    <div>objectives</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>["sales", "support", "retention"]</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table" style="margin-top: 20px;">
                            <div class="table-header">TABLE: knowledge_base</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Knowledge base entry identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí organizations(id)</div>
                                    <div>Linked organization</div>
                                </div>
                                <div class="table-row">
                                    <div>fileName</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Original file name</div>
                                </div>
                                <div class="table-row">
                                    <div>fileType</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>pdf|docx|url|image</div>
                                </div>
                                <div class="table-row">
                                    <div>s3Key</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>S3 object key</div>
                                </div>
                                <div class="table-row">
                                    <div>fileSize</div>
                                    <div>BIGINT</div>
                                    <div>NOT NULL</div>
                                    <div>File size in bytes</div>
                                </div>
                                <div class="table-row">
                                    <div>processingStatus</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>pending|processing|completed|error</div>
                                </div>
                                <div class="table-row">
                                    <div>extractedText</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Full-text searchable content</div>
                                </div>
                                <div class="table-row">
                                    <div>embedding</div>
                                    <div>VECTOR(1536)</div>
                                    <div>NULLABLE</div>
                                    <div>OpenAI embeddings for RAG</div>
                                </div>
                                <div class="table-row">
                                    <div>uploadedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Upload timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>processedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>Processing completion time</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">
                        üõ°Ô∏è SWIM LANE 5: GDPR COMPLIANCE REFERENCES
                    </div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">
                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> File Upload Consent</h3>
                                <div class="gdpr-section">
                                    <strong>Website Scraping = Data Processing</strong>
                                    <strong style="color: #333; font-weight: 400;">Article 6:</strong> Lawful Basis for Processing<br>
                                    <strong style="color: #333; font-weight: 400;">Consent Required:</strong> User must consent to website scraping and content extraction
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 6: Lawful Basis for Processing
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> Data Retention Policy</h3>
                                <div class="gdpr-section">
                                    <strong>Knowledge Base Retention</strong>
                                    <strong style="color: #333; font-weight: 400;">Policy:</strong> 30 days after account deletion<br>
                                    <strong style="color: #333; font-weight: 400;">S3 Versioning:</strong> 30-day recovery window<br>
                                    <strong style="color: #333; font-weight: 400;">Permanent Deletion:</strong> After 30 days
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Data Retention" (Line 1678)
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> Encryption at Rest</h3>
                                <div class="gdpr-section">
                                    <strong>S3 SSE-KMS Encryption</strong>
                                    <strong style="color: #333; font-weight: 400;">Method:</strong> AWS KMS managed keys<br>
                                    <strong style="color: #333; font-weight: 400;">Coverage:</strong> All uploaded files<br>
                                    <strong style="color: #333; font-weight: 400;">Key Rotation:</strong> Automatic annual rotation
                                </div>
                                <div class="reference">
                                    ‚Üí CONSOLIDATED_ARCHITECTURE.md<br>
                                    &nbsp;&nbsp; Decision #12: Security & IAM<br>
                                    &nbsp;&nbsp; Decision #6: File Storage
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 3: STEP 2 -->

            <!-- FRAME 4: STEP 3 - TEAM & ROLE SETUP -->
            <div class="frame" id="frame4">
                <div class="frame-title">
                    STEP 3: TEAM & ROLE SETUP
                </div>
                <div class="frame-subtitle">
                    Team Management Service + Role-Based Access Control + Invitation System
                </div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #D4E9E2;"></div>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FFF9E6;"></div>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #B7E4C7;"></div>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">
                        üë§ SWIM LANE 1: USER ACTIONS
                    </div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Invite Team Members</h3>
                                <ul>
                                    <li>Enter email addresses (comma-separated bulk)</li>
                                    <li>Assign roles per member</li>
                                    <li>Add custom message (optional)</li>
                                    <li>Send invitations</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Assign Roles</h3>
                                <ul>
                                    <li>Owner (full access)</li>
                                    <li>Admin (manage settings)</li>
                                    <li>Support (handle messages)</li>
                                    <li>Designer, Tech (specific permissions)</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Track Invitations</h3>
                                <ul>
                                    <li>View pending invitations</li>
                                    <li>Resend invitation emails</li>
                                    <li>Cancel pending invites</li>
                                    <li>24-hour expiry timer</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Manage Team</h3>
                                <ul>
                                    <li>Remove team members</li>
                                    <li>Change member roles</li>
                                    <li>View team activity</li>
                                    <li>Manage permissions</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">
                        ‚öôÔ∏è SWIM LANE 2: BACKEND SERVICES TRIGGERED
                    </div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">
                            <div class="service-card">
                                <h3><span class="service-icon">üë•</span> Team Management Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /teams/invite<br>
                                        ‚Ä¢ POST /teams/invite/bulk<br>
                                        ‚Ä¢ GET /teams/:orgId/members<br>
                                        ‚Ä¢ DELETE /teams/members/:id<br>
                                        ‚Ä¢ PATCH /teams/members/:id/role
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Team member invitation API<br>
                                        ‚Ä¢ Role-based access control (RBAC)<br>
                                        ‚Ä¢ Invitation token generation<br>
                                        ‚Ä¢ Bulk invite processing
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üìß</span> Email Service</h3>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Send invitation emails (Sendy + AWS SES)<br>
                                        ‚Ä¢ Invitation acceptance tracking<br>
                                        ‚Ä¢ Reminder emails (if not accepted)<br>
                                        ‚Ä¢ Email templates with branding
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Email Content:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Organization name<br>
                                        ‚Ä¢ Inviter name and role<br>
                                        ‚Ä¢ Acceptance link (with token)<br>
                                        ‚Ä¢ Privacy policy link (GDPR)
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üîê</span> Authorization Service</h3>
                                <div class="section">
                                    <div class="section-title">RBAC Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Role permissions matrix<br>
                                        ‚Ä¢ Feature access control<br>
                                        ‚Ä¢ API endpoint permissions<br>
                                        ‚Ä¢ Resource-level permissions
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Role Permissions:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Owner: All permissions<br>
                                        ‚Ä¢ Admin: Manage settings, team<br>
                                        ‚Ä¢ Support: Handle messages only<br>
                                        ‚Ä¢ Custom roles: Granular control
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">
                        ‚òÅÔ∏è SWIM LANE 3: AWS INFRASTRUCTURE USED
                    </div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">
                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate
                                </h4>
                                <div class="section-content">
                                    <strong>Service:</strong><br>
                                    ‚Ä¢ Team Management Service<br><br>
                                    <strong>Configuration:</strong><br>
                                    ‚Ä¢ Tasks: 2-5<br>
                                    ‚Ä¢ CPU: 2 vCPU<br>
                                    ‚Ä¢ RAM: 4GB
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL
                                </h4>
                                <div class="section-content">
                                    <strong>Tables:</strong><br>
                                    ‚Ä¢ team_members<br>
                                    ‚Ä¢ invitations<br>
                                    ‚Ä¢ roles<br><br>
                                    <strong>Port:</strong> 5432
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    ‚Ä¢ Invitation token cache<br>
                                    ‚Ä¢ 24-hour TTL<br><br>
                                    <strong>Key Pattern:</strong><br>
                                    ‚Ä¢ invite:{token}<br>
                                    ‚Ä¢ Port: 6379
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Notification-Service.svg" alt="SES" class="aws-icon">
                                    Sendy + AWS SES
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    ‚Ä¢ Invitation email delivery<br>
                                    ‚Ä¢ Reminder emails<br><br>
                                    <strong>Rate Limit:</strong><br>
                                    ‚Ä¢ 50 emails/second
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Compute/Lambda.svg" alt="Lambda" class="aws-icon">
                                    Lambda
                                </h4>
                                <div class="section-content">
                                    <strong>Function:</strong><br>
                                    ‚Ä¢ Invitation expiry cleanup<br><br>
                                    <strong>Schedule:</strong><br>
                                    ‚Ä¢ Cron: Every 24 hours<br>
                                    ‚Ä¢ CloudWatch Events
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">
                        üóÑÔ∏è SWIM LANE 4: DATA STORAGE (PostgreSQL Schema)
                    </div>
                    <div class="lane-content lane-data">
                        <div class="db-table">
                            <div class="table-header">TABLE: team_members</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Team member identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí organizations(id)</div>
                                    <div>Linked organization</div>
                                </div>
                                <div class="table-row">
                                    <div>userId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí users(id)</div>
                                    <div>Linked user account</div>
                                </div>
                                <div class="table-row">
                                    <div>role</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>owner|admin|support|designer|tech</div>
                                </div>
                                <div class="table-row">
                                    <div>permissions</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Granular permissions array</div>
                                </div>
                                <div class="table-row">
                                    <div>invitedBy</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí users(id)</div>
                                    <div>Who sent the invitation</div>
                                </div>
                                <div class="table-row">
                                    <div>joinedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Team join timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>active|removed</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table" style="margin-top: 20px;">
                            <div class="table-header">TABLE: invitations</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Invitation identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí organizations(id)</div>
                                    <div>Target organization</div>
                                </div>
                                <div class="table-row">
                                    <div>email</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Invitee email address</div>
                                </div>
                                <div class="table-row">
                                    <div>role</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>Assigned role</div>
                                </div>
                                <div class="table-row">
                                    <div>token</div>
                                    <div>VARCHAR(255)</div>
                                    <div>UNIQUE, NOT NULL</div>
                                    <div>Secure invitation token (UUID)</div>
                                </div>
                                <div class="table-row">
                                    <div>invitedBy</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí users(id)</div>
                                    <div>Inviter user ID</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>pending|accepted|expired|cancelled</div>
                                </div>
                                <div class="table-row">
                                    <div>expiresAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NOT NULL</div>
                                    <div>24 hours from creation</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Invitation creation time</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">
                        üõ°Ô∏è SWIM LANE 5: GDPR COMPLIANCE REFERENCES
                    </div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">
                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> Team Member Email Collection Consent</h3>
                                <div class="gdpr-section">
                                    <strong>Data We Collect</strong>
                                    <strong style="color: #333; font-weight: 400;">Email addresses of team members</strong><br>
                                    <strong style="color: #333; font-weight: 400;">Purpose:</strong> Team collaboration and access control<br>
                                    <strong style="color: #333; font-weight: 400;">Legal Basis:</strong> Legitimate interest (business operations)
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Data We Collect" (Line 1610)
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> Privacy Policy in Invitation Email</h3>
                                <div class="gdpr-section">
                                    <strong>Invitation Email Must Include:</strong>
                                    ‚Ä¢ Organization name<br>
                                    ‚Ä¢ Privacy policy link<br>
                                    ‚Ä¢ Right to decline invitation<br>
                                    ‚Ä¢ Data processing information
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Public Privacy Policy" (Line 1596)
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> Right to Decline Invitation</h3>
                                <div class="gdpr-section">
                                    <strong>GDPR Consent Principle</strong>
                                    <strong style="color: #333; font-weight: 400;">Invitee Rights:</strong><br>
                                    ‚Ä¢ Can decline invitation<br>
                                    ‚Ä¢ Can request email removal<br>
                                    ‚Ä¢ No automatic opt-in<br>
                                    ‚Ä¢ Clear unsubscribe option
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 7: Consent Requirements
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 4: STEP 3 -->

            <!-- FRAME 5: STEP 4 - AI ASSISTANT CREATION -->
            <div class="frame" id="frame5">
                <div class="frame-title">
                    STEP 4: AI ASSISTANT CREATION
                </div>
                <div class="frame-subtitle">
                    AI Configuration Service + OpenAI Integration + Multi-AI Management
                </div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #D4E9E2;"></div>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FFF9E6;"></div>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #B7E4C7;"></div>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">
                        üë§ SWIM LANE 1: USER ACTIONS
                    </div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Name Your AI</h3>
                                <ul>
                                    <li>Enter AI assistant name</li>
                                    <li>Default: "Beebot"</li>
                                    <li>Custom names allowed</li>
                                    <li>Name character limit: 50</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Select AI Model</h3>
                                <ul>
                                    <li>GPT-4 (recommended)</li>
                                    <li>GPT-3.5 Turbo</li>
                                    <li>Claude 3 (optional)</li>
                                    <li>Custom model parameters</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Configure Personality</h3>
                                <ul>
                                    <li>Tone: Professional, Friendly, Casual</li>
                                    <li>Response length preference</li>
                                    <li>Language support</li>
                                    <li>Custom instructions</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Create Assistant</h3>
                                <ul>
                                    <li>Review configuration</li>
                                    <li>Test AI responses</li>
                                    <li>Save and activate</li>
                                    <li>Create multiple assistants (plan limits)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">
                        ‚öôÔ∏è SWIM LANE 2: BACKEND SERVICES TRIGGERED
                    </div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">
                            <div class="service-card">
                                <h3><span class="service-icon">ü§ñ</span> AI Configuration Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /ai-assistants<br>
                                        ‚Ä¢ GET /ai-assistants/:orgId<br>
                                        ‚Ä¢ PATCH /ai-assistants/:id<br>
                                        ‚Ä¢ DELETE /ai-assistants/:id<br>
                                        ‚Ä¢ POST /ai-assistants/:id/test
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ AI assistant creation<br>
                                        ‚Ä¢ Configuration management<br>
                                        ‚Ä¢ Plan limit enforcement<br>
                                        ‚Ä¢ Multi-AI support
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">‚ú®</span> OpenAI Integration Service</h3>
                                <div class="section">
                                    <div class="section-title">OpenAI API Calls:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /v1/chat/completions<br>
                                        ‚Ä¢ POST /v1/embeddings<br>
                                        ‚Ä¢ POST /v1/assistants<br>
                                        ‚Ä¢ POST /v1/threads
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ GPT-4 / GPT-3.5 support<br>
                                        ‚Ä¢ System prompts management<br>
                                        ‚Ä¢ Temperature & token control<br>
                                        ‚Ä¢ Streaming responses
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üìã</span> Prompt Engineering Service</h3>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ System prompt generation<br>
                                        ‚Ä¢ Knowledge base injection<br>
                                        ‚Ä¢ Personality customization<br>
                                        ‚Ä¢ Context management
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Prompt Structure:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Business context<br>
                                        ‚Ä¢ Knowledge base context<br>
                                        ‚Ä¢ Tone & personality<br>
                                        ‚Ä¢ Response guidelines
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">
                        ‚òÅÔ∏è SWIM LANE 3: AWS INFRASTRUCTURE USED
                    </div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">
                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate
                                </h4>
                                <div class="section-content">
                                    <strong>Service:</strong><br>
                                    ‚Ä¢ AI Configuration Service<br><br>
                                    <strong>Configuration:</strong><br>
                                    ‚Ä¢ Tasks: 3-10<br>
                                    ‚Ä¢ CPU: 2 vCPU<br>
                                    ‚Ä¢ RAM: 4GB
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL
                                </h4>
                                <div class="section-content">
                                    <strong>Tables:</strong><br>
                                    ‚Ä¢ ai_assistants<br>
                                    ‚Ä¢ ai_configurations<br>
                                    ‚Ä¢ conversation_history<br><br>
                                    <strong>Port:</strong> 5432
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    ‚Ä¢ AI config cache<br>
                                    ‚Ä¢ Conversation context cache<br><br>
                                    <strong>TTL:</strong><br>
                                    ‚Ä¢ Config: 1 hour<br>
                                    ‚Ä¢ Context: 24 hours
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Secrets-Manager.svg" alt="Secrets Manager" class="aws-icon">
                                    Secrets Manager
                                </h4>
                                <div class="section-content">
                                    <strong>Stored:</strong><br>
                                    ‚Ä¢ OpenAI API Key<br>
                                    ‚Ä¢ Claude API Key (optional)<br><br>
                                    <strong>Encryption:</strong><br>
                                    ‚Ä¢ KMS encrypted
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">
                        üóÑÔ∏è SWIM LANE 4: DATA STORAGE (PostgreSQL Schema)
                    </div>
                    <div class="lane-content lane-data">
                        <div class="db-table">
                            <div class="table-header">TABLE: ai_assistants</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>AI assistant identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí organizations(id)</div>
                                    <div>Linked organization</div>
                                </div>
                                <div class="table-row">
                                    <div>name</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>AI assistant name (e.g., "Beebot")</div>
                                </div>
                                <div class="table-row">
                                    <div>model</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>gpt-4|gpt-3.5-turbo|claude-3</div>
                                </div>
                                <div class="table-row">
                                    <div>systemPrompt</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>AI instructions and personality</div>
                                </div>
                                <div class="table-row">
                                    <div>tone</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>professional|friendly|casual</div>
                                </div>
                                <div class="table-row">
                                    <div>temperature</div>
                                    <div>DECIMAL(3,2)</div>
                                    <div>DEFAULT 0.7</div>
                                    <div>AI creativity (0.0 - 1.0)</div>
                                </div>
                                <div class="table-row">
                                    <div>maxTokens</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 500</div>
                                    <div>Max response length</div>
                                </div>
                                <div class="table-row">
                                    <div>languages</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>["en", "es", "fr"]</div>
                                </div>
                                <div class="table-row">
                                    <div>isActive</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Active status</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Creation timestamp</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">
                        üõ°Ô∏è SWIM LANE 5: GDPR COMPLIANCE REFERENCES
                    </div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">
                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> AI Conversation Data Processing</h3>
                                <div class="gdpr-section">
                                    <strong>Article 6: Lawful Basis</strong>
                                    <strong style="color: #333; font-weight: 400;">Data Processed:</strong><br>
                                    ‚Ä¢ User messages to AI<br>
                                    ‚Ä¢ AI responses<br>
                                    ‚Ä¢ Conversation context<br><br>
                                    <strong style="color: #333; font-weight: 400;">Legal Basis:</strong> Legitimate interest (service provision)
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 6: Lawful Basis for Processing
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> OpenAI Data Processing Agreement</h3>
                                <div class="gdpr-section">
                                    <strong>Third-Party Processor</strong>
                                    <strong style="color: #333; font-weight: 400;">Agreement Required:</strong> DPA with OpenAI<br>
                                    <strong style="color: #333; font-weight: 400;">Data Retention:</strong> 30 days (OpenAI policy)<br>
                                    <strong style="color: #333; font-weight: 400;">No Training:</strong> API data not used for training
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Third-Party Processors"
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> Conversation History Retention</h3>
                                <div class="gdpr-section">
                                    <strong>Data Retention Policy</strong>
                                    <strong style="color: #333; font-weight: 400;">Retention:</strong> 90 days (configurable)<br>
                                    <strong style="color: #333; font-weight: 400;">User Rights:</strong> Right to access, delete<br>
                                    <strong style="color: #333; font-weight: 400;">Auto-deletion:</strong> After retention period
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Data Retention" (Line 1678)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 5: STEP 4 -->

            <!-- FRAME 6: STEP 5 - CHANNEL INTEGRATION -->
            <div class="frame" id="frame6">
                <div class="frame-title">
                    STEP 5: CHANNEL INTEGRATION
                </div>
                <div class="frame-subtitle">
                    Multi-Channel Connection Service + WhatsApp + Instagram + Facebook + Email + Telegram + LinkedIn + Shopify + PayPal + Calendly + Zoom + Stripe + SMS
                </div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #D4E9E2;"></div>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FFF9E6;"></div>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #B7E4C7;"></div>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">
                        üë§ SWIM LANE 1: USER ACTIONS
                    </div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Select Channels</h3>
                                <ul>
                                    <li><strong>Messaging:</strong> WhatsApp, Telegram, SMS</li>
                                    <li><strong>Social:</strong> Instagram, Facebook, LinkedIn</li>
                                    <li><strong>Email:</strong> Gmail, Outlook, SMTP</li>
                                    <li><strong>E-commerce:</strong> Shopify, PayPal, Stripe</li>
                                    <li><strong>Productivity:</strong> Calendly, Zoom</li>
                                    <li><strong>Web:</strong> Web Chat Widget</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Authenticate Channel</h3>
                                <ul>
                                    <li>OAuth: Facebook, Instagram, LinkedIn, Google, Outlook, Shopify, Zoom, Calendly</li>
                                    <li>API Keys: WhatsApp, Telegram, Stripe, PayPal</li>
                                    <li>SMTP/IMAP: Generic Email</li>
                                    <li>Twilio: Account SID & Auth Token</li>
                                    <li>Grant required permissions</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Verify Connection</h3>
                                <ul>
                                    <li>Test webhook delivery</li>
                                    <li>Verify message sending</li>
                                    <li>Check permissions</li>
                                    <li>Connection status: Active</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Assign AI Assistant</h3>
                                <ul>
                                    <li>Select which AI per channel</li>
                                    <li>Multi-AI support</li>
                                    <li>Channel-specific settings</li>
                                    <li>Save configuration</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">
                        ‚öôÔ∏è SWIM LANE 2: BACKEND SERVICES TRIGGERED
                    </div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">
                            <div class="service-card">
                                <h3><span class="service-icon">üì±</span> Channel Connection Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /channels/connect<br>
                                        ‚Ä¢ GET /channels/:orgId<br>
                                        ‚Ä¢ DELETE /channels/:id<br>
                                        ‚Ä¢ POST /channels/:id/verify<br>
                                        ‚Ä¢ PATCH /channels/:id/config
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ OAuth flow management<br>
                                        ‚Ä¢ Webhook setup & verification<br>
                                        ‚Ä¢ Connection health monitoring<br>
                                        ‚Ä¢ Multi-channel orchestration
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üí¨</span> WhatsApp Business Service</h3>
                                <div class="section">
                                    <div class="section-title">Integration:</div>
                                    <div class="section-content">
                                        ‚Ä¢ WhatsApp Business API<br>
                                        ‚Ä¢ Send/Receive messages<br>
                                        ‚Ä¢ Media handling (images, docs)<br>
                                        ‚Ä¢ Message templates (pre-approved)
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Webhooks:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /webhooks/whatsapp<br>
                                        ‚Ä¢ Message received events<br>
                                        ‚Ä¢ Delivery status updates<br>
                                        ‚Ä¢ Read receipts
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üìò</span> Facebook/Instagram Service</h3>
                                <div class="section">
                                    <div class="section-title">Integration:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Facebook Messenger API<br>
                                        ‚Ä¢ Instagram Messaging API<br>
                                        ‚Ä¢ OAuth 2.0 authentication<br>
                                        ‚Ä¢ Page/Account linking
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Send/Receive DMs<br>
                                        ‚Ä¢ Story replies<br>
                                        ‚Ä¢ Comment handling<br>
                                        ‚Ä¢ Media attachments
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üìû</span> Twilio SMS Service</h3>
                                <div class="section">
                                    <div class="section-title">Integration:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Twilio Programmable SMS<br>
                                        ‚Ä¢ Send/Receive SMS<br>
                                        ‚Ä¢ Phone number provisioning<br>
                                        ‚Ä¢ International SMS support
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Webhooks:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /webhooks/twilio<br>
                                        ‚Ä¢ Inbound message events<br>
                                        ‚Ä¢ Delivery callbacks<br>
                                        ‚Ä¢ Status updates
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üìß</span> Email Integration Service</h3>
                                <div class="section">
                                    <div class="section-title">Integrations:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Google Workspace (Gmail) - OAuth 2.0<br>
                                        ‚Ä¢ Microsoft Outlook/365 - OAuth 2.0<br>
                                        ‚Ä¢ Generic Email - SMTP/IMAP<br>
                                        ‚Ä¢ Bi-directional sync (send & receive)
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Email thread management<br>
                                        ‚Ä¢ Auto-reply detection<br>
                                        ‚Ä¢ Attachment handling<br>
                                        ‚Ä¢ HTML email parsing<br>
                                        ‚Ä¢ Spam filtering integration
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /channels/email/google/connect<br>
                                        ‚Ä¢ POST /channels/email/outlook/connect<br>
                                        ‚Ä¢ POST /channels/email/smtp/connect<br>
                                        ‚Ä¢ GET /channels/email/:id/inbox<br>
                                        ‚Ä¢ POST /channels/email/:id/send
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">‚úàÔ∏è</span> Telegram Bot Service</h3>
                                <div class="section">
                                    <div class="section-title">Integration:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Telegram Bot API<br>
                                        ‚Ä¢ Bot token authentication<br>
                                        ‚Ä¢ Send/Receive messages<br>
                                        ‚Ä¢ Media support (photos, docs, voice)<br>
                                        ‚Ä¢ Inline keyboards & commands
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Webhooks:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /webhooks/telegram<br>
                                        ‚Ä¢ Message updates<br>
                                        ‚Ä¢ Callback query events<br>
                                        ‚Ä¢ File uploads
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /channels/telegram/connect<br>
                                        ‚Ä¢ POST /channels/telegram/:id/send<br>
                                        ‚Ä¢ GET /channels/telegram/:id/info
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üíº</span> LinkedIn Messaging Service</h3>
                                <div class="section">
                                    <div class="section-title">Integration:</div>
                                    <div class="section-content">
                                        ‚Ä¢ LinkedIn Messaging API<br>
                                        ‚Ä¢ OAuth 2.0 authentication<br>
                                        ‚Ä¢ Direct message handling<br>
                                        ‚Ä¢ Company page messaging<br>
                                        ‚Ä¢ Connection request management
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Send/Receive InMail<br>
                                        ‚Ä¢ Conversation threading<br>
                                        ‚Ä¢ Profile data enrichment<br>
                                        ‚Ä¢ Rate limiting (API quotas)
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /channels/linkedin/connect<br>
                                        ‚Ä¢ GET /channels/linkedin/:id/conversations<br>
                                        ‚Ä¢ POST /channels/linkedin/:id/send
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üõçÔ∏è</span> Shopify Integration Service</h3>
                                <div class="section">
                                    <div class="section-title">Integration:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Shopify Admin API<br>
                                        ‚Ä¢ OAuth 2.0 authentication<br>
                                        ‚Ä¢ Order notifications<br>
                                        ‚Ä¢ Customer message handling<br>
                                        ‚Ä¢ Product inquiry automation
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Order status updates<br>
                                        ‚Ä¢ Abandoned cart notifications<br>
                                        ‚Ä¢ Customer support messaging<br>
                                        ‚Ä¢ Shipping tracking updates<br>
                                        ‚Ä¢ Refund/return handling
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Webhooks:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /webhooks/shopify<br>
                                        ‚Ä¢ orders/create<br>
                                        ‚Ä¢ orders/updated<br>
                                        ‚Ä¢ customers/create
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üí≥</span> Stripe Integration Service</h3>
                                <div class="section">
                                    <div class="section-title">Integration:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Stripe API<br>
                                        ‚Ä¢ Payment event notifications<br>
                                        ‚Ä¢ Customer communication channel<br>
                                        ‚Ä¢ Dispute management messaging
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Payment confirmation messages<br>
                                        ‚Ä¢ Failed payment alerts<br>
                                        ‚Ä¢ Subscription renewal reminders<br>
                                        ‚Ä¢ Invoice notifications
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Webhooks:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /webhooks/stripe<br>
                                        ‚Ä¢ payment_intent.succeeded<br>
                                        ‚Ä¢ payment_intent.failed<br>
                                        ‚Ä¢ invoice.paid
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üí∞</span> PayPal Integration Service</h3>
                                <div class="section">
                                    <div class="section-title">Integration:</div>
                                    <div class="section-content">
                                        ‚Ä¢ PayPal REST API<br>
                                        ‚Ä¢ OAuth 2.0 authentication<br>
                                        ‚Ä¢ Payment notifications<br>
                                        ‚Ä¢ Dispute messaging automation
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Payment received notifications<br>
                                        ‚Ä¢ Refund status updates<br>
                                        ‚Ä¢ Chargeback alerts<br>
                                        ‚Ä¢ Customer payment inquiries
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Webhooks:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /webhooks/paypal<br>
                                        ‚Ä¢ PAYMENT.SALE.COMPLETED<br>
                                        ‚Ä¢ PAYMENT.SALE.REFUNDED<br>
                                        ‚Ä¢ CUSTOMER.DISPUTE.CREATED
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üìÖ</span> Calendly Integration Service</h3>
                                <div class="section">
                                    <div class="section-title">Integration:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Calendly API v2<br>
                                        ‚Ä¢ OAuth 2.0 authentication<br>
                                        ‚Ä¢ Appointment booking notifications<br>
                                        ‚Ä¢ Calendar event messaging
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Booking confirmation messages<br>
                                        ‚Ä¢ Reminder notifications<br>
                                        ‚Ä¢ Cancellation/reschedule alerts<br>
                                        ‚Ä¢ Pre-meeting instructions<br>
                                        ‚Ä¢ Follow-up automation
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Webhooks:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /webhooks/calendly<br>
                                        ‚Ä¢ invitee.created<br>
                                        ‚Ä¢ invitee.canceled<br>
                                        ‚Ä¢ event_type.activated
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üé•</span> Zoom Integration Service</h3>
                                <div class="section">
                                    <div class="section-title">Integration:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Zoom API<br>
                                        ‚Ä¢ OAuth 2.0 authentication<br>
                                        ‚Ä¢ Meeting notifications<br>
                                        ‚Ä¢ Webinar messaging automation
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Meeting scheduled notifications<br>
                                        ‚Ä¢ Join link distribution<br>
                                        ‚Ä¢ Meeting reminders<br>
                                        ‚Ä¢ Recording available alerts<br>
                                        ‚Ä¢ Participant follow-ups
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Webhooks:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /webhooks/zoom<br>
                                        ‚Ä¢ meeting.started<br>
                                        ‚Ä¢ meeting.ended<br>
                                        ‚Ä¢ recording.completed
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">
                        ‚òÅÔ∏è SWIM LANE 3: AWS INFRASTRUCTURE USED
                    </div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">
                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate
                                </h4>
                                <div class="section-content">
                                    <strong>Services:</strong><br>
                                    ‚Ä¢ Channel Connection Service<br>
                                    ‚Ä¢ Messaging: WhatsApp, Telegram, SMS<br>
                                    ‚Ä¢ Social: Facebook, Instagram, LinkedIn<br>
                                    ‚Ä¢ Email: Gmail, Outlook, SMTP<br>
                                    ‚Ä¢ E-commerce: Shopify, Stripe, PayPal<br>
                                    ‚Ä¢ Productivity: Calendly, Zoom<br><br>
                                    <strong>Configuration:</strong><br>
                                    ‚Ä¢ Tasks: 10-30 (auto-scaling)<br>
                                    ‚Ä¢ CPU: 2 vCPU<br>
                                    ‚Ä¢ RAM: 4GB
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/API-Gateway.svg" alt="API Gateway" class="aws-icon">
                                    API Gateway
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    ‚Ä¢ Webhook endpoints<br>
                                    ‚Ä¢ Rate limiting<br>
                                    ‚Ä¢ Request validation<br><br>
                                    <strong>Endpoints:</strong><br>
                                    ‚Ä¢ /webhooks/whatsapp<br>
                                    ‚Ä¢ /webhooks/facebook<br>
                                    ‚Ä¢ /webhooks/twilio<br>
                                    ‚Ä¢ /webhooks/telegram<br>
                                    ‚Ä¢ /webhooks/linkedin<br>
                                    ‚Ä¢ /webhooks/shopify<br>
                                    ‚Ä¢ /webhooks/stripe<br>
                                    ‚Ä¢ /webhooks/paypal<br>
                                    ‚Ä¢ /webhooks/calendly<br>
                                    ‚Ä¢ /webhooks/zoom
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL
                                </h4>
                                <div class="section-content">
                                    <strong>Tables:</strong><br>
                                    ‚Ä¢ channels<br>
                                    ‚Ä¢ channel_credentials<br>
                                    ‚Ä¢ messages<br>
                                    ‚Ä¢ webhooks_log<br><br>
                                    <strong>Port:</strong> 5432
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    ‚Ä¢ OAuth token cache<br>
                                    ‚Ä¢ Message queue (Redis Streams)<br>
                                    ‚Ä¢ Rate limit tracking<br><br>
                                    <strong>TTL:</strong> Token: 1 hour
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Queue-Service.svg" alt="SQS" class="aws-icon">
                                    SQS Queue
                                </h4>
                                <div class="section-content">
                                    <strong>Queues:</strong><br>
                                    ‚Ä¢ inbound-messages-queue<br>
                                    ‚Ä¢ outbound-messages-queue<br><br>
                                    <strong>Purpose:</strong><br>
                                    ‚Ä¢ Message processing buffer<br>
                                    ‚Ä¢ Async webhook handling
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Secrets-Manager.svg" alt="Secrets Manager" class="aws-icon">
                                    Secrets Manager
                                </h4>
                                <div class="section-content">
                                    <strong>Stored:</strong><br>
                                    ‚Ä¢ WhatsApp API tokens<br>
                                    ‚Ä¢ Facebook/Instagram App secrets<br>
                                    ‚Ä¢ Twilio Auth Token<br>
                                    ‚Ä¢ Telegram Bot tokens<br>
                                    ‚Ä¢ LinkedIn OAuth secrets<br>
                                    ‚Ä¢ Google Workspace OAuth credentials<br>
                                    ‚Ä¢ Microsoft Outlook OAuth credentials<br>
                                    ‚Ä¢ SMTP/IMAP credentials<br>
                                    ‚Ä¢ Shopify App credentials<br>
                                    ‚Ä¢ Stripe API keys<br>
                                    ‚Ä¢ PayPal API credentials<br>
                                    ‚Ä¢ Calendly OAuth secrets<br>
                                    ‚Ä¢ Zoom OAuth secrets<br>
                                    ‚Ä¢ OAuth client secrets (all providers)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">
                        üóÑÔ∏è SWIM LANE 4: DATA STORAGE (PostgreSQL Schema)
                    </div>
                    <div class="lane-content lane-data">
                        <div class="db-table">
                            <div class="table-header">TABLE: channels</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Channel identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí organizations(id)</div>
                                    <div>Linked organization</div>
                                </div>
                                <div class="table-row">
                                    <div>channelType</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>whatsapp|facebook|instagram|sms|telegram|linkedin|email_gmail|email_outlook|email_smtp|shopify|stripe|paypal|calendly|zoom|webchat</div>
                                </div>
                                <div class="table-row">
                                    <div>channelName</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>User-friendly name</div>
                                </div>
                                <div class="table-row">
                                    <div>externalId</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>WhatsApp Business ID, FB Page ID, Telegram Bot ID, LinkedIn Profile ID, Shopify Store ID, etc.</div>
                                </div>
                                <div class="table-row">
                                    <div>aiAssistantId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí ai_assistants(id)</div>
                                    <div>Assigned AI assistant</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>active|inactive|pending|error</div>
                                </div>
                                <div class="table-row">
                                    <div>webhookUrl</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Webhook callback URL</div>
                                </div>
                                <div class="table-row">
                                    <div>configuration</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Channel-specific settings</div>
                                </div>
                                <div class="table-row">
                                    <div>connectedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Connection timestamp</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table" style="margin-top: 20px;">
                            <div class="table-header">TABLE: channel_credentials</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Credential identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>channelId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí channels(id)</div>
                                    <div>Linked channel</div>
                                </div>
                                <div class="table-row">
                                    <div>credentialType</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>oauth_token|api_key|access_token</div>
                                </div>
                                <div class="table-row">
                                    <div>encryptedValue</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>AES-256 encrypted credential</div>
                                </div>
                                <div class="table-row">
                                    <div>expiresAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>OAuth token expiry</div>
                                </div>
                                <div class="table-row">
                                    <div>refreshToken</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>OAuth refresh token (encrypted)</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Credential creation time</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table" style="margin-top: 30px;">
                            <div class="table-header">üìã CHANNEL CONFIGURATION JSONB SCHEMAS</div>
                            <div class="table-body" style="padding: 20px; background: #f8f9fa;">
                                <div style="margin-bottom: 25px;">
                                    <h4 style="color: #2c5530; margin-bottom: 10px;">üìß Email Channels (Gmail, Outlook, SMTP)</h4>
                                    <pre style="background: #fff; padding: 15px; border-radius: 5px; font-size: 0.85em; overflow-x: auto;">{
  "provider": "gmail|outlook|smtp",
  "emailAddress": "support@company.com",
  "displayName": "Company Support",
  "signature": "HTML email signature",
  "autoReply": {
    "enabled": true,
    "template": "Thank you for contacting us...",
    "businessHoursOnly": true
  },
  "threading": {
    "enabled": true,
    "maxThreadDepth": 10
  },
  "filters": {
    "spamFiltering": true,
    "blockedDomains": ["spam.com"],
    "requiredSubjectKeywords": []
  },
  "smtp": {
    "host": "smtp.gmail.com",
    "port": 587,
    "encryption": "tls"
  }
}</pre>
                                </div>

                                <div style="margin-bottom: 25px;">
                                    <h4 style="color: #2c5530; margin-bottom: 10px;">‚úàÔ∏è Telegram Bot</h4>
                                    <pre style="background: #fff; padding: 15px; border-radius: 5px; font-size: 0.85em; overflow-x: auto;">{
  "botUsername": "@companybot",
  "welcomeMessage": "Welcome! How can I help you?",
  "commands": [
    {"command": "/start", "description": "Start conversation"},
    {"command": "/help", "description": "Get help"}
  ],
  "inlineKeyboard": {
    "enabled": true,
    "buttons": [
      {"text": "Contact Support", "callback_data": "support"}
    ]
  },
  "mediaHandling": {
    "allowPhotos": true,
    "allowDocuments": true,
    "maxFileSize": 20971520
  }
}</pre>
                                </div>

                                <div style="margin-bottom: 25px;">
                                    <h4 style="color: #2c5530; margin-bottom: 10px;">üíº LinkedIn Messaging</h4>
                                    <pre style="background: #fff; padding: 15px; border-radius: 5px; font-size: 0.85em; overflow-x: auto;">{
  "profileId": "urn:li:person:xxxxx",
  "companyPageId": "urn:li:organization:xxxxx",
  "autoAcceptConnections": false,
  "welcomeMessage": "Thanks for connecting!",
  "rateLimits": {
    "maxMessagesPerDay": 100,
    "maxConnectionRequestsPerWeek": 100
  },
  "profileEnrichment": {
    "fetchJobTitle": true,
    "fetchCompany": true
  }
}</pre>
                                </div>

                                <div style="margin-bottom: 25px;">
                                    <h4 style="color: #2c5530; margin-bottom: 10px;">üõçÔ∏è Shopify + üí≥ Stripe + üí∞ PayPal</h4>
                                    <pre style="background: #fff; padding: 15px; border-radius: 5px; font-size: 0.85em; overflow-x: auto;">// Shopify
{
  "shopDomain": "mystore.myshopify.com",
  "notifications": {
    "orderCreated": {"enabled": true, "template": "Order confirmed"},
    "orderShipped": {"enabled": true, "includeTracking": true},
    "abandonedCart": {"enabled": true, "delayMinutes": 60}
  }
}

// Stripe
{
  "accountId": "acct_xxxxx",
  "notifications": {
    "paymentSucceeded": {"enabled": true},
    "paymentFailed": {"enabled": true, "alertTeam": true},
    "subscriptionRenewal": {"daysBeforeRenewal": 7}
  }
}

// PayPal
{
  "merchantId": "merchant_xxxxx",
  "environment": "live|sandbox",
  "notifications": {
    "paymentCompleted": {"enabled": true},
    "disputeCreated": {"alertTeam": true}
  }
}</pre>
                                </div>

                                <div style="margin-bottom: 25px;">
                                    <h4 style="color: #2c5530; margin-bottom: 10px;">üìÖ Calendly + üé• Zoom</h4>
                                    <pre style="background: #fff; padding: 15px; border-radius: 5px; font-size: 0.85em; overflow-x: auto;">// Calendly
{
  "organizationUri": "https://api.calendly.com/organizations/xxxxx",
  "notifications": {
    "bookingConfirmed": {
      "enabled": true,
      "sendReminders": true,
      "reminderMinutesBefore": [1440, 60]
    }
  }
}

// Zoom
{
  "accountId": "xxxxx",
  "notifications": {
    "meetingScheduled": {"enabled": true, "includeJoinLink": true},
    "recordingAvailable": {"enabled": true, "expiryDays": 30},
    "meetingReminder": {"minutesBefore": [60, 15]}
  },
  "meetingDefaults": {
    "autoRecording": "cloud",
    "waitingRoom": true
  }
}</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">
                        üõ°Ô∏è SWIM LANE 5: GDPR COMPLIANCE REFERENCES
                    </div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">
                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> Third-Party Data Processors</h3>
                                <div class="gdpr-section">
                                    <strong>Article 28: Data Processing Agreements</strong>
                                    <strong style="color: #333; font-weight: 400;">Processors:</strong><br>
                                    ‚Ä¢ Meta (WhatsApp, Facebook, Instagram)<br>
                                    ‚Ä¢ Twilio (SMS)<br>
                                    ‚Ä¢ Telegram (Bot API)<br>
                                    ‚Ä¢ LinkedIn (Messaging API)<br>
                                    ‚Ä¢ Google (Workspace/Gmail)<br>
                                    ‚Ä¢ Microsoft (Outlook/365)<br>
                                    ‚Ä¢ Shopify (E-commerce)<br>
                                    ‚Ä¢ Stripe (Payments)<br>
                                    ‚Ä¢ PayPal (Payments)<br>
                                    ‚Ä¢ Calendly (Scheduling)<br>
                                    ‚Ä¢ Zoom (Meetings)<br><br>
                                    <strong style="color: #333; font-weight: 400;">Requirements:</strong><br>
                                    ‚Ä¢ DPA signed with each processor<br>
                                    ‚Ä¢ GDPR-compliant data handling<br>
                                    ‚Ä¢ EU data residency options where available
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 28: Processor Requirements
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> Customer Message Data</h3>
                                <div class="gdpr-section">
                                    <strong>Data Minimization Principle</strong>
                                    <strong style="color: #333; font-weight: 400;">Data Collected:</strong><br>
                                    ‚Ä¢ Customer messages (minimal)<br>
                                    ‚Ä¢ Sender ID / Phone number<br>
                                    ‚Ä¢ Message metadata<br><br>
                                    <strong style="color: #333; font-weight: 400;">Purpose:</strong> Provide customer support service<br>
                                    <strong style="color: #333; font-weight: 400;">Retention:</strong> 90 days (configurable)
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Data Minimization"
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> Encrypted Credentials Storage</h3>
                                <div class="gdpr-section">
                                    <strong>Security Measure: Article 32</strong>
                                    <strong style="color: #333; font-weight: 400;">Encryption:</strong><br>
                                    ‚Ä¢ OAuth tokens: AES-256 encrypted<br>
                                    ‚Ä¢ API keys: AWS Secrets Manager (KMS)<br>
                                    ‚Ä¢ At-rest encryption for all credentials<br><br>
                                    <strong style="color: #333; font-weight: 400;">Access Control:</strong> IAM role-based
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 32: Security of Processing
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 6: STEP 5 -->

            <!-- FRAME 7: STEP 6 - PER-CHANNEL AI CONFIGURATION -->
            <div class="frame" id="frame7">
                <div class="frame-title">
                    STEP 6: PER-CHANNEL AI CONFIGURATION
                </div>
                <div class="frame-subtitle">
                    AI Assistant Selection + Follow-Up Triggers + Escalation Rules + BeeBot Nudges + AI Behavior Settings + Access Permissions
                </div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #D4E9E2;"></div>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FFF9E6;"></div>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #B7E4C7;"></div>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">
                        üë§ SWIM LANE 1: USER ACTIONS
                    </div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Select AI Assistant & Industry Type</h3>
                                <ul>
                                    <li>Choose AI Assistant (SupportBot, Professional, Detailed, Receptionist)</li>
                                    <li>Select Industry Type (Tech Support/SaaS, E-commerce, etc.)</li>
                                    <li>Enable Smart Suggestions by BeeBot (AI recommendations)</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Configure Escalation Rules</h3>
                                <ul>
                                    <li>Escalate after (5) unanswered messages</li>
                                    <li>Escalate on keyword (Fire, Emergency, Police)</li>
                                    <li>Escalate after no reply in (10 minutes)</li>
                                    <li>Select backup escalation contact (All team members)</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Setup Follow-Up Triggers</h3>
                                <ul>
                                    <li>Enable Follow-Up (toggle on/off)</li>
                                    <li>Delay Before Follow-Up (<10 Sec)</li>
                                    <li>Follow-Up Content Type (Sales/Support/Custom)</li>
                                    <li>Smart Suggestions: Use recommended settings</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. AI Behavior Settings (Timing)</h3>
                                <ul>
                                    <li>AI reply delay (5 Mins)</li>
                                    <li>Working Days (Monday - Friday)</li>
                                    <li>Select timezone (UTC+1:00)</li>
                                    <li>Opening Hours (09:00 AM) & Closing Hours (06:00 PM)</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>5. Access Permissions</h3>
                                <ul>
                                    <li>Select team members with channel access</li>
                                    <li>Assign roles (Admin, Manager, Agent, Viewer)</li>
                                    <li>Set "All Team Members" for shared access</li>
                                    <li>Configure per-channel permissions</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>6. Review & Save Configuration</h3>
                                <ul>
                                    <li>Review all AI configuration settings</li>
                                    <li>Test AI behavior per channel</li>
                                    <li>Apply configuration to selected channels</li>
                                    <li>Monitor AI performance & adjust settings</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">
                        ‚öôÔ∏è SWIM LANE 2: BACKEND SERVICES TRIGGERED
                    </div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">
                            <div class="service-card">
                                <h3><span class="service-icon">‚öôÔ∏è</span> Channel Configuration Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ PATCH /channels/:id/config<br>
                                        ‚Ä¢ POST /channels/:id/templates<br>
                                        ‚Ä¢ GET /channels/:id/config<br>
                                        ‚Ä¢ POST /channels/:id/test-config
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Business hours management<br>
                                        ‚Ä¢ Template storage & retrieval<br>
                                        ‚Ä¢ Configuration validation<br>
                                        ‚Ä¢ Real-time config updates
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">‚è∞</span> Business Hours Service</h3>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Timezone conversion<br>
                                        ‚Ä¢ Holiday calendar management<br>
                                        ‚Ä¢ Working hours validation<br>
                                        ‚Ä¢ Real-time availability check
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ GET /business-hours/is-available<br>
                                        ‚Ä¢ POST /business-hours/holidays
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üìù</span> Template Management Service</h3>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Template CRUD operations<br>
                                        ‚Ä¢ Variable replacement {name}<br>
                                        ‚Ä¢ Multi-language support<br>
                                        ‚Ä¢ Template versioning
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Template Types:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Greeting templates<br>
                                        ‚Ä¢ After-hours templates<br>
                                        ‚Ä¢ FAQ templates<br>
                                        ‚Ä¢ Escalation templates
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üîÑ</span> Follow-Up Automation Service</h3>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Automated follow-up triggers<br>
                                        ‚Ä¢ Delay before follow-up (configurable)<br>
                                        ‚Ä¢ Follow-up content type (Sales/Support/Custom)<br>
                                        ‚Ä¢ Smart Suggestions by BeeBot<br>
                                        ‚Ä¢ Multi-step follow-up sequences
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Trigger Conditions:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Customer initiated conversation<br>
                                        ‚Ä¢ No response from customer (X hours)<br>
                                        ‚Ä¢ Conversation marked as pending<br>
                                        ‚Ä¢ Keyword-based triggers<br>
                                        ‚Ä¢ Business hours aware
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /channels/:id/follow-up-rules<br>
                                        ‚Ä¢ GET /channels/:id/follow-up-rules<br>
                                        ‚Ä¢ PATCH /follow-up-rules/:ruleId<br>
                                        ‚Ä¢ POST /follow-up-rules/:ruleId/trigger<br>
                                        ‚Ä¢ GET /follow-ups/pending
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">‚ö†Ô∏è</span> Escalation Rules Service</h3>
                                <div class="section">
                                    <div class="section-title">Escalation Triggers:</div>
                                    <div class="section-content">
                                        ‚Ä¢ After X unanswered messages (configurable: 3, 5, 10)<br>
                                        ‚Ä¢ After no reply in X time (10min, 30min, 1hr, 24hr)<br>
                                        ‚Ä¢ Keyword detection (Fire, Emergency, Police, etc.)<br>
                                        ‚Ä¢ Customer sentiment analysis (angry, frustrated)<br>
                                        ‚Ä¢ VIP customer detection
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Escalation Actions:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Assign to specific team member<br>
                                        ‚Ä¢ Assign to inbox (all team members)<br>
                                        ‚Ä¢ Select backup escalation contact<br>
                                        ‚Ä¢ Send notification (email/SMS/Slack)<br>
                                        ‚Ä¢ Auto-tag conversation as "Escalated"
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /channels/:id/escalation-rules<br>
                                        ‚Ä¢ GET /channels/:id/escalation-rules<br>
                                        ‚Ä¢ PATCH /escalation-rules/:ruleId<br>
                                        ‚Ä¢ POST /conversations/:id/escalate<br>
                                        ‚Ä¢ GET /escalations/active
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üí°</span> BeeBot Nudges (Smart Suggestions)</h3>
                                <div class="section">
                                    <div class="section-title">Recommendation Engine:</div>
                                    <div class="section-content">
                                        ‚Ä¢ AI-powered settings recommendations<br>
                                        ‚Ä¢ Based on My Plan (Individual/Business/Premium/Organisation)<br>
                                        ‚Ä¢ Based on Business Type (Tech Support, SaaS, E-commerce)<br>
                                        ‚Ä¢ Industry best practices database<br>
                                        ‚Ä¢ A/B testing optimization suggestions
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Smart Suggestions:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Optimal AI reply delay (5sec, 10sec, 30sec)<br>
                                        ‚Ä¢ Recommended working days/hours<br>
                                        ‚Ä¢ Escalation thresholds (unanswered messages count)<br>
                                        ‚Ä¢ Follow-up timing (24 hours for support, 48 hours for sales)<br>
                                        ‚Ä¢ Tone profile recommendations (Professional, Friendly, Technical)
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ GET /channels/:id/smart-suggestions<br>
                                        ‚Ä¢ POST /channels/:id/apply-suggestion<br>
                                        ‚Ä¢ GET /suggestions/templates/:industry<br>
                                        ‚Ä¢ POST /feedback/suggestion/:id
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üîê</span> Access Permissions Service</h3>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Per-channel access control<br>
                                        ‚Ä¢ Role-based permissions (Admin, Manager, Agent, Viewer)<br>
                                        ‚Ä¢ Team member assignment to channels<br>
                                        ‚Ä¢ "All Team Members" option for shared access<br>
                                        ‚Ä¢ Permission inheritance from organization roles
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Permission Levels:</div>
                                    <div class="section-content">
                                        ‚Ä¢ <strong>Admin:</strong> Full config + conversation access<br>
                                        ‚Ä¢ <strong>Manager:</strong> View config + manage conversations<br>
                                        ‚Ä¢ <strong>Agent:</strong> Respond to conversations only<br>
                                        ‚Ä¢ <strong>Viewer:</strong> Read-only access
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /channels/:id/permissions<br>
                                        ‚Ä¢ GET /channels/:id/permissions<br>
                                        ‚Ä¢ PATCH /channels/:id/permissions/:userId<br>
                                        ‚Ä¢ DELETE /channels/:id/permissions/:userId<br>
                                        ‚Ä¢ GET /users/:id/accessible-channels
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">
                        ‚òÅÔ∏è SWIM LANE 3: AWS INFRASTRUCTURE USED
                    </div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">
                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate
                                </h4>
                                <div class="section-content">
                                    <strong>Services:</strong><br>
                                    ‚Ä¢ Channel Configuration Service<br>
                                    ‚Ä¢ Follow-Up Automation Service<br>
                                    ‚Ä¢ Escalation Rules Service<br>
                                    ‚Ä¢ BeeBot Nudges Service<br>
                                    ‚Ä¢ Access Permissions Service<br><br>
                                    <strong>Configuration:</strong><br>
                                    ‚Ä¢ Tasks: 2-8 (per service)<br>
                                    ‚Ä¢ CPU: 1 vCPU<br>
                                    ‚Ä¢ RAM: 2GB
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL
                                </h4>
                                <div class="section-content">
                                    <strong>Tables:</strong><br>
                                    ‚Ä¢ channel_configurations<br>
                                    ‚Ä¢ response_templates<br>
                                    ‚Ä¢ business_hours<br>
                                    ‚Ä¢ follow_up_rules<br>
                                    ‚Ä¢ escalation_rules<br>
                                    ‚Ä¢ channel_permissions<br><br>
                                    <strong>Port:</strong> 5432
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    ‚Ä¢ Config cache<br>
                                    ‚Ä¢ Template cache<br><br>
                                    <strong>TTL:</strong><br>
                                    ‚Ä¢ 30 minutes (hot reload)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">
                        üóÑÔ∏è SWIM LANE 4: DATA STORAGE (PostgreSQL Schema)
                    </div>
                    <div class="lane-content lane-data">
                        <div class="db-table">
                            <div class="table-header">TABLE: channel_configurations</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Configuration identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>channelId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí channels(id)</div>
                                    <div>Linked channel</div>
                                </div>
                                <div class="table-row">
                                    <div>businessHours</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>{monday: "9-17", timezone: "UTC"}</div>
                                </div>
                                <div class="table-row">
                                    <div>autoGreeting</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Send auto greeting</div>
                                </div>
                                <div class="table-row">
                                    <div>greetingTemplateId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí response_templates(id)</div>
                                    <div>Greeting template</div>
                                </div>
                                <div class="table-row">
                                    <div>afterHoursTemplateId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí response_templates(id)</div>
                                    <div>After-hours template</div>
                                </div>
                                <div class="table-row">
                                    <div>maxResponseLength</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 500</div>
                                    <div>Character limit per message</div>
                                </div>
                                <div class="table-row">
                                    <div>escalationRules</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Escalation trigger conditions</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table" style="margin-top: 30px;">
                            <div class="table-header">TABLE: follow_up_rules</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Follow-up rule identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>channelId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí channels(id)</div>
                                    <div>Linked channel</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí organizations(id)</div>
                                    <div>Owner organization</div>
                                </div>
                                <div class="table-row">
                                    <div>isEnabled</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Toggle follow-up on/off</div>
                                </div>
                                <div class="table-row">
                                    <div>delayHours</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 24</div>
                                    <div>Hours before follow-up (24, 48, 72)</div>
                                </div>
                                <div class="table-row">
                                    <div>contentType</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>sales|support|custom</div>
                                </div>
                                <div class="table-row">
                                    <div>followUpMessage</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>Follow-up message template</div>
                                </div>
                                <div class="table-row">
                                    <div>triggerConditions</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>{"noCustomerReply": true, "keywords": []}</div>
                                </div>
                                <div class="table-row">
                                    <div>businessHoursOnly</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Only send during business hours</div>
                                </div>
                                <div class="table-row">
                                    <div>maxFollowUps</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 2</div>
                                    <div>Max follow-ups per conversation</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Rule creation timestamp</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table" style="margin-top: 30px;">
                            <div class="table-header">TABLE: escalation_rules</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Escalation rule identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>channelId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí channels(id)</div>
                                    <div>Linked channel</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí organizations(id)</div>
                                    <div>Owner organization</div>
                                </div>
                                <div class="table-row">
                                    <div>isEnabled</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Toggle escalation on/off</div>
                                </div>
                                <div class="table-row">
                                    <div>unansweredMessageCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 5</div>
                                    <div>Escalate after X unanswered (3, 5, 10)</div>
                                </div>
                                <div class="table-row">
                                    <div>noReplyMinutes</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 10</div>
                                    <div>Escalate after X minutes (10, 30, 60, 1440)</div>
                                </div>
                                <div class="table-row">
                                    <div>keywordTriggers</div>
                                    <div>TEXT[]</div>
                                    <div>DEFAULT ARRAY[]::TEXT[]</div>
                                    <div>["fire", "emergency", "police", "urgent"]</div>
                                </div>
                                <div class="table-row">
                                    <div>sentimentTrigger</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Escalate on negative sentiment</div>
                                </div>
                                <div class="table-row">
                                    <div>assignToUserId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí users(id), NULLABLE</div>
                                    <div>Specific team member to assign</div>
                                </div>
                                <div class="table-row">
                                    <div>assignToInbox</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Assign to all team members</div>
                                </div>
                                <div class="table-row">
                                    <div>backupEscalationUserId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí users(id), NULLABLE</div>
                                    <div>Backup contact if primary unavailable</div>
                                </div>
                                <div class="table-row">
                                    <div>notificationChannels</div>
                                    <div>TEXT[]</div>
                                    <div>DEFAULT ARRAY['email']::TEXT[]</div>
                                    <div>["email", "sms", "slack"]</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Rule creation timestamp</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table" style="margin-top: 30px;">
                            <div class="table-header">TABLE: channel_permissions</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Permission identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>channelId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí channels(id)</div>
                                    <div>Linked channel</div>
                                </div>
                                <div class="table-row">
                                    <div>userId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí users(id)</div>
                                    <div>Team member with access</div>
                                </div>
                                <div class="table-row">
                                    <div>permissionLevel</div>
                                    <div>VARCHAR(20)</div>
                                    <div>NOT NULL</div>
                                    <div>admin|manager|agent|viewer</div>
                                </div>
                                <div class="table-row">
                                    <div>canViewConfig</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Can view channel configuration</div>
                                </div>
                                <div class="table-row">
                                    <div>canEditConfig</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Can edit channel configuration</div>
                                </div>
                                <div class="table-row">
                                    <div>canViewConversations</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Can view conversations</div>
                                </div>
                                <div class="table-row">
                                    <div>canReply</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Can reply to conversations</div>
                                </div>
                                <div class="table-row">
                                    <div>grantedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Permission grant timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>grantedBy</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí users(id)</div>
                                    <div>User who granted permission</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">
                        üõ°Ô∏è SWIM LANE 5: GDPR COMPLIANCE REFERENCES
                    </div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">
                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> Template Data Processing</h3>
                                <div class="gdpr-section">
                                    <strong>User-Generated Templates</strong>
                                    <strong style="color: #333; font-weight: 400;">Data:</strong> Message templates may contain placeholders like {customer_name}<br>
                                    <strong style="color: #333; font-weight: 400;">Processing:</strong> Variables replaced with actual customer data at runtime<br>
                                    <strong style="color: #333; font-weight: 400;">GDPR:</strong> Minimal personal data usage
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Data Minimization"
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> Configuration Data Storage</h3>
                                <div class="gdpr-section">
                                    <strong>Settings Not Personal Data</strong>
                                    <strong style="color: #333; font-weight: 400;">Stored:</strong> Business hours, templates, AI behavior<br>
                                    <strong style="color: #333; font-weight: 400;">Classification:</strong> Non-personal business configuration<br>
                                    <strong style="color: #333; font-weight: 400;">Retention:</strong> Lifetime of organization account
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "What We Collect"
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> Customer Data in Variables</h3>
                                <div class="gdpr-section">
                                    <strong>Runtime Variable Replacement</strong>
                                    <strong style="color: #333; font-weight: 400;">Variables:</strong> {name}, {email}, {order_id}<br>
                                    <strong style="color: #333; font-weight: 400;">Storage:</strong> Not stored in templates (runtime only)<br>
                                    <strong style="color: #333; font-weight: 400;">Compliance:</strong> Data minimization principle
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 5: Data Processing Principles
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 7: STEP 6 -->

            <!-- FRAME 8: STEP 7 - WEB CHAT SETUP -->
            <div class="frame" id="frame8">
                <div class="frame-title">
                    STEP 7: WEB CHAT SETUP
                </div>
                <div class="frame-subtitle">
                    Widget Configuration + Embed Code Generation + Branding + Domain Allowlist Security (XSS Protection) + Chat Customization
                </div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #D4E9E2;"></div>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FFF9E6;"></div>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #B7E4C7;"></div>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">
                        üë§ SWIM LANE 1: USER ACTIONS
                    </div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Customize Widget</h3>
                                <ul>
                                    <li>Widget position (bottom-right/left)</li>
                                    <li>Brand colors & theme</li>
                                    <li>Welcome message text</li>
                                    <li>Avatar/logo upload</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Configure Behavior</h3>
                                <ul>
                                    <li>Auto-open settings</li>
                                    <li>Show/hide on mobile</li>
                                    <li>Proactive messages</li>
                                    <li>Typing indicators</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Generate Embed Code</h3>
                                <ul>
                                    <li>Copy JavaScript snippet</li>
                                    <li>Installation instructions</li>
                                    <li>Widget ID assignment (unique UUID)</li>
                                </ul>
                            </div>
                            <div class="step-box" style="border: 2px solid #FF6B6B; background: #FFF5F5;">
                                <h3>4. Domain Allowlist Security üîí</h3>
                                <ul>
                                    <li><strong>Add authorized domains:</strong> example.com</li>
                                    <li><strong>Wildcard subdomains:</strong> *.example.com</li>
                                    <li><strong>Test domain verification</strong> before go-live</li>
                                    <li><strong>Security:</strong> Blocks XSS attacks & widget hijacking</li>
                                    <li><strong>Monitor:</strong> View blocked unauthorized attempts</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>5. Install & Test</h3>
                                <ul>
                                    <li>Paste code in website <code>&lt;head&gt;</code> or <code>&lt;body&gt;</code></li>
                                    <li>Test widget appearance on allowed domain</li>
                                    <li>Verify AI responses work correctly</li>
                                    <li>Check security: Try loading from unauthorized domain (should block)</li>
                                    <li>Go live</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">
                        ‚öôÔ∏è SWIM LANE 2: BACKEND SERVICES TRIGGERED
                    </div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">
                            <div class="service-card">
                                <h3><span class="service-icon">üí¨</span> Widget Configuration Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /widgets<br>
                                        ‚Ä¢ PATCH /widgets/:id<br>
                                        ‚Ä¢ GET /widgets/:id/embed-code<br>
                                        ‚Ä¢ POST /widgets/:id/preview
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Widget customization<br>
                                        ‚Ä¢ Embed code generation<br>
                                        ‚Ä¢ Domain validation<br>
                                        ‚Ä¢ Real-time preview
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üåê</span> Widget SDK Service</h3>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ JavaScript SDK hosting<br>
                                        ‚Ä¢ WebSocket connections<br>
                                        ‚Ä¢ Real-time messaging<br>
                                        ‚Ä¢ Message encryption (TLS)
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">SDK Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ /sdk/widget.js (CDN)<br>
                                        ‚Ä¢ wss://chat.unifiedbeez.com<br>
                                        ‚Ä¢ POST /api/v1/widget/messages
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">üé®</span> Branding Service</h3>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Custom CSS injection<br>
                                        ‚Ä¢ Logo/avatar management<br>
                                        ‚Ä¢ Color theme validation<br>
                                        ‚Ä¢ Preview generation
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Customizable Elements:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Primary/secondary colors<br>
                                        ‚Ä¢ Font family<br>
                                        ‚Ä¢ Border radius<br>
                                        ‚Ä¢ Widget size
                                    </div>
                                </div>
                            </div>

                            <div class="service-card" style="border: 3px solid #FF6B6B; background: #FFF5F5;">
                                <h3><span class="service-icon">üîí</span> Domain Allowlist Security Service <span style="color: #FF6B6B; font-weight: bold;">[CRITICAL]</span></h3>
                                <div class="section">
                                    <div class="section-title">XSS Protection Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Domain whitelist validation (CORS)<br>
                                        ‚Ä¢ Referrer header verification<br>
                                        ‚Ä¢ Origin header validation<br>
                                        ‚Ä¢ Wildcard subdomain support (*.example.com)<br>
                                        ‚Ä¢ Real-time domain verification on widget load<br>
                                        ‚Ä¢ Automatic blocking of unauthorized domains
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Security Workflow:</div>
                                    <div class="section-content">
                                        <strong>1. Widget Load Request:</strong><br>
                                        &nbsp;&nbsp;‚Üí Extract Origin/Referer header<br>
                                        &nbsp;&nbsp;‚Üí Query allowlist: SELECT * FROM widget_domains WHERE widgetId = ? AND domain = ?<br>
                                        &nbsp;&nbsp;‚Üí If NOT FOUND ‚Üí Return 403 Forbidden + Log attempt<br>
                                        &nbsp;&nbsp;‚Üí If FOUND ‚Üí Serve widget.js with CORS headers<br><br>
                                        <strong>2. WebSocket Connection:</strong><br>
                                        &nbsp;&nbsp;‚Üí Validate Origin header against allowlist<br>
                                        &nbsp;&nbsp;‚Üí Reject connection if domain not whitelisted<br><br>
                                        <strong>3. API Requests:</strong><br>
                                        &nbsp;&nbsp;‚Üí Verify widgetId + domain combination<br>
                                        &nbsp;&nbsp;‚Üí Rate limiting per domain (1000 req/min)
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Threat Prevention:</div>
                                    <div class="section-content">
                                        ‚Ä¢ <strong>XSS Attack:</strong> Prevents malicious sites from embedding widget<br>
                                        ‚Ä¢ <strong>Widget Hijacking:</strong> Blocks unauthorized domain usage<br>
                                        ‚Ä¢ <strong>Data Theft:</strong> Prevents conversation data leakage<br>
                                        ‚Ä¢ <strong>Brand Abuse:</strong> Stops widget use on competitor sites<br>
                                        ‚Ä¢ <strong>DDoS via Widget:</strong> Rate limits per allowed domain
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        ‚Ä¢ POST /widgets/:id/domains (Add domain to allowlist)<br>
                                        ‚Ä¢ GET /widgets/:id/domains (List allowed domains)<br>
                                        ‚Ä¢ DELETE /widgets/:id/domains/:domainId (Remove domain)<br>
                                        ‚Ä¢ POST /widgets/:id/domains/verify (Test domain access)<br>
                                        ‚Ä¢ GET /widgets/:id/blocked-attempts (Security logs)
                                    </div>
                                </div>
                                <div class="section" style="background: #FFE5E5; padding: 10px; border-radius: 5px; margin-top: 10px;">
                                    <div class="section-title" style="color: #C92A2A;">‚ö†Ô∏è Security Implementation:</div>
                                    <div class="section-content" style="color: #5C2020;">
                                        <strong>Middleware (NestJS Guard):</strong><br>
                                        <code style="background: white; padding: 2px 6px; border-radius: 3px; font-size: 0.85em;">@UseGuards(DomainAllowlistGuard)</code><br>
                                        Applied to ALL widget SDK endpoints<br><br>
                                        <strong>Response Headers:</strong><br>
                                        ‚Ä¢ Access-Control-Allow-Origin: https://example.com<br>
                                        ‚Ä¢ Content-Security-Policy: frame-ancestors 'self' https://example.com<br>
                                        ‚Ä¢ X-Frame-Options: ALLOW-FROM https://example.com
                                    </div>
                                </div>
                            </div>

                            <div class="service-card" style="border: 2px solid #52B788; background: #F0FFF4;">
                                <h3><span class="service-icon">üè∑Ô∏è</span> Label Management Service</h3>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Create custom labels per organization<br>
                                        ‚Ä¢ Apply multiple labels to conversations<br>
                                        ‚Ä¢ Filter conversations by labels<br>
                                        ‚Ä¢ Label auto-assignment via rules<br>
                                        ‚Ä¢ AI-suggested labels based on content<br>
                                        ‚Ä¢ Bulk label operations<br>
                                        ‚Ä¢ Label analytics (most used, trending)
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Label Categories:</div>
                                    <div class="section-content">
                                        ‚Ä¢ <strong>Sales:</strong> Hot Lead, Follow-up Required, Closed Won, Closed Lost<br>
                                        ‚Ä¢ <strong>Support:</strong> Bug, Feature Request, Question, Escalated, Resolved<br>
                                        ‚Ä¢ <strong>Priority:</strong> Urgent, High Priority, Normal, Low Priority<br>
                                        ‚Ä¢ <strong>Status:</strong> Open, In Progress, Waiting on Customer, Completed<br>
                                        ‚Ä¢ <strong>Channel:</strong> WhatsApp, Email, Instagram, Facebook<br>
                                        ‚Ä¢ <strong>Custom:</strong> User-defined labels with colors
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        <strong>Label Management:</strong><br>
                                        ‚Ä¢ POST /labels - Create new label<br>
                                        ‚Ä¢ GET /labels - List all organization labels<br>
                                        ‚Ä¢ GET /labels/:id - Get label details<br>
                                        ‚Ä¢ PATCH /labels/:id - Update label<br>
                                        ‚Ä¢ DELETE /labels/:id - Delete label<br><br>
                                        <strong>Label Assignment:</strong><br>
                                        ‚Ä¢ POST /conversations/:id/labels - Apply label to conversation<br>
                                        ‚Ä¢ DELETE /conversations/:id/labels/:labelId - Remove label<br>
                                        ‚Ä¢ GET /conversations/:id/labels - Get conversation labels<br>
                                        ‚Ä¢ POST /conversations/bulk-label - Apply label to multiple conversations<br><br>
                                        <strong>Label Filtering:</strong><br>
                                        ‚Ä¢ GET /conversations?labelIds=1,2,3 - Filter by labels<br>
                                        ‚Ä¢ GET /labels/:id/conversations - Get all conversations with label<br>
                                        ‚Ä¢ GET /labels/stats - Label usage statistics
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Auto-Labeling Rules:</div>
                                    <div class="section-content">
                                        ‚Ä¢ <strong>Keyword-based:</strong> "refund" ‚Üí Apply "Billing" label<br>
                                        ‚Ä¢ <strong>Sentiment-based:</strong> Negative sentiment ‚Üí Apply "Escalated" label<br>
                                        ‚Ä¢ <strong>Channel-based:</strong> WhatsApp messages ‚Üí Apply "WhatsApp" label<br>
                                        ‚Ä¢ <strong>AI-powered:</strong> OpenAI categorization ‚Üí Suggest relevant labels<br>
                                        ‚Ä¢ <strong>Time-based:</strong> No response >24hrs ‚Üí Apply "Stale" label
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Bulk Operations:</div>
                                    <div class="section-content">
                                        ‚Ä¢ Apply label to filtered conversations<br>
                                        ‚Ä¢ Remove label from multiple conversations<br>
                                        ‚Ä¢ Replace labels (remove old, apply new)<br>
                                        ‚Ä¢ Export labeled conversations (CSV, Excel)<br>
                                        ‚Ä¢ Scheduled label cleanup (remove unused labels)
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">
                        ‚òÅÔ∏è SWIM LANE 3: AWS INFRASTRUCTURE USED
                    </div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">
                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Networking-Content-Delivery/CloudFront.svg" alt="CloudFront" class="aws-icon">
                                    CloudFront
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    ‚Ä¢ Widget SDK distribution<br>
                                    ‚Ä¢ Global CDN delivery<br><br>
                                    <strong>File:</strong><br>
                                    ‚Ä¢ /sdk/widget.js<br>
                                    ‚Ä¢ Cache: 24 hours
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate
                                </h4>
                                <div class="section-content">
                                    <strong>Services:</strong><br>
                                    ‚Ä¢ Widget API Service<br>
                                    ‚Ä¢ WebSocket Server<br><br>
                                    <strong>Configuration:</strong><br>
                                    ‚Ä¢ Tasks: 5-50 (auto-scaling)<br>
                                    ‚Ä¢ CPU: 1 vCPU<br>
                                    ‚Ä¢ RAM: 2GB
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL
                                </h4>
                                <div class="section-content">
                                    <strong>Tables:</strong><br>
                                    ‚Ä¢ widgets<br>
                                    ‚Ä¢ widget_domains <span style="color: #FF6B6B; font-weight: bold;">[SECURITY]</span><br>
                                    ‚Ä¢ widget_blocked_attempts <span style="color: #FF6B6B; font-weight: bold;">[AUDIT]</span><br>
                                    ‚Ä¢ conversation_labels <span style="color: #52B788; font-weight: bold;">[NEW]</span><br>
                                    ‚Ä¢ conversation_label_assignments <span style="color: #52B788; font-weight: bold;">[NEW]</span><br>
                                    ‚Ä¢ widget_sessions<br>
                                    ‚Ä¢ chat_messages<br><br>
                                    <strong>Port:</strong> 5432
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Storage/Simple-Storage-Service.svg" alt="S3" class="aws-icon">
                                    S3 Bucket
                                </h4>
                                <div class="section-content">
                                    <strong>Bucket:</strong><br>
                                    ‚Ä¢ unifiedbeez-widget-assets<br><br>
                                    <strong>Stored:</strong><br>
                                    ‚Ä¢ Custom avatars/logos<br>
                                    ‚Ä¢ widget.js SDK file
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    ‚Ä¢ WebSocket session store<br>
                                    ‚Ä¢ Real-time message queue<br><br>
                                    <strong>TTL:</strong> Session: 24 hours
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">
                        üóÑÔ∏è SWIM LANE 4: DATA STORAGE (PostgreSQL Schema)
                    </div>
                    <div class="lane-content lane-data">
                        <div class="db-table">
                            <div class="table-header">TABLE: widgets</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Widget identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí organizations(id)</div>
                                    <div>Linked organization</div>
                                </div>
                                <div class="table-row">
                                    <div>widgetId</div>
                                    <div>VARCHAR(255)</div>
                                    <div>UNIQUE, NOT NULL</div>
                                    <div>Public widget ID (UUID)</div>
                                </div>
                                <div class="table-row">
                                    <div>widgetName</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>User-friendly name</div>
                                </div>
                                <div class="table-row">
                                    <div>position</div>
                                    <div>VARCHAR(50)</div>
                                    <div>DEFAULT 'bottom-right'</div>
                                    <div>bottom-right|bottom-left</div>
                                </div>
                                <div class="table-row">
                                    <div>primaryColor</div>
                                    <div>VARCHAR(7)</div>
                                    <div>NOT NULL</div>
                                    <div>Hex color (e.g., #1A4D2E)</div>
                                </div>
                                <div class="table-row">
                                    <div>welcomeMessage</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>Initial greeting text</div>
                                </div>
                                <div class="table-row">
                                    <div>avatarUrl</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>S3 CDN path to avatar</div>
                                </div>
                                <div class="table-row">
                                    <div>allowedDomains</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>["example.com", "*.example.com"]</div>
                                </div>
                                <div class="table-row">
                                    <div>aiAssistantId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí ai_assistants(id)</div>
                                    <div>Assigned AI for webchat</div>
                                </div>
                                <div class="table-row">
                                    <div>isActive</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Widget active status</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Creation timestamp</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table" style="margin-top: 30px; border: 3px solid #FF6B6B;">
                            <div class="table-header" style="background: #FF6B6B; color: white;">üîí TABLE: widget_domains (CRITICAL SECURITY)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Domain entry identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>widgetId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí widgets(id)</div>
                                    <div>Linked widget</div>
                                </div>
                                <div class="table-row">
                                    <div>domain</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL, INDEX</div>
                                    <div>example.com or *.example.com</div>
                                </div>
                                <div class="table-row">
                                    <div>domainType</div>
                                    <div>VARCHAR(20)</div>
                                    <div>NOT NULL</div>
                                    <div>exact|wildcard</div>
                                </div>
                                <div class="table-row">
                                    <div>isActive</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Enable/disable domain without deleting</div>
                                </div>
                                <div class="table-row">
                                    <div>addedBy</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí users(id)</div>
                                    <div>User who added this domain</div>
                                </div>
                                <div class="table-row">
                                    <div>addedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>When domain was whitelisted</div>
                                </div>
                                <div class="table-row">
                                    <div>lastVerifiedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>Last successful widget load from this domain</div>
                                </div>
                                <div class="table-row">
                                    <div>verificationCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Total successful loads (usage tracking)</div>
                                </div>
                            </div>
                            <div style="background: #FFE5E5; padding: 15px; margin-top: 10px; border-radius: 5px;">
                                <strong style="color: #C92A2A;">‚ö†Ô∏è Security Index:</strong><br>
                                <code style="background: white; padding: 3px 8px; border-radius: 3px; font-family: monospace; font-size: 0.9em;">
                                CREATE UNIQUE INDEX idx_widget_domain ON widget_domains(widgetId, domain);
                                </code><br>
                                <span style="font-size: 0.9em; color: #5C2020;">Ensures fast O(1) domain lookups for every widget load request</span>
                            </div>
                        </div>

                        <div class="db-table" style="margin-top: 30px; border: 3px solid #FF6B6B;">
                            <div class="table-header" style="background: #FF6B6B; color: white;">üö® TABLE: widget_blocked_attempts (SECURITY AUDIT LOG)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Log entry identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>widgetId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí widgets(id)</div>
                                    <div>Widget that rejected request</div>
                                </div>
                                <div class="table-row">
                                    <div>blockedDomain</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL, INDEX</div>
                                    <div>Unauthorized domain that attempted access</div>
                                </div>
                                <div class="table-row">
                                    <div>requestType</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>widget_load|websocket|api_call</div>
                                </div>
                                <div class="table-row">
                                    <div>ipAddress</div>
                                    <div>VARCHAR(45)</div>
                                    <div>NOT NULL</div>
                                    <div>Source IP (IPv4 or IPv6)</div>
                                </div>
                                <div class="table-row">
                                    <div>userAgent</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Browser/bot user agent string</div>
                                </div>
                                <div class="table-row">
                                    <div>refererHeader</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>HTTP Referer header (full URL)</div>
                                </div>
                                <div class="table-row">
                                    <div>blockedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW(), INDEX</div>
                                    <div>When attempt was blocked</div>
                                </div>
                            </div>
                            <div style="background: #FFE5E5; padding: 15px; margin-top: 10px; border-radius: 5px;">
                                <strong style="color: #C92A2A;">‚ö†Ô∏è Security Monitoring:</strong><br>
                                ‚Ä¢ Alert if same domain blocked >10 times in 1 hour (potential attack)<br>
                                ‚Ä¢ Alert if multiple IPs blocked for same widgetId (DDoS attempt)<br>
                                ‚Ä¢ Retention: 90 days (GDPR compliant, security incident investigation)<br>
                                ‚Ä¢ Dashboard: Show top 10 blocked domains per widget for security awareness
                            </div>
                        </div>

                        <div class="db-table" style="margin-top: 30px; border: 2px solid #52B788;">
                            <div class="table-header" style="background: #52B788; color: white;">üè∑Ô∏è TABLE: conversation_labels (Conversation Organization)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Label identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí organizations(id)</div>
                                    <div>Owning organization</div>
                                </div>
                                <div class="table-row">
                                    <div>name</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NOT NULL</div>
                                    <div>Label name (e.g., "Sales", "Support", "Bug")</div>
                                </div>
                                <div class="table-row">
                                    <div>color</div>
                                    <div>VARCHAR(7)</div>
                                    <div>NOT NULL</div>
                                    <div>Hex color for UI (e.g., #FF5733)</div>
                                </div>
                                <div class="table-row">
                                    <div>description</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Label purpose/description</div>
                                </div>
                                <div class="table-row">
                                    <div>category</div>
                                    <div>VARCHAR(50)</div>
                                    <div>DEFAULT 'general'</div>
                                    <div>sales|support|billing|technical|general|custom</div>
                                </div>
                                <div class="table-row">
                                    <div>isActive</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Enable/disable without deleting</div>
                                </div>
                                <div class="table-row">
                                    <div>displayOrder</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Sort order in UI</div>
                                </div>
                                <div class="table-row">
                                    <div>createdBy</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí users(id)</div>
                                    <div>User who created label</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Label creation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>updatedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last modification timestamp</div>
                                </div>
                            </div>
                            <div style="background: #E8F5E9; padding: 15px; margin-top: 10px; border-radius: 5px;">
                                <strong style="color: #1A4D2E;">üí° Usage Examples:</strong><br>
                                ‚Ä¢ <strong>Sales Labels:</strong> "Hot Lead", "Follow-up Required", "Closed Won", "Closed Lost"<br>
                                ‚Ä¢ <strong>Support Labels:</strong> "Bug", "Feature Request", "Question", "Escalated", "Resolved"<br>
                                ‚Ä¢ <strong>Priority Labels:</strong> "Urgent", "High Priority", "Normal", "Low Priority"<br>
                                ‚Ä¢ <strong>Status Labels:</strong> "Open", "In Progress", "Waiting on Customer", "Completed"<br>
                                ‚Ä¢ <strong>Channel Labels:</strong> "WhatsApp", "Email", "Instagram", "Facebook" (channel type tags)
                            </div>
                        </div>

                        <div class="db-table" style="margin-top: 30px; border: 2px solid #52B788;">
                            <div class="table-header" style="background: #52B788; color: white;">üîó TABLE: conversation_label_assignments (Junction Table)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Assignment identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>conversationId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí conversations(id)</div>
                                    <div>Conversation being labeled</div>
                                </div>
                                <div class="table-row">
                                    <div>labelId</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí conversation_labels(id)</div>
                                    <div>Applied label</div>
                                </div>
                                <div class="table-row">
                                    <div>assignedBy</div>
                                    <div>INTEGER</div>
                                    <div>FK ‚Üí users(id)</div>
                                    <div>User who applied label</div>
                                </div>
                                <div class="table-row">
                                    <div>assignedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>When label was applied</div>
                                </div>
                                <div class="table-row">
                                    <div>source</div>
                                    <div>VARCHAR(50)</div>
                                    <div>DEFAULT 'manual'</div>
                                    <div>manual|auto|ai_suggested|rule_based</div>
                                </div>
                            </div>
                            <div style="background: #E8F5E9; padding: 15px; margin-top: 10px; border-radius: 5px;">
                                <strong style="color: #1A4D2E;">üîç Unique Constraint:</strong><br>
                                <code style="background: white; padding: 3px 8px; border-radius: 3px; font-family: monospace; font-size: 0.9em;">
                                CREATE UNIQUE INDEX idx_conversation_label ON conversation_label_assignments(conversationId, labelId);
                                </code><br>
                                <span style="font-size: 0.9em; color: #2C5530;">Prevents duplicate labels on same conversation</span><br><br>
                                <strong style="color: #1A4D2E;">üìä Performance Index:</strong><br>
                                <code style="background: white; padding: 3px 8px; border-radius: 3px; font-family: monospace; font-size: 0.9em;">
                                CREATE INDEX idx_conversation_labels_lookup ON conversation_label_assignments(conversationId);
                                </code><br>
                                <span style="font-size: 0.9em; color: #2C5530;">Fast lookup of all labels for a conversation (O(log n))</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">‚Üì</div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">
                        üõ°Ô∏è SWIM LANE 5: GDPR COMPLIANCE REFERENCES
                    </div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">
                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> Cookie Consent Banner</h3>
                                <div class="gdpr-section">
                                    <strong>ePrivacy Directive Compliance</strong>
                                    <strong style="color: #333; font-weight: 400;">Required:</strong> Widget must show cookie consent banner<br>
                                    <strong style="color: #333; font-weight: 400;">Stored:</strong> Session cookies for chat functionality<br>
                                    <strong style="color: #333; font-weight: 400;">User Control:</strong> Accept/Reject cookies
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Cookie Policy"
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> Website Visitor Data</h3>
                                <div class="gdpr-section">
                                    <strong>Data Minimization</strong>
                                    <strong style="color: #333; font-weight: 400;">Collected:</strong><br>
                                    ‚Ä¢ Session ID (ephemeral)<br>
                                    ‚Ä¢ Messages sent to widget<br>
                                    ‚Ä¢ No tracking beyond chat<br><br>
                                    <strong style="color: #333; font-weight: 400;">Retention:</strong> 90 days
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Data We Collect"
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">‚úÖ</span> Embed Code Security</h3>
                                <div class="gdpr-section">
                                    <strong>Domain Allowlist Protection</strong>
                                    <strong style="color: #333; font-weight: 400;">Security:</strong><br>
                                    ‚Ä¢ Only allowed domains can load widget<br>
                                    ‚Ä¢ CORS validation<br>
                                    ‚Ä¢ TLS encryption (HTTPS only)<br>
                                    ‚Ä¢ Prevents unauthorized usage
                                </div>
                                <div class="reference">
                                    ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 32: Security of Processing
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 8: STEP 7 -->


            <!-- FRAME 9: STEP 8 - AUTOMATION TEMPLATES -->
            <div class="frame" id="frame9">
                <div class="frame-title">
                    STEP 8: AUTOMATION TEMPLATES
                </div>
                <div class="frame-subtitle">
                    Automation Library + Template Selection + Rule Configuration + Trigger Setup
                </div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #E8F5E9;"></div>
                        <div class="legend-label">üë§ User Actions</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #D4E9E2;"></div>
                        <div class="legend-label">‚öôÔ∏è Backend Services</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #FFF9E6;"></div>
                        <div class="legend-label">‚òÅÔ∏è AWS Infrastructure</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #B7E4C7;"></div>
                        <div class="legend-label">üóÑÔ∏è Data Storage</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #E8F5E9;"></div>
                        <div class="legend-label">üõ°Ô∏è GDPR Compliance</div>
                    </div>
                </div>

                <div class="swim-lanes">
                    <!-- SWIM LANE 1: USER ACTIONS -->
                    <div class="swim-lane lane-user">
                        <div class="lane-header">
                            üë§ SWIM LANE 1: USER ACTIONS
                        </div>
                        <div class="lane-content">
                            <div class="step-container">
                                <div class="step-box">
                                    <h3>üìö Browse Templates</h3>
                                    <p><strong>User explores automation library</strong></p>
                                    <ul>
                                        <li>View pre-built automation templates</li>
                                        <li>Filter by category (Sales, Support, Marketing)</li>
                                        <li>Search templates by keyword</li>
                                        <li>Preview template workflow</li>
                                    </ul>
                                </div>

                                <div class="step-box">
                                    <h3>‚úÖ Select Automation</h3>
                                    <p><strong>User chooses template to activate</strong></p>
                                    <ul>
                                        <li>Click "Use This Template"</li>
                                        <li>Review automation description</li>
                                        <li>Check required channels/integrations</li>
                                        <li>View example triggers & actions</li>
                                    </ul>
                                </div>

                                <div class="step-box">
                                    <h3>‚öôÔ∏è Configure Triggers</h3>
                                    <p><strong>User customizes automation conditions</strong></p>
                                    <ul>
                                        <li>Set trigger type (Time, Event, Keyword)</li>
                                        <li>Define conditions (IF/THEN rules)</li>
                                        <li>Configure action parameters</li>
                                        <li>Assign AI assistant to execute</li>
                                    </ul>
                                </div>

                                <div class="step-box">
                                    <h3>üöÄ Activate Automation</h3>
                                    <p><strong>User enables and tests automation</strong></p>
                                    <ul>
                                        <li>Name the automation</li>
                                        <li>Enable/disable toggle</li>
                                        <li>Test automation with sample data</li>
                                        <li>Save and deploy to production</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SWIM LANE 2: BACKEND SERVICES TRIGGERED -->
                    <div class="swim-lane lane-backend">
                        <div class="lane-header">
                            ‚öôÔ∏è SWIM LANE 2: BACKEND SERVICES TRIGGERED
                        </div>
                        <div class="lane-content">
                            <div class="service-grid">
                                <div class="service-card">
                                    <h3><span class="service-icon">üìö</span> Automation Library Service</h3>
                                    <div class="section">
                                        <div class="section-title">API Endpoints:</div>
                                        <div class="section-content">
                                            ‚Ä¢ GET /automations/templates<br>
                                            ‚Ä¢ GET /automations/templates/:id<br>
                                            ‚Ä¢ GET /automations/categories<br>
                                            ‚Ä¢ POST /automations/search<br>
                                            ‚Ä¢ GET /automations/templates/by-industry/:industry <span style="color: #52B788; font-weight: bold;">[NEW]</span><br>
                                            ‚Ä¢ GET /automations/industries <span style="color: #52B788; font-weight: bold;">[NEW]</span>
                                        </div>
                                    </div>
                                    <div class="section">
                                        <div class="section-title">Responsibilities:</div>
                                        <div class="section-content">
                                            ‚Ä¢ Serve pre-built templates<br>
                                            ‚Ä¢ Category management<br>
                                            ‚Ä¢ Template versioning<br>
                                            ‚Ä¢ Search & filtering<br>
                                            ‚Ä¢ <strong>Industry-specific filtering</strong> <span style="color: #52B788; font-weight: bold;">[NEW]</span><br>
                                            ‚Ä¢ Featured/recommended templates per industry <span style="color: #52B788; font-weight: bold;">[NEW]</span>
                                        </div>
                                    </div>
                                    <div class="section">
                                        <div class="section-title">Industry Categories:</div>
                                        <div class="section-content" style="background: #F0FFF4; padding: 10px; border-radius: 5px;">
                                            ‚Ä¢ <strong>E-commerce:</strong> Abandoned cart recovery, Order confirmation, Shipping updates<br>
                                            ‚Ä¢ <strong>Healthcare:</strong> Appointment reminders, Test result notifications, Follow-up care<br>
                                            ‚Ä¢ <strong>Education:</strong> Course enrollment, Assignment reminders, Grade notifications<br>
                                            ‚Ä¢ <strong>Real Estate:</strong> Property inquiries, Viewing schedules, Offer notifications<br>
                                            ‚Ä¢ <strong>SaaS/Tech:</strong> Trial expiry, Feature announcements, Usage alerts<br>
                                            ‚Ä¢ <strong>Finance:</strong> Payment reminders, Account alerts, Fraud notifications<br>
                                            ‚Ä¢ <strong>Hospitality:</strong> Booking confirmations, Check-in reminders, Guest feedback<br>
                                            ‚Ä¢ <strong>General:</strong> Universal templates applicable to any industry
                                        </div>
                                    </div>
                                    <div class="section">
                                        <div class="section-title">Dependencies:</div>
                                        <div class="section-content">
                                            ‚Ä¢ PostgreSQL (automation_templates, industry_categories, template_industry_mapping) <span style="color: #52B788; font-weight: bold;">[UPDATED]</span><br>
                                            ‚Ä¢ ElastiCache (template caching)<br>
                                            ‚Ä¢ S3 (template icons/assets)
                                        </div>
                                    </div>
                                </div>

                                <div class="service-card">
                                    <h3><span class="service-icon">‚öôÔ∏è</span> Automation Configuration Service</h3>
                                    <div class="section">
                                        <div class="section-title">API Endpoints:</div>
                                        <div class="section-content">
                                            ‚Ä¢ POST /automations/create<br>
                                            ‚Ä¢ PATCH /automations/:id<br>
                                            ‚Ä¢ DELETE /automations/:id<br>
                                            ‚Ä¢ POST /automations/:id/test
                                        </div>
                                    </div>
                                    <div class="section">
                                        <div class="section-title">Responsibilities:</div>
                                        <div class="section-content">
                                            ‚Ä¢ Create user automations<br>
                                            ‚Ä¢ Configure triggers & actions<br>
                                            ‚Ä¢ Validate rule logic<br>
                                            ‚Ä¢ Enable/disable automations
                                        </div>
                                    </div>
                                    <div class="section">
                                        <div class="section-title">Validation:</div>
                                        <div class="section-content">
                                            ‚Ä¢ Check channel availability<br>
                                            ‚Ä¢ Verify AI assistant exists<br>
                                            ‚Ä¢ Validate trigger conditions<br>
                                            ‚Ä¢ Test action parameters
                                        </div>
                                    </div>
                                </div>

                                <div class="service-card">
                                    <h3><span class="service-icon">‚ö°</span> Rule Execution Service</h3>
                                    <div class="section">
                                        <div class="section-title">API Endpoints:</div>
                                        <div class="section-content">
                                            ‚Ä¢ POST /rules/evaluate<br>
                                            ‚Ä¢ POST /rules/execute<br>
                                            ‚Ä¢ GET /rules/history<br>
                                            ‚Ä¢ GET /rules/:id/logs
                                        </div>
                                    </div>
                                    <div class="section">
                                        <div class="section-title">Responsibilities:</div>
                                        <div class="section-content">
                                            ‚Ä¢ Evaluate trigger conditions<br>
                                            ‚Ä¢ Execute automation actions<br>
                                            ‚Ä¢ Log execution results<br>
                                            ‚Ä¢ Handle errors & retries
                                        </div>
                                    </div>
                                    <div class="section">
                                        <div class="section-title">Integration:</div>
                                        <div class="section-content">
                                            ‚Ä¢ Python FastAPI Rules Engine<br>
                                            ‚Ä¢ NestJS Event Bridge<br>
                                            ‚Ä¢ SQS for async execution<br>
                                            ‚Ä¢ CloudWatch for monitoring
                                        </div>
                                    </div>
                                </div>

                                <div class="service-card">
                                    <h3><span class="service-icon">üîî</span> Event Trigger Service</h3>
                                    <div class="section">
                                        <div class="section-title">Event Sources:</div>
                                        <div class="section-content">
                                            ‚Ä¢ Time-based (Cron schedules)<br>
                                            ‚Ä¢ Event-based (New message, Tag added)<br>
                                            ‚Ä¢ Keyword-based (Message contains X)<br>
                                            ‚Ä¢ Condition-based (Business hours, Sentiment)
                                        </div>
                                    </div>
                                    <div class="section">
                                        <div class="section-title">Responsibilities:</div>
                                        <div class="section-content">
                                            ‚Ä¢ Monitor trigger conditions<br>
                                            ‚Ä¢ Emit events to SQS<br>
                                            ‚Ä¢ Rate limiting & throttling<br>
                                            ‚Ä¢ Duplicate prevention
                                        </div>
                                    </div>
                                    <div class="section">
                                        <div class="section-title">Processing:</div>
                                        <div class="section-content">
                                            ‚Ä¢ Real-time event detection<br>
                                            ‚Ä¢ Batch processing (scheduled)<br>
                                            ‚Ä¢ Retry failed triggers<br>
                                            ‚Ä¢ Dead-letter queue handling
                                        </div>
                                    </div>
                                </div>

                                <div class="service-card">
                                    <h3><span class="service-icon">üìä</span> Analytics & Reporting Service</h3>
                                    <div class="section">
                                        <div class="section-title">API Endpoints:</div>
                                        <div class="section-content">
                                            ‚Ä¢ GET /automations/:id/analytics<br>
                                            ‚Ä¢ GET /automations/performance<br>
                                            ‚Ä¢ GET /automations/execution-logs<br>
                                            ‚Ä¢ POST /automations/reports/export
                                        </div>
                                    </div>
                                    <div class="section">
                                        <div class="section-title">Metrics:</div>
                                        <div class="section-content">
                                            ‚Ä¢ Execution count (success/failure)<br>
                                            ‚Ä¢ Average execution time<br>
                                            ‚Ä¢ Trigger frequency<br>
                                            ‚Ä¢ Cost per automation (API calls)
                                        </div>
                                    </div>
                                    <div class="section">
                                        <div class="section-title">Storage:</div>
                                        <div class="section-content">
                                            ‚Ä¢ CloudWatch Logs (execution logs)<br>
                                            ‚Ä¢ PostgreSQL (aggregated metrics)<br>
                                            ‚Ä¢ S3 (historical exports)<br>
                                            ‚Ä¢ ElastiCache (real-time counters)
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SWIM LANE 3: AWS INFRASTRUCTURE USED -->
                    <div class="swim-lane lane-aws">
                        <div class="lane-header">
                            ‚òÅÔ∏è SWIM LANE 3: AWS INFRASTRUCTURE USED
                        </div>
                        <div class="lane-content">
                            <div class="aws-grid">
                                <div class="aws-box">
                                    <h4>
                                        <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                        ECS Fargate
                                    </h4>
                                    <p><strong>Backend Services Containers</strong></p>
                                    <ul>
                                        <li>Automation Library Service (NestJS)</li>
                                        <li>Configuration Service (NestJS)</li>
                                        <li>Rule Execution Service (Python FastAPI)</li>
                                        <li>Event Trigger Service (NestJS)</li>
                                        <li>Auto-scaling: 2-10 tasks</li>
                                    </ul>
                                </div>

                                <div class="aws-box">
                                    <h4>
                                        <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                        RDS PostgreSQL
                                    </h4>
                                    <p><strong>Database Tables</strong></p>
                                    <ul>
                                        <li>automation_templates (pre-built library)</li>
                                        <li>user_automations (custom configurations)</li>
                                        <li>automation_triggers (conditions)</li>
                                        <li>automation_actions (workflows)</li>
                                        <li>execution_logs (history)</li>
                                    </ul>
                                </div>

                                <div class="aws-box">
                                    <h4>
                                        <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Queue-Service.svg" alt="SQS" class="aws-icon">
                                        SQS
                                    </h4>
                                    <p><strong>Event Processing Queues</strong></p>
                                    <ul>
                                        <li>automation-trigger-queue (trigger events)</li>
                                        <li>automation-execution-queue (actions)</li>
                                        <li>automation-dlq (failed executions)</li>
                                        <li>Visibility timeout: 5 minutes</li>
                                        <li>Max retries: 3 attempts</li>
                                    </ul>
                                </div>

                                <div class="aws-box">
                                    <h4>
                                        <img src="https://icon.icepanel.io/AWS/svg/Compute/Lambda.svg" alt="Lambda" class="aws-icon">
                                        Lambda Functions
                                    </h4>
                                    <p><strong>Scheduled & Event-Driven Tasks</strong></p>
                                    <ul>
                                        <li>cron-trigger-checker (every 1 minute)</li>
                                        <li>event-processor (SQS consumer)</li>
                                        <li>rule-evaluator (condition checking)</li>
                                        <li>automation-executor (action runner)</li>
                                        <li>Runtime: Node.js 18.x, Python 3.11</li>
                                    </ul>
                                </div>

                                <div class="aws-box">
                                    <h4>
                                        <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                        ElastiCache Redis
                                    </h4>
                                    <p><strong>Caching & Rate Limiting</strong></p>
                                    <ul>
                                        <li>automation_templates:* (library cache)</li>
                                        <li>active_automations:org_id (quick lookup)</li>
                                        <li>trigger_count:automation_id (rate limits)</li>
                                        <li>execution_lock:automation_id (prevent duplicates)</li>
                                        <li>TTL: Templates 1 hour, Locks 5 minutes</li>
                                    </ul>
                                </div>

                                <div class="aws-box">
                                    <h4>
                                        <img src="https://icon.icepanel.io/AWS/svg/Management-Governance/CloudWatch.svg" alt="CloudWatch" class="aws-icon">
                                        CloudWatch
                                    </h4>
                                    <p><strong>Monitoring & Logging</strong></p>
                                    <ul>
                                        <li>Log Group: /aws/ecs/automation-services</li>
                                        <li>Metrics: ExecutionCount, FailureRate, Latency</li>
                                        <li>Alarms: FailureRate > 5%, Latency > 10s</li>
                                        <li>EventBridge: Cron schedules, Event rules</li>
                                        <li>Retention: 30 days</li>
                                    </ul>
                                </div>

                                <div class="aws-box">
                                    <h4>
                                        <img src="https://icon.icepanel.io/AWS/svg/Storage/Simple-Storage-Service.svg" alt="S3" class="aws-icon">
                                        S3
                                    </h4>
                                    <p><strong>Template Assets & Exports</strong></p>
                                    <ul>
                                        <li>unifiedbeez-automation-templates/ (icons, previews)</li>
                                        <li>unifiedbeez-automation-exports/ (analytics CSVs)</li>
                                        <li>Lifecycle: Delete exports after 90 days</li>
                                        <li>Encryption: SSE-S3 (AES-256)</li>
                                        <li>CloudFront CDN for template assets</li>
                                    </ul>
                                </div>

                                <div class="aws-box">
                                    <h4>
                                        <img src="https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Secrets-Manager.svg" alt="Secrets Manager" class="aws-icon">
                                        Secrets Manager
                                    </h4>
                                    <p><strong>External API Keys</strong></p>
                                    <ul>
                                        <li>automation/openai-api-key (AI execution)</li>
                                        <li>automation/sendy-aws-ses-credentials (email actions)</li>
                                        <li>automation/twilio-credentials (SMS actions)</li>
                                        <li>automation/slack-webhook (notification actions)</li>
                                        <li>Auto-rotation: Every 90 days</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SWIM LANE 4: DATA STORAGE & SCHEMAS -->
                    <div class="swim-lane lane-data">
                        <div class="lane-header">
                            üóÑÔ∏è SWIM LANE 4: DATA STORAGE & SCHEMAS
                        </div>
                        <div class="lane-content">
                            <div class="db-container">
                                <div class="db-table">
                                    <div class="table-header">TABLE: automation_templates</div>
                                    <div class="table-body">
                                        <div class="table-row header-row">
                                            <div>Column Name</div>
                                            <div>Type</div>
                                            <div>Constraints</div>
                                            <div>Purpose</div>
                                        </div>
                                        <div class="table-row">
                                            <div class="pk">id</div>
                                            <div>SERIAL</div>
                                            <div>PRIMARY KEY</div>
                                            <div>Template identifier</div>
                                        </div>
                                        <div class="table-row">
                                            <div>name</div>
                                            <div>VARCHAR(200)</div>
                                            <div>NOT NULL, UNIQUE</div>
                                            <div>"Auto-assign to Sales", "After-hours Response"</div>
                                        </div>
                                        <div class="table-row">
                                            <div>category</div>
                                            <div>VARCHAR(50)</div>
                                            <div>NOT NULL</div>
                                            <div>sales|support|marketing|operations</div>
                                        </div>
                                        <div class="table-row">
                                            <div>description</div>
                                            <div>TEXT</div>
                                            <div>NOT NULL</div>
                                            <div>Template explanation for users</div>
                                        </div>
                                        <div class="table-row">
                                            <div>triggerType</div>
                                            <div>VARCHAR(50)</div>
                                            <div>NOT NULL</div>
                                            <div>time|event|keyword|condition</div>
                                        </div>
                                        <div class="table-row">
                                            <div>triggerConfig</div>
                                            <div>JSONB</div>
                                            <div>NOT NULL</div>
                                            <div>{"cron": "0 9 * * *"} or {"event": "message.received"}</div>
                                        </div>
                                        <div class="table-row">
                                            <div>actionType</div>
                                            <div>VARCHAR(50)</div>
                                            <div>NOT NULL</div>
                                            <div>send_message|assign_tag|transfer_chat|create_ticket</div>
                                        </div>
                                        <div class="table-row">
                                            <div>actionConfig</div>
                                            <div>JSONB</div>
                                            <div>NOT NULL</div>
                                            <div>{"message": "Thanks for contacting us!", "delay": 60}</div>
                                        </div>
                                        <div class="table-row">
                                            <div>iconUrl</div>
                                            <div>VARCHAR(500)</div>
                                            <div>NULLABLE</div>
                                            <div>S3 URL for template icon</div>
                                        </div>
                                        <div class="table-row">
                                            <div>popularity</div>
                                            <div>INTEGER</div>
                                            <div>DEFAULT 0</div>
                                            <div>Usage count (for sorting)</div>
                                        </div>
                                        <div class="table-row">
                                            <div>isActive</div>
                                            <div>BOOLEAN</div>
                                            <div>DEFAULT true</div>
                                            <div>Show/hide template</div>
                                        </div>
                                        <div class="table-row">
                                            <div>createdAt</div>
                                            <div>TIMESTAMP</div>
                                            <div>DEFAULT NOW()</div>
                                            <div>Template creation date</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="db-table" style="border: 2px solid #52B788; margin-top: 20px;">
                                    <div class="table-header" style="background: #52B788; color: white;">üè¢ TABLE: industry_categories (Industry Classification)</div>
                                    <div class="table-body">
                                        <div class="table-row header-row">
                                            <div>Column Name</div>
                                            <div>Type</div>
                                            <div>Constraints</div>
                                            <div>Purpose</div>
                                        </div>
                                        <div class="table-row">
                                            <div class="pk">id</div>
                                            <div>SERIAL</div>
                                            <div>PRIMARY KEY</div>
                                            <div>Industry identifier</div>
                                        </div>
                                        <div class="table-row">
                                            <div>name</div>
                                            <div>VARCHAR(100)</div>
                                            <div>NOT NULL, UNIQUE</div>
                                            <div>Industry name (e.g., "E-commerce", "Healthcare")</div>
                                        </div>
                                        <div class="table-row">
                                            <div>slug</div>
                                            <div>VARCHAR(100)</div>
                                            <div>NOT NULL, UNIQUE</div>
                                            <div>URL-friendly identifier (e.g., "ecommerce", "healthcare")</div>
                                        </div>
                                        <div class="table-row">
                                            <div>description</div>
                                            <div>TEXT</div>
                                            <div>NOT NULL</div>
                                            <div>Industry description for users</div>
                                        </div>
                                        <div class="table-row">
                                            <div>iconUrl</div>
                                            <div>VARCHAR(500)</div>
                                            <div>NULLABLE</div>
                                            <div>S3 URL for industry icon</div>
                                        </div>
                                        <div class="table-row">
                                            <div>displayOrder</div>
                                            <div>INTEGER</div>
                                            <div>DEFAULT 0</div>
                                            <div>Sort order in UI</div>
                                        </div>
                                        <div class="table-row">
                                            <div>isActive</div>
                                            <div>BOOLEAN</div>
                                            <div>DEFAULT true</div>
                                            <div>Show/hide industry category</div>
                                        </div>
                                        <div class="table-row">
                                            <div>templateCount</div>
                                            <div>INTEGER</div>
                                            <div>DEFAULT 0</div>
                                            <div>Number of templates in this industry (cached)</div>
                                        </div>
                                        <div class="table-row">
                                            <div>createdAt</div>
                                            <div>TIMESTAMP</div>
                                            <div>DEFAULT NOW()</div>
                                            <div>Category creation date</div>
                                        </div>
                                        <div class="table-row">
                                            <div>updatedAt</div>
                                            <div>TIMESTAMP</div>
                                            <div>DEFAULT NOW()</div>
                                            <div>Last modification date</div>
                                        </div>
                                    </div>
                                    <div style="background: #E8F5E9; padding: 15px; margin-top: 10px; border-radius: 5px;">
                                        <strong style="color: #1A4D2E;">üìã Sample Industries:</strong><br>
                                        ‚Ä¢ <strong>E-commerce:</strong> Online retail, marketplace platforms, dropshipping<br>
                                        ‚Ä¢ <strong>Healthcare:</strong> Clinics, hospitals, telehealth, pharmacies<br>
                                        ‚Ä¢ <strong>Education:</strong> Schools, universities, online courses, tutoring<br>
                                        ‚Ä¢ <strong>Real Estate:</strong> Agencies, property management, rentals<br>
                                        ‚Ä¢ <strong>SaaS/Tech:</strong> Software companies, tech startups, IT services<br>
                                        ‚Ä¢ <strong>Finance:</strong> Banks, fintech, insurance, accounting<br>
                                        ‚Ä¢ <strong>Hospitality:</strong> Hotels, restaurants, travel agencies<br>
                                        ‚Ä¢ <strong>General:</strong> Applicable to any industry
                                    </div>
                                </div>

                                <div class="db-table" style="border: 2px solid #52B788; margin-top: 20px;">
                                    <div class="table-header" style="background: #52B788; color: white;">üîó TABLE: template_industry_mapping (Junction Table)</div>
                                    <div class="table-body">
                                        <div class="table-row header-row">
                                            <div>Column Name</div>
                                            <div>Type</div>
                                            <div>Constraints</div>
                                            <div>Purpose</div>
                                        </div>
                                        <div class="table-row">
                                            <div class="pk">id</div>
                                            <div>SERIAL</div>
                                            <div>PRIMARY KEY</div>
                                            <div>Mapping identifier</div>
                                        </div>
                                        <div class="table-row">
                                            <div>templateId</div>
                                            <div>INTEGER</div>
                                            <div>FK ‚Üí automation_templates(id)</div>
                                            <div>Automation template</div>
                                        </div>
                                        <div class="table-row">
                                            <div>industryId</div>
                                            <div>INTEGER</div>
                                            <div>FK ‚Üí industry_categories(id)</div>
                                            <div>Industry category</div>
                                        </div>
                                        <div class="table-row">
                                            <div>isFeatured</div>
                                            <div>BOOLEAN</div>
                                            <div>DEFAULT false</div>
                                            <div>Featured/recommended template for this industry</div>
                                        </div>
                                        <div class="table-row">
                                            <div>relevanceScore</div>
                                            <div>INTEGER</div>
                                            <div>DEFAULT 50</div>
                                            <div>Relevance score (0-100) for sorting</div>
                                        </div>
                                        <div class="table-row">
                                            <div>createdAt</div>
                                            <div>TIMESTAMP</div>
                                            <div>DEFAULT NOW()</div>
                                            <div>Mapping creation date</div>
                                        </div>
                                    </div>
                                    <div style="background: #E8F5E9; padding: 15px; margin-top: 10px; border-radius: 5px;">
                                        <strong style="color: #1A4D2E;">üîç Unique Constraint:</strong><br>
                                        <code style="background: white; padding: 3px 8px; border-radius: 3px; font-family: monospace; font-size: 0.9em;">
                                        CREATE UNIQUE INDEX idx_template_industry ON template_industry_mapping(templateId, industryId);
                                        </code><br>
                                        <span style="font-size: 0.9em; color: #2C5530;">Prevents duplicate industry assignments to same template</span><br><br>
                                        <strong style="color: #1A4D2E;">üìä Performance Index:</strong><br>
                                        <code style="background: white; padding: 3px 8px; border-radius: 3px; font-family: monospace; font-size: 0.9em;">
                                        CREATE INDEX idx_industry_templates_lookup ON template_industry_mapping(industryId, relevanceScore DESC);
                                        </code><br>
                                        <span style="font-size: 0.9em; color: #2C5530;">Fast lookup of templates by industry with relevance sorting (O(log n))</span><br><br>
                                        <strong style="color: #1A4D2E;">üí° Example Usage:</strong><br>
                                        ‚Ä¢ Template "Abandoned Cart Recovery" ‚Üí Mapped to "E-commerce" (relevanceScore: 95, isFeatured: true)<br>
                                        ‚Ä¢ Template "Appointment Reminder" ‚Üí Mapped to "Healthcare" (relevanceScore: 90), "Education" (relevanceScore: 70)<br>
                                        ‚Ä¢ Template "Welcome Message" ‚Üí Mapped to "General" (relevanceScore: 80) - applies to all industries
                                    </div>
                                </div>

                                <div class="db-table">
                                    <div class="table-header">TABLE: user_automations</div>
                                    <div class="table-body">
                                        <div class="table-row header-row">
                                            <div>Column Name</div>
                                            <div>Type</div>
                                            <div>Constraints</div>
                                            <div>Purpose</div>
                                        </div>
                                        <div class="table-row">
                                            <div class="pk">id</div>
                                            <div>SERIAL</div>
                                            <div>PRIMARY KEY</div>
                                            <div>User automation identifier</div>
                                        </div>
                                        <div class="table-row">
                                            <div>organizationId</div>
                                            <div>INTEGER</div>
                                            <div>FK ‚Üí organizations.id</div>
                                            <div>Which organization owns this</div>
                                        </div>
                                        <div class="table-row">
                                            <div>templateId</div>
                                            <div>INTEGER</div>
                                            <div>FK ‚Üí automation_templates.id</div>
                                            <div>Based on which template</div>
                                        </div>
                                        <div class="table-row">
                                            <div>name</div>
                                            <div>VARCHAR(200)</div>
                                            <div>NOT NULL</div>
                                            <div>User-defined name</div>
                                        </div>
                                        <div class="table-row">
                                            <div>isEnabled</div>
                                            <div>BOOLEAN</div>
                                            <div>DEFAULT true</div>
                                            <div>Active/paused toggle</div>
                                        </div>
                                        <div class="table-row">
                                            <div>triggerConfig</div>
                                            <div>JSONB</div>
                                            <div>NOT NULL</div>
                                            <div>Customized trigger conditions</div>
                                        </div>
                                        <div class="table-row">
                                            <div>actionConfig</div>
                                            <div>JSONB</div>
                                            <div>NOT NULL</div>
                                            <div>Customized action parameters</div>
                                        </div>
                                        <div class="table-row">
                                            <div>assignedAiAssistantId</div>
                                            <div>INTEGER</div>
                                            <div>FK ‚Üí ai_assistants.id</div>
                                            <div>Which AI executes this automation</div>
                                        </div>
                                        <div class="table-row">
                                            <div>channelFilter</div>
                                            <div>JSONB</div>
                                            <div>NULLABLE</div>
                                            <div>["whatsapp", "webchat"] or null for all</div>
                                        </div>
                                        <div class="table-row">
                                            <div>executionCount</div>
                                            <div>INTEGER</div>
                                            <div>DEFAULT 0</div>
                                            <div>Total times executed</div>
                                        </div>
                                        <div class="table-row">
                                            <div>lastExecutedAt</div>
                                            <div>TIMESTAMP</div>
                                            <div>NULLABLE</div>
                                            <div>Last run timestamp</div>
                                        </div>
                                        <div class="table-row">
                                            <div>createdBy</div>
                                            <div>INTEGER</div>
                                            <div>FK ‚Üí users.id</div>
                                            <div>Team member who created it</div>
                                        </div>
                                        <div class="table-row">
                                            <div>createdAt</div>
                                            <div>TIMESTAMP</div>
                                            <div>DEFAULT NOW()</div>
                                            <div>Creation date</div>
                                        </div>
                                        <div class="table-row">
                                            <div>updatedAt</div>
                                            <div>TIMESTAMP</div>
                                            <div>DEFAULT NOW()</div>
                                            <div>Last modification date</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="db-table">
                                    <div class="table-header">TABLE: automation_execution_logs</div>
                                    <div class="table-body">
                                        <div class="table-row header-row">
                                            <div>Column Name</div>
                                            <div>Type</div>
                                            <div>Constraints</div>
                                            <div>Purpose</div>
                                        </div>
                                        <div class="table-row">
                                            <div class="pk">id</div>
                                            <div>SERIAL</div>
                                            <div>PRIMARY KEY</div>
                                            <div>Log entry identifier</div>
                                        </div>
                                        <div class="table-row">
                                            <div>automationId</div>
                                            <div>INTEGER</div>
                                            <div>FK ‚Üí user_automations.id</div>
                                            <div>Which automation ran</div>
                                        </div>
                                        <div class="table-row">
                                            <div>triggeredBy</div>
                                            <div>VARCHAR(100)</div>
                                            <div>NOT NULL</div>
                                            <div>cron|event|manual</div>
                                        </div>
                                        <div class="table-row">
                                            <div>triggerData</div>
                                            <div>JSONB</div>
                                            <div>NULLABLE</div>
                                            <div>Event payload that triggered execution</div>
                                        </div>
                                        <div class="table-row">
                                            <div>status</div>
                                            <div>VARCHAR(50)</div>
                                            <div>NOT NULL</div>
                                            <div>success|failed|retrying</div>
                                        </div>
                                        <div class="table-row">
                                            <div>result</div>
                                            <div>JSONB</div>
                                            <div>NULLABLE</div>
                                            <div>Action execution results</div>
                                        </div>
                                        <div class="table-row">
                                            <div>errorMessage</div>
                                            <div>TEXT</div>
                                            <div>NULLABLE</div>
                                            <div>Error details if failed</div>
                                        </div>
                                        <div class="table-row">
                                            <div>executionTime</div>
                                            <div>INTEGER</div>
                                            <div>NOT NULL</div>
                                            <div>Duration in milliseconds</div>
                                        </div>
                                        <div class="table-row">
                                            <div>retryCount</div>
                                            <div>INTEGER</div>
                                            <div>DEFAULT 0</div>
                                            <div>Number of retry attempts</div>
                                        </div>
                                        <div class="table-row">
                                            <div>executedAt</div>
                                            <div>TIMESTAMP</div>
                                            <div>DEFAULT NOW()</div>
                                            <div>When automation ran</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="note-box">
                                    <div class="note-title">üîç Database Relationships</div>
                                    <div class="note-content">
                                        <strong>Foreign Keys:</strong><br>
                                        ‚Ä¢ user_automations.templateId ‚Üí automation_templates.id<br>
                                        ‚Ä¢ user_automations.organizationId ‚Üí organizations.id<br>
                                        ‚Ä¢ user_automations.assignedAiAssistantId ‚Üí ai_assistants.id<br>
                                        ‚Ä¢ user_automations.createdBy ‚Üí users.id<br>
                                        ‚Ä¢ automation_execution_logs.automationId ‚Üí user_automations.id<br><br>

                                        <strong>Indexes for Performance:</strong><br>
                                        ‚Ä¢ automation_templates: (category, isActive, popularity DESC)<br>
                                        ‚Ä¢ user_automations: (organizationId, isEnabled)<br>
                                        ‚Ä¢ user_automations: (assignedAiAssistantId)<br>
                                        ‚Ä¢ automation_execution_logs: (automationId, executedAt DESC)<br>
                                        ‚Ä¢ automation_execution_logs: (status, executedAt DESC)<br><br>

                                        <strong>Data Retention:</strong><br>
                                        ‚Ä¢ automation_templates: Permanent (until archived)<br>
                                        ‚Ä¢ user_automations: Permanent (soft delete)<br>
                                        ‚Ä¢ automation_execution_logs: 90 days (auto-archive to S3)
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                    <div class="swim-lane lane-gdpr">
                        <div class="lane-header">
                            üõ°Ô∏è SWIM LANE 5: GDPR COMPLIANCE
                        </div>
                        <div class="lane-content">
                            <div class="gdpr-container">
                                <div class="gdpr-box">
                                    <h3><span class="check">‚úÖ</span> Article 6: Lawful Basis</h3>
                                    <div class="gdpr-section">
                                        <strong>Legitimate Interest</strong>
                                        <strong style="color: #333; font-weight: 400;">Data Collected:</strong><br>
                                        ‚Ä¢ Automation configurations (trigger/action settings)<br>
                                        ‚Ä¢ Execution logs (performance metrics)<br>
                                        ‚Ä¢ Template usage statistics<br><br>

                                        <strong style="color: #333; font-weight: 400;">Purpose:</strong> Service improvement & automation execution<br>
                                        <strong style="color: #333; font-weight: 400;">Retention:</strong> Configs permanent, Logs 90 days
                                    </div>
                                    <div class="reference">
                                        ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                        &nbsp;&nbsp; Line 78-125: Article 6 Compliance
                                    </div>
                                </div>

                                <div class="gdpr-box">
                                    <h3><span class="check">‚úÖ</span> Article 13: Right to Information</h3>
                                    <div class="gdpr-section">
                                        <strong>Transparency Requirements</strong>
                                        <strong style="color: #333; font-weight: 400;">User Notifications:</strong><br>
                                        ‚Ä¢ "This automation will process customer messages"<br>
                                        ‚Ä¢ "Execution logs stored for 90 days"<br>
                                        ‚Ä¢ "You can disable or delete automations anytime"<br>
                                        ‚Ä¢ Link to automation data policy
                                    </div>
                                    <div class="reference">
                                        ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                        &nbsp;&nbsp; Line 568-623: Article 13 Implementation
                                    </div>
                                </div>

                                <div class="gdpr-box">
                                    <h3><span class="check">‚úÖ</span> Article 15: Right of Access</h3>
                                    <div class="gdpr-section">
                                        <strong>Data Export Capabilities</strong>
                                        <strong style="color: #333; font-weight: 400;">User Can Download:</strong><br>
                                        ‚Ä¢ All automation configurations (JSON export)<br>
                                        ‚Ä¢ Execution history (CSV export)<br>
                                        ‚Ä¢ Template usage analytics<br>
                                        ‚Ä¢ API: GET /user/data/automations
                                    </div>
                                    <div class="reference">
                                        ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                        &nbsp;&nbsp; Line 624-673: Article 15 Data Access
                                    </div>
                                </div>

                                <div class="gdpr-box">
                                    <h3><span class="check">‚úÖ</span> Article 17: Right to Erasure</h3>
                                    <div class="gdpr-section">
                                        <strong>Deletion Capabilities</strong>
                                        <strong style="color: #333; font-weight: 400;">User Can Delete:</strong><br>
                                        ‚Ä¢ Individual automations (immediate deletion)<br>
                                        ‚Ä¢ All execution logs (cascade delete)<br>
                                        ‚Ä¢ Template usage history<br><br>

                                        <strong style="color: #333; font-weight: 400;">Organization Deletion:</strong><br>
                                        ‚Ä¢ All automations deleted when org deleted<br>
                                        ‚Ä¢ Execution logs purged from database<br>
                                        ‚Ä¢ S3 exports removed (lifecycle policy)
                                    </div>
                                    <div class="reference">
                                        ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                        &nbsp;&nbsp; Line 674-728: Article 17 Right to Erasure
                                    </div>
                                </div>

                                <div class="gdpr-box">
                                    <h3><span class="check">‚úÖ</span> Article 22: Automated Decision-Making</h3>
                                    <div class="gdpr-section">
                                        <strong>Human Oversight Required</strong>
                                        <strong style="color: #333; font-weight: 400;">Safeguards:</strong><br>
                                        ‚Ä¢ User explicitly creates & enables automations<br>
                                        ‚Ä¢ Can disable/modify automations anytime<br>
                                        ‚Ä¢ All actions logged & reviewable<br>
                                        ‚Ä¢ Human can override AI decisions<br><br>

                                        <strong style="color: #333; font-weight: 400;">No Profiling:</strong><br>
                                        ‚Ä¢ Automations execute rule-based logic only<br>
                                        ‚Ä¢ No automated legal/financial decisions<br>
                                        ‚Ä¢ Transparent trigger/action configurations
                                    </div>
                                    <div class="reference">
                                        ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                        &nbsp;&nbsp; Line 905-976: Article 22 Automated Decisions
                                    </div>
                                </div>

                                <div class="gdpr-box">
                                    <h3><span class="check">‚úÖ</span> Article 28: Data Processors</h3>
                                    <div class="gdpr-section">
                                        <strong>Third-Party Integrations</strong>
                                        <strong style="color: #333; font-weight: 400;">Processors Used:</strong><br>
                                        ‚Ä¢ OpenAI (AI-generated responses in actions)<br>
                                        ‚Ä¢ Sendy + AWS SES (email notification actions)<br>
                                        ‚Ä¢ Twilio (SMS notification actions)<br>
                                        ‚Ä¢ Slack (webhook notification actions)<br><br>

                                        <strong style="color: #333; font-weight: 400;">DPA Status:</strong><br>
                                        ‚Ä¢ All processors have signed DPAs<br>
                                        ‚Ä¢ GDPR-compliant data handling<br>
                                        ‚Ä¢ EU data residency where applicable
                                    </div>
                                    <div class="reference">
                                        ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                        &nbsp;&nbsp; Line 977-1014: Article 28 Processors
                                    </div>
                                </div>

                                <div class="gdpr-box">
                                    <h3><span class="check">‚úÖ</span> Article 32: Security Measures</h3>
                                    <div class="gdpr-section">
                                        <strong>Technical & Organizational Security</strong>
                                        <strong style="color: #333; font-weight: 400;">Encryption:</strong><br>
                                        ‚Ä¢ TLS 1.3 for all API communications<br>
                                        ‚Ä¢ At-rest encryption (RDS, S3)<br>
                                        ‚Ä¢ Secrets Manager for API keys<br><br>

                                        <strong style="color: #333; font-weight: 400;">Access Control:</strong><br>
                                        ‚Ä¢ RBAC for automation management<br>
                                        ‚Ä¢ Audit logs for all modifications<br>
                                        ‚Ä¢ Rate limiting on execution endpoints<br><br>

                                        <strong style="color: #333; font-weight: 400;">Monitoring:</strong><br>
                                        ‚Ä¢ CloudWatch alarms for failures<br>
                                        ‚Ä¢ Execution logs for audit trails<br>
                                        ‚Ä¢ Dead-letter queue for failed jobs
                                    </div>
                                    <div class="reference">
                                        ‚Üí COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                        &nbsp;&nbsp; Line 1015-1088: Article 32 Security
                                    </div>
                                </div>

                                <div class="note-box">
                                    <div class="note-title">üõ°Ô∏è Automation-Specific GDPR Considerations</div>
                                    <div class="note-content">
                                        <strong>Data Minimization (Article 5):</strong><br>
                                        ‚Ä¢ Only log necessary execution metadata<br>
                                        ‚Ä¢ Don't store full message content in logs<br>
                                        ‚Ä¢ Aggregate metrics instead of raw data<br><br>

                                        <strong>Purpose Limitation (Article 5):</strong><br>
                                        ‚Ä¢ Execution logs used ONLY for debugging & analytics<br>
                                        ‚Ä¢ Not shared with third parties<br>
                                        ‚Ä¢ Not used for profiling or marketing<br><br>

                                        <strong>Storage Limitation (Article 5):</strong><br>
                                        ‚Ä¢ Execution logs auto-deleted after 90 days<br>
                                        ‚Ä¢ S3 lifecycle policy enforces retention<br>
                                        ‚Ä¢ User can request earlier deletion<br><br>

                                        <strong>User Control & Transparency:</strong><br>
                                        ‚Ä¢ Clear UI showing what automation does<br>
                                        ‚Ä¢ Easy enable/disable toggle<br>
                                        ‚Ä¢ Real-time execution logs visible to user<br>
                                        ‚Ä¢ Export all automation data on request
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 9: STEP 8 -->

        </div>
    </div>

    <script>
        let zoomLevel = 1.0;

        function zoomIn() {
            zoomLevel = Math.min(zoomLevel + 0.1, 2.0);
            updateZoom();
        }

        function zoomOut() {
            zoomLevel = Math.max(zoomLevel - 0.1, 0.5);
            updateZoom();
        }

        function resetZoom() {
            zoomLevel = 1.0;
            updateZoom();
        }

        function updateZoom() {
            const wrapper = document.getElementById('diagramWrapper');
            wrapper.style.transform = `scale(${zoomLevel})`;
            document.getElementById('zoomLevel').textContent = `${Math.round(zoomLevel * 100)}%`;
        }

        function exportScreenshot() {
            alert('Screenshot Instructions:\n\n1. Zoom to desired size\n2. Use Windows Snipping Tool (Win+Shift+S) or Mac Screenshot (Cmd+Shift+4)\n3. Select the diagram area\n4. Paste into Miro Board\n\nTip: Zoom to 100% for best quality!');
        }

        // Scroll zoom
        document.getElementById('diagramContainer').addEventListener('wheel', (e) => {
            if (e.ctrlKey) {
                e.preventDefault();
                if (e.deltaY < 0) {
                    zoomIn();
                } else {
                    zoomOut();
                }
            }
        });

        console.log('UnifiedBeez Architecture - Visual Diagrams Loaded!');
        console.log('Use Ctrl+Scroll to zoom, or buttons above');
    </script>

    <a href="#" class="back-to-top">‚Üë</a>
    <script src="assets/navigation.js"></script>
</body>
</html>
