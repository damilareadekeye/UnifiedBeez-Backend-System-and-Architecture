<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automation Library + Builders Architecture - UnifiedBeez</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #FFFBF5;
            min-height: 100vh;
        }

        .header-bar {
            background: linear-gradient(135deg, #1A4D2E 0%, #2D6A4F 50%, #52B788 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            position: relative;
        }

        .header-bar h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .header-bar p {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .back-to-index-btn {
            position: absolute;
            top: 20px;
            right: 30px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            border: 2px solid white;
        }

        .back-to-index-btn:hover {
            background: white;
            color: #1A4D2E;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .controls-bar {
            background: white;
            padding: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 80px;
            z-index: 999;
        }

        .control-btn {
            padding: 10px 20px;
            background: #1A4D2E;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: #2D6A4F;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.4);
        }

        .zoom-level {
            padding: 10px 20px;
            background: #E8F5E9;
            color: #1A4D2E;
            border-radius: 8px;
            font-weight: 700;
        }

        /* FRAME NAVIGATION */
        .frame-navigation {
            background: white;
            padding: 15px 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 160px;
            z-index: 999;
            overflow-x: auto;
        }

        .frame-nav-scroll {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .frame-nav-btn {
            padding: 10px 20px;
            background: #E8F5E9;
            color: #1A4D2E;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            white-space: nowrap;
        }

        .frame-nav-btn:hover {
            background: #1A4D2E;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.3);
        }

        .diagram-container {
            padding: 40px 20px;
            overflow-x: auto;
            background: white;
        }

        .diagram-wrapper {
            min-width: 1920px;
            width: max-content;
            transform-origin: top left;
            transition: transform 0.1s ease;
            margin: 0 auto;
        }

        /* FRAME STRUCTURE */
        .frame {
            background: white;
            border: 3px solid #1A4D2E;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
            width: 1920px;
        }

        .frame-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1A4D2E;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #E8F5E9 0%, #B7E4C7 100%);
            border-radius: 8px;
            margin-bottom: 30px;
            border: 2px solid #2D6A4F;
        }

        .frame-subtitle {
            font-size: 1.2rem;
            color: #2C3E50;
            text-align: center;
            margin-bottom: 30px;
        }

        /* LEGEND */
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .legend-box {
            width: 30px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid rgba(0, 0, 0, 0.2);
        }

        /* SWIM LANES */
        .swim-lane {
            margin: 20px 0;
            border: 3px solid #1A4D2E;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.2);
        }

        .lane-header {
            padding: 20px;
            font-weight: 700;
            font-size: 1.3rem;
            color: #1A4D2E;
            border-bottom: 3px solid #1A4D2E;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .lane-content {
            padding: 20px;
            min-height: auto;
        }

        /* LANE BACKGROUNDS */
        .lane-user { background: #E8F5E9; }
        .lane-backend { background: #D4E9E2; }
        .lane-aws { background: #FFF9E6; }
        .lane-data { background: #B7E4C7; }
        .lane-gdpr { background: #E8F5E9; }

        /* CARDS AND BOXES */
        .step-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            align-items: stretch;
        }

        .step-box {
            background: white;
            border: 3px solid #2D6A4F;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.15);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .step-box:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(45, 106, 79, 0.3);
            border-color: #1A4D2E;
        }

        .step-box h3 {
            font-size: 1.05rem;
            color: #1A4D2E;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .step-box ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .step-box li {
            padding: 4px 0;
            color: #2C3E50;
            font-size: 0.9rem;
        }

        .step-box li:before {
            content: "• ";
            color: #2D6A4F;
            font-weight: bold;
            margin-right: 5px;
        }

        /* SERVICE CARDS */
        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .service-card {
            background: white;
            border: 3px solid #2D6A4F;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.15);
        }

        .service-card h3 {
            font-size: 1.2rem;
            color: #1A4D2E;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .service-icon {
            font-size: 1.5rem;
        }

        .service-card .section {
            margin: 12px 0;
        }

        .section-title {
            font-weight: 700;
            color: #2C3E50;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .section-content {
            color: #2C3E50;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* AWS INFRASTRUCTURE BOXES */
        .aws-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        .aws-box {
            background: white;
            border: 3px solid #FB9C1D;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(251, 156, 29, 0.2);
        }

        .aws-box h4 {
            font-size: 1.1rem;
            color: #1A4D2E;
            margin-bottom: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .aws-icon {
            width: 32px;
            height: 32px;
            object-fit: contain;
        }

        /* DATABASE TABLE */
        .db-table {
            background: white;
            border: 3px solid #1A4D2E;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.15);
            margin-bottom: 20px;
        }

        .table-header {
            background: linear-gradient(135deg, #1A4D2E 0%, #2D6A4F 50%, #52B788 100%);
            color: white;
            padding: 15px 20px;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .table-body {
            padding: 20px;
        }

        .table-row {
            display: grid;
            grid-template-columns: 200px 150px 250px 350px;
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.9rem;
        }

        .table-row:last-child {
            border-bottom: none;
        }

        .table-row.header-row {
            background: #E8F5E9;
            font-weight: 700;
            color: #1A4D2E;
        }

        .pk {
            color: #FB9C1D;
            font-weight: 700;
        }

        /* GDPR BOXES */
        .gdpr-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
        }

        .gdpr-box {
            background: white;
            border: 3px solid #1A4D2E;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.15);
        }

        .gdpr-box h3 {
            color: #1A4D2E;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .gdpr-box .check {
            color: #2D6A4F;
            font-size: 1.2rem;
            margin-right: 5px;
        }

        .gdpr-section {
            margin: 12px 0;
            padding: 12px;
            background: #FFF9E6;
            border-radius: 6px;
        }

        .gdpr-section strong {
            color: #FB9C1D;
            display: block;
            margin-bottom: 8px;
        }

        .reference {
            background: #E8F5E9;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            color: #1A4D2E;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
        }

        /* FLOW ARROWS */
        .flow-arrow-down {
            text-align: center;
            font-size: 2.5rem;
            color: #2D6A4F;
            margin: 10px 0;
            line-height: 1;
        }

        /* NOTE BOX */
        .note-box {
            background: #E8F5E9;
            border-left: 6px solid #2D6A4F;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }

        .note-box h3 {
            color: #1A4D2E;
            margin-bottom: 10px;
        }

        .note-box ul {
            margin-left: 20px;
            color: #2C3E50;
        }

        .note-box li {
            margin: 8px 0;
        }

        /* RESPONSIVE DESIGN */
        @media (max-width: 768px) {
            .frame-nav-scroll {
                flex-wrap: nowrap;
                overflow-x: auto;
                justify-content: flex-start;
            }

            .frame-nav-btn {
                font-size: 0.85rem;
                padding: 8px 16px;
            }

            .back-to-index-btn {
                position: static;
                display: inline-block;
                margin-top: 10px;
                font-size: 0.85rem;
                padding: 8px 16px;
            }

            .header-bar h1 {
                font-size: 1.3rem;
            }

            .header-bar p {
                font-size: 0.8rem;
            }
        }

        @media print {
            .header-bar, .controls-bar, .frame-navigation {
                position: static;
            }
        }
    </style>
    <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
    <!-- NAVIGATION BAR -->
    <nav class="architecture-nav">
        <a href="index.html">🏠 Home</a>
        <a href="manual-onboarding.html">📝 Manual Onboarding</a>
        <a href="beezaro-copilot.html">🤖 Beezaro Copilot</a>
        <a href="live-dashboard-overview.html">📊 Live Dashboard</a>
        <a href="automation-library-builders.html" class="active">🛠️ Automation Builders</a>
        <a href="complete-architecture-map.html">🗺️ Complete Map</a>
    </nav>

    <!-- BREADCRUMB -->
    <div class="breadcrumb">
        <a href="index.html">🏠 Home</a> <span>/</span> <span>⚡ Automation Library + Builders</span>
    </div>

    <div class="header-bar">
        <h1>⚡ UnifiedBeez Automation Library + Builders - Backend Architecture</h1>
        <p>Email Builder | Form Builder | Campaign Automation | Retention & Nurture | Sales & Lead Gen | Support & Escalation</p>
        <a href="index.html" class="back-to-index-btn">← Back to Index</a>
    </div>

    <div class="controls-bar">
        <button class="control-btn" onclick="zoomIn()">🔍 Zoom In</button>
        <button class="control-btn" onclick="zoomOut()">🔍 Zoom Out</button>
        <button class="control-btn" onclick="resetZoom()">↺ Reset</button>
        <span class="zoom-level" id="zoomLevel">100%</span>
        <button class="control-btn" onclick="exportScreenshot()">📸 Prepare Screenshot</button>
    </div>

    <!-- FRAME NAVIGATION -->
    <div class="frame-navigation">
        <div class="frame-nav-scroll">
            <a href="#frame1" class="frame-nav-btn">Frame 1: System Overview</a>
            <a href="#frame2" class="frame-nav-btn">Frame 2: Email Builder - Core</a>
            <a href="#frame3" class="frame-nav-btn">Frame 3: Email Builder - Templates</a>
            <a href="#frame4" class="frame-nav-btn">Frame 4: Form Builder</a>
            <a href="#frame5" class="frame-nav-btn">Frame 5: Campaign Automation - Core</a>
            <a href="#frame6" class="frame-nav-btn">Frame 6: Campaign Automation - Multi-Channel</a>
            <a href="#frame7" class="frame-nav-btn">Frame 7: Retention & Nurture</a>
            <a href="#frame8" class="frame-nav-btn">Frame 8: Sales - Lead Capture</a>
            <a href="#frame9" class="frame-nav-btn">Frame 9: Sales - CRM Integration</a>
            <a href="#frame10" class="frame-nav-btn">Frame 10: Sales - Email Verification</a>
            <a href="#frame11" class="frame-nav-btn">Frame 11: Sales - Smart Consent</a>
            <a href="#frame12" class="frame-nav-btn">Frame 12: Support & Escalation - FAQ</a>
            <a href="#frame13" class="frame-nav-btn">Frame 13: Support & Escalation - Rules</a>
            <a href="#frame14" class="frame-nav-btn">Frame 14: A/B Testing & Segmentation</a>
            <a href="#frame15" class="frame-nav-btn">Frame 15: Analytics & Reporting</a>
        </div>
    </div>

    <div class="diagram-container" id="diagramContainer">
        <div class="diagram-wrapper" id="diagramWrapper">

            <!-- FRAME 1: AUTOMATION SYSTEM OVERVIEW -->
            <div class="frame" id="frame1">
                <div class="frame-title">
                    FRAME 1: AUTOMATION SYSTEM OVERVIEW
                </div>
                <div class="frame-subtitle">
                    Core Automation Engine Architecture - Foundation for All 6 Builders
                </div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #D4E9E2;"></div>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FFF9E6;"></div>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #B7E4C7;"></div>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">
                        👤 SWIM LANE 1: USER ACTIONS - Automation Creation Workflow
                    </div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Create Automation</h3>
                                <ul>
                                    <li>Select builder type (Email, Form, Campaign, etc.)</li>
                                    <li>Choose template or start from scratch</li>
                                    <li>Name automation</li>
                                    <li>Set automation goal</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Define Triggers</h3>
                                <ul>
                                    <li>Select trigger type (50+ options)</li>
                                    <li>Configure trigger conditions</li>
                                    <li>Set trigger frequency</li>
                                    <li>Define trigger filters</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Build Workflow</h3>
                                <ul>
                                    <li>Add actions (email, SMS, WhatsApp)</li>
                                    <li>Configure wait states</li>
                                    <li>Add conditional logic (if/then)</li>
                                    <li>Set up branching paths</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Test & Activate</h3>
                                <ul>
                                    <li>Preview automation flow</li>
                                    <li>Test with sample data</li>
                                    <li>Review analytics setup</li>
                                    <li>Activate automation</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">
                        ⚙️ SWIM LANE 2: CORE AUTOMATION BACKEND SERVICES
                    </div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">
                            <div class="service-card">
                                <h3><span class="service-icon">⚡</span> Automation Engine Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /automations/create<br>
                                        • GET /automations/:id<br>
                                        • PUT /automations/:id<br>
                                        • POST /automations/:id/activate<br>
                                        • POST /automations/:id/deactivate<br>
                                        • DELETE /automations/:id
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • Workflow orchestration<br>
                                        • State management<br>
                                        • Version control<br>
                                        • Template management
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🎯</span> Trigger Evaluation Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /triggers/evaluate<br>
                                        • GET /triggers/types<br>
                                        • POST /triggers/:id/test
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • 50+ trigger types<br>
                                        • Real-time event processing<br>
                                        • Scheduled triggers (cron)<br>
                                        • Webhook triggers
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🧠</span> Condition Logic Engine</h3>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • Smart Rules evaluation<br>
                                        • Boolean logic (AND/OR/NOT)<br>
                                        • Nested conditions<br>
                                        • Dynamic field comparison
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Operators:</div>
                                    <div class="section-content">
                                        • Equals, Not Equals, Contains<br>
                                        • Greater than, Less than<br>
                                        • Regex pattern matching<br>
                                        • Date/time comparisons
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🚀</span> Action Executor Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /actions/execute<br>
                                        • GET /actions/types<br>
                                        • GET /actions/:id/status
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Action Types:</div>
                                    <div class="section-content">
                                        • Send email, SMS, WhatsApp<br>
                                        • Update contact fields<br>
                                        • Add/remove tags<br>
                                        • Create tasks<br>
                                        • Trigger webhooks<br>
                                        • Wait/delay actions
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📊</span> Analytics Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • GET /automations/:id/analytics<br>
                                        • GET /automations/:id/runs<br>
                                        • GET /automations/:id/performance
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Metrics Tracked:</div>
                                    <div class="section-content">
                                        • Execution count<br>
                                        • Success/failure rate<br>
                                        • Average execution time<br>
                                        • Conversion rates<br>
                                        • Revenue attribution
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📋</span> Template Library Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • GET /templates<br>
                                        • GET /templates/:id<br>
                                        • POST /templates/:id/use<br>
                                        • POST /templates/save-custom
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • 200+ preset templates<br>
                                        • Category filtering<br>
                                        • Industry-specific templates<br>
                                        • Custom template saving
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">
                        ☁️ SWIM LANE 3: AWS INFRASTRUCTURE FOR AUTOMATION SYSTEM
                    </div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">
                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate
                                </h4>
                                <div class="section-content">
                                    <strong>Services:</strong><br>
                                    • Automation Engine<br>
                                    • Trigger Evaluator<br>
                                    • Action Executor<br><br>
                                    <strong>Configuration:</strong><br>
                                    • Tasks: 3-15 (auto-scaling)<br>
                                    • CPU: 4 vCPU<br>
                                    • RAM: 8GB<br>
                                    • Port: 3000
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL
                                </h4>
                                <div class="section-content">
                                    <strong>Configuration:</strong><br>
                                    • Multi-AZ<br>
                                    • db.t4g.medium<br>
                                    • 100GB storage<br><br>
                                    <strong>Tables:</strong><br>
                                    • automations<br>
                                    • automation_runs<br>
                                    • automation_actions<br>
                                    • automation_triggers<br><br>
                                    <strong>Port:</strong> 5432
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Queue-Service.svg" alt="SQS" class="aws-icon">
                                    SQS Queues
                                </h4>
                                <div class="section-content">
                                    <strong>Queues:</strong><br>
                                    • automation-execution-queue<br>
                                    • automation-email-queue<br>
                                    • automation-sms-queue<br>
                                    • automation-webhook-queue<br><br>
                                    <strong>Purpose:</strong><br>
                                    • Async action processing<br>
                                    • Visibility timeout: 5 min<br>
                                    • DLQ for failed actions
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    • Bull Queue backend<br>
                                    • Automation state cache<br>
                                    • Rate limiting<br>
                                    • Session locking<br><br>
                                    <strong>Type:</strong><br>
                                    • cache.t4g.micro<br>
                                    • Multi-AZ (Primary + Replica)<br><br>
                                    <strong>Port:</strong> 6379
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Compute/Lambda.svg" alt="Lambda" class="aws-icon">
                                    Lambda Functions
                                </h4>
                                <div class="section-content">
                                    <strong>Functions:</strong><br>
                                    • automation-scheduler<br>
                                    • automation-cleanup<br>
                                    • automation-webhook-handler<br><br>
                                    <strong>Triggers:</strong><br>
                                    • EventBridge (cron)<br>
                                    • API Gateway<br>
                                    • Timeout: 5 minutes
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/EventBridge.svg" alt="EventBridge" class="aws-icon">
                                    EventBridge
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    • Scheduled automation triggers<br>
                                    • Time-based workflows<br><br>
                                    <strong>Rules:</strong><br>
                                    • Daily digest automations<br>
                                    • Weekly reports<br>
                                    • Monthly retention campaigns<br>
                                    • Custom cron expressions
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Management-Governance/CloudWatch.svg" alt="CloudWatch" class="aws-icon">
                                    CloudWatch
                                </h4>
                                <div class="section-content">
                                    <strong>Log Groups:</strong><br>
                                    • /aws/ecs/automation-engine<br>
                                    • /aws/lambda/automation-scheduler<br><br>
                                    <strong>Metrics:</strong><br>
                                    • Automation execution count<br>
                                    • Success/failure rate<br>
                                    • Average execution time<br><br>
                                    <strong>Retention:</strong> 30 days
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Secrets-Manager.svg" alt="Secrets Manager" class="aws-icon">
                                    Secrets Manager
                                </h4>
                                <div class="section-content">
                                    <strong>Stored:</strong><br>
                                    • OpenAI API key<br>
                                    • Twilio credentials<br>
                                    • Webhook secrets<br>
                                    • Email service credentials<br><br>
                                    <strong>Encryption:</strong><br>
                                    • KMS encrypted<br>
                                    • Auto-rotation enabled
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">
                        🗄️ SWIM LANE 4: CORE AUTOMATION DATABASE SCHEMA (PostgreSQL)
                    </div>
                    <div class="lane-content lane-data">
                        <div class="db-table">
                            <div class="table-header">TABLE: automations</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Automation identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK → organizations(id)</div>
                                    <div>Organization owner</div>
                                </div>
                                <div class="table-row">
                                    <div>name</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Automation name</div>
                                </div>
                                <div class="table-row">
                                    <div>type</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>email|form|campaign|retention|sales|support</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>VARCHAR(50)</div>
                                    <div>DEFAULT 'draft'</div>
                                    <div>draft|active|paused|archived</div>
                                </div>
                                <div class="table-row">
                                    <div>configuration</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Automation workflow definition (triggers, actions, conditions)</div>
                                </div>
                                <div class="table-row">
                                    <div>templateId</div>
                                    <div>INTEGER</div>
                                    <div>FK → automation_templates(id)</div>
                                    <div>Source template (if created from template)</div>
                                </div>
                                <div class="table-row">
                                    <div>createdBy</div>
                                    <div>INTEGER</div>
                                    <div>FK → users(id)</div>
                                    <div>Creator user</div>
                                </div>
                                <div class="table-row">
                                    <div>activatedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When automation was activated</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Creation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>updatedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last update timestamp</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: automation_runs</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Run identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>automationId</div>
                                    <div>INTEGER</div>
                                    <div>FK → automations(id)</div>
                                    <div>Automation being executed</div>
                                </div>
                                <div class="table-row">
                                    <div>contactId</div>
                                    <div>INTEGER</div>
                                    <div>FK → contacts(id)</div>
                                    <div>Target contact</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>pending|running|completed|failed</div>
                                </div>
                                <div class="table-row">
                                    <div>startedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NOT NULL</div>
                                    <div>Execution start time</div>
                                </div>
                                <div class="table-row">
                                    <div>completedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>Execution completion time</div>
                                </div>
                                <div class="table-row">
                                    <div>executionLog</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Step-by-step execution details</div>
                                </div>
                                <div class="table-row">
                                    <div>errorMessage</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Error details (if failed)</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: automation_triggers</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Trigger identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>automationId</div>
                                    <div>INTEGER</div>
                                    <div>FK → automations(id)</div>
                                    <div>Associated automation</div>
                                </div>
                                <div class="table-row">
                                    <div>triggerType</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NOT NULL</div>
                                    <div>contact_created|tag_added|form_submitted|etc.</div>
                                </div>
                                <div class="table-row">
                                    <div>conditions</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Trigger filter conditions</div>
                                </div>
                                <div class="table-row">
                                    <div>schedule</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>Cron expression (for scheduled triggers)</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: automation_actions</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Action identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>automationId</div>
                                    <div>INTEGER</div>
                                    <div>FK → automations(id)</div>
                                    <div>Associated automation</div>
                                </div>
                                <div class="table-row">
                                    <div>actionType</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NOT NULL</div>
                                    <div>send_email|send_sms|add_tag|create_task|etc.</div>
                                </div>
                                <div class="table-row">
                                    <div>stepOrder</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL</div>
                                    <div>Execution sequence</div>
                                </div>
                                <div class="table-row">
                                    <div>configuration</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Action-specific config (template, delay, etc.)</div>
                                </div>
                                <div class="table-row">
                                    <div>parentActionId</div>
                                    <div>INTEGER</div>
                                    <div>FK → automation_actions(id)</div>
                                    <div>Parent action (for branching)</div>
                                </div>
                                <div class="table-row">
                                    <div>conditions</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Conditional execution rules</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">
                        🛡️ SWIM LANE 5: GDPR COMPLIANCE FOR AUTOMATION SYSTEM
                    </div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">
                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Automation Data Retention</h3>
                                <div class="gdpr-section">
                                    <strong>Automation Runs Data Retention</strong>
                                    <strong style="color: #333; font-weight: 400;">Policy:</strong> 90 days for execution logs<br>
                                    <strong style="color: #333; font-weight: 400;">Aggregated Analytics:</strong> Retained indefinitely (no PII)<br>
                                    <strong style="color: #333; font-weight: 400;">Automated Cleanup:</strong> Lambda function runs daily
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Data Retention" (Line 1678)
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Right to Data Portability</h3>
                                <div class="gdpr-section">
                                    <strong>Article 20: Data Portability</strong>
                                    <strong style="color: #333; font-weight: 400;">Export Includes:</strong><br>
                                    • All automation configurations<br>
                                    • Automation run history (90 days)<br>
                                    • Templates created by user<br>
                                    <strong style="color: #333; font-weight: 400;">Format:</strong> JSON export within 24 hours
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 20: Right to Data Portability
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Right to Erasure</h3>
                                <div class="gdpr-section">
                                    <strong>Article 17: Right to Be Forgotten</strong>
                                    <strong style="color: #333; font-weight: 400;">Deletion Workflow:</strong><br>
                                    1. Soft delete automations (30-day recovery)<br>
                                    2. Stop all running automations immediately<br>
                                    3. Purge execution logs after 30 days<br>
                                    4. Remove from analytics (anonymize metrics)
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 17: Right to Erasure
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Consent Management</h3>
                                <div class="gdpr-section">
                                    <strong>Marketing Automation Consent</strong>
                                    <strong style="color: #333; font-weight: 400;">Article 6(1)(a):</strong> Explicit consent for marketing automations<br>
                                    <strong style="color: #333; font-weight: 400;">Opt-out:</strong> One-click unsubscribe in all emails<br>
                                    <strong style="color: #333; font-weight: 400;">Audit Trail:</strong> Consent timestamp + IP address logged
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 6: Lawful Basis for Processing
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="note-box">
                    <h3>📝 Navigation Guide</h3>
                    <p><strong>This Overview Frame establishes the foundation architecture shared by all 6 builders:</strong></p>
                    <ul>
                        <li><strong>Frame 2-4:</strong> Email Builder (Component System, Content Management, Delivery)</li>
                        <li><strong>Frame 5-6:</strong> Form Builder (Schema Builder, Integration)</li>
                        <li><strong>Frame 7-10:</strong> Campaign Automation Builder (Workflow Engine, Multi-Channel, Templates, Analytics)</li>
                        <li><strong>Frame 11-12:</strong> Retention & Nurture Builder (Workflow, Execution)</li>
                        <li><strong>Frame 13-16:</strong> Sales & Lead Generation Builder (Lead Capture, CRM Tagging, Consent, Email Config)</li>
                        <li><strong>Frame 17-18:</strong> Support & Escalation Builder (FAQ Management, Channel Integration)</li>
                    </ul>
                </div>

            </div>
            <!-- END FRAME 1 -->

            <!-- FRAME 2: EMAIL BUILDER - COMPONENT ARCHITECTURE -->
            <div class="frame" id="frame2">
                <div class="frame-title">
                    FRAME 2: EMAIL BUILDER - COMPONENT ARCHITECTURE
                </div>
                <div class="frame-subtitle">
                    13 Email Component Types | Template System | Media Management
                </div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #D4E9E2;"></div>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FFF9E6;"></div>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #B7E4C7;"></div>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">
                        👤 SWIM LANE 1: EMAIL BUILDER USER ACTIONS
                    </div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Create Email Template</h3>
                                <ul>
                                    <li>Choose layout (4 layout types)</li>
                                    <li>Select email type (Basic, E-commerce, Socials)</li>
                                    <li>Name email template</li>
                                    <li>Set subject line</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Add Components</h3>
                                <ul>
                                    <li>Drag/drop 13 component types</li>
                                    <li>Button, Header, Image, Video, GIF</li>
                                    <li>Paragraph, Link, Divider, Spacer</li>
                                    <li>Social icons, Stickers, HTML, Icon</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Configure Components</h3>
                                <ul>
                                    <li>Edit content (text, links, media)</li>
                                    <li>Adjust layout (alignment, padding)</li>
                                    <li>Style customization (colors, fonts)</li>
                                    <li>Add dynamic merge fields</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Preview & Save</h3>
                                <ul>
                                    <li>Desktop/mobile preview</li>
                                    <li>Test with sample data</li>
                                    <li>Save as template</li>
                                    <li>Publish to automation</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">
                        ⚙️ SWIM LANE 2: EMAIL BUILDER BACKEND SERVICES
                    </div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">
                            <div class="service-card">
                                <h3><span class="service-icon">📧</span> Email Template Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /email-templates/create<br>
                                        • GET /email-templates/:id<br>
                                        • PUT /email-templates/:id<br>
                                        • DELETE /email-templates/:id<br>
                                        • GET /email-templates/list<br>
                                        • POST /email-templates/:id/duplicate<br>
                                        • POST /email-templates/:id/preview
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • Template CRUD operations<br>
                                        • Version control<br>
                                        • Template categorization<br>
                                        • Search & filtering
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🧩</span> Email Component Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /email-components/add<br>
                                        • PUT /email-components/:id<br>
                                        • DELETE /email-components/:id<br>
                                        • POST /email-components/reorder<br>
                                        • GET /email-components/types
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Component Types (13):</div>
                                    <div class="section-content">
                                        • Button, Header, Image, Video<br>
                                        • Paragraph, Link, Divider, Spacer<br>
                                        • Social, Sticker, HTML, Icon, GIF
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📁</span> Media Storage Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /media/upload<br>
                                        • GET /media/:id<br>
                                        • DELETE /media/:id<br>
                                        • GET /media/list
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • S3 upload (images, videos, GIFs)<br>
                                        • Automatic image optimization<br>
                                        • CloudFront CDN distribution<br>
                                        • File type validation (10MB limit)
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🎨</span> Email Rendering Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /email-render/preview<br>
                                        • POST /email-render/generate-html<br>
                                        • POST /email-render/test-send
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • Component-to-HTML conversion<br>
                                        • Responsive email CSS<br>
                                        • Cross-client compatibility<br>
                                        • Merge field substitution
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🔀</span> Merge Field Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • GET /merge-fields/list<br>
                                        • POST /merge-fields/validate<br>
                                        • POST /merge-fields/resolve
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Available Merge Fields:</div>
                                    <div class="section-content">
                                        • {{firstName}}, {{lastName}}<br>
                                        • {{email}}, {{phone}}<br>
                                        • {{company}}, {{industry}}<br>
                                        • {{customField_*}}<br>
                                        • Dynamic contact properties
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📦</span> Product Grid Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /product-grid/add<br>
                                        • PUT /product-grid/:id<br>
                                        • GET /product-grid/shopify-sync
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • E-commerce product display<br>
                                        • Shopify integration<br>
                                        • Dynamic product insertion<br>
                                        • Grid/list layouts
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">
                        ☁️ SWIM LANE 3: AWS INFRASTRUCTURE FOR EMAIL BUILDER
                    </div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">
                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate
                                </h4>
                                <div class="section-content">
                                    <strong>Services:</strong><br>
                                    • Email Template Service<br>
                                    • Email Rendering Service<br><br>
                                    <strong>Configuration:</strong><br>
                                    • Tasks: 2-8<br>
                                    • CPU: 2 vCPU<br>
                                    • RAM: 4GB
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL
                                </h4>
                                <div class="section-content">
                                    <strong>Tables:</strong><br>
                                    • email_templates<br>
                                    • email_components<br>
                                    • email_layouts<br>
                                    • email_media<br><br>
                                    <strong>Indexes:</strong><br>
                                    • organizationId + status<br>
                                    • templateId + componentOrder
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Storage/Simple-Storage-Service.svg" alt="S3" class="aws-icon">
                                    S3 Buckets
                                </h4>
                                <div class="section-content">
                                    <strong>Buckets:</strong><br>
                                    • unifiedbeez-email-media/<br>
                                    • unifiedbeez-email-images/<br>
                                    • unifiedbeez-email-videos/<br><br>
                                    <strong>Features:</strong><br>
                                    • Versioning enabled<br>
                                    • Lifecycle: 90 days → Glacier
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Networking-Content-Delivery/CloudFront.svg" alt="CloudFront" class="aws-icon">
                                    CloudFront
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    • Email image CDN<br>
                                    • Video streaming<br><br>
                                    <strong>Configuration:</strong><br>
                                    • Origin: S3 email-media<br>
                                    • Cache TTL: 7 days<br>
                                    • Edge locations: 450+
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Compute/Lambda.svg" alt="Lambda" class="aws-icon">
                                    Lambda Functions
                                </h4>
                                <div class="section-content">
                                    <strong>Functions:</strong><br>
                                    • image-optimizer<br>
                                    • video-transcoder<br>
                                    • email-html-generator<br><br>
                                    <strong>Trigger:</strong><br>
                                    • S3 PUT events<br>
                                    • Timeout: 3 minutes
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    • Template cache<br>
                                    • Rendered HTML cache<br>
                                    • Component library cache<br><br>
                                    <strong>TTL:</strong> 1 hour
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">
                        🗄️ SWIM LANE 4: EMAIL BUILDER DATABASE SCHEMA
                    </div>
                    <div class="lane-content lane-data">
                        <div class="db-table">
                            <div class="table-header">TABLE: email_templates</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Template identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK → organizations(id)</div>
                                    <div>Organization owner</div>
                                </div>
                                <div class="table-row">
                                    <div>name</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Template name</div>
                                </div>
                                <div class="table-row">
                                    <div>subject</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Email subject line (supports merge fields)</div>
                                </div>
                                <div class="table-row">
                                    <div>preheader</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Preview text</div>
                                </div>
                                <div class="table-row">
                                    <div>layoutType</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>layout1|layout2|layout3|layout4</div>
                                </div>
                                <div class="table-row">
                                    <div>emailType</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>basic|ecommerce|socials</div>
                                </div>
                                <div class="table-row">
                                    <div>configuration</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Full email structure (components, styles, settings)</div>
                                </div>
                                <div class="table-row">
                                    <div>renderedHtml</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Cached HTML output</div>
                                </div>
                                <div class="table-row">
                                    <div>thumbnailUrl</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>S3 path to preview image</div>
                                </div>
                                <div class="table-row">
                                    <div>createdBy</div>
                                    <div>INTEGER</div>
                                    <div>FK → users(id)</div>
                                    <div>Creator user</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Creation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>updatedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last update timestamp</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: email_components</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Component identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>templateId</div>
                                    <div>INTEGER</div>
                                    <div>FK → email_templates(id)</div>
                                    <div>Parent template</div>
                                </div>
                                <div class="table-row">
                                    <div>componentType</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>button|header|image|video|paragraph|link|divider|etc.</div>
                                </div>
                                <div class="table-row">
                                    <div>componentOrder</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL</div>
                                    <div>Display sequence</div>
                                </div>
                                <div class="table-row">
                                    <div>content</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Component-specific content (text, URLs, settings)</div>
                                </div>
                                <div class="table-row">
                                    <div>styles</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Component styling (colors, fonts, padding, alignment)</div>
                                </div>
                                <div class="table-row">
                                    <div>layout</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Layout settings (width, height, responsive rules)</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: email_media</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Media identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK → organizations(id)</div>
                                    <div>Organization owner</div>
                                </div>
                                <div class="table-row">
                                    <div>fileName</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Original filename</div>
                                </div>
                                <div class="table-row">
                                    <div>fileType</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>image|video|gif</div>
                                </div>
                                <div class="table-row">
                                    <div>s3Key</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>S3 object key</div>
                                </div>
                                <div class="table-row">
                                    <div>cdnUrl</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>CloudFront distribution URL</div>
                                </div>
                                <div class="table-row">
                                    <div>fileSize</div>
                                    <div>BIGINT</div>
                                    <div>NOT NULL</div>
                                    <div>File size in bytes</div>
                                </div>
                                <div class="table-row">
                                    <div>uploadedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Upload timestamp</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">
                        🛡️ SWIM LANE 5: GDPR COMPLIANCE FOR EMAIL BUILDER
                    </div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">
                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Email Media Retention</h3>
                                <div class="gdpr-section">
                                    <strong>S3 Lifecycle Policy</strong>
                                    <strong style="color: #333; font-weight: 400;">Policy:</strong> 90 days Standard → Glacier<br>
                                    <strong style="color: #333; font-weight: 400;">Deletion:</strong> After 365 days or account deletion<br>
                                    <strong style="color: #333; font-weight: 400;">Recovery Window:</strong> 30 days (S3 versioning)
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Data Retention" (Line 1678)
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Template Data Export</h3>
                                <div class="gdpr-section">
                                    <strong>Article 20: Data Portability</strong>
                                    <strong style="color: #333; font-weight: 400;">Export Includes:</strong><br>
                                    • All email templates (JSON)<br>
                                    • Component configurations<br>
                                    • Media files (S3 downloads)<br>
                                    <strong style="color: #333; font-weight: 400;">Format:</strong> ZIP archive delivered within 24 hours
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 20: Right to Data Portability
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Template Deletion</h3>
                                <div class="gdpr-section">
                                    <strong>Article 17: Right to Erasure</strong>
                                    <strong style="color: #333; font-weight: 400;">Deletion Workflow:</strong><br>
                                    1. Soft delete templates (30-day recovery)<br>
                                    2. Mark S3 media for deletion<br>
                                    3. Purge cached HTML from Redis<br>
                                    4. Remove from CloudFront CDN
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 17: Right to Erasure
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Email Content Encryption</h3>
                                <div class="gdpr-section">
                                    <strong>Security Measures</strong>
                                    <strong style="color: #333; font-weight: 400;">S3 Encryption:</strong> SSE-KMS<br>
                                    <strong style="color: #333; font-weight: 400;">Database Encryption:</strong> RDS at-rest encryption<br>
                                    <strong style="color: #333; font-weight: 400;">Transit:</strong> TLS 1.3 for all API calls
                                </div>
                                <div class="reference">
                                    → CONSOLIDATED_ARCHITECTURE.md<br>
                                    &nbsp;&nbsp; Decision #12: Security & IAM
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 2 -->

            <!-- FRAME 3: EMAIL BUILDER - DELIVERY & TRACKING -->
            <div class="frame" id="frame3">
                <div class="frame-title">
                    FRAME 3: EMAIL BUILDER - DELIVERY & TRACKING
                </div>
                <div class="frame-subtitle">
                    Email Delivery via Sendy + AWS SES | Open/Click Tracking | Bounce Handling | GDPR Unsubscribe
                </div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #D4E9E2;"></div>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FFF9E6;"></div>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #B7E4C7;"></div>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">
                        👤 SWIM LANE 1: EMAIL DELIVERY USER ACTIONS
                    </div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Send Test Email</h3>
                                <ul>
                                    <li>Enter test recipient email</li>
                                    <li>Preview with merge fields</li>
                                    <li>Send test (delivered within seconds)</li>
                                    <li>Verify inbox delivery</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Configure Delivery</h3>
                                <ul>
                                    <li>Set sender name & email</li>
                                    <li>Configure reply-to address</li>
                                    <li>Enable tracking (opens, clicks)</li>
                                    <li>Set unsubscribe link</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Send to List/Automation</h3>
                                <ul>
                                    <li>Select contact list or automation</li>
                                    <li>Review recipient count</li>
                                    <li>Schedule or send immediately</li>
                                    <li>Confirm sending</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Monitor Analytics</h3>
                                <ul>
                                    <li>View delivery status</li>
                                    <li>Track open rate</li>
                                    <li>Track click-through rate</li>
                                    <li>Review bounce/complaints</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">
                        ⚙️ SWIM LANE 2: EMAIL DELIVERY BACKEND SERVICES
                    </div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">
                            <div class="service-card">
                                <h3><span class="service-icon">📤</span> Email Delivery Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /emails/send<br>
                                        • POST /emails/send-test<br>
                                        • POST /emails/send-batch<br>
                                        • GET /emails/:id/status<br>
                                        • POST /emails/schedule
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Integration:</div>
                                    <div class="section-content">
                                        • Sendy (self-hosted)<br>
                                        • AWS SES for delivery<br>
                                        • Queue-based sending<br>
                                        • Rate limiting (14 emails/sec)
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📊</span> Email Tracking Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • GET /tracking/open/:trackingId<br>
                                        • GET /tracking/click/:trackingId<br>
                                        • POST /tracking/webhook (AWS SES)<br>
                                        • GET /emails/:id/analytics
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Tracking Methods:</div>
                                    <div class="section-content">
                                        • Open tracking (1x1 pixel)<br>
                                        • Click tracking (URL rewriting)<br>
                                        • Bounce notifications (SES SNS)<br>
                                        • Complaint handling (SES SNS)
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🚫</span> Unsubscribe Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • GET /unsubscribe/:token<br>
                                        • POST /unsubscribe/confirm<br>
                                        • GET /unsubscribe/preferences/:token
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • One-click unsubscribe<br>
                                        • Preference center<br>
                                        • Global suppression list<br>
                                        • GDPR-compliant opt-out
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">⚠️</span> Bounce Handling Service</h3>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • Hard bounce detection<br>
                                        • Soft bounce retry (3 attempts)<br>
                                        • Auto-suppression after 3 hard bounces<br>
                                        • Complaint (spam) tracking
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">AWS SES Integration:</div>
                                    <div class="section-content">
                                        • SNS webhook for bounce events<br>
                                        • SNS webhook for complaint events<br>
                                        • Real-time status updates
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">
                        ☁️ SWIM LANE 3: AWS INFRASTRUCTURE FOR EMAIL DELIVERY
                    </div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">
                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate
                                </h4>
                                <div class="section-content">
                                    <strong>Services:</strong><br>
                                    • Email Delivery Service<br>
                                    • Email Tracking Service<br><br>
                                    <strong>Configuration:</strong><br>
                                    • Tasks: 2-10<br>
                                    • CPU: 2 vCPU<br>
                                    • RAM: 4GB
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Notification-Service.svg" alt="SES" class="aws-icon">
                                    AWS SES
                                </h4>
                                <div class="section-content">
                                    <strong>Configuration:</strong><br>
                                    • Production access<br>
                                    • DKIM/SPF verified<br>
                                    • Rate: 14 emails/sec<br>
                                    • Daily limit: 50,000 emails<br><br>
                                    <strong>Features:</strong><br>
                                    • Bounce handling<br>
                                    • Complaint tracking<br>
                                    • Delivery notifications
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Queue-Service.svg" alt="SQS" class="aws-icon">
                                    SQS Queue
                                </h4>
                                <div class="section-content">
                                    <strong>Queue:</strong><br>
                                    • email-sending-queue<br><br>
                                    <strong>Purpose:</strong><br>
                                    • Async email sending<br>
                                    • Rate limiting enforcement<br>
                                    • Visibility timeout: 5 min<br>
                                    • DLQ for failed sends
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL
                                </h4>
                                <div class="section-content">
                                    <strong>Tables:</strong><br>
                                    • email_sends<br>
                                    • email_opens<br>
                                    • email_clicks<br>
                                    • email_bounces<br>
                                    • unsubscribes
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    • Rate limiting counters<br>
                                    • Suppression list cache<br>
                                    • Tracking pixel cache<br><br>
                                    <strong>TTL:</strong> 24 hours
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Management-Governance/CloudWatch.svg" alt="CloudWatch" class="aws-icon">
                                    CloudWatch
                                </h4>
                                <div class="section-content">
                                    <strong>Metrics:</strong><br>
                                    • Email send count<br>
                                    • Delivery rate<br>
                                    • Bounce rate<br>
                                    • Complaint rate<br><br>
                                    <strong>Alarms:</strong><br>
                                    • Bounce rate > 5%<br>
                                    • Complaint rate > 0.1%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">
                        🗄️ SWIM LANE 4: EMAIL DELIVERY DATABASE SCHEMA
                    </div>
                    <div class="lane-content lane-data">
                        <div class="db-table">
                            <div class="table-header">TABLE: email_sends</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Send record identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>templateId</div>
                                    <div>INTEGER</div>
                                    <div>FK → email_templates(id)</div>
                                    <div>Email template used</div>
                                </div>
                                <div class="table-row">
                                    <div>contactId</div>
                                    <div>INTEGER</div>
                                    <div>FK → contacts(id)</div>
                                    <div>Recipient contact</div>
                                </div>
                                <div class="table-row">
                                    <div>recipientEmail</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Recipient email address</div>
                                </div>
                                <div class="table-row">
                                    <div>subject</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Rendered subject line</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>queued|sent|delivered|bounced|complained</div>
                                </div>
                                <div class="table-row">
                                    <div>sesMessageId</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>AWS SES message ID</div>
                                </div>
                                <div class="table-row">
                                    <div>trackingToken</div>
                                    <div>VARCHAR(255)</div>
                                    <div>UNIQUE</div>
                                    <div>Unique tracking token</div>
                                </div>
                                <div class="table-row">
                                    <div>sentAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When sent to SES</div>
                                </div>
                                <div class="table-row">
                                    <div>deliveredAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When delivered (SES webhook)</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: email_opens</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Open event identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>emailSendId</div>
                                    <div>INTEGER</div>
                                    <div>FK → email_sends(id)</div>
                                    <div>Associated email send</div>
                                </div>
                                <div class="table-row">
                                    <div>ipAddress</div>
                                    <div>INET</div>
                                    <div>NULLABLE</div>
                                    <div>Opener's IP address</div>
                                </div>
                                <div class="table-row">
                                    <div>userAgent</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Opener's user agent</div>
                                </div>
                                <div class="table-row">
                                    <div>openedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Open timestamp</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: email_clicks</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Click event identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>emailSendId</div>
                                    <div>INTEGER</div>
                                    <div>FK → email_sends(id)</div>
                                    <div>Associated email send</div>
                                </div>
                                <div class="table-row">
                                    <div>linkUrl</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>Original link URL</div>
                                </div>
                                <div class="table-row">
                                    <div>ipAddress</div>
                                    <div>INET</div>
                                    <div>NULLABLE</div>
                                    <div>Clicker's IP address</div>
                                </div>
                                <div class="table-row">
                                    <div>clickedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Click timestamp</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: unsubscribes</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unsubscribe identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>contactId</div>
                                    <div>INTEGER</div>
                                    <div>FK → contacts(id)</div>
                                    <div>Contact who unsubscribed</div>
                                </div>
                                <div class="table-row">
                                    <div>email</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Unsubscribed email</div>
                                </div>
                                <div class="table-row">
                                    <div>reason</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Unsubscribe reason (optional)</div>
                                </div>
                                <div class="table-row">
                                    <div>unsubscribedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Unsubscribe timestamp</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">
                        🛡️ SWIM LANE 5: GDPR COMPLIANCE FOR EMAIL DELIVERY
                    </div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">
                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Email Consent Tracking</h3>
                                <div class="gdpr-section">
                                    <strong>Article 6: Lawful Basis for Processing</strong>
                                    <strong style="color: #333; font-weight: 400;">Consent Required:</strong> Marketing emails require explicit opt-in<br>
                                    <strong style="color: #333; font-weight: 400;">Transactional Emails:</strong> Legitimate interest basis<br>
                                    <strong style="color: #333; font-weight: 400;">Audit Trail:</strong> Consent timestamp + IP logged
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 6: Lawful Basis for Processing
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> One-Click Unsubscribe</h3>
                                <div class="gdpr-section">
                                    <strong>Article 21: Right to Object</strong>
                                    <strong style="color: #333; font-weight: 400;">Unsubscribe Link:</strong> In every marketing email footer<br>
                                    <strong style="color: #333; font-weight: 400;">Processing:</strong> Immediate (no confirmation required)<br>
                                    <strong style="color: #333; font-weight: 400;">Effect:</strong> Global suppression within 24 hours
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 21: Right to Object
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Email Data Retention</h3>
                                <div class="gdpr-section">
                                    <strong>Data Retention Policy</strong>
                                    <strong style="color: #333; font-weight: 400;">Email Sends:</strong> 90 days retention<br>
                                    <strong style="color: #333; font-weight: 400;">Opens/Clicks:</strong> 90 days retention<br>
                                    <strong style="color: #333; font-weight: 400;">Bounces:</strong> Permanent (suppress list)<br>
                                    <strong style="color: #333; font-weight: 400;">Unsubscribes:</strong> Permanent (legal requirement)
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Data Retention" (Line 1678)
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Email Analytics Export</h3>
                                <div class="gdpr-section">
                                    <strong>Article 20: Data Portability</strong>
                                    <strong style="color: #333; font-weight: 400;">Export Includes:</strong><br>
                                    • All emails sent to contact<br>
                                    • Open/click history<br>
                                    • Unsubscribe status<br>
                                    <strong style="color: #333; font-weight: 400;">Format:</strong> CSV export within 24 hours
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 20: Right to Data Portability
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 3 -->

            <!-- FRAME 4: FORM BUILDER - SCHEMA & VALIDATION -->
            <div class="frame" id="frame4">
                <div class="frame-title">
                    FRAME 4: FORM BUILDER - SCHEMA & VALIDATION
                </div>
                <div class="frame-subtitle">
                    14+ Field Types | Schema Builder | Validation Rules | CAPTCHA Integration | CRM Mapping
                </div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #D4E9E2;"></div>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FFF9E6;"></div>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #B7E4C7;"></div>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">
                        👤 SWIM LANE 1: FORM BUILDER USER ACTIONS
                    </div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Create Form</h3>
                                <ul>
                                    <li>Name form</li>
                                    <li>Choose form type (lead capture, survey, contact)</li>
                                    <li>Select layout (horizontal/vertical)</li>
                                    <li>Set submission destination</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Add Form Fields</h3>
                                <ul>
                                    <li>Drag/drop 14+ field types</li>
                                    <li>Text, Email, Phone, Date, Dropdown</li>
                                    <li>Checkbox, Radio, File Upload, CAPTCHA</li>
                                    <li>Image, List Selector, Multi-select</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Configure Fields</h3>
                                <ul>
                                    <li>Set field labels & placeholders</li>
                                    <li>Configure validation rules</li>
                                    <li>Mark required/optional fields</li>
                                    <li>Map to CRM fields</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Style & Publish</h3>
                                <ul>
                                    <li>Customize colors & fonts</li>
                                    <li>Preview form</li>
                                    <li>Generate embed code</li>
                                    <li>Publish & activate</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">
                        ⚙️ SWIM LANE 2: FORM BUILDER BACKEND SERVICES
                    </div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">
                            <div class="service-card">
                                <h3><span class="service-icon">📋</span> Form Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /forms/create<br>
                                        • GET /forms/:id<br>
                                        • PUT /forms/:id<br>
                                        • DELETE /forms/:id<br>
                                        • GET /forms/list<br>
                                        • POST /forms/:id/duplicate
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • Form CRUD operations<br>
                                        • Schema management<br>
                                        • Version control<br>
                                        • Embed code generation
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📝</span> Form Field Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /forms/:id/fields<br>
                                        • PUT /forms/:id/fields/:fieldId<br>
                                        • DELETE /forms/:id/fields/:fieldId<br>
                                        • POST /forms/:id/fields/reorder
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Field Types (14+):</div>
                                    <div class="section-content">
                                        • text, email, phone, url<br>
                                        • number, date, time<br>
                                        • dropdown, radio, checkbox<br>
                                        • file_upload, textarea, captcha<br>
                                        • image, list_selector
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">✅</span> Validation Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /forms/validate-field<br>
                                        • POST /forms/validate-submission<br>
                                        • GET /forms/validation-rules
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Validation Rules:</div>
                                    <div class="section-content">
                                        • Required field validation<br>
                                        • Email format validation<br>
                                        • Phone number validation (intl)<br>
                                        • Min/max length validation<br>
                                        • Regex pattern matching<br>
                                        • Custom validation functions
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🤖</span> CAPTCHA Service</h3>
                                <div class="section">
                                    <div class="section-title">Integration:</div>
                                    <div class="section-content">
                                        • Google reCAPTCHA v3<br>
                                        • Score-based verification<br>
                                        • Invisible CAPTCHA<br>
                                        • Bot detection
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /captcha/verify<br>
                                        • GET /captcha/site-key
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🗂️</span> Form Submission Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /forms/:id/submit<br>
                                        • GET /forms/:id/submissions<br>
                                        • GET /forms/:id/submissions/:submissionId<br>
                                        • DELETE /forms/:id/submissions/:submissionId
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • Submission processing<br>
                                        • Data sanitization<br>
                                        • Spam filtering<br>
                                        • Webhook notifications
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🔗</span> CRM Mapping Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /forms/:id/crm-mapping<br>
                                        • GET /forms/:id/crm-mapping<br>
                                        • GET /crm/fields/list
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • Map form fields to CRM fields<br>
                                        • Auto-create contacts<br>
                                        • Tag assignment on submission<br>
                                        • List assignment
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">
                        ☁️ SWIM LANE 3: AWS INFRASTRUCTURE FOR FORM BUILDER
                    </div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">
                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate
                                </h4>
                                <div class="section-content">
                                    <strong>Services:</strong><br>
                                    • Form Service<br>
                                    • Form Submission Service<br>
                                    • Validation Service<br><br>
                                    <strong>Configuration:</strong><br>
                                    • Tasks: 2-8<br>
                                    • CPU: 2 vCPU<br>
                                    • RAM: 4GB
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL
                                </h4>
                                <div class="section-content">
                                    <strong>Tables:</strong><br>
                                    • forms<br>
                                    • form_fields<br>
                                    • form_submissions<br>
                                    • form_validation_rules<br><br>
                                    <strong>Indexes:</strong><br>
                                    • organizationId + status<br>
                                    • formId + submittedAt
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Compute/Lambda.svg" alt="Lambda" class="aws-icon">
                                    Lambda Functions
                                </h4>
                                <div class="section-content">
                                    <strong>Functions:</strong><br>
                                    • form-submission-processor<br>
                                    • form-file-upload-handler<br>
                                    • captcha-verifier<br><br>
                                    <strong>Trigger:</strong><br>
                                    • API Gateway<br>
                                    • S3 PUT events<br>
                                    • Timeout: 3 minutes
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Storage/Simple-Storage-Service.svg" alt="S3" class="aws-icon">
                                    S3 Buckets
                                </h4>
                                <div class="section-content">
                                    <strong>Buckets:</strong><br>
                                    • unifiedbeez-form-uploads/<br><br>
                                    <strong>Purpose:</strong><br>
                                    • File upload storage<br>
                                    • Form submission attachments<br><br>
                                    <strong>Features:</strong><br>
                                    • Versioning enabled<br>
                                    • Lifecycle: 180 days
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    • Form schema cache<br>
                                    • Validation rules cache<br>
                                    • Rate limiting (prevent spam)<br><br>
                                    <strong>TTL:</strong> 1 hour
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Queue-Service.svg" alt="SQS" class="aws-icon">
                                    SQS Queue
                                </h4>
                                <div class="section-content">
                                    <strong>Queue:</strong><br>
                                    • form-submission-queue<br><br>
                                    <strong>Purpose:</strong><br>
                                    • Async submission processing<br>
                                    • CRM contact creation<br>
                                    • Webhook notifications<br>
                                    • Visibility timeout: 2 min
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">
                        🗄️ SWIM LANE 4: FORM BUILDER DATABASE SCHEMA
                    </div>
                    <div class="lane-content lane-data">
                        <div class="db-table">
                            <div class="table-header">TABLE: forms</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Form identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK → organizations(id)</div>
                                    <div>Organization owner</div>
                                </div>
                                <div class="table-row">
                                    <div>name</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Form name</div>
                                </div>
                                <div class="table-row">
                                    <div>formType</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>lead_capture|survey|contact|registration</div>
                                </div>
                                <div class="table-row">
                                    <div>layout</div>
                                    <div>VARCHAR(50)</div>
                                    <div>DEFAULT 'vertical'</div>
                                    <div>vertical|horizontal</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>VARCHAR(50)</div>
                                    <div>DEFAULT 'draft'</div>
                                    <div>draft|published|archived</div>
                                </div>
                                <div class="table-row">
                                    <div>configuration</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Form settings (colors, fonts, submit button text)</div>
                                </div>
                                <div class="table-row">
                                    <div>embedCode</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Generated embed HTML/JS</div>
                                </div>
                                <div class="table-row">
                                    <div>successMessage</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Message shown after submission</div>
                                </div>
                                <div class="table-row">
                                    <div>redirectUrl</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Redirect after submission (optional)</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Creation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>updatedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last update timestamp</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: form_fields</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Field identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>formId</div>
                                    <div>INTEGER</div>
                                    <div>FK → forms(id)</div>
                                    <div>Parent form</div>
                                </div>
                                <div class="table-row">
                                    <div>fieldType</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>text|email|phone|dropdown|checkbox|file|etc.</div>
                                </div>
                                <div class="table-row">
                                    <div>label</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Field label</div>
                                </div>
                                <div class="table-row">
                                    <div>placeholder</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>Field placeholder text</div>
                                </div>
                                <div class="table-row">
                                    <div>required</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Is field required?</div>
                                </div>
                                <div class="table-row">
                                    <div>fieldOrder</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL</div>
                                    <div>Display order</div>
                                </div>
                                <div class="table-row">
                                    <div>validationRules</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Validation config (min, max, regex, custom)</div>
                                </div>
                                <div class="table-row">
                                    <div>options</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Options for dropdown/radio/checkbox</div>
                                </div>
                                <div class="table-row">
                                    <div>crmFieldMapping</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>CRM field to map to (e.g., firstName, email)</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: form_submissions</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Submission identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>formId</div>
                                    <div>INTEGER</div>
                                    <div>FK → forms(id)</div>
                                    <div>Form submitted</div>
                                </div>
                                <div class="table-row">
                                    <div>contactId</div>
                                    <div>INTEGER</div>
                                    <div>FK → contacts(id)</div>
                                    <div>Contact created/updated from submission</div>
                                </div>
                                <div class="table-row">
                                    <div>submissionData</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Full form submission data (field_id: value)</div>
                                </div>
                                <div class="table-row">
                                    <div>ipAddress</div>
                                    <div>INET</div>
                                    <div>NULLABLE</div>
                                    <div>Submitter's IP address</div>
                                </div>
                                <div class="table-row">
                                    <div>userAgent</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Submitter's user agent</div>
                                </div>
                                <div class="table-row">
                                    <div>captchaScore</div>
                                    <div>DECIMAL(3,2)</div>
                                    <div>NULLABLE</div>
                                    <div>reCAPTCHA score (0.0-1.0)</div>
                                </div>
                                <div class="table-row">
                                    <div>isSpam</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Spam detection flag</div>
                                </div>
                                <div class="table-row">
                                    <div>submittedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Submission timestamp</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">
                        🛡️ SWIM LANE 5: GDPR COMPLIANCE FOR FORM BUILDER
                    </div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">
                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Form Submission Consent</h3>
                                <div class="gdpr-section">
                                    <strong>Article 6: Lawful Basis for Processing</strong>
                                    <strong style="color: #333; font-weight: 400;">Consent Required:</strong> Explicit consent checkbox in forms<br>
                                    <strong style="color: #333; font-weight: 400;">Consent Text:</strong> "I agree to receive communications"<br>
                                    <strong style="color: #333; font-weight: 400;">Audit Trail:</strong> IP address + timestamp logged
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 6: Lawful Basis for Processing
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Form Data Retention</h3>
                                <div class="gdpr-section">
                                    <strong>Data Retention Policy</strong>
                                    <strong style="color: #333; font-weight: 400;">Form Submissions:</strong> 180 days retention<br>
                                    <strong style="color: #333; font-weight: 400;">File Uploads:</strong> 180 days (S3 lifecycle)<br>
                                    <strong style="color: #333; font-weight: 400;">Spam Submissions:</strong> 30 days only<br>
                                    <strong style="color: #333; font-weight: 400;">Deletion:</strong> Automated Lambda cleanup
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Data Retention" (Line 1678)
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Form Submission Export</h3>
                                <div class="gdpr-section">
                                    <strong>Article 20: Data Portability</strong>
                                    <strong style="color: #333; font-weight: 400;">Export Includes:</strong><br>
                                    • All form submissions by contact<br>
                                    • Submission timestamp + IP<br>
                                    • File upload downloads<br>
                                    <strong style="color: #333; font-weight: 400;">Format:</strong> JSON + file attachments (ZIP)
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 20: Right to Data Portability
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Form Data Deletion</h3>
                                <div class="gdpr-section">
                                    <strong>Article 17: Right to Erasure</strong>
                                    <strong style="color: #333; font-weight: 400;">Deletion Workflow:</strong><br>
                                    1. Soft delete form submissions (30 days)<br>
                                    2. Delete file uploads from S3<br>
                                    3. Anonymize IP addresses<br>
                                    4. Remove from analytics
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 17: Right to Erasure
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 4 -->

            <!-- FRAME 5: CAMPAIGN AUTOMATION BUILDER - WORKFLOW ENGINE -->
            <div class="frame" id="frame5">
                <div class="frame-title">
                    FRAME 5: CAMPAIGN AUTOMATION - WORKFLOW ENGINE
                </div>
                <div class="frame-subtitle">
                    50+ Trigger Types | Smart Rules & Conditions | Boolean Logic | Workflow Orchestration | Action Branching
                </div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #D4E9E2;"></div>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FFF9E6;"></div>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #B7E4C7;"></div>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">
                        👤 SWIM LANE 1: CAMPAIGN AUTOMATION WORKFLOW USER ACTIONS
                    </div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Create Campaign</h3>
                                <ul>
                                    <li>Name campaign</li>
                                    <li>Select campaign type (re-engagement, nurture, sales)</li>
                                    <li>Choose template or start from scratch</li>
                                    <li>Set campaign goal & KPIs</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Define Triggers</h3>
                                <ul>
                                    <li>Select trigger (50+ types)</li>
                                    <li>Contact created, tag added, form submitted</li>
                                    <li>Email opened, link clicked, purchase made</li>
                                    <li>Set trigger filters & conditions</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Build Workflow</h3>
                                <ul>
                                    <li>Add actions (email, SMS, WhatsApp, wait)</li>
                                    <li>Configure Smart Rules (if/then logic)</li>
                                    <li>Add condition groups (AND/OR/NOT)</li>
                                    <li>Create branching paths</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Test & Launch</h3>
                                <ul>
                                    <li>Preview workflow visualization</li>
                                    <li>Test with sample contacts</li>
                                    <li>Review trigger conditions</li>
                                    <li>Activate campaign</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">
                        ⚙️ SWIM LANE 2: CAMPAIGN WORKFLOW BACKEND SERVICES
                    </div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">
                            <div class="service-card">
                                <h3><span class="service-icon">🎯</span> Campaign Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /campaigns/create<br>
                                        • GET /campaigns/:id<br>
                                        • PUT /campaigns/:id<br>
                                        • POST /campaigns/:id/activate<br>
                                        • POST /campaigns/:id/pause<br>
                                        • DELETE /campaigns/:id<br>
                                        • GET /campaigns/list
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • Campaign CRUD operations<br>
                                        • Workflow orchestration<br>
                                        • State management<br>
                                        • Version control
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">⚡</span> Trigger Evaluation Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /triggers/evaluate<br>
                                        • GET /triggers/types<br>
                                        • POST /triggers/:id/test<br>
                                        • POST /triggers/register-event
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Trigger Types (50+):</div>
                                    <div class="section-content">
                                        • Contact: created, updated, tag_added<br>
                                        • Email: opened, clicked, bounced<br>
                                        • Form: submitted, abandoned<br>
                                        • Purchase: completed, refunded<br>
                                        • Time-based: date_reached, anniversary<br>
                                        • Custom: webhook, API event
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🧠</span> Smart Rules Engine</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /smart-rules/evaluate<br>
                                        • POST /smart-rules/validate<br>
                                        • GET /smart-rules/operators
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Logic Operations:</div>
                                    <div class="section-content">
                                        • Boolean: AND, OR, NOT<br>
                                        • Comparison: equals, not_equals, contains<br>
                                        • Numeric: greater_than, less_than<br>
                                        • Date: before, after, between<br>
                                        • Regex: pattern matching<br>
                                        • Nested condition groups
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🔀</span> Workflow Orchestration Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /workflows/execute<br>
                                        • GET /workflows/:id/status<br>
                                        • POST /workflows/:id/pause<br>
                                        • POST /workflows/:id/resume
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • State machine management<br>
                                        • Branching path execution<br>
                                        • Wait state handling<br>
                                        • Error recovery & retries<br>
                                        • Parallel action execution
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">⏱️</span> Wait Action Service</h3>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • Time-based delays (minutes to months)<br>
                                        • Wait until specific date/time<br>
                                        • Wait for event (e.g., email opened)<br>
                                        • Smart wait (optimal send time)
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Implementation:</div>
                                    <div class="section-content">
                                        • EventBridge scheduled rules<br>
                                        • SQS delayed messages<br>
                                        • Redis TTL for short delays<br>
                                        • Database polling for event waits
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📊</span> Campaign Analytics Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • GET /campaigns/:id/analytics<br>
                                        • GET /campaigns/:id/performance<br>
                                        • GET /campaigns/:id/funnel<br>
                                        • GET /campaigns/:id/revenue
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Metrics Tracked:</div>
                                    <div class="section-content">
                                        • Contacts entered<br>
                                        • Conversion rate<br>
                                        • Revenue attribution<br>
                                        • Action completion rates<br>
                                        • Drop-off analysis
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">
                        ☁️ SWIM LANE 3: AWS INFRASTRUCTURE FOR CAMPAIGN WORKFLOWS
                    </div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">
                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate
                                </h4>
                                <div class="section-content">
                                    <strong>Services:</strong><br>
                                    • Campaign Service<br>
                                    • Trigger Evaluation Service<br>
                                    • Workflow Orchestration<br>
                                    • Smart Rules Engine<br><br>
                                    <strong>Configuration:</strong><br>
                                    • Tasks: 5-15<br>
                                    • CPU: 4 vCPU<br>
                                    • RAM: 8GB
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL
                                </h4>
                                <div class="section-content">
                                    <strong>Tables:</strong><br>
                                    • campaigns<br>
                                    • campaign_triggers<br>
                                    • campaign_actions<br>
                                    • campaign_conditions<br>
                                    • campaign_runs<br>
                                    • campaign_analytics<br><br>
                                    <strong>Indexes:</strong><br>
                                    • campaignId + status<br>
                                    • contactId + campaignId
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Queue-Service.svg" alt="SQS" class="aws-icon">
                                    SQS Queues
                                </h4>
                                <div class="section-content">
                                    <strong>Queues:</strong><br>
                                    • campaign-trigger-queue<br>
                                    • campaign-action-queue<br>
                                    • campaign-delay-queue (delay 0-15min)<br><br>
                                    <strong>Purpose:</strong><br>
                                    • Async trigger processing<br>
                                    • Action execution<br>
                                    • Wait state delays<br>
                                    • DLQ for failed actions
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    • Campaign state cache<br>
                                    • Active workflow tracking<br>
                                    • Rate limiting<br>
                                    • Session locking<br><br>
                                    <strong>Data Structures:</strong><br>
                                    • Sorted sets (scheduled actions)<br>
                                    • Hash maps (workflow state)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/EventBridge.svg" alt="EventBridge" class="aws-icon">
                                    EventBridge
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    • Scheduled campaign triggers<br>
                                    • Time-based automation<br>
                                    • Delayed action execution<br><br>
                                    <strong>Rules:</strong><br>
                                    • Daily/weekly campaign checks<br>
                                    • Anniversary automations<br>
                                    • Custom cron schedules
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Compute/Lambda.svg" alt="Lambda" class="aws-icon">
                                    Lambda Functions
                                </h4>
                                <div class="section-content">
                                    <strong>Functions:</strong><br>
                                    • campaign-trigger-evaluator<br>
                                    • campaign-workflow-executor<br>
                                    • campaign-cleanup<br><br>
                                    <strong>Triggers:</strong><br>
                                    • EventBridge (scheduled)<br>
                                    • SQS (delayed messages)<br>
                                    • Timeout: 5 minutes
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Management-Governance/CloudWatch.svg" alt="CloudWatch" class="aws-icon">
                                    CloudWatch
                                </h4>
                                <div class="section-content">
                                    <strong>Log Groups:</strong><br>
                                    • /aws/ecs/campaign-service<br>
                                    • /aws/lambda/campaign-executor<br><br>
                                    <strong>Metrics:</strong><br>
                                    • Campaign execution count<br>
                                    • Success/failure rate<br>
                                    • Average execution time<br><br>
                                    <strong>Alarms:</strong><br>
                                    • Failed workflow rate > 5%
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Secrets-Manager.svg" alt="Secrets Manager" class="aws-icon">
                                    Secrets Manager
                                </h4>
                                <div class="section-content">
                                    <strong>Stored:</strong><br>
                                    • Webhook secrets<br>
                                    • Third-party API keys<br>
                                    • Channel credentials<br><br>
                                    <strong>Encryption:</strong><br>
                                    • KMS encrypted<br>
                                    • Auto-rotation enabled
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">
                        🗄️ SWIM LANE 4: CAMPAIGN WORKFLOW DATABASE SCHEMA
                    </div>
                    <div class="lane-content lane-data">
                        <div class="db-table">
                            <div class="table-header">TABLE: campaigns</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Campaign identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK → organizations(id)</div>
                                    <div>Organization owner</div>
                                </div>
                                <div class="table-row">
                                    <div>name</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Campaign name</div>
                                </div>
                                <div class="table-row">
                                    <div>campaignType</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>re_engagement|nurture|sales|retention</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>VARCHAR(50)</div>
                                    <div>DEFAULT 'draft'</div>
                                    <div>draft|active|paused|completed|archived</div>
                                </div>
                                <div class="table-row">
                                    <div>workflowDefinition</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Full workflow graph (triggers, actions, conditions, branches)</div>
                                </div>
                                <div class="table-row">
                                    <div>goal</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>Campaign objective</div>
                                </div>
                                <div class="table-row">
                                    <div>targetKPI</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>KPI targets (conversion_rate, revenue, etc.)</div>
                                </div>
                                <div class="table-row">
                                    <div>activatedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When campaign was activated</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Creation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>updatedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last update timestamp</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: campaign_triggers</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Trigger identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>campaignId</div>
                                    <div>INTEGER</div>
                                    <div>FK → campaigns(id)</div>
                                    <div>Associated campaign</div>
                                </div>
                                <div class="table-row">
                                    <div>triggerType</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NOT NULL</div>
                                    <div>contact_created|tag_added|email_opened|form_submitted|etc.</div>
                                </div>
                                <div class="table-row">
                                    <div>filterConditions</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Trigger filter rules (e.g., only if tag = "vip")</div>
                                </div>
                                <div class="table-row">
                                    <div>schedule</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>Cron expression (for time-based triggers)</div>
                                </div>
                                <div class="table-row">
                                    <div>isActive</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Is trigger enabled?</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: campaign_actions</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Action identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>campaignId</div>
                                    <div>INTEGER</div>
                                    <div>FK → campaigns(id)</div>
                                    <div>Associated campaign</div>
                                </div>
                                <div class="table-row">
                                    <div>actionType</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NOT NULL</div>
                                    <div>send_email|send_sms|send_whatsapp|wait|add_tag|etc.</div>
                                </div>
                                <div class="table-row">
                                    <div>stepOrder</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL</div>
                                    <div>Execution sequence</div>
                                </div>
                                <div class="table-row">
                                    <div>configuration</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Action config (templateId, delay, channel settings)</div>
                                </div>
                                <div class="table-row">
                                    <div>parentActionId</div>
                                    <div>INTEGER</div>
                                    <div>FK → campaign_actions(id)</div>
                                    <div>Parent action (for branching workflows)</div>
                                </div>
                                <div class="table-row">
                                    <div>conditionGroupId</div>
                                    <div>INTEGER</div>
                                    <div>FK → campaign_conditions(id)</div>
                                    <div>Condition required for execution</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: campaign_conditions</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Condition group identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>campaignId</div>
                                    <div>INTEGER</div>
                                    <div>FK → campaigns(id)</div>
                                    <div>Associated campaign</div>
                                </div>
                                <div class="table-row">
                                    <div>logicOperator</div>
                                    <div>VARCHAR(10)</div>
                                    <div>NOT NULL</div>
                                    <div>AND|OR|NOT</div>
                                </div>
                                <div class="table-row">
                                    <div>conditions</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Array of condition rules [{field, operator, value}]</div>
                                </div>
                                <div class="table-row">
                                    <div>parentConditionId</div>
                                    <div>INTEGER</div>
                                    <div>FK → campaign_conditions(id)</div>
                                    <div>Parent condition group (for nesting)</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: campaign_runs</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Run identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>campaignId</div>
                                    <div>INTEGER</div>
                                    <div>FK → campaigns(id)</div>
                                    <div>Campaign being executed</div>
                                </div>
                                <div class="table-row">
                                    <div>contactId</div>
                                    <div>INTEGER</div>
                                    <div>FK → contacts(id)</div>
                                    <div>Target contact</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>pending|running|waiting|completed|failed|exited</div>
                                </div>
                                <div class="table-row">
                                    <div>currentActionId</div>
                                    <div>INTEGER</div>
                                    <div>FK → campaign_actions(id)</div>
                                    <div>Current workflow step</div>
                                </div>
                                <div class="table-row">
                                    <div>workflowState</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Workflow execution state & history</div>
                                </div>
                                <div class="table-row">
                                    <div>startedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NOT NULL</div>
                                    <div>Execution start time</div>
                                </div>
                                <div class="table-row">
                                    <div>completedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>Execution completion time</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">
                        🛡️ SWIM LANE 5: GDPR COMPLIANCE FOR CAMPAIGN AUTOMATION
                    </div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">
                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Campaign Consent Tracking</h3>
                                <div class="gdpr-section">
                                    <strong>Article 6: Lawful Basis for Processing</strong>
                                    <strong style="color: #333; font-weight: 400;">Marketing Campaigns:</strong> Require explicit opt-in consent<br>
                                    <strong style="color: #333; font-weight: 400;">Transactional Campaigns:</strong> Legitimate interest basis<br>
                                    <strong style="color: #333; font-weight: 400;">Opt-out:</strong> Immediate campaign exit on unsubscribe
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 6: Lawful Basis for Processing
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Campaign Data Retention</h3>
                                <div class="gdpr-section">
                                    <strong>Data Retention Policy</strong>
                                    <strong style="color: #333; font-weight: 400;">Campaign Runs:</strong> 90 days retention<br>
                                    <strong style="color: #333; font-weight: 400;">Workflow State:</strong> 90 days retention<br>
                                    <strong style="color: #333; font-weight: 400;">Analytics:</strong> Aggregated (no PII), retained indefinitely<br>
                                    <strong style="color: #333; font-weight: 400;">Cleanup:</strong> Lambda function (daily)
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Data Retention" (Line 1678)
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Campaign Data Export</h3>
                                <div class="gdpr-section">
                                    <strong>Article 20: Data Portability</strong>
                                    <strong style="color: #333; font-weight: 400;">Export Includes:</strong><br>
                                    • All campaign runs for contact<br>
                                    • Workflow execution history<br>
                                    • Actions taken & timestamps<br>
                                    <strong style="color: #333; font-weight: 400;">Format:</strong> JSON export within 24 hours
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 20: Right to Data Portability
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Right to Object to Processing</h3>
                                <div class="gdpr-section">
                                    <strong>Article 21: Right to Object</strong>
                                    <strong style="color: #333; font-weight: 400;">Campaign Exit:</strong> Contact removed from all active campaigns<br>
                                    <strong style="color: #333; font-weight: 400;">Processing:</strong> Within 24 hours<br>
                                    <strong style="color: #333; font-weight: 400;">Effect:</strong> No further automated messages sent
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 21: Right to Object
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 5 -->

            <!-- FRAME 6: CAMPAIGN AUTOMATION - MULTI-CHANNEL MESSAGING -->
            <div class="frame" id="frame6">
                <div class="frame-title">
                    FRAME 6: CAMPAIGN AUTOMATION - MULTI-CHANNEL MESSAGING
                </div>
                <div class="frame-subtitle">
                    Email | SMS (Twilio) | WhatsApp Business API | Channel Selection | Message Templates | Delivery Tracking
                </div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #D4E9E2;"></div>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FFF9E6;"></div>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #B7E4C7;"></div>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">
                        👤 SWIM LANE 1: MULTI-CHANNEL MESSAGING USER ACTIONS
                    </div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Select Channel</h3>
                                <ul>
                                    <li>Choose message channel (Email, SMS, WhatsApp)</li>
                                    <li>View channel availability per contact</li>
                                    <li>Set fallback channel (if primary fails)</li>
                                    <li>Configure channel priorities</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Create Message</h3>
                                <ul>
                                    <li>Email: Use email builder template</li>
                                    <li>SMS: Write text message (160 chars)</li>
                                    <li>WhatsApp: Select approved template</li>
                                    <li>Add dynamic merge fields</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Configure Settings</h3>
                                <ul>
                                    <li>Set sender information</li>
                                    <li>Configure delivery timing</li>
                                    <li>Enable/disable tracking</li>
                                    <li>Set rate limits</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Test & Deploy</h3>
                                <ul>
                                    <li>Send test messages</li>
                                    <li>Preview across channels</li>
                                    <li>Verify template approval (WhatsApp)</li>
                                    <li>Add to campaign workflow</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">
                        ⚙️ SWIM LANE 2: MULTI-CHANNEL MESSAGING BACKEND SERVICES
                    </div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">
                            <div class="service-card">
                                <h3><span class="service-icon">📧</span> Email Channel Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /channels/email/send<br>
                                        • GET /channels/email/templates<br>
                                        • POST /channels/email/test
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Integration:</div>
                                    <div class="section-content">
                                        • Sendy + AWS SES<br>
                                        • Rate: 14 emails/sec<br>
                                        • Open/click tracking<br>
                                        • Bounce/complaint handling
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">💬</span> SMS Channel Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /channels/sms/send<br>
                                        • GET /channels/sms/status/:id<br>
                                        • POST /channels/sms/test<br>
                                        • GET /channels/sms/pricing
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Integration:</div>
                                    <div class="section-content">
                                        • Twilio SMS API<br>
                                        • International support (190+ countries)<br>
                                        • Delivery receipts<br>
                                        • Character count: 160 (single), 1600 (concat)
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📱</span> WhatsApp Channel Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /channels/whatsapp/send<br>
                                        • GET /channels/whatsapp/templates<br>
                                        • POST /channels/whatsapp/templates/submit<br>
                                        • GET /channels/whatsapp/template-status/:id
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Integration:</div>
                                    <div class="section-content">
                                        • WhatsApp Business Cloud API<br>
                                        • Pre-approved message templates<br>
                                        • Rich media support (images, videos, docs)<br>
                                        • Interactive buttons
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🔀</span> Channel Router Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /channel-router/send<br>
                                        • POST /channel-router/select-optimal<br>
                                        • GET /channel-router/availability/:contactId
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • Auto-select optimal channel<br>
                                        • Fallback channel logic<br>
                                        • Contact preference tracking<br>
                                        • Channel availability validation
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📋</span> Message Template Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • GET /message-templates<br>
                                        • POST /message-templates/create<br>
                                        • PUT /message-templates/:id<br>
                                        • POST /message-templates/:id/approve
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • Channel-specific templates<br>
                                        • WhatsApp template approval workflow<br>
                                        • Template versioning<br>
                                        • Variable/merge field management
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📊</span> Message Tracking Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /message-tracking/delivery<br>
                                        • POST /message-tracking/read<br>
                                        • POST /message-tracking/failed<br>
                                        • GET /message-tracking/:messageId
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Tracking Events:</div>
                                    <div class="section-content">
                                        • Sent, Delivered, Read<br>
                                        • Failed, Bounced<br>
                                        • Clicked (email/WhatsApp buttons)<br>
                                        • Replied
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">
                        ☁️ SWIM LANE 3: AWS INFRASTRUCTURE FOR MULTI-CHANNEL MESSAGING
                    </div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">
                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate
                                </h4>
                                <div class="section-content">
                                    <strong>Services:</strong><br>
                                    • Email Channel Service<br>
                                    • SMS Channel Service<br>
                                    • WhatsApp Channel Service<br>
                                    • Channel Router Service<br><br>
                                    <strong>Configuration:</strong><br>
                                    • Tasks: 3-12<br>
                                    • CPU: 2 vCPU<br>
                                    • RAM: 4GB
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL
                                </h4>
                                <div class="section-content">
                                    <strong>Tables:</strong><br>
                                    • messages<br>
                                    • message_templates<br>
                                    • channel_preferences<br>
                                    • whatsapp_templates<br>
                                    • message_delivery_status<br><br>
                                    <strong>Indexes:</strong><br>
                                    • messageId + channel<br>
                                    • contactId + sentAt
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Queue-Service.svg" alt="SQS" class="aws-icon">
                                    SQS Queues
                                </h4>
                                <div class="section-content">
                                    <strong>Queues:</strong><br>
                                    • email-sending-queue<br>
                                    • sms-sending-queue<br>
                                    • whatsapp-sending-queue<br>
                                    • message-status-queue<br><br>
                                    <strong>Purpose:</strong><br>
                                    • Channel-specific message queues<br>
                                    • Rate limiting per channel<br>
                                    • Delivery status updates
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Notification-Service.svg" alt="SNS" class="aws-icon">
                                    SNS Topics
                                </h4>
                                <div class="section-content">
                                    <strong>Topics:</strong><br>
                                    • message-delivered<br>
                                    • message-failed<br>
                                    • whatsapp-webhook-events<br><br>
                                    <strong>Purpose:</strong><br>
                                    • Webhook notifications<br>
                                    • Delivery status broadcasting<br>
                                    • Multi-subscriber pattern
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    • Rate limiting (per channel)<br>
                                    • Message template cache<br>
                                    • WhatsApp template status<br>
                                    • Contact channel preference<br><br>
                                    <strong>TTL:</strong> 6 hours
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Compute/Lambda.svg" alt="Lambda" class="aws-icon">
                                    Lambda Functions
                                </h4>
                                <div class="section-content">
                                    <strong>Functions:</strong><br>
                                    • whatsapp-webhook-handler<br>
                                    • twilio-webhook-handler<br>
                                    • message-status-processor<br><br>
                                    <strong>Triggers:</strong><br>
                                    • API Gateway (webhooks)<br>
                                    • SNS (status events)<br>
                                    • Timeout: 2 minutes
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Secrets-Manager.svg" alt="Secrets Manager" class="aws-icon">
                                    Secrets Manager
                                </h4>
                                <div class="section-content">
                                    <strong>Stored:</strong><br>
                                    • Twilio Account SID & Auth Token<br>
                                    • WhatsApp Business API credentials<br>
                                    • Sendy API key<br>
                                    • AWS SES credentials<br><br>
                                    <strong>Encryption:</strong> KMS
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Management-Governance/CloudWatch.svg" alt="CloudWatch" class="aws-icon">
                                    CloudWatch
                                </h4>
                                <div class="section-content">
                                    <strong>Metrics:</strong><br>
                                    • Messages sent (per channel)<br>
                                    • Delivery success rate<br>
                                    • Failed message count<br>
                                    • Average delivery time<br><br>
                                    <strong>Alarms:</strong><br>
                                    • Email delivery rate < 95%<br>
                                    • SMS failure rate > 5%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">
                        🗄️ SWIM LANE 4: MULTI-CHANNEL MESSAGING DATABASE SCHEMA
                    </div>
                    <div class="lane-content lane-data">
                        <div class="db-table">
                            <div class="table-header">TABLE: messages</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Message identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>campaignRunId</div>
                                    <div>INTEGER</div>
                                    <div>FK → campaign_runs(id)</div>
                                    <div>Associated campaign run</div>
                                </div>
                                <div class="table-row">
                                    <div>contactId</div>
                                    <div>INTEGER</div>
                                    <div>FK → contacts(id)</div>
                                    <div>Recipient contact</div>
                                </div>
                                <div class="table-row">
                                    <div>channel</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>email|sms|whatsapp</div>
                                </div>
                                <div class="table-row">
                                    <div>templateId</div>
                                    <div>INTEGER</div>
                                    <div>FK → message_templates(id)</div>
                                    <div>Template used</div>
                                </div>
                                <div class="table-row">
                                    <div>content</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>Rendered message content</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>queued|sent|delivered|read|failed|bounced</div>
                                </div>
                                <div class="table-row">
                                    <div>externalMessageId</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>Provider message ID (Twilio SID, WhatsApp WAMID, SES ID)</div>
                                </div>
                                <div class="table-row">
                                    <div>sentAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When sent to provider</div>
                                </div>
                                <div class="table-row">
                                    <div>deliveredAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When delivered to recipient</div>
                                </div>
                                <div class="table-row">
                                    <div>readAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When read by recipient (WhatsApp, email)</div>
                                </div>
                                <div class="table-row">
                                    <div>errorMessage</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Error details (if failed)</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: message_templates</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Template identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK → organizations(id)</div>
                                    <div>Organization owner</div>
                                </div>
                                <div class="table-row">
                                    <div>name</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Template name</div>
                                </div>
                                <div class="table-row">
                                    <div>channel</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>email|sms|whatsapp</div>
                                </div>
                                <div class="table-row">
                                    <div>content</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>Template content with merge fields</div>
                                </div>
                                <div class="table-row">
                                    <div>variables</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Template variables/merge fields</div>
                                </div>
                                <div class="table-row">
                                    <div>category</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NULLABLE</div>
                                    <div>Template category (marketing, transactional, etc.)</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Creation timestamp</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: whatsapp_templates</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>WhatsApp template identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK → organizations(id)</div>
                                    <div>Organization owner</div>
                                </div>
                                <div class="table-row">
                                    <div>templateName</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>WhatsApp template name</div>
                                </div>
                                <div class="table-row">
                                    <div>language</div>
                                    <div>VARCHAR(10)</div>
                                    <div>NOT NULL</div>
                                    <div>Template language (en_US, es_ES, etc.)</div>
                                </div>
                                <div class="table-row">
                                    <div>category</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>UTILITY|MARKETING|AUTHENTICATION</div>
                                </div>
                                <div class="table-row">
                                    <div>components</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Template structure (header, body, footer, buttons)</div>
                                </div>
                                <div class="table-row">
                                    <div>approvalStatus</div>
                                    <div>VARCHAR(50)</div>
                                    <div>DEFAULT 'pending'</div>
                                    <div>pending|approved|rejected</div>
                                </div>
                                <div class="table-row">
                                    <div>metaTemplateId</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>Meta/WhatsApp template ID (after approval)</div>
                                </div>
                                <div class="table-row">
                                    <div>submittedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When submitted for approval</div>
                                </div>
                                <div class="table-row">
                                    <div>approvedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When approved by Meta</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: channel_preferences</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Preference identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>contactId</div>
                                    <div>INTEGER</div>
                                    <div>FK → contacts(id)</div>
                                    <div>Contact</div>
                                </div>
                                <div class="table-row">
                                    <div>preferredChannel</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>email|sms|whatsapp</div>
                                </div>
                                <div class="table-row">
                                    <div>emailEnabled</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Email channel enabled?</div>
                                </div>
                                <div class="table-row">
                                    <div>smsEnabled</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>SMS channel enabled?</div>
                                </div>
                                <div class="table-row">
                                    <div>whatsappEnabled</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>WhatsApp channel enabled?</div>
                                </div>
                                <div class="table-row">
                                    <div>updatedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last preference update</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">
                        🛡️ SWIM LANE 5: GDPR COMPLIANCE FOR MULTI-CHANNEL MESSAGING
                    </div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">
                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Channel-Specific Consent</h3>
                                <div class="gdpr-section">
                                    <strong>Article 6: Lawful Basis for Processing</strong>
                                    <strong style="color: #333; font-weight: 400;">Email:</strong> Marketing opt-in required<br>
                                    <strong style="color: #333; font-weight: 400;">SMS:</strong> Explicit consent with opt-out keyword<br>
                                    <strong style="color: #333; font-weight: 400;">WhatsApp:</strong> Opt-in via form or conversation<br>
                                    <strong style="color: #333; font-weight: 400;">Audit:</strong> Channel consent timestamp logged
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 6: Lawful Basis for Processing
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Message Data Retention</h3>
                                <div class="gdpr-section">
                                    <strong>Data Retention Policy</strong>
                                    <strong style="color: #333; font-weight: 400;">Messages:</strong> 90 days retention<br>
                                    <strong style="color: #333; font-weight: 400;">Delivery Status:</strong> 90 days retention<br>
                                    <strong style="color: #333; font-weight: 400;">Templates:</strong> Retained until deleted<br>
                                    <strong style="color: #333; font-weight: 400;">Cleanup:</strong> Lambda function (daily)
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Data Retention" (Line 1678)
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Message History Export</h3>
                                <div class="gdpr-section">
                                    <strong>Article 20: Data Portability</strong>
                                    <strong style="color: #333; font-weight: 400;">Export Includes:</strong><br>
                                    • All messages sent to contact (all channels)<br>
                                    • Delivery & read timestamps<br>
                                    • Channel preferences<br>
                                    <strong style="color: #333; font-weight: 400;">Format:</strong> JSON export within 24 hours
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 20: Right to Data Portability
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Opt-Out & Unsubscribe</h3>
                                <div class="gdpr-section">
                                    <strong>Article 21: Right to Object</strong>
                                    <strong style="color: #333; font-weight: 400;">Email:</strong> One-click unsubscribe in footer<br>
                                    <strong style="color: #333; font-weight: 400;">SMS:</strong> "STOP" keyword support<br>
                                    <strong style="color: #333; font-weight: 400;">WhatsApp:</strong> Opt-out button in messages<br>
                                    <strong style="color: #333; font-weight: 400;">Processing:</strong> Immediate (< 1 minute)
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 21: Right to Object
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 6 -->

            <!-- FRAME 7: RETENTION & NURTURE BUILDER - WORKFLOW -->
            <div class="frame" id="frame7">
                <div class="frame-title">
                    FRAME 7: RETENTION & NURTURE BUILDER - WORKFLOW
                </div>
                <div class="frame-subtitle">
                    Customer Lifecycle Campaigns | Drip Sequences | Engagement Scoring | Automated Nurturing | Win-back Campaigns
                </div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #D4E9E2;"></div>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FFF9E6;"></div>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #B7E4C7;"></div>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">
                        👤 SWIM LANE 1: RETENTION & NURTURE USER ACTIONS
                    </div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Create Nurture Campaign</h3>
                                <ul>
                                    <li>Select campaign type (onboarding, engagement, win-back)</li>
                                    <li>Define customer lifecycle stage</li>
                                    <li>Set nurture duration (days/weeks)</li>
                                    <li>Choose sequence template</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Build Drip Sequence</h3>
                                <ul>
                                    <li>Add sequence steps (Day 1, Day 3, Day 7, etc.)</li>
                                    <li>Create email/SMS for each step</li>
                                    <li>Set time delays between steps</li>
                                    <li>Configure step conditions</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Configure Engagement Rules</h3>
                                <ul>
                                    <li>Set engagement scoring criteria</li>
                                    <li>Define exit conditions (goal reached)</li>
                                    <li>Configure re-entry rules</li>
                                    <li>Set engagement thresholds</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Launch & Monitor</h3>
                                <ul>
                                    <li>Preview full sequence</li>
                                    <li>Test sequence with sample contacts</li>
                                    <li>Review engagement metrics</li>
                                    <li>Activate nurture campaign</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">
                        ⚙️ SWIM LANE 2: RETENTION & NURTURE BACKEND SERVICES
                    </div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">
                            <div class="service-card">
                                <h3><span class="service-icon">🌱</span> Nurture Campaign Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /nurture-campaigns/create<br>
                                        • GET /nurture-campaigns/:id<br>
                                        • PUT /nurture-campaigns/:id<br>
                                        • POST /nurture-campaigns/:id/activate<br>
                                        • DELETE /nurture-campaigns/:id<br>
                                        • GET /nurture-campaigns/list
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • Campaign CRUD operations<br>
                                        • Lifecycle stage tracking<br>
                                        • Template library (50+ nurture sequences)<br>
                                        • Multi-step workflow management
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">💧</span> Drip Sequence Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • POST /drip-sequences/create<br>
                                        • GET /drip-sequences/:id<br>
                                        • POST /drip-sequences/:id/steps<br>
                                        • PUT /drip-sequences/:id/steps/:stepId<br>
                                        • POST /drip-sequences/:id/enroll-contact
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • Multi-step sequence builder<br>
                                        • Time-based delays (hours to months)<br>
                                        • Conditional step execution<br>
                                        • Dynamic content per step<br>
                                        • Sequence cloning & versioning
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📈</span> Engagement Scoring Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • GET /engagement/score/:contactId<br>
                                        • POST /engagement/calculate<br>
                                        • PUT /engagement/scoring-rules<br>
                                        • GET /engagement/leaderboard
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Scoring Criteria:</div>
                                    <div class="section-content">
                                        • Email opens (+5 points)<br>
                                        • Link clicks (+10 points)<br>
                                        • Form submissions (+20 points)<br>
                                        • Purchases (+50 points)<br>
                                        • Inactivity decay (-2 points/day)<br>
                                        • Custom scoring rules
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🔄</span> Lifecycle Stage Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • GET /lifecycle/stages<br>
                                        • POST /lifecycle/update-stage<br>
                                        • GET /lifecycle/contacts-by-stage
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Lifecycle Stages:</div>
                                    <div class="section-content">
                                        • Subscriber → Lead → Customer<br>
                                        • Engaged → At-Risk → Churned<br>
                                        • VIP → Inactive<br>
                                        • Automated stage transitions<br>
                                        • Stage-specific nurture sequences
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🎯</span> Win-Back Campaign Service</h3>
                                <div class="section">
                                    <div class="section-title">Features:</div>
                                    <div class="section-content">
                                        • Inactive contact detection<br>
                                        • Automated win-back triggers<br>
                                        • Special offer management<br>
                                        • Re-engagement incentives
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Triggers:</div>
                                    <div class="section-content">
                                        • No activity in 30/60/90 days<br>
                                        • Engagement score below threshold<br>
                                        • No email opens in X days<br>
                                        • Cart abandonment
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📊</span> Retention Analytics Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • GET /retention/cohort-analysis<br>
                                        • GET /retention/churn-prediction<br>
                                        • GET /retention/ltv-calculation<br>
                                        • GET /retention/campaign-performance
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Metrics Tracked:</div>
                                    <div class="section-content">
                                        • Retention rate (30/60/90 days)<br>
                                        • Churn rate<br>
                                        • Customer Lifetime Value (LTV)<br>
                                        • Engagement trends<br>
                                        • Win-back success rate
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">
                        ☁️ SWIM LANE 3: AWS INFRASTRUCTURE FOR RETENTION & NURTURE
                    </div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">
                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate
                                </h4>
                                <div class="section-content">
                                    <strong>Services:</strong><br>
                                    • Nurture Campaign Service<br>
                                    • Drip Sequence Service<br>
                                    • Engagement Scoring Service<br>
                                    • Lifecycle Stage Service<br><br>
                                    <strong>Configuration:</strong><br>
                                    • Tasks: 2-10<br>
                                    • CPU: 2 vCPU<br>
                                    • RAM: 4GB
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL
                                </h4>
                                <div class="section-content">
                                    <strong>Tables:</strong><br>
                                    • nurture_campaigns<br>
                                    • drip_sequences<br>
                                    • sequence_steps<br>
                                    • sequence_enrollments<br>
                                    • engagement_scores<br>
                                    • lifecycle_stages<br><br>
                                    <strong>Indexes:</strong><br>
                                    • contactId + lifecycleStage<br>
                                    • enrollmentId + status
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Queue-Service.svg" alt="SQS" class="aws-icon">
                                    SQS Queues
                                </h4>
                                <div class="section-content">
                                    <strong>Queues:</strong><br>
                                    • nurture-sequence-queue<br>
                                    • engagement-score-update-queue<br>
                                    • lifecycle-transition-queue<br><br>
                                    <strong>Purpose:</strong><br>
                                    • Async sequence step execution<br>
                                    • Score calculation processing<br>
                                    • Stage transition notifications
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    • Engagement score cache<br>
                                    • Active sequence tracking<br>
                                    • Lifecycle stage cache<br>
                                    • Upcoming step schedule<br><br>
                                    <strong>TTL:</strong> 1 hour
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/EventBridge.svg" alt="EventBridge" class="aws-icon">
                                    EventBridge
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong><br>
                                    • Daily engagement score calculation<br>
                                    • Scheduled sequence step execution<br>
                                    • Churn prediction jobs<br><br>
                                    <strong>Rules:</strong><br>
                                    • Daily: Score decay calculation<br>
                                    • Hourly: Check upcoming steps<br>
                                    • Weekly: Cohort analysis
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Compute/Lambda.svg" alt="Lambda" class="aws-icon">
                                    Lambda Functions
                                </h4>
                                <div class="section-content">
                                    <strong>Functions:</strong><br>
                                    • sequence-step-executor<br>
                                    • engagement-score-calculator<br>
                                    • churn-predictor<br>
                                    • lifecycle-stage-updater<br><br>
                                    <strong>Triggers:</strong><br>
                                    • EventBridge (scheduled)<br>
                                    • SQS (step execution)<br>
                                    • Timeout: 5 minutes
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Management-Governance/CloudWatch.svg" alt="CloudWatch" class="aws-icon">
                                    CloudWatch
                                </h4>
                                <div class="section-content">
                                    <strong>Metrics:</strong><br>
                                    • Active sequences count<br>
                                    • Sequence completion rate<br>
                                    • Average engagement score<br>
                                    • Churn rate<br><br>
                                    <strong>Alarms:</strong><br>
                                    • Sequence failure rate > 5%<br>
                                    • Churn rate > 10%
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Secrets-Manager.svg" alt="Secrets Manager" class="aws-icon">
                                    Secrets Manager
                                </h4>
                                <div class="section-content">
                                    <strong>Stored:</strong><br>
                                    • Analytics API keys<br>
                                    • Third-party integration tokens<br><br>
                                    <strong>Encryption:</strong><br>
                                    • KMS encrypted<br>
                                    • Auto-rotation enabled
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">
                        🗄️ SWIM LANE 4: RETENTION & NURTURE DATABASE SCHEMA
                    </div>
                    <div class="lane-content lane-data">
                        <div class="db-table">
                            <div class="table-header">TABLE: nurture_campaigns</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Nurture campaign identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>FK → organizations(id)</div>
                                    <div>Organization owner</div>
                                </div>
                                <div class="table-row">
                                    <div>name</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Campaign name</div>
                                </div>
                                <div class="table-row">
                                    <div>campaignType</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>onboarding|engagement|win_back|lifecycle</div>
                                </div>
                                <div class="table-row">
                                    <div>targetLifecycleStage</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NULLABLE</div>
                                    <div>Lifecycle stage this campaign targets</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>VARCHAR(50)</div>
                                    <div>DEFAULT 'draft'</div>
                                    <div>draft|active|paused|archived</div>
                                </div>
                                <div class="table-row">
                                    <div>durationDays</div>
                                    <div>INTEGER</div>
                                    <div>NULLABLE</div>
                                    <div>Total campaign duration in days</div>
                                </div>
                                <div class="table-row">
                                    <div>goalMetric</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NULLABLE</div>
                                    <div>engagement_score|conversion|retention</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Creation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>activatedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When campaign was activated</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: drip_sequences</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Sequence identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>nurtureCampaignId</div>
                                    <div>INTEGER</div>
                                    <div>FK → nurture_campaigns(id)</div>
                                    <div>Parent nurture campaign</div>
                                </div>
                                <div class="table-row">
                                    <div>name</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Sequence name</div>
                                </div>
                                <div class="table-row">
                                    <div>description</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Sequence description</div>
                                </div>
                                <div class="table-row">
                                    <div>totalSteps</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL</div>
                                    <div>Number of steps in sequence</div>
                                </div>
                                <div class="table-row">
                                    <div>enrollmentTrigger</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Conditions to enroll contact in sequence</div>
                                </div>
                                <div class="table-row">
                                    <div>exitConditions</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Conditions to exit sequence early</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: sequence_steps</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Step identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>sequenceId</div>
                                    <div>INTEGER</div>
                                    <div>FK → drip_sequences(id)</div>
                                    <div>Parent sequence</div>
                                </div>
                                <div class="table-row">
                                    <div>stepNumber</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL</div>
                                    <div>Step order (1, 2, 3, etc.)</div>
                                </div>
                                <div class="table-row">
                                    <div>delayValue</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL</div>
                                    <div>Delay before this step (in delayUnit)</div>
                                </div>
                                <div class="table-row">
                                    <div>delayUnit</div>
                                    <div>VARCHAR(20)</div>
                                    <div>NOT NULL</div>
                                    <div>hours|days|weeks</div>
                                </div>
                                <div class="table-row">
                                    <div>actionType</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>send_email|send_sms|add_tag|update_score</div>
                                </div>
                                <div class="table-row">
                                    <div>actionConfiguration</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Step action details (templateId, content, etc.)</div>
                                </div>
                                <div class="table-row">
                                    <div>conditions</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Conditional execution rules for this step</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: sequence_enrollments</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Enrollment identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>sequenceId</div>
                                    <div>INTEGER</div>
                                    <div>FK → drip_sequences(id)</div>
                                    <div>Sequence enrolled in</div>
                                </div>
                                <div class="table-row">
                                    <div>contactId</div>
                                    <div>INTEGER</div>
                                    <div>FK → contacts(id)</div>
                                    <div>Contact enrolled</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>active|completed|exited|paused</div>
                                </div>
                                <div class="table-row">
                                    <div>currentStep</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL</div>
                                    <div>Current step number in sequence</div>
                                </div>
                                <div class="table-row">
                                    <div>enrolledAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Enrollment timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>completedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When sequence was completed</div>
                                </div>
                                <div class="table-row">
                                    <div>nextStepAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When next step should execute</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: engagement_scores</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Score identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>contactId</div>
                                    <div>INTEGER</div>
                                    <div>FK → contacts(id)</div>
                                    <div>Contact</div>
                                </div>
                                <div class="table-row">
                                    <div>score</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Current engagement score</div>
                                </div>
                                <div class="table-row">
                                    <div>lastActivityDate</div>
                                    <div>DATE</div>
                                    <div>NULLABLE</div>
                                    <div>Date of last engagement activity</div>
                                </div>
                                <div class="table-row">
                                    <div>engagementLevel</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>high|medium|low|inactive</div>
                                </div>
                                <div class="table-row">
                                    <div>updatedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last score update</div>
                                </div>
                            </div>
                        </div>

                        <div class="db-table">
                            <div class="table-header">TABLE: lifecycle_stages</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Stage assignment identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>contactId</div>
                                    <div>INTEGER</div>
                                    <div>FK → contacts(id)</div>
                                    <div>Contact</div>
                                </div>
                                <div class="table-row">
                                    <div>currentStage</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>subscriber|lead|customer|engaged|at_risk|churned|vip</div>
                                </div>
                                <div class="table-row">
                                    <div>previousStage</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NULLABLE</div>
                                    <div>Previous lifecycle stage</div>
                                </div>
                                <div class="table-row">
                                    <div>stageChangedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>When stage was last updated</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">
                        🛡️ SWIM LANE 5: GDPR COMPLIANCE FOR RETENTION & NURTURE
                    </div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">
                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Nurture Sequence Consent</h3>
                                <div class="gdpr-section">
                                    <strong>Article 6: Lawful Basis for Processing</strong>
                                    <strong style="color: #333; font-weight: 400;">Enrollment Consent:</strong> Opt-in required for nurture campaigns<br>
                                    <strong style="color: #333; font-weight: 400;">Onboarding Sequences:</strong> Legitimate interest (transactional)<br>
                                    <strong style="color: #333; font-weight: 400;">Exit:</strong> Contact can exit sequence anytime
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 6: Lawful Basis for Processing
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Sequence Data Retention</h3>
                                <div class="gdpr-section">
                                    <strong>Data Retention Policy</strong>
                                    <strong style="color: #333; font-weight: 400;">Enrollment History:</strong> 90 days after completion<br>
                                    <strong style="color: #333; font-weight: 400;">Engagement Scores:</strong> Current score only (no historical)<br>
                                    <strong style="color: #333; font-weight: 400;">Lifecycle Stages:</strong> Current + previous stage only<br>
                                    <strong style="color: #333; font-weight: 400;">Cleanup:</strong> Lambda function (daily)
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: "Data Retention" (Line 1678)
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Nurture Data Export</h3>
                                <div class="gdpr-section">
                                    <strong>Article 20: Data Portability</strong>
                                    <strong style="color: #333; font-weight: 400;">Export Includes:</strong><br>
                                    • All sequence enrollments<br>
                                    • Engagement score history<br>
                                    • Lifecycle stage history<br>
                                    <strong style="color: #333; font-weight: 400;">Format:</strong> JSON export within 24 hours
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 20: Right to Data Portability
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Right to Withdraw from Sequences</h3>
                                <div class="gdpr-section">
                                    <strong>Article 21: Right to Object</strong>
                                    <strong style="color: #333; font-weight: 400;">Withdrawal:</strong> Contact removed from all active sequences<br>
                                    <strong style="color: #333; font-weight: 400;">Processing:</strong> Immediate (< 1 hour)<br>
                                    <strong style="color: #333; font-weight: 400;">Effect:</strong> No further sequence steps executed
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 21: Right to Object
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 7 -->

            <!-- FRAME 8: SALES & LEAD GENERATION BUILDER - LEAD CAPTURE -->
            <div class="frame" id="frame8">
                <div class="frame-title">FRAME 8: SALES & LEAD GENERATION BUILDER - LEAD CAPTURE</div>
                <div class="frame-subtitle">Multi-Source Lead Capture | Form Integration | BeeBot WebChat | Lead Scoring & Qualification</div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <span class="legend-color" style="background: #E8F5E9;"></span>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #E3F2FD;"></span>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #FFF3E0;"></span>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #F3E5F5;"></span>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #E0F2F1;"></span>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">👤 SWIM LANE 1: USER ACTIONS</div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Configure Lead Capture Sources</h3>
                                <ul>
                                    <li><strong>Form Integration:</strong> Connect website forms (native, WordPress, custom HTML)</li>
                                    <li><strong>BeeBot WebChat:</strong> Enable AI-powered chat widget with lead qualification</li>
                                    <li><strong>Landing Pages:</strong> Create high-converting landing pages with form builder</li>
                                    <li><strong>Import Leads:</strong> CSV/Excel bulk import with field mapping</li>
                                    <li><strong>API Integration:</strong> Connect third-party CRMs (Salesforce, HubSpot, Zoho)</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Set Up Lead Scoring Rules</h3>
                                <ul>
                                    <li><strong>Demographic Scoring:</strong> Points based on job title, company size, industry</li>
                                    <li><strong>Behavioral Scoring:</strong> Website visits, email engagement, content downloads</li>
                                    <li><strong>Firmographic Scoring:</strong> Company revenue, employee count, location</li>
                                    <li><strong>Engagement Scoring:</strong> Form submissions, chat interactions, meeting bookings</li>
                                    <li><strong>Decay Rules:</strong> Reduce score for inactivity over time</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Configure Lead Qualification</h3>
                                <ul>
                                    <li><strong>BANT Framework:</strong> Budget, Authority, Need, Timeline qualification</li>
                                    <li><strong>Lead Stages:</strong> Cold → Warm → Hot → MQL → SQL → Opportunity</li>
                                    <li><strong>Disqualification Rules:</strong> Competitors, students, invalid emails, spam domains</li>
                                    <li><strong>Auto-Assignment:</strong> Route qualified leads to sales reps based on territory/product</li>
                                    <li><strong>Notification Settings:</strong> Real-time alerts for hot leads (score >80)</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Enable Lead Enrichment</h3>
                                <ul>
                                    <li><strong>Company Data:</strong> Auto-fetch company info from domain (Clearbit API)</li>
                                    <li><strong>Social Profiles:</strong> LinkedIn, Twitter profile enrichment</li>
                                    <li><strong>Email Validation:</strong> Real-time email verification (syntax, MX records, disposable detection)</li>
                                    <li><strong>Duplicate Detection:</strong> Merge duplicate leads by email/phone</li>
                                    <li><strong>Custom Fields:</strong> Add industry-specific qualification fields</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">⚙️ SWIM LANE 2: BACKEND SERVICES (NestJS + TypeScript)</div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">

                            <div class="service-card">
                                <h3><span class="service-icon">🎯</span> Lead Capture Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/leads/capture - Create new lead from any source<br>
                                        • <strong>POST</strong> /api/leads/bulk-import - CSV/Excel import with validation<br>
                                        • <strong>GET</strong> /api/leads/:id - Retrieve lead details with enrichment data<br>
                                        • <strong>PUT</strong> /api/leads/:id - Update lead information<br>
                                        • <strong>POST</strong> /api/leads/:id/merge - Merge duplicate leads
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Core Logic:</div>
                                    <div class="section-content">
                                        • Multi-source lead ingestion (forms, chat, API, import)<br>
                                        • Real-time email validation (regex, MX lookup, disposable check)<br>
                                        • Duplicate detection algorithm (email/phone/name fuzzy match)<br>
                                        • Lead deduplication with merge conflict resolution<br>
                                        • Source tracking (UTM parameters, referrer, campaign)
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📝</span> Form Integration Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/forms/integrate - Connect external form<br>
                                        • <strong>POST</strong> /api/forms/webhook - Receive form submissions<br>
                                        • <strong>GET</strong> /api/forms/:id/embed-code - Generate embed code<br>
                                        • <strong>POST</strong> /api/forms/:id/map-fields - Map form fields to CRM fields
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Integrations:</div>
                                    <div class="section-content">
                                        • Native HTML forms (JavaScript SDK)<br>
                                        • WordPress plugin integration<br>
                                        • Typeform, Jotform, Google Forms webhooks<br>
                                        • Custom webhook receiver with signature validation<br>
                                        • reCAPTCHA v3 spam prevention (score threshold 0.5)
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">💬</span> BeeBot WebChat Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/beechat/initialize - Initialize chat session<br>
                                        • <strong>POST</strong> /api/beechat/message - Send/receive chat messages<br>
                                        • <strong>POST</strong> /api/beechat/qualify-lead - Run qualification logic<br>
                                        • <strong>POST</strong> /api/beechat/handoff - Transfer to human agent
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">AI Features:</div>
                                    <div class="section-content">
                                        • Natural language qualification (BANT extraction)<br>
                                        • Intent detection (pricing, demo, support, general inquiry)<br>
                                        • Sentiment analysis (positive, neutral, negative)<br>
                                        • Smart follow-up questions based on context<br>
                                        • Auto-book meetings with calendar integration (Calendly API)
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">⭐</span> Lead Scoring Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/scoring/calculate - Calculate lead score<br>
                                        • <strong>POST</strong> /api/scoring/rules - Create/update scoring rules<br>
                                        • <strong>GET</strong> /api/scoring/history/:leadId - Score change history<br>
                                        • <strong>POST</strong> /api/scoring/batch - Recalculate scores for segment
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Scoring Algorithm:</div>
                                    <div class="section-content">
                                        • <strong>Demographic:</strong> Job title (+20 decision-maker), company size (+15 enterprise)<br>
                                        • <strong>Behavioral:</strong> Email open (+5), link click (+10), form submit (+25)<br>
                                        • <strong>Engagement:</strong> Chat interaction (+30), demo request (+50), pricing page (+40)<br>
                                        • <strong>Firmographic:</strong> Revenue >$10M (+25), employees >500 (+20)<br>
                                        • <strong>Decay:</strong> -2 points per day of inactivity
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">✅</span> Lead Qualification Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/qualification/evaluate - Evaluate lead against BANT<br>
                                        • <strong>PUT</strong> /api/qualification/:leadId/stage - Update lead stage<br>
                                        • <strong>POST</strong> /api/qualification/disqualify - Mark lead as disqualified<br>
                                        • <strong>POST</strong> /api/qualification/assign - Auto-assign to sales rep
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Qualification Logic:</div>
                                    <div class="section-content">
                                        • <strong>MQL (Marketing Qualified):</strong> Score >50, engaged last 30 days<br>
                                        • <strong>SQL (Sales Qualified):</strong> Score >80, BANT criteria met<br>
                                        • <strong>Opportunity:</strong> SQL + meeting booked/demo requested<br>
                                        • <strong>Disqualification:</strong> Competitor domains, role-based emails, spam patterns<br>
                                        • <strong>Round-robin assignment:</strong> Distribute leads evenly to sales team
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🔍</span> Lead Enrichment Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/enrichment/company - Enrich company data from domain<br>
                                        • <strong>POST</strong> /api/enrichment/email-validate - Validate email deliverability<br>
                                        • <strong>POST</strong> /api/enrichment/social - Fetch social profiles<br>
                                        • <strong>POST</strong> /api/enrichment/batch - Bulk enrichment job
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Enrichment Sources:</div>
                                    <div class="section-content">
                                        • <strong>Clearbit API:</strong> Company data (name, logo, industry, employee count, revenue)<br>
                                        • <strong>Hunter.io:</strong> Email verification (deliverability score, catch-all detection)<br>
                                        • <strong>LinkedIn API:</strong> Professional profile data (requires OAuth)<br>
                                        • <strong>DNS Lookup:</strong> MX records validation for email domains<br>
                                        • <strong>IP Geolocation:</strong> Location data from submission IP
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">☁️ SWIM LANE 3: AWS INFRASTRUCTURE</div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate - Lead Services
                                </h4>
                                <div class="section-content">
                                    <strong>Task Definition:</strong> lead-capture-service, lead-scoring-service, lead-qualification-service<br>
                                    <strong>CPU/Memory:</strong> 1 vCPU, 2GB RAM per task<br>
                                    <strong>Auto Scaling:</strong> 2-15 tasks based on SQS queue depth<br>
                                    <strong>Scaling Metric:</strong> ApproximateNumberOfMessagesVisible >100<br>
                                    <strong>Health Check:</strong> /health endpoint every 30s<br>
                                    <strong>Deployment:</strong> Rolling update, 50% minimum healthy
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL 15.4 - Lead Database
                                </h4>
                                <div class="section-content">
                                    <strong>Instance:</strong> db.r6g.xlarge (Multi-AZ for HA)<br>
                                    <strong>Storage:</strong> 500GB GP3 SSD (auto-scaling to 1TB)<br>
                                    <strong>Tables:</strong> leads (1M+ rows), lead_scores, lead_sources, lead_activities<br>
                                    <strong>Indexes:</strong> email (unique), phone, company_domain, created_at, score<br>
                                    <strong>Partitioning:</strong> lead_activities partitioned by month<br>
                                    <strong>Backup:</strong> Automated daily snapshots, 7-day retention
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Queue-Service.svg" alt="SQS" class="aws-icon">
                                    SQS - Lead Processing Queues
                                </h4>
                                <div class="section-content">
                                    <strong>lead-capture-queue:</strong> New lead ingestion (FIFO, message retention 14 days)<br>
                                    <strong>lead-enrichment-queue:</strong> Asynchronous enrichment jobs<br>
                                    <strong>lead-scoring-queue:</strong> Score recalculation events<br>
                                    <strong>Visibility Timeout:</strong> 5 minutes (enrichment), 30 seconds (scoring)<br>
                                    <strong>Dead Letter Queue:</strong> 3 retries before DLQ<br>
                                    <strong>Throughput:</strong> ~500 messages/second peak
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis - Lead Cache
                                </h4>
                                <div class="section-content">
                                    <strong>Node Type:</strong> cache.r6g.large (Cluster Mode enabled)<br>
                                    <strong>Use Cases:</strong><br>
                                    • Lead deduplication cache (email/phone hashes, TTL 24h)<br>
                                    • Scoring rules cache (TTL 1h, invalidate on rule update)<br>
                                    • API rate limiting (sliding window, 100 req/min per IP)<br>
                                    • Session data for BeeBot chat (TTL 30 min)<br>
                                    • Enrichment API response cache (TTL 7 days)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Compute/Lambda.svg" alt="Lambda" class="aws-icon">
                                    Lambda Functions
                                </h4>
                                <div class="section-content">
                                    <strong>lead-enrichment-worker:</strong> Calls Clearbit/Hunter APIs (timeout 60s, 1GB RAM)<br>
                                    <strong>lead-score-decay:</strong> Daily job to apply inactivity decay (EventBridge trigger)<br>
                                    <strong>duplicate-lead-merger:</strong> Nightly duplicate detection + merge (6GB RAM)<br>
                                    <strong>lead-export:</strong> Generate CSV/Excel exports for GDPR requests (15min timeout)<br>
                                    <strong>Runtime:</strong> Node.js 20.x, bundled with esbuild
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Notification-Service.svg" alt="SNS" class="aws-icon">
                                    SNS - Lead Notifications
                                </h4>
                                <div class="section-content">
                                    <strong>hot-lead-alerts:</strong> Real-time alerts for leads with score >80<br>
                                    <strong>mql-notifications:</strong> Notify sales team when lead becomes MQL<br>
                                    <strong>sql-notifications:</strong> High-priority SQL notifications<br>
                                    <strong>Subscribers:</strong> Email, SMS (Twilio), Slack webhooks, PagerDuty<br>
                                    <strong>Filtering:</strong> Subscription filters by lead source, territory, product
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Management-Governance/CloudWatch.svg" alt="CloudWatch" class="aws-icon">
                                    CloudWatch - Monitoring & Alerts
                                </h4>
                                <div class="section-content">
                                    <strong>Metrics:</strong> Leads captured/min, avg enrichment time, scoring latency, duplicate rate<br>
                                    <strong>Alarms:</strong> Enrichment failures >5%, scoring queue depth >1000<br>
                                    <strong>Logs:</strong> Lead capture events, validation errors, API call logs<br>
                                    <strong>Dashboards:</strong> Lead funnel metrics, source performance, conversion rates<br>
                                    <strong>Retention:</strong> 90 days log retention
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Secrets-Manager.svg" alt="Secrets Manager" class="aws-icon">
                                    Secrets Manager - API Credentials
                                </h4>
                                <div class="section-content">
                                    <strong>Secrets Stored:</strong><br>
                                    • unifiedbeez/clearbit-api-key (company enrichment)<br>
                                    • unifiedbeez/hunter-api-key (email validation)<br>
                                    • unifiedbeez/linkedin-oauth (social enrichment)<br>
                                    • unifiedbeez/recaptcha-secret (spam prevention)<br>
                                    <strong>Encryption:</strong> KMS key (unifiedbeez-secrets-key)<br>
                                    <strong>Rotation:</strong> 90-day automatic rotation
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">🗄️ SWIM LANE 4: DATABASE SCHEMA & RELATIONSHIPS</div>
                    <div class="lane-content lane-data">

                        <!-- TABLE: leads -->
                        <div class="db-table">
                            <div class="table-header">TABLE: leads</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique lead identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>email</div>
                                    <div>VARCHAR(255)</div>
                                    <div>UNIQUE, NOT NULL</div>
                                    <div>Lead email address (primary deduplication key)</div>
                                </div>
                                <div class="table-row">
                                    <div>phone</div>
                                    <div>VARCHAR(20)</div>
                                    <div>NULLABLE</div>
                                    <div>Phone number (E.164 format, secondary dedup key)</div>
                                </div>
                                <div class="table-row">
                                    <div>first_name</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NOT NULL</div>
                                    <div>First name</div>
                                </div>
                                <div class="table-row">
                                    <div>last_name</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NOT NULL</div>
                                    <div>Last name</div>
                                </div>
                                <div class="table-row">
                                    <div>company_name</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>Company name (enriched from domain or manually entered)</div>
                                </div>
                                <div class="table-row">
                                    <div>company_domain</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE, INDEX</div>
                                    <div>Company website domain (for enrichment)</div>
                                </div>
                                <div class="table-row">
                                    <div>job_title</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>Job title/role</div>
                                </div>
                                <div class="table-row">
                                    <div>industry</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NULLABLE</div>
                                    <div>Industry vertical (enriched)</div>
                                </div>
                                <div class="table-row">
                                    <div>company_size</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NULLABLE</div>
                                    <div>Employee count range (1-10, 11-50, 51-200, 201-500, 500+)</div>
                                </div>
                                <div class="table-row">
                                    <div>annual_revenue</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NULLABLE</div>
                                    <div>Revenue range ($0-1M, $1-10M, $10-50M, $50M+)</div>
                                </div>
                                <div class="table-row">
                                    <div>country</div>
                                    <div>VARCHAR(2)</div>
                                    <div>NULLABLE</div>
                                    <div>ISO 3166-1 alpha-2 country code</div>
                                </div>
                                <div class="table-row">
                                    <div>state</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NULLABLE</div>
                                    <div>State/province</div>
                                </div>
                                <div class="table-row">
                                    <div>city</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NULLABLE</div>
                                    <div>City</div>
                                </div>
                                <div class="table-row">
                                    <div>lead_source_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → lead_sources(id)</div>
                                    <div>Reference to source (form, chat, API, import)</div>
                                </div>
                                <div class="table-row">
                                    <div>score</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0, INDEX</div>
                                    <div>Current lead score (0-100)</div>
                                </div>
                                <div class="table-row">
                                    <div>stage</div>
                                    <div>ENUM</div>
                                    <div>'cold', 'warm', 'hot', 'mql', 'sql', 'opportunity', 'customer', 'disqualified'</div>
                                    <div>Current lead stage in funnel</div>
                                </div>
                                <div class="table-row">
                                    <div>disqualification_reason</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Reason if stage = 'disqualified'</div>
                                </div>
                                <div class="table-row">
                                    <div>assigned_to_user_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → users(id), NULLABLE</div>
                                    <div>Assigned sales rep</div>
                                </div>
                                <div class="table-row">
                                    <div>utm_source</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>UTM source parameter</div>
                                </div>
                                <div class="table-row">
                                    <div>utm_medium</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>UTM medium parameter</div>
                                </div>
                                <div class="table-row">
                                    <div>utm_campaign</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>UTM campaign parameter</div>
                                </div>
                                <div class="table-row">
                                    <div>referrer_url</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>HTTP referrer URL</div>
                                </div>
                                <div class="table-row">
                                    <div>ip_address</div>
                                    <div>INET</div>
                                    <div>NULLABLE</div>
                                    <div>Submission IP address (for geolocation)</div>
                                </div>
                                <div class="table-row">
                                    <div>enrichment_data</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Enriched data from Clearbit/Hunter (company logo, social profiles, etc.)</div>
                                </div>
                                <div class="table-row">
                                    <div>custom_fields</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Industry-specific custom fields</div>
                                </div>
                                <div class="table-row">
                                    <div>consent_marketing</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Consent to receive marketing emails (GDPR)</div>
                                </div>
                                <div class="table-row">
                                    <div>consent_sales</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Consent to be contacted by sales (GDPR)</div>
                                </div>
                                <div class="table-row">
                                    <div>consent_ip</div>
                                    <div>INET</div>
                                    <div>NULLABLE</div>
                                    <div>IP address when consent was given</div>
                                </div>
                                <div class="table-row">
                                    <div>consent_timestamp</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When consent was given</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW(), INDEX</div>
                                    <div>Lead capture timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>updated_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last update timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>last_activity_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE, INDEX</div>
                                    <div>Last engagement timestamp (for score decay)</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: lead_sources -->
                        <div class="db-table">
                            <div class="table-header">TABLE: lead_sources</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique source identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>tenant_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → tenants(id)</div>
                                    <div>Multi-tenancy isolation</div>
                                </div>
                                <div class="table-row">
                                    <div>name</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Source name (e.g., "Contact Form", "BeeBot Chat", "LinkedIn Campaign")</div>
                                </div>
                                <div class="table-row">
                                    <div>type</div>
                                    <div>ENUM</div>
                                    <div>'form', 'chat', 'api', 'import', 'landing_page', 'webhook'</div>
                                    <div>Source type</div>
                                </div>
                                <div class="table-row">
                                    <div>integration_config</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Integration-specific config (webhook URL, API keys, field mappings)</div>
                                </div>
                                <div class="table-row">
                                    <div>is_active</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Source status (active/paused)</div>
                                </div>
                                <div class="table-row">
                                    <div>total_leads_captured</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Lifetime lead count from this source</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Source creation timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: lead_scores -->
                        <div class="db-table">
                            <div class="table-header">TABLE: lead_scores</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique score record identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>lead_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → leads(id), INDEX</div>
                                    <div>Associated lead</div>
                                </div>
                                <div class="table-row">
                                    <div>previous_score</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL</div>
                                    <div>Score before this change</div>
                                </div>
                                <div class="table-row">
                                    <div>new_score</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL</div>
                                    <div>Score after this change</div>
                                </div>
                                <div class="table-row">
                                    <div>score_delta</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL</div>
                                    <div>Score change (+/-)</div>
                                </div>
                                <div class="table-row">
                                    <div>reason</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Reason for score change (e.g., "Email opened", "Form submitted", "Inactivity decay")</div>
                                </div>
                                <div class="table-row">
                                    <div>category</div>
                                    <div>ENUM</div>
                                    <div>'demographic', 'behavioral', 'firmographic', 'engagement', 'decay'</div>
                                    <div>Score change category</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW(), INDEX</div>
                                    <div>When score changed</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: lead_activities -->
                        <div class="db-table">
                            <div class="table-header">TABLE: lead_activities (Partitioned by month)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique activity identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>lead_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → leads(id), INDEX</div>
                                    <div>Associated lead</div>
                                </div>
                                <div class="table-row">
                                    <div>activity_type</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NOT NULL, INDEX</div>
                                    <div>Activity type (email_open, link_click, form_submit, chat_message, etc.)</div>
                                </div>
                                <div class="table-row">
                                    <div>activity_data</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Activity-specific data (email subject, clicked URL, form fields, etc.)</div>
                                </div>
                                <div class="table-row">
                                    <div>ip_address</div>
                                    <div>INET</div>
                                    <div>NULLABLE</div>
                                    <div>IP address of activity</div>
                                </div>
                                <div class="table-row">
                                    <div>user_agent</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Browser user agent</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW(), INDEX, PARTITION KEY</div>
                                    <div>Activity timestamp (partition by month for performance)</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: scoring_rules -->
                        <div class="db-table">
                            <div class="table-header">TABLE: scoring_rules</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique rule identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>tenant_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → tenants(id)</div>
                                    <div>Multi-tenancy isolation</div>
                                </div>
                                <div class="table-row">
                                    <div>name</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Rule name (e.g., "C-Level Decision Maker", "Enterprise Company")</div>
                                </div>
                                <div class="table-row">
                                    <div>category</div>
                                    <div>ENUM</div>
                                    <div>'demographic', 'behavioral', 'firmographic', 'engagement'</div>
                                    <div>Rule category</div>
                                </div>
                                <div class="table-row">
                                    <div>condition</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Condition logic (e.g., {"field": "job_title", "operator": "contains", "value": "CEO"})</div>
                                </div>
                                <div class="table-row">
                                    <div>points</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL</div>
                                    <div>Points to add/subtract when condition met</div>
                                </div>
                                <div class="table-row">
                                    <div>is_active</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Rule status</div>
                                </div>
                                <div class="table-row">
                                    <div>priority</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Rule evaluation order (higher priority = evaluated first)</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Rule creation timestamp</div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">🛡️ SWIM LANE 5: GDPR COMPLIANCE & DATA PROTECTION</div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Lawful Basis for Processing</h3>
                                <div class="gdpr-section">
                                    <strong>Article 6(1)(a) - Consent:</strong>
                                    <ul>
                                        <li>Explicit opt-in checkboxes for marketing and sales contact</li>
                                        <li>Separate consent fields: consent_marketing, consent_sales</li>
                                        <li>Consent metadata: IP address, timestamp, checkbox text captured</li>
                                        <li>Double opt-in for email marketing (confirmation email required)</li>
                                        <li>Granular consent: ability to consent to one but not both</li>
                                    </ul>
                                    <strong>Article 6(1)(b) - Contract Performance:</strong>
                                    <ul>
                                        <li>Lead data processing necessary for sales process (quotes, demos)</li>
                                        <li>Clear disclosure in privacy policy and terms of service</li>
                                    </ul>
                                    <strong>Article 6(1)(f) - Legitimate Interest:</strong>
                                    <ul>
                                        <li>Lead enrichment for better service delivery (company data lookup)</li>
                                        <li>Fraud prevention (email validation, duplicate detection)</li>
                                        <li>Legitimate Interest Assessment (LIA) documented</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 6: Lawfulness of Processing<br>
                                    &nbsp;&nbsp; Section: Consent Management for Lead Capture
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Data Subject Rights</h3>
                                <div class="gdpr-section">
                                    <strong>Article 15 - Right of Access:</strong>
                                    <ul>
                                        <li>Self-service dashboard: leads can view all captured data</li>
                                        <li>API endpoint: GET /api/leads/my-data (authenticated by email + token)</li>
                                        <li>Includes: personal data, enrichment data, activity history, consent records</li>
                                        <li>Response within 30 days (automated for self-service)</li>
                                    </ul>
                                    <strong>Article 16 - Right to Rectification:</strong>
                                    <ul>
                                        <li>Self-service profile update form</li>
                                        <li>API endpoint: PUT /api/leads/my-data/update</li>
                                        <li>Leads can correct name, company, job title, phone</li>
                                    </ul>
                                    <strong>Article 17 - Right to Erasure:</strong>
                                    <ul>
                                        <li>Self-service "Delete My Data" button</li>
                                        <li>Anonymization: PII replaced with [DELETED] placeholders</li>
                                        <li>Retention: score history kept for analytics (anonymized)</li>
                                        <li>Deletion confirmation email sent</li>
                                    </ul>
                                    <strong>Article 20 - Right to Data Portability:</strong>
                                    <ul>
                                        <li>Export lead data as JSON, CSV, Excel</li>
                                        <li>Includes all personal data + enrichment data + activity logs</li>
                                        <li>Machine-readable format (structured data)</li>
                                    </ul>
                                    <strong>Article 21 - Right to Object:</strong>
                                    <ul>
                                        <li>Opt-out links in all marketing emails</li>
                                        <li>Unsubscribe immediately updates consent_marketing = false</li>
                                        <li>Sales objection: form to request no further sales contact</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Chapter 3: Data Subject Rights<br>
                                    &nbsp;&nbsp; Section: Lead Management DSR Implementation
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Data Retention & Deletion</h3>
                                <div class="gdpr-section">
                                    <strong>Retention Policy:</strong>
                                    <ul>
                                        <li><strong>Active Leads (engaged last 90 days):</strong> Retained indefinitely</li>
                                        <li><strong>Inactive Leads (no activity 90+ days):</strong> Flagged for review</li>
                                        <li><strong>Cold Leads (no activity 180+ days):</strong> Auto-deleted or anonymized</li>
                                        <li><strong>Disqualified Leads:</strong> Deleted after 30 days (unless customer)</li>
                                        <li><strong>Activity Logs:</strong> Partitioned by month, deleted after 12 months</li>
                                        <li><strong>Score History:</strong> Anonymized after lead deletion (for analytics)</li>
                                    </ul>
                                    <strong>Automated Deletion (Lambda Function):</strong>
                                    <ul>
                                        <li>Daily job: lead-retention-cleanup Lambda</li>
                                        <li>Identifies leads with last_activity_at > 180 days ago</li>
                                        <li>Sends deletion warning email (7-day notice)</li>
                                        <li>After 7 days, anonymizes PII (GDPR-compliant deletion)</li>
                                        <li>CloudWatch alarm if deletion job fails</li>
                                    </ul>
                                    <strong>Audit Trail:</strong>
                                    <ul>
                                        <li>All deletions logged to deletion_audit table</li>
                                        <li>Logs: lead_id, deletion_reason, timestamp, deleted_by</li>
                                        <li>Audit logs retained 7 years (regulatory compliance)</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 5(1)(e): Storage Limitation<br>
                                    &nbsp;&nbsp; Section: Automated Data Retention for Leads
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Security & Third-Party Processing</h3>
                                <div class="gdpr-section">
                                    <strong>Article 32 - Security of Processing:</strong>
                                    <ul>
                                        <li>Encryption at rest: RDS encryption with KMS (AES-256)</li>
                                        <li>Encryption in transit: TLS 1.3 for all API calls</li>
                                        <li>API rate limiting: 100 req/min per IP (prevent brute force)</li>
                                        <li>Secrets Manager: API keys encrypted with KMS rotation</li>
                                        <li>Access control: RBAC (only sales team can view lead data)</li>
                                    </ul>
                                    <strong>Article 28 - Processor Agreements (DPAs):</strong>
                                    <ul>
                                        <li><strong>Clearbit:</strong> DPA signed, GDPR-compliant enrichment</li>
                                        <li><strong>Hunter.io:</strong> DPA signed, email validation only (no storage)</li>
                                        <li><strong>Twilio:</strong> DPA signed for SMS notifications</li>
                                        <li><strong>AWS:</strong> AWS GDPR Data Processing Addendum in place</li>
                                        <li>All processors: EU/US Data Privacy Framework certified</li>
                                    </ul>
                                    <strong>Article 33/34 - Breach Notification:</strong>
                                    <ul>
                                        <li>CloudWatch alarm: unauthorized access to leads table</li>
                                        <li>SNS alert to security team within 15 minutes</li>
                                        <li>Breach response plan: notify DPA within 72 hours</li>
                                        <li>Data subjects notified if high risk (email compromise)</li>
                                    </ul>
                                    <strong>Privacy by Design (Article 25):</strong>
                                    <ul>
                                        <li>Default consent = false (opt-in required)</li>
                                        <li>Minimal data collection: only necessary fields required</li>
                                        <li>Pseudonymization: lead IDs are UUIDs (not sequential)</li>
                                        <li>Data minimization: enrichment only when legitimately needed</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Chapter 7: Security Measures<br>
                                    &nbsp;&nbsp; Chapter 8: Third-Party Data Processors
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 8 -->

            <!-- FRAME 9: SALES & LEAD GENERATION BUILDER - CRM INTEGRATION & TAGGING -->
            <div class="frame" id="frame9">
                <div class="frame-title">FRAME 9: SALES & LEAD GENERATION BUILDER - CRM INTEGRATION & TAGGING</div>
                <div class="frame-subtitle">Two-Way CRM Sync | Smart Tagging | Custom Fields | Pipeline Management | Activity Tracking</div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <span class="legend-color" style="background: #E8F5E9;"></span>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #E3F2FD;"></span>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #FFF3E0;"></span>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #F3E5F5;"></span>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #E0F2F1;"></span>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">👤 SWIM LANE 1: USER ACTIONS</div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Connect CRM Platforms</h3>
                                <ul>
                                    <li><strong>Salesforce:</strong> OAuth 2.0 connection with API permissions (read/write contacts, leads, opportunities)</li>
                                    <li><strong>HubSpot:</strong> Private app integration with contact/company/deal scopes</li>
                                    <li><strong>Zoho CRM:</strong> OAuth connection with CRM.modules.ALL scope</li>
                                    <li><strong>Pipedrive:</strong> API token authentication for person/deal/activity sync</li>
                                    <li><strong>Field Mapping:</strong> Map UnifiedBeez fields to CRM custom fields</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Configure Sync Rules</h3>
                                <ul>
                                    <li><strong>Sync Direction:</strong> One-way (UnifiedBeez → CRM) or Two-way (bidirectional)</li>
                                    <li><strong>Sync Frequency:</strong> Real-time (webhook), Hourly, Daily batch sync</li>
                                    <li><strong>Conflict Resolution:</strong> CRM wins, UnifiedBeez wins, or manual review</li>
                                    <li><strong>Sync Filters:</strong> Only sync leads with score >50 or stage = MQL/SQL</li>
                                    <li><strong>Deduplication:</strong> Match by email, prevent duplicate contact creation</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Set Up Smart Tagging System</h3>
                                <ul>
                                    <li><strong>Behavioral Tags:</strong> Auto-tag based on actions (opened_pricing_page, downloaded_whitepaper)</li>
                                    <li><strong>Segmentation Tags:</strong> Industry, company_size, job_role, region</li>
                                    <li><strong>Lifecycle Tags:</strong> new_lead, engaged, nurture_ready, sales_ready</li>
                                    <li><strong>Campaign Tags:</strong> Tag leads by campaign source (webinar_q1_2024, linkedin_ads)</li>
                                    <li><strong>Custom Tags:</strong> Create unlimited custom tags with color coding</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Manage Sales Pipelines</h3>
                                <ul>
                                    <li><strong>Pipeline Stages:</strong> Prospect → Contact Made → Demo Scheduled → Proposal Sent → Negotiation → Closed Won/Lost</li>
                                    <li><strong>Stage Automation:</strong> Auto-move leads between stages based on actions</li>
                                    <li><strong>Deal Value Tracking:</strong> Track estimated deal value and close probability</li>
                                    <li><strong>Sales Rep Assignment:</strong> Round-robin, territory-based, or manual assignment</li>
                                    <li><strong>Activity Logging:</strong> Track calls, emails, meetings, notes synced to CRM</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">⚙️ SWIM LANE 2: BACKEND SERVICES (NestJS + TypeScript)</div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">

                            <div class="service-card">
                                <h3><span class="service-icon">🔗</span> CRM Integration Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/crm/connect - Initiate OAuth flow for CRM connection<br>
                                        • <strong>POST</strong> /api/crm/sync - Trigger manual sync job<br>
                                        • <strong>GET</strong> /api/crm/status - Check sync status and last sync time<br>
                                        • <strong>POST</strong> /api/crm/field-mapping - Configure field mappings<br>
                                        • <strong>DELETE</strong> /api/crm/disconnect - Revoke CRM connection
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Supported Platforms:</div>
                                    <div class="section-content">
                                        • <strong>Salesforce:</strong> REST API v59.0, OAuth 2.0, SOQL queries<br>
                                        • <strong>HubSpot:</strong> CRM API v3, private apps, batch endpoints<br>
                                        • <strong>Zoho CRM:</strong> REST API v2, OAuth 2.0, bulk read/write<br>
                                        • <strong>Pipedrive:</strong> REST API v1, token auth, webhook support<br>
                                        • <strong>Generic Webhook:</strong> Custom webhook receiver for any CRM
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🔄</span> Data Sync Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/sync/lead-to-crm - Sync single lead to CRM<br>
                                        • <strong>POST</strong> /api/sync/batch - Batch sync multiple leads<br>
                                        • <strong>POST</strong> /api/sync/crm-to-lead - Pull updates from CRM<br>
                                        • <strong>GET</strong> /api/sync/conflicts - Get sync conflicts requiring resolution<br>
                                        • <strong>POST</strong> /api/sync/resolve-conflict - Resolve sync conflict
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Sync Logic:</div>
                                    <div class="section-content">
                                        • <strong>Real-time Sync:</strong> Webhook triggers on lead create/update<br>
                                        • <strong>Batch Sync:</strong> Scheduled jobs (hourly/daily) via EventBridge<br>
                                        • <strong>Conflict Detection:</strong> Compare updated_at timestamps<br>
                                        • <strong>Retry Logic:</strong> Exponential backoff for API failures (3 retries)<br>
                                        • <strong>Error Handling:</strong> Invalid field mapping errors logged to CloudWatch
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🏷️</span> Tagging Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/tags/create - Create new tag with color/category<br>
                                        • <strong>POST</strong> /api/tags/apply - Apply tag(s) to lead(s)<br>
                                        • <strong>DELETE</strong> /api/tags/remove - Remove tag from lead<br>
                                        • <strong>GET</strong> /api/tags/search - Search leads by tag(s)<br>
                                        • <strong>POST</strong> /api/tags/auto-tag - Configure auto-tagging rules
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Auto-Tagging Rules:</div>
                                    <div class="section-content">
                                        • <strong>Behavioral:</strong> Tag "pricing_interested" when pricing page visited 3+ times<br>
                                        • <strong>Engagement:</strong> Tag "highly_engaged" when score >80<br>
                                        • <strong>Lifecycle:</strong> Tag "hot_lead" when stage = SQL<br>
                                        • <strong>Temporal:</strong> Tag "stale_lead" when no activity for 60 days<br>
                                        • <strong>Boolean Logic:</strong> AND/OR/NOT conditions for complex rules
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📋</span> Custom Fields Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/custom-fields/create - Create custom field definition<br>
                                        • <strong>PUT</strong> /api/custom-fields/:fieldId - Update field config<br>
                                        • <strong>POST</strong> /api/custom-fields/set-value - Set custom field value for lead<br>
                                        • <strong>GET</strong> /api/custom-fields/values/:leadId - Get all custom values for lead
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Field Types:</div>
                                    <div class="section-content">
                                        • <strong>Text:</strong> Single-line text (max 255 chars)<br>
                                        • <strong>Number:</strong> Integer or decimal with min/max validation<br>
                                        • <strong>Date:</strong> ISO 8601 date/datetime<br>
                                        • <strong>Dropdown:</strong> Single-select from predefined options<br>
                                        • <strong>Multi-select:</strong> Multiple values from options<br>
                                        • <strong>Boolean:</strong> Yes/No checkbox<br>
                                        • <strong>URL:</strong> URL with validation
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📊</span> Pipeline Management Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/pipeline/create - Create custom pipeline<br>
                                        • <strong>POST</strong> /api/pipeline/:id/stages - Add/reorder stages<br>
                                        • <strong>PUT</strong> /api/pipeline/move-lead - Move lead to different stage<br>
                                        • <strong>GET</strong> /api/pipeline/metrics - Pipeline conversion metrics<br>
                                        • <strong>POST</strong> /api/pipeline/forecast - Revenue forecasting
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Pipeline Features:</div>
                                    <div class="section-content">
                                        • <strong>Stage Automation:</strong> Auto-advance on trigger (demo_booked → Demo Scheduled)<br>
                                        • <strong>Deal Tracking:</strong> Estimated value, close date, probability<br>
                                        • <strong>Conversion Metrics:</strong> Stage conversion rates, avg time in stage<br>
                                        • <strong>Revenue Forecast:</strong> Weighted pipeline value (probability × deal value)<br>
                                        • <strong>Lost Reason Tracking:</strong> Categorize why deals are lost
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📝</span> Activity Tracking Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/activities/log - Log sales activity (call, email, meeting, note)<br>
                                        • <strong>GET</strong> /api/activities/:leadId - Get activity timeline for lead<br>
                                        • <strong>POST</strong> /api/activities/task - Create follow-up task<br>
                                        • <strong>PUT</strong> /api/activities/task/:id/complete - Mark task as complete
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Activity Types:</div>
                                    <div class="section-content">
                                        • <strong>Call:</strong> Duration, outcome (connected, voicemail, no answer), notes<br>
                                        • <strong>Email:</strong> Subject, body, sent/received, opened/clicked<br>
                                        • <strong>Meeting:</strong> Date, duration, attendees, meeting notes, outcome<br>
                                        • <strong>Note:</strong> Free-form text notes about lead interaction<br>
                                        • <strong>Task:</strong> Follow-up tasks with due date, priority, assignee<br>
                                        • <strong>CRM Sync:</strong> All activities synced to connected CRM
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">☁️ SWIM LANE 3: AWS INFRASTRUCTURE</div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate - CRM Services
                                </h4>
                                <div class="section-content">
                                    <strong>Task Definition:</strong> crm-integration-service, data-sync-service, pipeline-service<br>
                                    <strong>CPU/Memory:</strong> 1 vCPU, 2GB RAM per task<br>
                                    <strong>Auto Scaling:</strong> 2-10 tasks based on SQS sync queue depth<br>
                                    <strong>Scaling Metric:</strong> ApproximateNumberOfMessagesVisible >50<br>
                                    <strong>Health Check:</strong> /health endpoint every 30s<br>
                                    <strong>Deployment:</strong> Rolling update, 50% minimum healthy
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL 15.4 - CRM Data
                                </h4>
                                <div class="section-content">
                                    <strong>Instance:</strong> db.r6g.xlarge (Multi-AZ for HA)<br>
                                    <strong>Storage:</strong> 500GB GP3 SSD (auto-scaling to 1TB)<br>
                                    <strong>Tables:</strong> crm_connections, sync_logs, tags, custom_fields, pipelines, activities<br>
                                    <strong>Indexes:</strong> lead_id, tag_name, activity_type, created_at<br>
                                    <strong>Partitioning:</strong> activities partitioned by quarter<br>
                                    <strong>Backup:</strong> Automated daily snapshots, 7-day retention
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Queue-Service.svg" alt="SQS" class="aws-icon">
                                    SQS - Sync Queues
                                </h4>
                                <div class="section-content">
                                    <strong>crm-sync-queue:</strong> Real-time lead sync events (FIFO, retention 14 days)<br>
                                    <strong>batch-sync-queue:</strong> Scheduled batch sync jobs<br>
                                    <strong>webhook-receiver-queue:</strong> Incoming webhooks from CRMs<br>
                                    <strong>Visibility Timeout:</strong> 10 minutes (CRM API calls can be slow)<br>
                                    <strong>Dead Letter Queue:</strong> 3 retries before DLQ<br>
                                    <strong>Throughput:</strong> ~200 messages/second peak
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis - CRM Cache
                                </h4>
                                <div class="section-content">
                                    <strong>Node Type:</strong> cache.r6g.large (Cluster Mode enabled)<br>
                                    <strong>Use Cases:</strong><br>
                                    • CRM OAuth tokens (TTL = token expiry, auto-refresh)<br>
                                    • Field mapping cache (TTL 24h, invalidate on update)<br>
                                    • Tag lookup cache (TTL 1h)<br>
                                    • CRM API rate limit tracking (sliding window)<br>
                                    • Recent sync status (TTL 5 min)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/EventBridge.svg" alt="EventBridge" class="aws-icon">
                                    EventBridge - Scheduled Sync
                                </h4>
                                <div class="section-content">
                                    <strong>hourly-crm-sync:</strong> cron(0 * * * ? *) - Hourly batch sync<br>
                                    <strong>daily-full-sync:</strong> cron(0 2 * * ? *) - 2 AM daily full reconciliation<br>
                                    <strong>weekly-cleanup:</strong> cron(0 3 ? * SUN *) - Clean old sync logs<br>
                                    <strong>Target:</strong> Lambda function → SQS batch-sync-queue<br>
                                    <strong>Retry Policy:</strong> 3 retries with exponential backoff
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Compute/Lambda.svg" alt="Lambda" class="aws-icon">
                                    Lambda Functions
                                </h4>
                                <div class="section-content">
                                    <strong>crm-sync-worker:</strong> Process sync jobs, call CRM APIs (timeout 5min, 2GB RAM)<br>
                                    <strong>webhook-processor:</strong> Process incoming CRM webhooks (timeout 30s, 512MB RAM)<br>
                                    <strong>auto-tag-evaluator:</strong> Evaluate auto-tagging rules hourly (1GB RAM)<br>
                                    <strong>sync-conflict-detector:</strong> Detect and flag sync conflicts (1GB RAM)<br>
                                    <strong>Runtime:</strong> Node.js 20.x, bundled with esbuild
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Notification-Service.svg" alt="SNS" class="aws-icon">
                                    SNS - Sync Notifications
                                </h4>
                                <div class="section-content">
                                    <strong>sync-failure-alerts:</strong> Notify admins when sync fails (>5% error rate)<br>
                                    <strong>conflict-notifications:</strong> Alert when sync conflicts require resolution<br>
                                    <strong>webhook-errors:</strong> Notify when CRM webhook fails to process<br>
                                    <strong>Subscribers:</strong> Email, Slack webhooks, PagerDuty (critical only)<br>
                                    <strong>Filtering:</strong> Severity-based filtering (info, warning, critical)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Management-Governance/CloudWatch.svg" alt="CloudWatch" class="aws-icon">
                                    CloudWatch - Monitoring
                                </h4>
                                <div class="section-content">
                                    <strong>Metrics:</strong> Sync success rate, API call latency, sync queue depth, conflicts/hour<br>
                                    <strong>Alarms:</strong> Sync failure rate >5%, CRM API timeout >10s, queue depth >500<br>
                                    <strong>Logs:</strong> Sync events, field mapping errors, CRM API responses<br>
                                    <strong>Dashboards:</strong> CRM sync health, tag usage, pipeline metrics<br>
                                    <strong>Retention:</strong> 90 days log retention
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Secrets-Manager.svg" alt="Secrets Manager" class="aws-icon">
                                    Secrets Manager - CRM Credentials
                                </h4>
                                <div class="section-content">
                                    <strong>Secrets Stored (per tenant):</strong><br>
                                    • unifiedbeez/crm/salesforce-oauth (access + refresh tokens)<br>
                                    • unifiedbeez/crm/hubspot-api-key (private app key)<br>
                                    • unifiedbeez/crm/zoho-oauth (OAuth credentials)<br>
                                    • unifiedbeez/crm/pipedrive-token (API token)<br>
                                    <strong>Encryption:</strong> KMS key (unifiedbeez-secrets-key)<br>
                                    <strong>Rotation:</strong> OAuth tokens refreshed automatically before expiry
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">🗄️ SWIM LANE 4: DATABASE SCHEMA & RELATIONSHIPS</div>
                    <div class="lane-content lane-data">

                        <!-- TABLE: crm_connections -->
                        <div class="db-table">
                            <div class="table-header">TABLE: crm_connections</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique connection identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>tenant_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → tenants(id), UNIQUE</div>
                                    <div>Multi-tenancy isolation (one CRM per tenant)</div>
                                </div>
                                <div class="table-row">
                                    <div>crm_platform</div>
                                    <div>ENUM</div>
                                    <div>'salesforce', 'hubspot', 'zoho', 'pipedrive', 'custom'</div>
                                    <div>Connected CRM platform</div>
                                </div>
                                <div class="table-row">
                                    <div>auth_type</div>
                                    <div>ENUM</div>
                                    <div>'oauth2', 'api_token', 'api_key'</div>
                                    <div>Authentication method used</div>
                                </div>
                                <div class="table-row">
                                    <div>credentials_secret_arn</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>AWS Secrets Manager ARN for credentials</div>
                                </div>
                                <div class="table-row">
                                    <div>sync_direction</div>
                                    <div>ENUM</div>
                                    <div>'one_way_to_crm', 'one_way_from_crm', 'two_way'</div>
                                    <div>Sync direction configuration</div>
                                </div>
                                <div class="table-row">
                                    <div>sync_frequency</div>
                                    <div>ENUM</div>
                                    <div>'realtime', 'hourly', 'daily'</div>
                                    <div>How often to sync data</div>
                                </div>
                                <div class="table-row">
                                    <div>conflict_resolution</div>
                                    <div>ENUM</div>
                                    <div>'crm_wins', 'unifiedbeez_wins', 'manual'</div>
                                    <div>How to handle sync conflicts</div>
                                </div>
                                <div class="table-row">
                                    <div>field_mappings</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Field mapping config (UnifiedBeez field → CRM field)</div>
                                </div>
                                <div class="table-row">
                                    <div>sync_filters</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Conditions for syncing (e.g., only sync if score >50)</div>
                                </div>
                                <div class="table-row">
                                    <div>is_active</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Connection status</div>
                                </div>
                                <div class="table-row">
                                    <div>last_sync_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>Last successful sync timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>webhook_url</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Webhook URL for receiving CRM updates</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Connection creation timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: sync_logs -->
                        <div class="db-table">
                            <div class="table-header">TABLE: sync_logs</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique log identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>crm_connection_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → crm_connections(id), INDEX</div>
                                    <div>Associated CRM connection</div>
                                </div>
                                <div class="table-row">
                                    <div>lead_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → leads(id), INDEX</div>
                                    <div>Lead being synced</div>
                                </div>
                                <div class="table-row">
                                    <div>sync_direction</div>
                                    <div>ENUM</div>
                                    <div>'to_crm', 'from_crm'</div>
                                    <div>Direction of this sync</div>
                                </div>
                                <div class="table-row">
                                    <div>sync_type</div>
                                    <div>ENUM</div>
                                    <div>'create', 'update', 'delete'</div>
                                    <div>Type of sync operation</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>ENUM</div>
                                    <div>'success', 'failed', 'conflict', 'skipped'</div>
                                    <div>Sync result</div>
                                </div>
                                <div class="table-row">
                                    <div>crm_record_id</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>CRM's record ID (for mapping)</div>
                                </div>
                                <div class="table-row">
                                    <div>error_message</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Error details if status = failed</div>
                                </div>
                                <div class="table-row">
                                    <div>conflict_details</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Field-level conflict info (UnifiedBeez value vs CRM value)</div>
                                </div>
                                <div class="table-row">
                                    <div>synced_fields</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Fields that were synced in this operation</div>
                                </div>
                                <div class="table-row">
                                    <div>api_response</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>CRM API response (for debugging)</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW(), INDEX</div>
                                    <div>Sync attempt timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: tags -->
                        <div class="db-table">
                            <div class="table-header">TABLE: tags</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique tag identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>tenant_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → tenants(id), INDEX</div>
                                    <div>Multi-tenancy isolation</div>
                                </div>
                                <div class="table-row">
                                    <div>name</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NOT NULL, INDEX</div>
                                    <div>Tag name (e.g., "hot_lead", "enterprise", "churned")</div>
                                </div>
                                <div class="table-row">
                                    <div>category</div>
                                    <div>ENUM</div>
                                    <div>'behavioral', 'segmentation', 'lifecycle', 'campaign', 'custom'</div>
                                    <div>Tag category</div>
                                </div>
                                <div class="table-row">
                                    <div>color</div>
                                    <div>VARCHAR(7)</div>
                                    <div>DEFAULT '#3B82F6'</div>
                                    <div>Hex color for UI display</div>
                                </div>
                                <div class="table-row">
                                    <div>description</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Tag description/purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>auto_apply_rules</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Auto-tagging rules (conditions for automatic application)</div>
                                </div>
                                <div class="table-row">
                                    <div>is_system_tag</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>System tags cannot be deleted by users</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Tag creation timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: lead_tags (junction table) -->
                        <div class="db-table">
                            <div class="table-header">TABLE: lead_tags (Many-to-Many Relationship)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique relationship identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>lead_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → leads(id), INDEX</div>
                                    <div>Lead being tagged</div>
                                </div>
                                <div class="table-row">
                                    <div>tag_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → tags(id), INDEX</div>
                                    <div>Applied tag</div>
                                </div>
                                <div class="table-row">
                                    <div>applied_by</div>
                                    <div>ENUM</div>
                                    <div>'user', 'auto_rule', 'system'</div>
                                    <div>How tag was applied</div>
                                </div>
                                <div class="table-row">
                                    <div>applied_by_user_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → users(id), NULLABLE</div>
                                    <div>User who applied tag (if manual)</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>When tag was applied</div>
                                </div>
                                <div class="table-row">
                                    <div>-</div>
                                    <div>-</div>
                                    <div>UNIQUE (lead_id, tag_id)</div>
                                    <div>Prevent duplicate tag applications</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: custom_fields -->
                        <div class="db-table">
                            <div class="table-header">TABLE: custom_fields</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique field identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>tenant_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → tenants(id), INDEX</div>
                                    <div>Multi-tenancy isolation</div>
                                </div>
                                <div class="table-row">
                                    <div>field_name</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NOT NULL</div>
                                    <div>Field name (e.g., "annual_contract_value", "use_case")</div>
                                </div>
                                <div class="table-row">
                                    <div>field_type</div>
                                    <div>ENUM</div>
                                    <div>'text', 'number', 'date', 'dropdown', 'multi_select', 'boolean', 'url'</div>
                                    <div>Data type of field</div>
                                </div>
                                <div class="table-row">
                                    <div>options</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Options for dropdown/multi_select (array of strings)</div>
                                </div>
                                <div class="table-row">
                                    <div>validation_rules</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Validation config (min/max for numbers, regex for text)</div>
                                </div>
                                <div class="table-row">
                                    <div>is_required</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Whether field must have value</div>
                                </div>
                                <div class="table-row">
                                    <div>display_order</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Order in UI</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Field definition creation</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: pipelines -->
                        <div class="db-table">
                            <div class="table-header">TABLE: pipelines</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique pipeline identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>tenant_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → tenants(id), INDEX</div>
                                    <div>Multi-tenancy isolation</div>
                                </div>
                                <div class="table-row">
                                    <div>name</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Pipeline name (e.g., "Sales Pipeline", "Enterprise Deals")</div>
                                </div>
                                <div class="table-row">
                                    <div>stages</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Array of stage objects [{name, order, probability}]</div>
                                </div>
                                <div class="table-row">
                                    <div>is_default</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Default pipeline for new leads</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Pipeline creation timestamp</div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">🛡️ SWIM LANE 5: GDPR COMPLIANCE & DATA PROTECTION</div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Third-Party Data Sharing</h3>
                                <div class="gdpr-section">
                                    <strong>Article 28 - Processor Agreements:</strong>
                                    <ul>
                                        <li><strong>Salesforce:</strong> DPA signed, EU Data Residency option available</li>
                                        <li><strong>HubSpot:</strong> DPA signed, Privacy Shield certified</li>
                                        <li><strong>Zoho CRM:</strong> DPA signed, EU data centers available</li>
                                        <li><strong>Pipedrive:</strong> DPA signed, GDPR-compliant hosting</li>
                                        <li>All CRMs: EU/US Data Privacy Framework certified</li>
                                    </ul>
                                    <strong>Article 44-49 - International Transfers:</strong>
                                    <ul>
                                        <li>Standard Contractual Clauses (SCCs) in place for non-EU CRMs</li>
                                        <li>Data transfer impact assessments (TIA) documented</li>
                                        <li>Option to restrict sync to EU-only CRM instances</li>
                                        <li>Transparent disclosure of data transfer locations in privacy policy</li>
                                    </ul>
                                    <strong>User Consent for CRM Sync:</strong>
                                    <ul>
                                        <li>Privacy policy discloses CRM integration and data sharing</li>
                                        <li>Legitimate interest basis: CRM sync necessary for sales process</li>
                                        <li>Users can object to CRM sync (right to object - Article 21)</li>
                                        <li>Consent withdrawal stops future syncs immediately</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Chapter 8: Third-Party Data Processors<br>
                                    &nbsp;&nbsp; Article 44: International Data Transfers
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Data Minimization & Purpose Limitation</h3>
                                <div class="gdpr-section">
                                    <strong>Article 5(1)(b) - Purpose Limitation:</strong>
                                    <ul>
                                        <li>CRM sync only for legitimate sales/customer management purposes</li>
                                        <li>Tags used for segmentation, not discriminatory profiling</li>
                                        <li>Custom fields limited to business-relevant data only</li>
                                        <li>No sensitive data synced to CRM (health, religion, politics)</li>
                                    </ul>
                                    <strong>Article 5(1)(c) - Data Minimization:</strong>
                                    <ul>
                                        <li>Sync filters allow selecting only necessary fields to sync</li>
                                        <li>Field mapping configured to avoid over-sharing data</li>
                                        <li>Option to sync only high-value leads (score >50) to reduce data transfer</li>
                                        <li>Custom fields require explicit creation (not auto-generated)</li>
                                    </ul>
                                    <strong>Sync Transparency:</strong>
                                    <ul>
                                        <li>Sync logs record every data transfer (audit trail)</li>
                                        <li>Users can view sync history (which data sent to CRM, when)</li>
                                        <li>Sync status dashboard shows real-time sync activity</li>
                                        <li>Privacy policy explains CRM sync scope and frequency</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 5: Data Protection Principles<br>
                                    &nbsp;&nbsp; Section: Purpose Limitation & Data Minimization
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Data Subject Rights for CRM Data</h3>
                                <div class="gdpr-section">
                                    <strong>Article 15 - Right of Access:</strong>
                                    <ul>
                                        <li>Self-service dashboard shows CRM sync status</li>
                                        <li>View which CRM platform is connected</li>
                                        <li>See all sync logs (what data was synced, when, to where)</li>
                                        <li>Access CRM record ID for cross-reference</li>
                                    </ul>
                                    <strong>Article 17 - Right to Erasure:</strong>
                                    <ul>
                                        <li>Delete request triggers sync to delete from CRM (if two-way sync)</li>
                                        <li>One-way sync: user instructed to contact CRM directly</li>
                                        <li>Deletion logged in sync_logs for compliance audit</li>
                                        <li>Tags and custom field values deleted with lead deletion</li>
                                    </ul>
                                    <strong>Article 20 - Right to Data Portability:</strong>
                                    <ul>
                                        <li>Export includes: tags, custom fields, pipeline stage, CRM sync history</li>
                                        <li>JSON/CSV export includes all CRM-related metadata</li>
                                        <li>CRM record IDs included for cross-platform portability</li>
                                    </ul>
                                    <strong>Article 21 - Right to Object:</strong>
                                    <ul>
                                        <li>Users can object to CRM sync (opt-out)</li>
                                        <li>Opt-out pauses sync immediately (is_active = false)</li>
                                        <li>Tags applied manually can be removed by user or support</li>
                                        <li>Auto-tagging rules can be disabled per user request</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Chapter 3: Data Subject Rights<br>
                                    &nbsp;&nbsp; Section: CRM Integration & Third-Party Sync
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Security & Sync Integrity</h3>
                                <div class="gdpr-section">
                                    <strong>Article 32 - Security of Processing:</strong>
                                    <ul>
                                        <li>CRM credentials stored in AWS Secrets Manager (KMS encrypted)</li>
                                        <li>OAuth tokens encrypted at rest (AES-256)</li>
                                        <li>All CRM API calls over HTTPS (TLS 1.3)</li>
                                        <li>Webhook signature validation (HMAC-SHA256) for incoming CRM updates</li>
                                        <li>API rate limiting to prevent abuse (100 req/min per CRM connection)</li>
                                    </ul>
                                    <strong>Sync Audit Trail:</strong>
                                    <ul>
                                        <li>Every sync operation logged to sync_logs table</li>
                                        <li>Logs retained 90 days for compliance audit</li>
                                        <li>Sync failures logged with error details for investigation</li>
                                        <li>Conflict logs show both versions (UnifiedBeez vs CRM) for transparency</li>
                                    </ul>
                                    <strong>Access Control:</strong>
                                    <ul>
                                        <li>RBAC: Only admin users can configure CRM connections</li>
                                        <li>Sales reps can view sync status but not modify config</li>
                                        <li>API keys/tokens visible only to authorized admins</li>
                                        <li>CloudWatch alarms for unauthorized CRM API access attempts</li>
                                    </ul>
                                    <strong>Data Retention:</strong>
                                    <ul>
                                        <li>Sync logs deleted after 90 days (no longer needed)</li>
                                        <li>Disconnecting CRM deletes credentials from Secrets Manager</li>
                                        <li>CRM record IDs retained for reconciliation (orphan cleanup)</li>
                                        <li>Tags and custom fields retained separately (user-managed)</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Chapter 7: Security Measures<br>
                                    &nbsp;&nbsp; Section: Third-Party API Security
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 9 -->

            <!-- FRAME 10: SALES & LEAD GENERATION BUILDER - EMAIL SENDER VERIFICATION -->
            <div class="frame" id="frame10">
                <div class="frame-title">FRAME 10: SALES & LEAD GENERATION BUILDER - EMAIL SENDER VERIFICATION</div>
                <div class="frame-subtitle">SPF/DKIM/DMARC Setup | Domain Authentication | Sender Reputation | Deliverability Monitoring</div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <span class="legend-color" style="background: #E8F5E9;"></span>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #E3F2FD;"></span>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #FFF3E0;"></span>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #F3E5F5;"></span>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #E0F2F1;"></span>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">👤 SWIM LANE 1: USER ACTIONS</div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Configure Sender Domains</h3>
                                <ul>
                                    <li><strong>Add Domain:</strong> Register custom domain for sending (e.g., sales@company.com)</li>
                                    <li><strong>DNS Verification:</strong> Add TXT record to verify domain ownership</li>
                                    <li><strong>Multiple Senders:</strong> Configure multiple sender addresses (sales, marketing, support)</li>
                                    <li><strong>Default Sender:</strong> Set default "From" address for campaigns</li>
                                    <li><strong>Reply-To Configuration:</strong> Specify reply-to address (can differ from sender)</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Set Up Email Authentication</h3>
                                <ul>
                                    <li><strong>SPF Record:</strong> Add SPF TXT record to authorize AWS SES servers</li>
                                    <li><strong>DKIM Setup:</strong> Generate DKIM keys and add CNAME records to DNS</li>
                                    <li><strong>DMARC Policy:</strong> Configure DMARC record (quarantine/reject policy)</li>
                                    <li><strong>Verification Status:</strong> Monitor DNS propagation and verification status</li>
                                    <li><strong>Alignment Check:</strong> Ensure SPF/DKIM alignment with DMARC requirements</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Monitor Sender Reputation</h3>
                                <ul>
                                    <li><strong>Reputation Score:</strong> View sender reputation score (0-100) from AWS SES</li>
                                    <li><strong>Bounce Rate:</strong> Monitor bounce rate (hard/soft bounces, target <5%)</li>
                                    <li><strong>Complaint Rate:</strong> Track spam complaint rate (target <0.1%)</li>
                                    <li><strong>Suppression List:</strong> View suppressed emails (bounces, complaints, unsubscribes)</li>
                                    <li><strong>Blocklist Check:</strong> Check if domain/IP is on public email blocklists</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Optimize Deliverability</h3>
                                <ul>
                                    <li><strong>Warm-up Schedule:</strong> Gradual sending volume increase for new domains (10/day → 1000/day over 2 weeks)</li>
                                    <li><strong>Email Testing:</strong> Send test emails to check inbox placement (Gmail, Outlook, Yahoo)</li>
                                    <li><strong>Content Analysis:</strong> Scan emails for spam trigger words/phrases</li>
                                    <li><strong>Authentication Check:</strong> Verify SPF/DKIM/DMARC pass on test emails</li>
                                    <li><strong>Feedback Loops:</strong> Subscribe to ISP feedback loops for complaint notifications</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">⚙️ SWIM LANE 2: BACKEND SERVICES (NestJS + TypeScript)</div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">

                            <div class="service-card">
                                <h3><span class="service-icon">📧</span> Domain Verification Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/sender-domains/add - Add new sender domain<br>
                                        • <strong>POST</strong> /api/sender-domains/:id/verify - Verify domain via DNS TXT record<br>
                                        • <strong>GET</strong> /api/sender-domains/:id/dns-records - Get required DNS records<br>
                                        • <strong>DELETE</strong> /api/sender-domains/:id - Remove sender domain<br>
                                        • <strong>GET</strong> /api/sender-domains/status - Get verification status for all domains
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Verification Logic:</div>
                                    <div class="section-content">
                                        • <strong>DNS Lookup:</strong> Query TXT records for verification token<br>
                                        • <strong>AWS SES Integration:</strong> VerifyDomainIdentity API call<br>
                                        • <strong>Propagation Check:</strong> Retry DNS lookup every 5 minutes (max 72 hours)<br>
                                        • <strong>Verification Token:</strong> Random 32-character alphanumeric string<br>
                                        • <strong>Auto-verification:</strong> Background job checks pending domains hourly
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🔐</span> Email Authentication Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/auth/generate-dkim - Generate DKIM key pair for domain<br>
                                        • <strong>GET</strong> /api/auth/spf-record - Get SPF record configuration<br>
                                        • <strong>GET</strong> /api/auth/dmarc-record - Get DMARC record configuration<br>
                                        • <strong>POST</strong> /api/auth/verify-alignment - Check SPF/DKIM/DMARC alignment<br>
                                        • <strong>GET</strong> /api/auth/status/:domain - Get authentication status
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Authentication Setup:</div>
                                    <div class="section-content">
                                        • <strong>SPF:</strong> v=spf1 include:amazonses.com ~all<br>
                                        • <strong>DKIM:</strong> 2048-bit RSA key, AWS SES manages keys<br>
                                        • <strong>DMARC:</strong> v=DMARC1; p=quarantine; rua=mailto:dmarc@company.com<br>
                                        • <strong>Alignment Check:</strong> From domain must match SPF/DKIM signing domain<br>
                                        • <strong>DNS Propagation:</strong> Check nameservers for record updates
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📊</span> Reputation Monitoring Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>GET</strong> /api/reputation/score - Get sender reputation score<br>
                                        • <strong>GET</strong> /api/reputation/metrics - Bounce/complaint rates<br>
                                        • <strong>GET</strong> /api/reputation/suppression-list - View suppressed emails<br>
                                        • <strong>POST</strong> /api/reputation/blocklist-check - Check domain against blocklists<br>
                                        • <strong>GET</strong> /api/reputation/trends - Historical reputation data
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Reputation Metrics:</div>
                                    <div class="section-content">
                                        • <strong>Bounce Rate:</strong> (bounces / sent) × 100 (target <5%)<br>
                                        • <strong>Complaint Rate:</strong> (complaints / sent) × 100 (target <0.1%)<br>
                                        • <strong>Reputation Score:</strong> AWS SES account reputation (0-100)<br>
                                        • <strong>Blocklist Status:</strong> Check against Spamhaus, Barracuda, SURBL<br>
                                        • <strong>Sending Limits:</strong> Current SES sending quota (14/sec default)
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📈</span> Deliverability Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/deliverability/test-email - Send test email to seed accounts<br>
                                        • <strong>POST</strong> /api/deliverability/analyze-content - Scan for spam triggers<br>
                                        • <strong>GET</strong> /api/deliverability/inbox-placement - Inbox vs spam folder rate<br>
                                        • <strong>POST</strong> /api/deliverability/warmup-schedule - Create domain warmup plan<br>
                                        • <strong>GET</strong> /api/deliverability/recommendations - Get improvement suggestions
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Deliverability Checks:</div>
                                    <div class="section-content">
                                        • <strong>Spam Score:</strong> Content analysis (0-10, <3 is good)<br>
                                        • <strong>Inbox Placement:</strong> Gmail (85%+), Outlook (80%+), Yahoo (75%+)<br>
                                        • <strong>Authentication Pass Rate:</strong> SPF/DKIM/DMARC pass percentage<br>
                                        • <strong>Engagement Rate:</strong> Opens + clicks (indicates good deliverability)<br>
                                        • <strong>Warmup Progress:</strong> Track daily send volume vs warmup schedule
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🚨</span> Bounce & Complaint Handler</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/bounces/webhook - SNS webhook for bounce notifications<br>
                                        • <strong>POST</strong> /api/complaints/webhook - SNS webhook for complaints<br>
                                        • <strong>GET</strong> /api/bounces/:leadId - Get bounce history for lead<br>
                                        • <strong>POST</strong> /api/suppression/add - Manually suppress email<br>
                                        • <strong>DELETE</strong> /api/suppression/:email - Remove from suppression list
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Handling Logic:</div>
                                    <div class="section-content">
                                        • <strong>Hard Bounce:</strong> Permanently suppress email (invalid, doesn't exist)<br>
                                        • <strong>Soft Bounce:</strong> Retry 3 times over 72 hours (mailbox full, temp error)<br>
                                        • <strong>Complaint:</strong> Immediately suppress + mark lead as unsubscribed<br>
                                        • <strong>Suppression Sync:</strong> Update leads table (email_valid = false)<br>
                                        • <strong>SNS Topic:</strong> ses-bounce-topic, ses-complaint-topic
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🔍</span> DNS Management Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/dns/lookup - Perform DNS record lookup<br>
                                        • <strong>GET</strong> /api/dns/nameservers/:domain - Get domain nameservers<br>
                                        • <strong>POST</strong> /api/dns/validate-records - Validate all required DNS records<br>
                                        • <strong>GET</strong> /api/dns/propagation-status - Check DNS propagation globally
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">DNS Operations:</div>
                                    <div class="section-content">
                                        • <strong>TXT Lookup:</strong> Verification token, SPF, DMARC records<br>
                                        • <strong>CNAME Lookup:</strong> DKIM keys (3 CNAME records per domain)<br>
                                        • <strong>MX Lookup:</strong> Verify inbound email routing<br>
                                        • <strong>NS Lookup:</strong> Get authoritative nameservers<br>
                                        • <strong>Global Check:</strong> Query DNS from multiple regions (8 locations)
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">☁️ SWIM LANE 3: AWS INFRASTRUCTURE</div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate - Sender Services
                                </h4>
                                <div class="section-content">
                                    <strong>Task Definition:</strong> domain-verification-service, email-auth-service, reputation-service<br>
                                    <strong>CPU/Memory:</strong> 0.5 vCPU, 1GB RAM per task<br>
                                    <strong>Auto Scaling:</strong> 2-8 tasks based on CPU utilization<br>
                                    <strong>Scaling Metric:</strong> CPUUtilization >70%<br>
                                    <strong>Health Check:</strong> /health endpoint every 30s<br>
                                    <strong>Deployment:</strong> Rolling update, 50% minimum healthy
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Customer-Enablement/Simple-Email-Service.svg" alt="SES" class="aws-icon">
                                    AWS SES - Email Sending
                                </h4>
                                <div class="section-content">
                                    <strong>Region:</strong> us-east-1 (production), us-west-2 (backup)<br>
                                    <strong>Sending Limits:</strong> 14 emails/sec, 50,000 emails/day (default)<br>
                                    <strong>Domain Identities:</strong> SPF/DKIM/DMARC verified domains<br>
                                    <strong>Configuration Sets:</strong> Track opens/clicks, bounce/complaint events<br>
                                    <strong>Dedicated IPs:</strong> Optional dedicated IP pools for high-volume senders<br>
                                    <strong>Reputation:</strong> Account-level reputation dashboard
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL 15.4 - Sender Data
                                </h4>
                                <div class="section-content">
                                    <strong>Instance:</strong> db.r6g.large (Multi-AZ for HA)<br>
                                    <strong>Storage:</strong> 200GB GP3 SSD (auto-scaling to 500GB)<br>
                                    <strong>Tables:</strong> sender_domains, dns_records, bounce_logs, complaint_logs, reputation_history<br>
                                    <strong>Indexes:</strong> domain, email, bounce_type, created_at<br>
                                    <strong>Partitioning:</strong> bounce_logs/complaint_logs partitioned by month<br>
                                    <strong>Backup:</strong> Automated daily snapshots, 7-day retention
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Notification-Service.svg" alt="SNS" class="aws-icon">
                                    SNS - SES Event Notifications
                                </h4>
                                <div class="section-content">
                                    <strong>ses-bounce-topic:</strong> Hard/soft bounce notifications from SES<br>
                                    <strong>ses-complaint-topic:</strong> Spam complaint notifications from SES<br>
                                    <strong>ses-delivery-topic:</strong> Successful delivery confirmations<br>
                                    <strong>Subscribers:</strong> Lambda functions, SQS queues, HTTP/S endpoints<br>
                                    <strong>Message Format:</strong> JSON with bounce type, recipient, timestamp<br>
                                    <strong>Retry Policy:</strong> 3 retries with exponential backoff
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Queue-Service.svg" alt="SQS" class="aws-icon">
                                    SQS - Event Processing Queues
                                </h4>
                                <div class="section-content">
                                    <strong>bounce-processing-queue:</strong> Process bounce events (retention 14 days)<br>
                                    <strong>complaint-processing-queue:</strong> Process complaint events<br>
                                    <strong>dns-verification-queue:</strong> Domain verification checks<br>
                                    <strong>Visibility Timeout:</strong> 2 minutes (DNS lookups can be slow)<br>
                                    <strong>Dead Letter Queue:</strong> 3 retries before DLQ<br>
                                    <strong>Throughput:</strong> ~100 messages/second peak
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis - DNS Cache
                                </h4>
                                <div class="section-content">
                                    <strong>Node Type:</strong> cache.r6g.large (Cluster Mode enabled)<br>
                                    <strong>Use Cases:</strong><br>
                                    • DNS lookup results (TTL 1 hour)<br>
                                    • Domain verification status (TTL 5 min)<br>
                                    • Reputation scores (TTL 15 min)<br>
                                    • Suppression list cache (TTL 10 min)<br>
                                    • Blocklist check results (TTL 24 hours)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Compute/Lambda.svg" alt="Lambda" class="aws-icon">
                                    Lambda Functions
                                </h4>
                                <div class="section-content">
                                    <strong>bounce-handler:</strong> Process bounce SNS events (timeout 30s, 512MB RAM)<br>
                                    <strong>complaint-handler:</strong> Process complaint SNS events (timeout 30s, 512MB RAM)<br>
                                    <strong>dns-verification-worker:</strong> Check domain verification status hourly (1GB RAM)<br>
                                    <strong>reputation-calculator:</strong> Calculate daily reputation metrics (1GB RAM)<br>
                                    <strong>blocklist-checker:</strong> Check domains against public blocklists (2GB RAM)<br>
                                    <strong>Runtime:</strong> Node.js 20.x, bundled with esbuild
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/EventBridge.svg" alt="EventBridge" class="aws-icon">
                                    EventBridge - Scheduled Jobs
                                </h4>
                                <div class="section-content">
                                    <strong>hourly-dns-check:</strong> cron(0 * * * ? *) - Verify pending domains<br>
                                    <strong>daily-reputation-report:</strong> cron(0 8 * * ? *) - Calculate daily metrics<br>
                                    <strong>daily-blocklist-check:</strong> cron(0 9 * * ? *) - Check all domains<br>
                                    <strong>weekly-suppression-cleanup:</strong> cron(0 2 ? * SUN *) - Clean old records<br>
                                    <strong>Target:</strong> Lambda functions<br>
                                    <strong>Retry Policy:</strong> 3 retries with exponential backoff
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Management-Governance/CloudWatch.svg" alt="CloudWatch" class="aws-icon">
                                    CloudWatch - Monitoring
                                </h4>
                                <div class="section-content">
                                    <strong>Metrics:</strong> Bounce rate, complaint rate, send quota utilization, reputation score<br>
                                    <strong>Alarms:</strong> Bounce rate >5%, complaint rate >0.1%, reputation score <80<br>
                                    <strong>Logs:</strong> DNS verification attempts, bounce/complaint events, SES API calls<br>
                                    <strong>Dashboards:</strong> Sender health, domain status, deliverability metrics<br>
                                    <strong>Retention:</strong> 90 days log retention<br>
                                    <strong>SNS Alerts:</strong> Critical reputation issues (score <60)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Secrets-Manager.svg" alt="Secrets Manager" class="aws-icon">
                                    Secrets Manager - DKIM Keys
                                </h4>
                                <div class="section-content">
                                    <strong>Secrets Stored:</strong><br>
                                    • unifiedbeez/ses/dkim-private-keys (per domain)<br>
                                    • unifiedbeez/blocklist-api-keys (for premium blocklist checks)<br>
                                    • unifiedbeez/dns-api-credentials (DNS provider APIs)<br>
                                    <strong>Encryption:</strong> KMS key (unifiedbeez-secrets-key)<br>
                                    <strong>Rotation:</strong> DKIM keys rotated every 6 months<br>
                                    <strong>Access Control:</strong> IAM role-based (ECS tasks only)
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">🗄️ SWIM LANE 4: DATABASE SCHEMA & RELATIONSHIPS</div>
                    <div class="lane-content lane-data">

                        <!-- TABLE: sender_domains -->
                        <div class="db-table">
                            <div class="table-header">TABLE: sender_domains</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique domain identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>tenant_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → tenants(id), INDEX</div>
                                    <div>Multi-tenancy isolation</div>
                                </div>
                                <div class="table-row">
                                    <div>domain</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL, INDEX</div>
                                    <div>Domain name (e.g., company.com)</div>
                                </div>
                                <div class="table-row">
                                    <div>sender_email</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Full sender email (e.g., sales@company.com)</div>
                                </div>
                                <div class="table-row">
                                    <div>reply_to_email</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>Reply-to address (if different from sender)</div>
                                </div>
                                <div class="table-row">
                                    <div>verification_token</div>
                                    <div>VARCHAR(64)</div>
                                    <div>NOT NULL, UNIQUE</div>
                                    <div>DNS TXT record verification token</div>
                                </div>
                                <div class="table-row">
                                    <div>verification_status</div>
                                    <div>ENUM</div>
                                    <div>'pending', 'verified', 'failed'</div>
                                    <div>Domain verification status</div>
                                </div>
                                <div class="table-row">
                                    <div>verified_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When domain was verified</div>
                                </div>
                                <div class="table-row">
                                    <div>spf_configured</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>SPF record detected</div>
                                </div>
                                <div class="table-row">
                                    <div>dkim_configured</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>DKIM keys configured (3 CNAME records)</div>
                                </div>
                                <div class="table-row">
                                    <div>dmarc_configured</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>DMARC policy configured</div>
                                </div>
                                <div class="table-row">
                                    <div>dkim_tokens</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Array of 3 DKIM tokens for CNAME records</div>
                                </div>
                                <div class="table-row">
                                    <div>is_default</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Default sender for campaigns</div>
                                </div>
                                <div class="table-row">
                                    <div>is_active</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Domain status (active/paused)</div>
                                </div>
                                <div class="table-row">
                                    <div>reputation_score</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 100</div>
                                    <div>Current reputation score (0-100)</div>
                                </div>
                                <div class="table-row">
                                    <div>warmup_status</div>
                                    <div>ENUM</div>
                                    <div>'not_started', 'in_progress', 'completed'</div>
                                    <div>Domain warmup phase</div>
                                </div>
                                <div class="table-row">
                                    <div>warmup_daily_limit</div>
                                    <div>INTEGER</div>
                                    <div>NULLABLE</div>
                                    <div>Current daily send limit during warmup</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Domain creation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>updated_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last update timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: dns_records -->
                        <div class="db-table">
                            <div class="table-header">TABLE: dns_records</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique record identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>sender_domain_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → sender_domains(id), INDEX</div>
                                    <div>Associated sender domain</div>
                                </div>
                                <div class="table-row">
                                    <div>record_type</div>
                                    <div>ENUM</div>
                                    <div>'TXT', 'CNAME', 'MX'</div>
                                    <div>DNS record type</div>
                                </div>
                                <div class="table-row">
                                    <div>purpose</div>
                                    <div>ENUM</div>
                                    <div>'verification', 'spf', 'dkim', 'dmarc'</div>
                                    <div>Record purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>record_name</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>DNS record name (e.g., _amazonses.company.com)</div>
                                </div>
                                <div class="table-row">
                                    <div>record_value</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>DNS record value</div>
                                </div>
                                <div class="table-row">
                                    <div>is_configured</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Record detected in DNS</div>
                                </div>
                                <div class="table-row">
                                    <div>last_checked_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>Last DNS lookup timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Record creation timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: bounce_logs -->
                        <div class="db-table">
                            <div class="table-header">TABLE: bounce_logs (Partitioned by month)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique bounce log identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>sender_domain_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → sender_domains(id), INDEX</div>
                                    <div>Associated sender domain</div>
                                </div>
                                <div class="table-row">
                                    <div>lead_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → leads(id), INDEX</div>
                                    <div>Recipient lead</div>
                                </div>
                                <div class="table-row">
                                    <div>email</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL, INDEX</div>
                                    <div>Bounced email address</div>
                                </div>
                                <div class="table-row">
                                    <div>bounce_type</div>
                                    <div>ENUM</div>
                                    <div>'hard', 'soft', 'transient'</div>
                                    <div>Type of bounce</div>
                                </div>
                                <div class="table-row">
                                    <div>bounce_subtype</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NULLABLE</div>
                                    <div>Detailed bounce reason (e.g., 'mailbox_full', 'invalid_recipient')</div>
                                </div>
                                <div class="table-row">
                                    <div>diagnostic_code</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>SMTP diagnostic message</div>
                                </div>
                                <div class="table-row">
                                    <div>message_id</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>SES message ID</div>
                                </div>
                                <div class="table-row">
                                    <div>sns_message</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Full SNS bounce notification</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW(), INDEX, PARTITION KEY</div>
                                    <div>Bounce timestamp (partition by month)</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: complaint_logs -->
                        <div class="db-table">
                            <div class="table-header">TABLE: complaint_logs (Partitioned by month)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique complaint log identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>sender_domain_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → sender_domains(id), INDEX</div>
                                    <div>Associated sender domain</div>
                                </div>
                                <div class="table-row">
                                    <div>lead_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → leads(id), INDEX</div>
                                    <div>Recipient lead who complained</div>
                                </div>
                                <div class="table-row">
                                    <div>email</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL, INDEX</div>
                                    <div>Email that complained</div>
                                </div>
                                <div class="table-row">
                                    <div>complaint_type</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NULLABLE</div>
                                    <div>Complaint type (spam, abuse, fraud, etc.)</div>
                                </div>
                                <div class="table-row">
                                    <div>feedback_type</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NULLABLE</div>
                                    <div>ISP feedback loop type</div>
                                </div>
                                <div class="table-row">
                                    <div>user_agent</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Email client user agent</div>
                                </div>
                                <div class="table-row">
                                    <div>message_id</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>SES message ID</div>
                                </div>
                                <div class="table-row">
                                    <div>sns_message</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Full SNS complaint notification</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW(), INDEX, PARTITION KEY</div>
                                    <div>Complaint timestamp (partition by month)</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: reputation_history -->
                        <div class="db-table">
                            <div class="table-header">TABLE: reputation_history</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique history record identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>sender_domain_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → sender_domains(id), INDEX</div>
                                    <div>Associated sender domain</div>
                                </div>
                                <div class="table-row">
                                    <div>date</div>
                                    <div>DATE</div>
                                    <div>NOT NULL, INDEX</div>
                                    <div>Metrics date</div>
                                </div>
                                <div class="table-row">
                                    <div>emails_sent</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Total emails sent this day</div>
                                </div>
                                <div class="table-row">
                                    <div>emails_delivered</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Successfully delivered</div>
                                </div>
                                <div class="table-row">
                                    <div>hard_bounces</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Hard bounce count</div>
                                </div>
                                <div class="table-row">
                                    <div>soft_bounces</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Soft bounce count</div>
                                </div>
                                <div class="table-row">
                                    <div>complaints</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Spam complaint count</div>
                                </div>
                                <div class="table-row">
                                    <div>bounce_rate</div>
                                    <div>DECIMAL(5,2)</div>
                                    <div>DEFAULT 0.00</div>
                                    <div>Bounce rate percentage</div>
                                </div>
                                <div class="table-row">
                                    <div>complaint_rate</div>
                                    <div>DECIMAL(5,2)</div>
                                    <div>DEFAULT 0.00</div>
                                    <div>Complaint rate percentage</div>
                                </div>
                                <div class="table-row">
                                    <div>reputation_score</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 100</div>
                                    <div>Daily reputation score snapshot</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Record creation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>-</div>
                                    <div>-</div>
                                    <div>UNIQUE (sender_domain_id, date)</div>
                                    <div>One record per domain per day</div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">🛡️ SWIM LANE 5: GDPR COMPLIANCE & DATA PROTECTION</div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Bounce & Complaint Handling</h3>
                                <div class="gdpr-section">
                                    <strong>Article 21 - Right to Object:</strong>
                                    <ul>
                                        <li>Spam complaints treated as immediate objection to processing</li>
                                        <li>Automatic suppression of email after complaint</li>
                                        <li>Lead marked as unsubscribed (consent_marketing = false)</li>
                                        <li>No further emails sent to complained addresses (permanent suppression)</li>
                                    </ul>
                                    <strong>Article 5(1)(c) - Data Minimization:</strong>
                                    <ul>
                                        <li>Hard bounces = invalid data, automatically marked email_valid = false</li>
                                        <li>Invalid emails not included in future campaigns (reduces unnecessary processing)</li>
                                        <li>Suppression list prevents sending to known-bad addresses</li>
                                        <li>Bounce/complaint logs partitioned by month, deleted after 12 months</li>
                                    </ul>
                                    <strong>Legitimate Interest Assessment:</strong>
                                    <ul>
                                        <li>Bounce handling necessary to maintain sender reputation</li>
                                        <li>Protects deliverability for all users (legitimate interest)</li>
                                        <li>Complaint handling required by anti-spam laws (CAN-SPAM, CASL)</li>
                                        <li>Suppression prevents unwanted contact (benefits data subjects)</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 21: Right to Object<br>
                                    &nbsp;&nbsp; Section: Email Bounce & Complaint Processing
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Data Retention for Logs</h3>
                                <div class="gdpr-section">
                                    <strong>Article 5(1)(e) - Storage Limitation:</strong>
                                    <ul>
                                        <li><strong>Bounce Logs:</strong> Retained 12 months (compliance audit + pattern analysis)</li>
                                        <li><strong>Complaint Logs:</strong> Retained 12 months (legal compliance + anti-spam)</li>
                                        <li><strong>Reputation History:</strong> Retained 24 months (trend analysis, anonymized)</li>
                                        <li><strong>DNS Records:</strong> Retained while domain is active</li>
                                        <li><strong>Suppression List:</strong> Retained indefinitely (prevent unwanted contact)</li>
                                    </ul>
                                    <strong>Automated Deletion (Lambda Function):</strong>
                                    <ul>
                                        <li>Monthly job: Delete bounce/complaint logs older than 12 months</li>
                                        <li>Quarterly job: Anonymize reputation_history older than 24 months</li>
                                        <li>Suppression list: Never deleted (permanent opt-out honored)</li>
                                        <li>CloudWatch alarm if deletion job fails</li>
                                    </ul>
                                    <strong>Legal Basis for Retention:</strong>
                                    <ul>
                                        <li>Anti-spam compliance (CAN-SPAM requires suppression list)</li>
                                        <li>AWS SES reputation management (avoid account suspension)</li>
                                        <li>Fraud prevention (identify malicious email patterns)</li>
                                        <li>Documented in privacy policy with clear retention periods</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 5(1)(e): Storage Limitation<br>
                                    &nbsp;&nbsp; Section: Email Event Log Retention
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Third-Party Processing (AWS SES)</h3>
                                <div class="gdpr-section">
                                    <strong>Article 28 - Processor Agreement:</strong>
                                    <ul>
                                        <li>AWS SES: Data Processing Addendum (DPA) signed</li>
                                        <li>AWS is GDPR-compliant processor for email sending</li>
                                        <li>AWS SES data centers: EU (eu-west-1), US (us-east-1)</li>
                                        <li>Option to restrict sending to EU-only regions</li>
                                        <li>AWS does not use customer email data for own purposes</li>
                                    </ul>
                                    <strong>Article 32 - Security of Processing:</strong>
                                    <ul>
                                        <li>DKIM private keys stored in AWS Secrets Manager (KMS encrypted)</li>
                                        <li>Email content encrypted in transit (TLS 1.3)</li>
                                        <li>SES configuration sets track events without storing content</li>
                                        <li>Bounce/complaint SNS notifications signed with HMAC-SHA256</li>
                                        <li>Access control: Only authorized ECS tasks can call SES APIs</li>
                                    </ul>
                                    <strong>Data Transfers:</strong>
                                    <ul>
                                        <li>Standard Contractual Clauses (SCCs) with AWS for non-EU regions</li>
                                        <li>Transfer Impact Assessment (TIA) documented for US regions</li>
                                        <li>Email recipients in any jurisdiction (disclosed in privacy policy)</li>
                                        <li>No email content stored by AWS SES (ephemeral processing)</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Chapter 8: Third-Party Data Processors<br>
                                    &nbsp;&nbsp; Section: AWS SES Email Delivery
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Transparency & User Rights</h3>
                                <div class="gdpr-section">
                                    <strong>Article 13 - Information to be Provided:</strong>
                                    <ul>
                                        <li>Privacy policy explains email authentication (SPF/DKIM/DMARC)</li>
                                        <li>Disclosure of AWS SES as email processor</li>
                                        <li>Bounce/complaint handling explained (automatic suppression)</li>
                                        <li>Retention periods disclosed (logs 12 months, suppression indefinite)</li>
                                    </ul>
                                    <strong>Article 15 - Right of Access:</strong>
                                    <ul>
                                        <li>Self-service dashboard: View bounce/complaint history</li>
                                        <li>API endpoint: GET /api/my-email-status (authenticated)</li>
                                        <li>Shows suppression status, bounce count, complaint flag</li>
                                        <li>Export includes all email event logs (bounces, complaints)</li>
                                    </ul>
                                    <strong>Article 17 - Right to Erasure:</strong>
                                    <ul>
                                        <li>Deletion request removes email from bounce/complaint logs</li>
                                        <li>Email replaced with [DELETED] placeholder (preserve metrics)</li>
                                        <li>Suppression list entry retained (prevents accidental re-contact)</li>
                                        <li>Anonymized logs kept for aggregate analytics only</li>
                                    </ul>
                                    <strong>Article 20 - Right to Data Portability:</strong>
                                    <ul>
                                        <li>Export includes: bounce logs, complaint logs, suppression status</li>
                                        <li>JSON/CSV format with all email event metadata</li>
                                        <li>Domain verification status and authentication config excluded (tenant-level)</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Chapter 2: Transparency Requirements<br>
                                    &nbsp;&nbsp; Chapter 3: Data Subject Rights<br>
                                    &nbsp;&nbsp; Section: Email Deliverability & Reputation
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 10 -->

            <!-- FRAME 11: SALES & LEAD GENERATION BUILDER - SMART CONSENT & COMPLIANCE -->
            <div class="frame" id="frame11">
                <div class="frame-title">FRAME 11: SALES & LEAD GENERATION BUILDER - SMART CONSENT & COMPLIANCE</div>
                <div class="frame-subtitle">Double Opt-In | Preference Centers | Unsubscribe Management | Consent Tracking | Privacy Compliance</div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <span class="legend-color" style="background: #E8F5E9;"></span>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #E3F2FD;"></span>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #FFF3E0;"></span>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #F3E5F5;"></span>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #E0F2F1;"></span>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">👤 SWIM LANE 1: USER ACTIONS</div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Configure Consent Collection</h3>
                                <ul>
                                    <li><strong>Double Opt-In:</strong> Require email confirmation for new subscribers</li>
                                    <li><strong>Consent Checkboxes:</strong> Separate opt-ins for marketing, sales, newsletter</li>
                                    <li><strong>Granular Consent:</strong> Allow subscribers to choose topic preferences (product updates, promotions, events)</li>
                                    <li><strong>Pre-checked Disabled:</strong> All consent checkboxes unchecked by default (GDPR-compliant)</li>
                                    <li><strong>Clear Language:</strong> Plain-language consent text (e.g., "I agree to receive marketing emails")</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Design Preference Center</h3>
                                <ul>
                                    <li><strong>Custom Branding:</strong> Logo, colors, company name for preference center page</li>
                                    <li><strong>Communication Preferences:</strong> Toggle email, SMS, WhatsApp channels on/off</li>
                                    <li><strong>Topic Subscriptions:</strong> Subscribe/unsubscribe from specific email topics</li>
                                    <li><strong>Frequency Control:</strong> Choose email frequency (daily, weekly, monthly, digest)</li>
                                    <li><strong>Profile Update:</strong> Allow subscribers to update name, email, preferences</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Set Up Unsubscribe Flow</h3>
                                <ul>
                                    <li><strong>One-Click Unsubscribe:</strong> RFC 8058 List-Unsubscribe header in emails</li>
                                    <li><strong>Unsubscribe Page:</strong> Custom branded confirmation page</li>
                                    <li><strong>Exit Survey:</strong> Optional feedback form (Why are you unsubscribing?)</li>
                                    <li><strong>Partial Unsubscribe:</strong> Option to reduce frequency instead of full unsubscribe</li>
                                    <li><strong>Re-subscribe Option:</strong> Link to re-subscribe if unsubscribed by mistake</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Monitor Compliance</h3>
                                <ul>
                                    <li><strong>Consent Audit Log:</strong> View all consent changes with timestamps and IP addresses</li>
                                    <li><strong>Opt-In Rate:</strong> Track percentage of leads who confirm double opt-in</li>
                                    <li><strong>Unsubscribe Rate:</strong> Monitor unsubscribe rate by campaign (target <1%)</li>
                                    <li><strong>Compliance Dashboard:</strong> GDPR/CAN-SPAM/CASL compliance status</li>
                                    <li><strong>Export Consent Records:</strong> Generate compliance reports for audits</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">⚙️ SWIM LANE 2: BACKEND SERVICES (NestJS + TypeScript)</div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">

                            <div class="service-card">
                                <h3><span class="service-icon">✅</span> Consent Management Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/consent/grant - Record consent grant (opt-in)<br>
                                        • <strong>POST</strong> /api/consent/revoke - Record consent revocation (opt-out)<br>
                                        • <strong>GET</strong> /api/consent/:leadId - Get consent status for lead<br>
                                        • <strong>GET</strong> /api/consent/audit-log/:leadId - Get consent change history<br>
                                        • <strong>POST</strong> /api/consent/verify-token - Verify double opt-in token
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Consent Logic:</div>
                                    <div class="section-content">
                                        • <strong>Double Opt-In:</strong> Generate unique token, send confirmation email, expire after 72 hours<br>
                                        • <strong>Consent Metadata:</strong> Capture IP, user agent, timestamp, checkbox text, form URL<br>
                                        • <strong>Granular Consent:</strong> Track consent per channel (email, sms, whatsapp) and topic<br>
                                        • <strong>Consent Versioning:</strong> Track consent under specific privacy policy version<br>
                                        • <strong>Withdrawal:</strong> Immediate consent revocation, stop all campaigns instantly
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">⚙️</span> Preference Center Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>GET</strong> /api/preferences/:token - Load preference center (authenticated by token)<br>
                                        • <strong>PUT</strong> /api/preferences/update - Update communication preferences<br>
                                        • <strong>POST</strong> /api/preferences/generate-link - Generate magic link for preference center<br>
                                        • <strong>GET</strong> /api/preferences/topics - Get available subscription topics
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Preference Features:</div>
                                    <div class="section-content">
                                        • <strong>Magic Link:</strong> Tokenized URL (no login required, expires 30 days)<br>
                                        • <strong>Channel Toggle:</strong> Enable/disable email, SMS, WhatsApp independently<br>
                                        • <strong>Topic Subscriptions:</strong> Subscribe to specific topics (newsletters, promotions, events)<br>
                                        • <strong>Frequency Control:</strong> Choose digest frequency (immediate, daily, weekly)<br>
                                        • <strong>Profile Update:</strong> Update name, email, phone (with re-verification)
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🚫</span> Unsubscribe Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/unsubscribe/:token - Unsubscribe via email link<br>
                                        • <strong>POST</strong> /api/unsubscribe/list-unsubscribe - RFC 8058 List-Unsubscribe handler<br>
                                        • <strong>POST</strong> /api/unsubscribe/feedback - Submit unsubscribe reason<br>
                                        • <strong>POST</strong> /api/resubscribe/:token - Re-subscribe if unsubscribed by mistake<br>
                                        • <strong>GET</strong> /api/unsubscribe/status/:leadId - Check unsubscribe status
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Unsubscribe Logic:</div>
                                    <div class="section-content">
                                        • <strong>One-Click:</strong> List-Unsubscribe header (mailto + HTTPS URL)<br>
                                        • <strong>Instant Processing:</strong> Unsubscribe effective immediately (no delay)<br>
                                        • <strong>Global Unsubscribe:</strong> Option to unsubscribe from all emails vs specific topics<br>
                                        • <strong>Feedback Collection:</strong> Optional exit survey (frequency, content, relevance)<br>
                                        • <strong>Suppression Sync:</strong> Add to suppression list, mark consent_marketing = false
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📋</span> Compliance Reporting Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>GET</strong> /api/compliance/report - Generate compliance report<br>
                                        • <strong>GET</strong> /api/compliance/consent-stats - Opt-in/opt-out statistics<br>
                                        • <strong>GET</strong> /api/compliance/audit-export - Export consent audit log (CSV/JSON)<br>
                                        • <strong>POST</strong> /api/compliance/validate - Validate compliance status
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Compliance Metrics:</div>
                                    <div class="section-content">
                                        • <strong>Opt-In Rate:</strong> (confirmed / sent confirmation emails) × 100<br>
                                        • <strong>Unsubscribe Rate:</strong> (unsubscribes / emails sent) × 100 (target <1%)<br>
                                        • <strong>Consent Coverage:</strong> % of leads with explicit consent records<br>
                                        • <strong>GDPR Compliance Score:</strong> Automated checks (consent metadata, retention, DPAs)<br>
                                        • <strong>Audit Readiness:</strong> Exportable consent records with full metadata
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🔐</span> Privacy Policy Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/privacy-policy/create-version - Create new policy version<br>
                                        • <strong>GET</strong> /api/privacy-policy/current - Get current active policy<br>
                                        • <strong>GET</strong> /api/privacy-policy/history - List all policy versions<br>
                                        • <strong>POST</strong> /api/privacy-policy/notify-changes - Send policy update notifications
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Policy Features:</div>
                                    <div class="section-content">
                                        • <strong>Version Control:</strong> Track policy changes with version numbers (1.0, 1.1, 2.0)<br>
                                        • <strong>Consent Linking:</strong> Link consent records to specific policy version<br>
                                        • <strong>Change Notifications:</strong> Notify subscribers of material policy changes<br>
                                        • <strong>Re-consent Required:</strong> Optionally require re-consent for major policy changes<br>
                                        • <strong>Public Archive:</strong> All policy versions publicly accessible
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📊</span> Consent Analytics Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>GET</strong> /api/analytics/consent-funnel - Consent funnel metrics<br>
                                        • <strong>GET</strong> /api/analytics/unsubscribe-reasons - Top unsubscribe reasons<br>
                                        • <strong>GET</strong> /api/analytics/preference-trends - Preference center usage trends<br>
                                        • <strong>GET</strong> /api/analytics/consent-by-source - Consent rates by lead source
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Analytics Metrics:</div>
                                    <div class="section-content">
                                        • <strong>Consent Funnel:</strong> Form submit → Confirmation sent → Confirmed (double opt-in)<br>
                                        • <strong>Unsubscribe Reasons:</strong> Too frequent (40%), not relevant (30%), never subscribed (20%)<br>
                                        • <strong>Preference Center Usage:</strong> Visits, updates, partial unsubscribes<br>
                                        • <strong>Consent by Source:</strong> Compare opt-in rates across lead sources<br>
                                        • <strong>Re-engagement:</strong> Track re-subscribe rate after unsubscribe
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">☁️ SWIM LANE 3: AWS INFRASTRUCTURE</div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate - Consent Services
                                </h4>
                                <div class="section-content">
                                    <strong>Task Definition:</strong> consent-service, preference-center-service, unsubscribe-service<br>
                                    <strong>CPU/Memory:</strong> 0.5 vCPU, 1GB RAM per task<br>
                                    <strong>Auto Scaling:</strong> 2-8 tasks based on request count<br>
                                    <strong>Scaling Metric:</strong> RequestCountPerTarget >500<br>
                                    <strong>Health Check:</strong> /health endpoint every 30s<br>
                                    <strong>Deployment:</strong> Rolling update, 50% minimum healthy
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL 15.4 - Consent Data
                                </h4>
                                <div class="section-content">
                                    <strong>Instance:</strong> db.r6g.large (Multi-AZ for HA)<br>
                                    <strong>Storage:</strong> 200GB GP3 SSD (auto-scaling to 500GB)<br>
                                    <strong>Tables:</strong> consent_records, consent_audit_log, preference_topics, unsubscribe_feedback, privacy_policies<br>
                                    <strong>Indexes:</strong> lead_id, consent_type, created_at, policy_version<br>
                                    <strong>Partitioning:</strong> consent_audit_log partitioned by quarter<br>
                                    <strong>Backup:</strong> Automated daily snapshots, 7-day retention
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis - Consent Cache
                                </h4>
                                <div class="section-content">
                                    <strong>Node Type:</strong> cache.r6g.large (Cluster Mode enabled)<br>
                                    <strong>Use Cases:</strong><br>
                                    • Consent status cache (TTL 5 min, invalidate on update)<br>
                                    • Double opt-in tokens (TTL 72 hours)<br>
                                    • Preference center magic links (TTL 30 days)<br>
                                    • Unsubscribe tokens (TTL 90 days)<br>
                                    • Privacy policy current version (TTL 1 hour)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Queue-Service.svg" alt="SQS" class="aws-icon">
                                    SQS - Consent Processing Queues
                                </h4>
                                <div class="section-content">
                                    <strong>consent-confirmation-queue:</strong> Double opt-in confirmation emails (retention 14 days)<br>
                                    <strong>unsubscribe-processing-queue:</strong> Process unsubscribe requests<br>
                                    <strong>preference-update-queue:</strong> Sync preference changes to campaigns<br>
                                    <strong>Visibility Timeout:</strong> 1 minute<br>
                                    <strong>Dead Letter Queue:</strong> 3 retries before DLQ<br>
                                    <strong>Throughput:</strong> ~200 messages/second peak
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Compute/Lambda.svg" alt="Lambda" class="aws-icon">
                                    Lambda Functions
                                </h4>
                                <div class="section-content">
                                    <strong>consent-confirmation-sender:</strong> Send double opt-in emails (timeout 30s, 512MB RAM)<br>
                                    <strong>unsubscribe-processor:</strong> Process unsubscribe requests (timeout 30s, 512MB RAM)<br>
                                    <strong>consent-audit-logger:</strong> Log all consent changes (timeout 15s, 256MB RAM)<br>
                                    <strong>preference-sync-worker:</strong> Sync preference changes to campaigns (1GB RAM)<br>
                                    <strong>compliance-report-generator:</strong> Generate compliance reports (5min timeout, 2GB RAM)<br>
                                    <strong>Runtime:</strong> Node.js 20.x, bundled with esbuild
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Storage/Simple-Storage-Service.svg" alt="S3" class="aws-icon">
                                    S3 - Compliance Documents
                                </h4>
                                <div class="section-content">
                                    <strong>Bucket:</strong> unifiedbeez-compliance-docs<br>
                                    <strong>Storage:</strong><br>
                                    • Privacy policy versions (HTML + PDF)<br>
                                    • Terms of service versions<br>
                                    • Consent audit exports (CSV + JSON)<br>
                                    • Compliance reports (monthly/quarterly/annual)<br>
                                    <strong>Versioning:</strong> Enabled (track all document changes)<br>
                                    <strong>Lifecycle:</strong> Transition to Glacier after 2 years, retain 7 years
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Networking-Content-Delivery/CloudFront.svg" alt="CloudFront" class="aws-icon">
                                    CloudFront - Preference Center CDN
                                </h4>
                                <div class="section-content">
                                    <strong>Distribution:</strong> Global edge locations (200+ POPs)<br>
                                    <strong>Origin:</strong> S3 bucket (static assets) + ECS Fargate (dynamic API)<br>
                                    <strong>Caching:</strong> Static assets 1 year, API responses no-cache<br>
                                    <strong>SSL/TLS:</strong> TLS 1.3, custom domain (preferences.unifiedbeez.com)<br>
                                    <strong>Performance:</strong> <100ms response time globally<br>
                                    <strong>Security:</strong> AWS WAF integration, DDoS protection
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/EventBridge.svg" alt="EventBridge" class="aws-icon">
                                    EventBridge - Scheduled Jobs
                                </h4>
                                <div class="section-content">
                                    <strong>daily-consent-metrics:</strong> cron(0 8 * * ? *) - Calculate daily consent stats<br>
                                    <strong>weekly-compliance-report:</strong> cron(0 9 ? * MON *) - Generate weekly report<br>
                                    <strong>monthly-audit-export:</strong> cron(0 2 1 * ? *) - Export consent audit logs<br>
                                    <strong>token-cleanup:</strong> cron(0 3 * * ? *) - Delete expired double opt-in tokens<br>
                                    <strong>Target:</strong> Lambda functions<br>
                                    <strong>Retry Policy:</strong> 3 retries with exponential backoff
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Management-Governance/CloudWatch.svg" alt="CloudWatch" class="aws-icon">
                                    CloudWatch - Monitoring
                                </h4>
                                <div class="section-content">
                                    <strong>Metrics:</strong> Opt-in rate, unsubscribe rate, preference center visits, consent changes/day<br>
                                    <strong>Alarms:</strong> Unsubscribe rate >1%, opt-in rate <30%, API errors >5%<br>
                                    <strong>Logs:</strong> Consent grants/revocations, preference updates, unsubscribe requests<br>
                                    <strong>Dashboards:</strong> Consent funnel, compliance health, preference trends<br>
                                    <strong>Retention:</strong> 90 days log retention<br>
                                    <strong>Audit Trail:</strong> All consent changes logged for 7 years (regulatory requirement)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Secrets-Manager.svg" alt="Secrets Manager" class="aws-icon">
                                    Secrets Manager - API Keys
                                </h4>
                                <div class="section-content">
                                    <strong>Secrets Stored:</strong><br>
                                    • unifiedbeez/consent/jwt-signing-key (magic link tokens)<br>
                                    • unifiedbeez/consent/encryption-key (PII encryption)<br>
                                    <strong>Encryption:</strong> KMS key (unifiedbeez-secrets-key)<br>
                                    <strong>Rotation:</strong> JWT keys rotated every 90 days<br>
                                    <strong>Access Control:</strong> IAM role-based (ECS tasks + Lambda only)
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">🗄️ SWIM LANE 4: DATABASE SCHEMA & RELATIONSHIPS</div>
                    <div class="lane-content lane-data">

                        <!-- TABLE: consent_records -->
                        <div class="db-table">
                            <div class="table-header">TABLE: consent_records</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique consent record identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>lead_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → leads(id), INDEX</div>
                                    <div>Associated lead</div>
                                </div>
                                <div class="table-row">
                                    <div>consent_type</div>
                                    <div>ENUM</div>
                                    <div>'marketing', 'sales', 'newsletter', 'sms', 'whatsapp'</div>
                                    <div>Type of consent</div>
                                </div>
                                <div class="table-row">
                                    <div>consent_status</div>
                                    <div>ENUM</div>
                                    <div>'pending', 'granted', 'revoked'</div>
                                    <div>Current consent status</div>
                                </div>
                                <div class="table-row">
                                    <div>double_opt_in_required</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Whether double opt-in is required</div>
                                </div>
                                <div class="table-row">
                                    <div>double_opt_in_confirmed_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When confirmation email was clicked</div>
                                </div>
                                <div class="table-row">
                                    <div>consent_method</div>
                                    <div>ENUM</div>
                                    <div>'form_checkbox', 'api', 'import', 'admin'</div>
                                    <div>How consent was obtained</div>
                                </div>
                                <div class="table-row">
                                    <div>consent_text</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>Exact text of consent checkbox/agreement</div>
                                </div>
                                <div class="table-row">
                                    <div>privacy_policy_version</div>
                                    <div>VARCHAR(20)</div>
                                    <div>NOT NULL</div>
                                    <div>Privacy policy version at time of consent</div>
                                </div>
                                <div class="table-row">
                                    <div>form_url</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>URL of form where consent was given</div>
                                </div>
                                <div class="table-row">
                                    <div>ip_address</div>
                                    <div>INET</div>
                                    <div>NULLABLE</div>
                                    <div>IP address when consent was granted</div>
                                </div>
                                <div class="table-row">
                                    <div>user_agent</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Browser user agent</div>
                                </div>
                                <div class="table-row">
                                    <div>geolocation</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Country, region, city from IP lookup</div>
                                </div>
                                <div class="table-row">
                                    <div>granted_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When consent was granted</div>
                                </div>
                                <div class="table-row">
                                    <div>revoked_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When consent was revoked (unsubscribed)</div>
                                </div>
                                <div class="table-row">
                                    <div>revocation_reason</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Reason for unsubscribe (from exit survey)</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW(), INDEX</div>
                                    <div>Record creation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>updated_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last update timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>-</div>
                                    <div>-</div>
                                    <div>UNIQUE (lead_id, consent_type)</div>
                                    <div>One consent record per lead per type</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: consent_audit_log -->
                        <div class="db-table">
                            <div class="table-header">TABLE: consent_audit_log (Partitioned by quarter)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique audit log identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>consent_record_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → consent_records(id), INDEX</div>
                                    <div>Associated consent record</div>
                                </div>
                                <div class="table-row">
                                    <div>lead_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → leads(id), INDEX</div>
                                    <div>Associated lead</div>
                                </div>
                                <div class="table-row">
                                    <div>action</div>
                                    <div>ENUM</div>
                                    <div>'granted', 'confirmed', 'revoked', 'updated'</div>
                                    <div>Action performed</div>
                                </div>
                                <div class="table-row">
                                    <div>previous_status</div>
                                    <div>ENUM</div>
                                    <div>'pending', 'granted', 'revoked', NULL</div>
                                    <div>Status before change</div>
                                </div>
                                <div class="table-row">
                                    <div>new_status</div>
                                    <div>ENUM</div>
                                    <div>'pending', 'granted', 'revoked'</div>
                                    <div>Status after change</div>
                                </div>
                                <div class="table-row">
                                    <div>changed_by</div>
                                    <div>ENUM</div>
                                    <div>'user', 'system', 'admin'</div>
                                    <div>Who initiated the change</div>
                                </div>
                                <div class="table-row">
                                    <div>ip_address</div>
                                    <div>INET</div>
                                    <div>NULLABLE</div>
                                    <div>IP address of change</div>
                                </div>
                                <div class="table-row">
                                    <div>user_agent</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Browser user agent</div>
                                </div>
                                <div class="table-row">
                                    <div>metadata</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Additional context (form URL, campaign ID, etc.)</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW(), INDEX, PARTITION KEY</div>
                                    <div>Audit log timestamp (partition by quarter)</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: preference_topics -->
                        <div class="db-table">
                            <div class="table-header">TABLE: preference_topics</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique topic identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>tenant_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → tenants(id), INDEX</div>
                                    <div>Multi-tenancy isolation</div>
                                </div>
                                <div class="table-row">
                                    <div>topic_name</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Topic name (e.g., "Product Updates", "Weekly Newsletter", "Promotions")</div>
                                </div>
                                <div class="table-row">
                                    <div>topic_description</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Description shown in preference center</div>
                                </div>
                                <div class="table-row">
                                    <div>is_default_subscribed</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Auto-subscribe new leads to this topic</div>
                                </div>
                                <div class="table-row">
                                    <div>display_order</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Display order in preference center</div>
                                </div>
                                <div class="table-row">
                                    <div>is_active</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Topic status</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Topic creation timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: lead_topic_subscriptions -->
                        <div class="db-table">
                            <div class="table-header">TABLE: lead_topic_subscriptions (Many-to-Many)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique subscription identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>lead_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → leads(id), INDEX</div>
                                    <div>Associated lead</div>
                                </div>
                                <div class="table-row">
                                    <div>topic_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → preference_topics(id), INDEX</div>
                                    <div>Associated topic</div>
                                </div>
                                <div class="table-row">
                                    <div>is_subscribed</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Subscription status</div>
                                </div>
                                <div class="table-row">
                                    <div>subscribed_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When subscribed to topic</div>
                                </div>
                                <div class="table-row">
                                    <div>unsubscribed_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When unsubscribed from topic</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Record creation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>-</div>
                                    <div>-</div>
                                    <div>UNIQUE (lead_id, topic_id)</div>
                                    <div>One subscription per lead per topic</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: unsubscribe_feedback -->
                        <div class="db-table">
                            <div class="table-header">TABLE: unsubscribe_feedback</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique feedback identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>lead_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → leads(id), INDEX</div>
                                    <div>Lead who unsubscribed</div>
                                </div>
                                <div class="table-row">
                                    <div>reason</div>
                                    <div>ENUM</div>
                                    <div>'too_frequent', 'not_relevant', 'never_subscribed', 'privacy_concern', 'other'</div>
                                    <div>Primary unsubscribe reason</div>
                                </div>
                                <div class="table-row">
                                    <div>additional_feedback</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Free-form feedback text</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW(), INDEX</div>
                                    <div>Feedback submission timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: privacy_policies -->
                        <div class="db-table">
                            <div class="table-header">TABLE: privacy_policies</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique policy identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>tenant_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → tenants(id), INDEX</div>
                                    <div>Multi-tenancy isolation</div>
                                </div>
                                <div class="table-row">
                                    <div>version</div>
                                    <div>VARCHAR(20)</div>
                                    <div>NOT NULL, UNIQUE</div>
                                    <div>Policy version (e.g., "1.0", "2.0", "2.1")</div>
                                </div>
                                <div class="table-row">
                                    <div>policy_html</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>Full HTML content of privacy policy</div>
                                </div>
                                <div class="table-row">
                                    <div>policy_pdf_url</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>S3 URL to PDF version</div>
                                </div>
                                <div class="table-row">
                                    <div>effective_date</div>
                                    <div>DATE</div>
                                    <div>NOT NULL</div>
                                    <div>When this version becomes effective</div>
                                </div>
                                <div class="table-row">
                                    <div>is_current</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Current active policy version</div>
                                </div>
                                <div class="table-row">
                                    <div>change_summary</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Summary of changes from previous version</div>
                                </div>
                                <div class="table-row">
                                    <div>requires_reconsent</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Whether material changes require re-consent</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Policy version creation timestamp</div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">🛡️ SWIM LANE 5: GDPR COMPLIANCE & DATA PROTECTION</div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Consent Requirements (GDPR Gold Standard)</h3>
                                <div class="gdpr-section">
                                    <strong>Article 7 - Conditions for Consent:</strong>
                                    <ul>
                                        <li><strong>Freely Given:</strong> No pre-checked boxes, opt-in is optional (not required for service)</li>
                                        <li><strong>Specific:</strong> Separate consent for marketing, sales, newsletter (granular control)</li>
                                        <li><strong>Informed:</strong> Clear consent text explains what user is agreeing to</li>
                                        <li><strong>Unambiguous:</strong> Affirmative action required (checkbox, button click)</li>
                                        <li><strong>Withdrawal:</strong> Easy to withdraw as it was to give (one-click unsubscribe)</li>
                                    </ul>
                                    <strong>Article 4(11) - Consent Definition:</strong>
                                    <ul>
                                        <li>Double opt-in ensures affirmative action (click confirmation link)</li>
                                        <li>Consent metadata captured (IP, timestamp, user agent, form URL, checkbox text)</li>
                                        <li>Privacy policy version linked to consent (track changes over time)</li>
                                        <li>Audit log records all consent changes (immutable compliance trail)</li>
                                    </ul>
                                    <strong>Recital 32 - Consent Documentation:</strong>
                                    <ul>
                                        <li>Consent records retained for 7 years (regulatory requirement)</li>
                                        <li>Full audit trail: when, where, how, what consent was given</li>
                                        <li>Exportable consent records for audits/investigations</li>
                                        <li>Consent versioning tracks policy changes requiring re-consent</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 7: Conditions for Consent<br>
                                    &nbsp;&nbsp; Section: Consent Management Best Practices
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Right to Withdraw Consent</h3>
                                <div class="gdpr-section">
                                    <strong>Article 7(3) - Easy Withdrawal:</strong>
                                    <ul>
                                        <li>One-click unsubscribe (RFC 8058 List-Unsubscribe header)</li>
                                        <li>No login required (magic link from email)</li>
                                        <li>Immediate processing (effective instantly, no delay)</li>
                                        <li>Confirmation page + email (proof of unsubscribe)</li>
                                        <li>Withdrawal as easy as granting consent (symmetry principle)</li>
                                    </ul>
                                    <strong>Preference Center:</strong>
                                    <ul>
                                        <li>Granular control: withdraw consent for specific topics/channels</li>
                                        <li>Partial withdrawal: reduce frequency instead of full unsubscribe</li>
                                        <li>Re-subscribe option: allows accidental unsubscribes to be reversed</li>
                                        <li>Preference center accessible via magic link (no password required)</li>
                                    </ul>
                                    <strong>Processing After Withdrawal:</strong>
                                    <ul>
                                        <li>All active campaigns stopped immediately</li>
                                        <li>Lead added to suppression list (prevent accidental contact)</li>
                                        <li>CRM synced with updated consent status (if integrated)</li>
                                        <li>Withdrawal logged to audit trail (compliance proof)</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 7(3): Withdrawal of Consent<br>
                                    &nbsp;&nbsp; Section: Unsubscribe & Preference Management
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Transparency & Information</h3>
                                <div class="gdpr-section">
                                    <strong>Article 13 - Information to be Provided:</strong>
                                    <ul>
                                        <li><strong>Identity:</strong> Company name, contact details in every email</li>
                                        <li><strong>Purpose:</strong> Why consent is being requested (marketing, sales, newsletter)</li>
                                        <li><strong>Legal Basis:</strong> Consent (Article 6(1)(a)) disclosed</li>
                                        <li><strong>Recipients:</strong> Email service providers (AWS SES) disclosed</li>
                                        <li><strong>Retention:</strong> How long data is kept (until consent withdrawn)</li>
                                        <li><strong>Rights:</strong> Right to withdraw, access, erasure explained</li>
                                        <li><strong>Privacy Policy:</strong> Link to full privacy policy in every email footer</li>
                                    </ul>
                                    <strong>Article 12 - Transparent Communication:</strong>
                                    <ul>
                                        <li>Plain language consent text (no legalese)</li>
                                        <li>Concise, clear, easily accessible information</li>
                                        <li>Preference center shows all consent records with dates</li>
                                        <li>Unsubscribe confirmation page explains what happens next</li>
                                    </ul>
                                    <strong>Privacy Policy Versioning:</strong>
                                    <ul>
                                        <li>All policy versions publicly accessible (transparency)</li>
                                        <li>Change summary highlights material changes</li>
                                        <li>Email notification sent for material policy changes</li>
                                        <li>Re-consent required for major changes (opt-in again)</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 13: Information to be Provided<br>
                                    &nbsp;&nbsp; Chapter 2: Transparency Requirements
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Accountability & Compliance Proof</h3>
                                <div class="gdpr-section">
                                    <strong>Article 5(2) - Accountability Principle:</strong>
                                    <ul>
                                        <li>Consent audit log (immutable record of all consent changes)</li>
                                        <li>7-year retention for compliance audits (regulatory requirement)</li>
                                        <li>Exportable consent records (CSV/JSON for audits)</li>
                                        <li>Compliance dashboard (real-time GDPR health check)</li>
                                        <li>Weekly/monthly compliance reports (automated generation)</li>
                                    </ul>
                                    <strong>Article 30 - Records of Processing:</strong>
                                    <ul>
                                        <li>Purpose of processing documented (marketing, sales communication)</li>
                                        <li>Categories of data subjects (leads, customers)</li>
                                        <li>Categories of personal data (name, email, consent records)</li>
                                        <li>Recipients disclosed (AWS SES, Twilio for SMS)</li>
                                        <li>Retention periods documented (consent: 7 years, logs: 90 days)</li>
                                        <li>Security measures documented (encryption, access control)</li>
                                    </ul>
                                    <strong>Compliance Metrics:</strong>
                                    <ul>
                                        <li><strong>Consent Coverage:</strong> % of leads with explicit consent (target 100%)</li>
                                        <li><strong>Opt-In Rate:</strong> Double opt-in confirmation rate (benchmark 30-50%)</li>
                                        <li><strong>Unsubscribe Rate:</strong> % of emails resulting in unsubscribe (target <1%)</li>
                                        <li><strong>Audit Readiness:</strong> All consent metadata captured and exportable</li>
                                    </ul>
                                    <strong>Data Protection Impact Assessment (DPIA):</strong>
                                    <ul>
                                        <li>Consent management DPIA completed (low risk assessment)</li>
                                        <li>Double opt-in reduces risk of unwanted contact</li>
                                        <li>Preference center empowers data subjects (privacy by design)</li>
                                        <li>Audit trail ensures accountability and transparency</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 5(2): Accountability<br>
                                    &nbsp;&nbsp; Article 30: Records of Processing Activities<br>
                                    &nbsp;&nbsp; Chapter 9: Compliance Audits & Reporting
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 11 -->

            <!-- FRAME 12: SUPPORT & ESCALATION BUILDER - FAQ MANAGEMENT & MULTI-CHANNEL -->
            <div class="frame" id="frame12">
                <div class="frame-title">FRAME 12: SUPPORT & ESCALATION BUILDER - FAQ MANAGEMENT & MULTI-CHANNEL</div>
                <div class="frame-subtitle">Knowledge Base | Smart FAQ Suggestions | Multi-Channel Support Selection | Auto-Responses | BeeBot Integration</div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <span class="legend-color" style="background: #E8F5E9;"></span>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #E3F2FD;"></span>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #FFF3E0;"></span>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #F3E5F5;"></span>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #E0F2F1;"></span>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">👤 SWIM LANE 1: USER ACTIONS</div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Build Knowledge Base</h3>
                                <ul>
                                    <li><strong>Create FAQ Categories:</strong> Product, Billing, Account, Technical Support, Shipping</li>
                                    <li><strong>Add FAQ Articles:</strong> Rich text editor with images, videos, code snippets</li>
                                    <li><strong>Keyword Tagging:</strong> Add keywords for semantic search (synonyms, variations)</li>
                                    <li><strong>Multi-Language Support:</strong> Translate FAQs to multiple languages (auto-translate + manual review)</li>
                                    <li><strong>Version Control:</strong> Track article changes, rollback to previous versions</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Configure Smart FAQ Suggestions</h3>
                                <ul>
                                    <li><strong>Intent Detection:</strong> Analyze customer query to suggest relevant FAQs</li>
                                    <li><strong>Contextual Suggestions:</strong> Show FAQs based on current page/product viewed</li>
                                    <li><strong>Search Bar Integration:</strong> Real-time FAQ search with autocomplete</li>
                                    <li><strong>Feedback Loop:</strong> "Was this helpful?" voting to improve suggestions</li>
                                    <li><strong>Related Articles:</strong> Show related FAQs at end of article</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Set Up Multi-Channel Support</h3>
                                <ul>
                                    <li><strong>Email Support:</strong> Support@company.com inbox integration</li>
                                    <li><strong>Live Chat:</strong> BeeBot AI chat with human handoff</li>
                                    <li><strong>WhatsApp Support:</strong> WhatsApp Business API for messaging</li>
                                    <li><strong>SMS Support:</strong> Two-way SMS support via Twilio</li>
                                    <li><strong>Phone Support:</strong> Callback request scheduling, IVR integration</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Configure Auto-Responses</h3>
                                <ul>
                                    <li><strong>Business Hours:</strong> Set support hours (9 AM - 6 PM Mon-Fri)</li>
                                    <li><strong>After-Hours Message:</strong> Auto-response with expected reply time</li>
                                    <li><strong>Acknowledgment Messages:</strong> "We received your message, agent will reply in 2 hours"</li>
                                    <li><strong>Canned Responses:</strong> Pre-written responses for common queries</li>
                                    <li><strong>Language Detection:</strong> Auto-detect customer language, respond accordingly</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">⚙️ SWIM LANE 2: BACKEND SERVICES (NestJS + TypeScript)</div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">

                            <div class="service-card">
                                <h3><span class="service-icon">📚</span> Knowledge Base Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/kb/categories - Create FAQ category<br>
                                        • <strong>POST</strong> /api/kb/articles - Create FAQ article<br>
                                        • <strong>PUT</strong> /api/kb/articles/:id - Update article (versioned)<br>
                                        • <strong>GET</strong> /api/kb/search - Search articles by keyword/query<br>
                                        • <strong>GET</strong> /api/kb/popular - Get most viewed/helpful articles
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Knowledge Base Features:</div>
                                    <div class="section-content">
                                        • <strong>Rich Content:</strong> Markdown, HTML, images, videos, code blocks<br>
                                        • <strong>SEO Optimization:</strong> Meta tags, structured data, sitemap generation<br>
                                        • <strong>Analytics:</strong> View count, search impressions, helpfulness votes<br>
                                        • <strong>Multi-Language:</strong> Google Translate API integration for auto-translation<br>
                                        • <strong>Version History:</strong> Git-like versioning, diff view, rollback capability
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🔍</span> FAQ Search Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>GET</strong> /api/faq/search - Full-text search with ranking<br>
                                        • <strong>POST</strong> /api/faq/suggest - AI-powered FAQ suggestions based on query<br>
                                        • <strong>GET</strong> /api/faq/autocomplete - Real-time autocomplete suggestions<br>
                                        • <strong>POST</strong> /api/faq/feedback - Submit helpfulness feedback (thumbs up/down)
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Search Algorithm:</div>
                                    <div class="section-content">
                                        • <strong>Full-Text Search:</strong> PostgreSQL full-text search with ranking<br>
                                        • <strong>Semantic Search:</strong> OpenAI embeddings for similarity matching<br>
                                        • <strong>Keyword Matching:</strong> Exact match, fuzzy match, synonym expansion<br>
                                        • <strong>Relevance Ranking:</strong> TF-IDF + helpfulness votes + recency<br>
                                        • <strong>Personalization:</strong> Rank higher based on user's previous interactions
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">💬</span> Multi-Channel Support Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/support/ticket - Create support ticket<br>
                                        • <strong>POST</strong> /api/support/message - Send message (email/chat/whatsapp/sms)<br>
                                        • <strong>GET</strong> /api/support/conversations/:id - Get conversation history<br>
                                        • <strong>POST</strong> /api/support/assign - Assign ticket to agent<br>
                                        • <strong>PUT</strong> /api/support/status/:id - Update ticket status
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Channel Integration:</div>
                                    <div class="section-content">
                                        • <strong>Email:</strong> IMAP/SMTP integration, parse incoming emails<br>
                                        • <strong>Live Chat:</strong> WebSocket for real-time messaging<br>
                                        • <strong>WhatsApp:</strong> WhatsApp Business Cloud API webhook receiver<br>
                                        • <strong>SMS:</strong> Twilio SMS API with two-way messaging<br>
                                        • <strong>Unified Inbox:</strong> All channels visible in single support dashboard
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🤖</span> BeeBot AI Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/beebot/chat - Process chat message<br>
                                        • <strong>POST</strong> /api/beebot/intent - Detect intent from user query<br>
                                        • <strong>POST</strong> /api/beebot/handoff - Transfer to human agent<br>
                                        • <strong>GET</strong> /api/beebot/context - Get conversation context
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">AI Capabilities:</div>
                                    <div class="section-content">
                                        • <strong>Intent Classification:</strong> OpenAI GPT-4 for intent detection (FAQ, billing, technical)<br>
                                        • <strong>FAQ Retrieval:</strong> Vector search in knowledge base (embeddings)<br>
                                        • <strong>Response Generation:</strong> Generate natural language responses from FAQs<br>
                                        • <strong>Sentiment Analysis:</strong> Detect frustrated customers, prioritize handoff<br>
                                        • <strong>Language Support:</strong> 95+ languages with auto-translation
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">⏰</span> Auto-Response Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/auto-response/configure - Set business hours<br>
                                        • <strong>POST</strong> /api/auto-response/templates - Create canned responses<br>
                                        • <strong>POST</strong> /api/auto-response/send - Send auto-response<br>
                                        • <strong>GET</strong> /api/auto-response/is-business-hours - Check availability
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Auto-Response Logic:</div>
                                    <div class="section-content">
                                        • <strong>Business Hours Check:</strong> Timezone-aware availability check<br>
                                        • <strong>After-Hours Response:</strong> "Our support team is available Mon-Fri 9 AM - 6 PM EST"<br>
                                        • <strong>Acknowledgment:</strong> "Thank you for contacting us. We'll respond within 2 hours."<br>
                                        • <strong>Canned Responses:</strong> 50+ pre-written templates for common queries<br>
                                        • <strong>Variable Replacement:</strong> {{customer_name}}, {{order_id}}, {{ticket_id}}
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📊</span> Support Analytics Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>GET</strong> /api/analytics/ticket-volume - Tickets by channel/category/time<br>
                                        • <strong>GET</strong> /api/analytics/response-time - Avg first response time, resolution time<br>
                                        • <strong>GET</strong> /api/analytics/csat - Customer satisfaction scores<br>
                                        • <strong>GET</strong> /api/analytics/faq-performance - Most viewed/helpful FAQs
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Analytics Metrics:</div>
                                    <div class="section-content">
                                        • <strong>Ticket Volume:</strong> Tickets created/resolved per day/week/month<br>
                                        • <strong>First Response Time:</strong> Avg time to first agent response (target <2 hours)<br>
                                        • <strong>Resolution Time:</strong> Avg time to close ticket (target <24 hours)<br>
                                        • <strong>CSAT Score:</strong> Customer satisfaction (1-5 stars, target >4.5)<br>
                                        • <strong>Self-Service Rate:</strong> % of queries resolved via FAQs (target >60%)
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">☁️ SWIM LANE 3: AWS INFRASTRUCTURE</div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate - Support Services
                                </h4>
                                <div class="section-content">
                                    <strong>Task Definition:</strong> kb-service, faq-search-service, support-service, beebot-service<br>
                                    <strong>CPU/Memory:</strong> 1 vCPU, 2GB RAM per task<br>
                                    <strong>Auto Scaling:</strong> 3-15 tasks based on request count<br>
                                    <strong>Scaling Metric:</strong> RequestCountPerTarget >1000<br>
                                    <strong>Health Check:</strong> /health endpoint every 30s<br>
                                    <strong>Deployment:</strong> Rolling update, 50% minimum healthy
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL 15.4 - Support Data
                                </h4>
                                <div class="section-content">
                                    <strong>Instance:</strong> db.r6g.xlarge (Multi-AZ for HA)<br>
                                    <strong>Storage:</strong> 500GB GP3 SSD (auto-scaling to 1TB)<br>
                                    <strong>Tables:</strong> kb_articles, kb_categories, support_tickets, conversations, faq_feedback<br>
                                    <strong>Full-Text Search:</strong> PostgreSQL tsvector for article search<br>
                                    <strong>Indexes:</strong> GIN index on tsvector, category_id, status, created_at<br>
                                    <strong>Backup:</strong> Automated daily snapshots, 7-day retention
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis - Support Cache
                                </h4>
                                <div class="section-content">
                                    <strong>Node Type:</strong> cache.r6g.large (Cluster Mode enabled)<br>
                                    <strong>Use Cases:</strong><br>
                                    • FAQ article cache (TTL 1 hour, invalidate on update)<br>
                                    • Search results cache (TTL 15 min)<br>
                                    • BeeBot conversation context (TTL 30 min)<br>
                                    • Business hours config (TTL 24 hours)<br>
                                    • Rate limiting (100 req/min per IP)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Queue-Service.svg" alt="SQS" class="aws-icon">
                                    SQS - Support Processing Queues
                                </h4>
                                <div class="section-content">
                                    <strong>ticket-creation-queue:</strong> New ticket creation events (retention 14 days)<br>
                                    <strong>notification-queue:</strong> Send notifications to customers/agents<br>
                                    <strong>translation-queue:</strong> Translate FAQs/messages (async processing)<br>
                                    <strong>Visibility Timeout:</strong> 2 minutes<br>
                                    <strong>Dead Letter Queue:</strong> 3 retries before DLQ<br>
                                    <strong>Throughput:</strong> ~300 messages/second peak
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Storage/Simple-Storage-Service.svg" alt="S3" class="aws-icon">
                                    S3 - Knowledge Base Assets
                                </h4>
                                <div class="section-content">
                                    <strong>Bucket:</strong> unifiedbeez-kb-assets<br>
                                    <strong>Storage:</strong><br>
                                    • FAQ images (screenshots, diagrams)<br>
                                    • Tutorial videos (MP4, WebM)<br>
                                    • PDF guides (user manuals, troubleshooting guides)<br>
                                    • Ticket attachments (customer uploads)<br>
                                    <strong>CloudFront:</strong> CDN for fast asset delivery<br>
                                    <strong>Lifecycle:</strong> Move to Glacier after 1 year
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Compute/Lambda.svg" alt="Lambda" class="aws-icon">
                                    Lambda Functions
                                </h4>
                                <div class="section-content">
                                    <strong>ticket-router:</strong> Route tickets to appropriate agent/queue (1GB RAM)<br>
                                    <strong>auto-response-sender:</strong> Send auto-responses (timeout 30s, 512MB RAM)<br>
                                    <strong>faq-indexer:</strong> Index FAQs for search (2GB RAM, timeout 5min)<br>
                                    <strong>translation-worker:</strong> Translate content via Google Translate API (1GB RAM)<br>
                                    <strong>analytics-aggregator:</strong> Calculate daily support metrics (2GB RAM)<br>
                                    <strong>Runtime:</strong> Node.js 20.x, bundled with esbuild
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Notification-Service.svg" alt="SNS" class="aws-icon">
                                    SNS - Support Notifications
                                </h4>
                                <div class="section-content">
                                    <strong>new-ticket-topic:</strong> Notify agents of new tickets<br>
                                    <strong>urgent-ticket-topic:</strong> High-priority ticket alerts<br>
                                    <strong>ticket-resolved-topic:</strong> Notify customers of resolution<br>
                                    <strong>Subscribers:</strong> Email, SMS, Slack webhooks, mobile push<br>
                                    <strong>Filtering:</strong> Category-based routing (billing, technical, account)<br>
                                    <strong>Priority:</strong> Urgent tickets trigger SMS/push, normal = email
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/EventBridge.svg" alt="EventBridge" class="aws-icon">
                                    EventBridge - Scheduled Jobs
                                </h4>
                                <div class="section-content">
                                    <strong>hourly-sla-check:</strong> cron(0 * * * ? *) - Check for SLA violations<br>
                                    <strong>daily-analytics:</strong> cron(0 8 * * ? *) - Calculate daily support metrics<br>
                                    <strong>weekly-faq-report:</strong> cron(0 9 ? * MON *) - Most viewed/helpful FAQs<br>
                                    <strong>nightly-cleanup:</strong> cron(0 2 * * ? *) - Archive resolved tickets >90 days<br>
                                    <strong>Target:</strong> Lambda functions<br>
                                    <strong>Retry Policy:</strong> 3 retries with exponential backoff
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Management-Governance/CloudWatch.svg" alt="CloudWatch" class="aws-icon">
                                    CloudWatch - Monitoring
                                </h4>
                                <div class="section-content">
                                    <strong>Metrics:</strong> Ticket volume, response time, resolution time, CSAT score, self-service rate<br>
                                    <strong>Alarms:</strong> Response time >2hrs, open tickets >100, CSAT <4.0<br>
                                    <strong>Logs:</strong> Ticket creation, message exchanges, FAQ searches, BeeBot interactions<br>
                                    <strong>Dashboards:</strong> Support health, agent performance, channel metrics<br>
                                    <strong>Retention:</strong> 90 days log retention<br>
                                    <strong>Insights:</strong> Log Insights for query analysis and troubleshooting
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Secrets-Manager.svg" alt="Secrets Manager" class="aws-icon">
                                    Secrets Manager - API Keys
                                </h4>
                                <div class="section-content">
                                    <strong>Secrets Stored:</strong><br>
                                    • unifiedbeez/openai-api-key (BeeBot AI)<br>
                                    • unifiedbeez/google-translate-api-key (translations)<br>
                                    • unifiedbeez/whatsapp-api-token (WhatsApp Business)<br>
                                    • unifiedbeez/twilio-credentials (SMS support)<br>
                                    <strong>Encryption:</strong> KMS key (unifiedbeez-secrets-key)<br>
                                    <strong>Rotation:</strong> API keys rotated every 90 days<br>
                                    <strong>Access Control:</strong> IAM role-based (ECS tasks + Lambda only)
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">🗄️ SWIM LANE 4: DATABASE SCHEMA & RELATIONSHIPS</div>
                    <div class="lane-content lane-data">

                        <!-- TABLE: kb_categories -->
                        <div class="db-table">
                            <div class="table-header">TABLE: kb_categories</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique category identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>tenant_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → tenants(id), INDEX</div>
                                    <div>Multi-tenancy isolation</div>
                                </div>
                                <div class="table-row">
                                    <div>name</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Category name (e.g., "Billing", "Technical Support", "Account")</div>
                                </div>
                                <div class="table-row">
                                    <div>slug</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL, UNIQUE</div>
                                    <div>URL-friendly slug (e.g., "billing", "technical-support")</div>
                                </div>
                                <div class="table-row">
                                    <div>description</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Category description</div>
                                </div>
                                <div class="table-row">
                                    <div>icon</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NULLABLE</div>
                                    <div>Icon name (e.g., "💰", "🔧", "👤")</div>
                                </div>
                                <div class="table-row">
                                    <div>display_order</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Display order in KB</div>
                                </div>
                                <div class="table-row">
                                    <div>is_active</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Category status</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Category creation timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: kb_articles -->
                        <div class="db-table">
                            <div class="table-header">TABLE: kb_articles</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique article identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>category_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → kb_categories(id), INDEX</div>
                                    <div>Associated category</div>
                                </div>
                                <div class="table-row">
                                    <div>title</div>
                                    <div>VARCHAR(500)</div>
                                    <div>NOT NULL</div>
                                    <div>Article title</div>
                                </div>
                                <div class="table-row">
                                    <div>slug</div>
                                    <div>VARCHAR(500)</div>
                                    <div>NOT NULL, UNIQUE</div>
                                    <div>URL-friendly slug</div>
                                </div>
                                <div class="table-row">
                                    <div>content</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>Article content (Markdown or HTML)</div>
                                </div>
                                <div class="table-row">
                                    <div>content_html</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Rendered HTML (cached)</div>
                                </div>
                                <div class="table-row">
                                    <div>search_vector</div>
                                    <div>TSVECTOR</div>
                                    <div>GIN INDEX</div>
                                    <div>Full-text search vector (title + content)</div>
                                </div>
                                <div class="table-row">
                                    <div>keywords</div>
                                    <div>TEXT[]</div>
                                    <div>NULLABLE</div>
                                    <div>Array of keywords/tags for search</div>
                                </div>
                                <div class="table-row">
                                    <div>language</div>
                                    <div>VARCHAR(5)</div>
                                    <div>DEFAULT 'en'</div>
                                    <div>ISO 639-1 language code (en, es, fr, de, etc.)</div>
                                </div>
                                <div class="table-row">
                                    <div>translated_from</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → kb_articles(id), NULLABLE</div>
                                    <div>Original article if this is a translation</div>
                                </div>
                                <div class="table-row">
                                    <div>view_count</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Number of times article viewed</div>
                                </div>
                                <div class="table-row">
                                    <div>helpful_count</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Number of "helpful" votes</div>
                                </div>
                                <div class="table-row">
                                    <div>not_helpful_count</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Number of "not helpful" votes</div>
                                </div>
                                <div class="table-row">
                                    <div>version</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 1</div>
                                    <div>Article version number</div>
                                </div>
                                <div class="table-row">
                                    <div>is_published</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Publication status</div>
                                </div>
                                <div class="table-row">
                                    <div>published_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When article was published</div>
                                </div>
                                <div class="table-row">
                                    <div>created_by</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → users(id)</div>
                                    <div>Article author</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW(), INDEX</div>
                                    <div>Article creation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>updated_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last update timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: support_tickets -->
                        <div class="db-table">
                            <div class="table-header">TABLE: support_tickets</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique ticket identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>ticket_number</div>
                                    <div>VARCHAR(20)</div>
                                    <div>UNIQUE, NOT NULL</div>
                                    <div>Human-readable ticket number (e.g., "TICKET-12345")</div>
                                </div>
                                <div class="table-row">
                                    <div>tenant_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → tenants(id), INDEX</div>
                                    <div>Multi-tenancy isolation</div>
                                </div>
                                <div class="table-row">
                                    <div>customer_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → leads(id), INDEX</div>
                                    <div>Customer who created ticket</div>
                                </div>
                                <div class="table-row">
                                    <div>category_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → kb_categories(id), INDEX</div>
                                    <div>Ticket category</div>
                                </div>
                                <div class="table-row">
                                    <div>channel</div>
                                    <div>ENUM</div>
                                    <div>'email', 'chat', 'whatsapp', 'sms', 'phone'</div>
                                    <div>Support channel</div>
                                </div>
                                <div class="table-row">
                                    <div>subject</div>
                                    <div>VARCHAR(500)</div>
                                    <div>NOT NULL</div>
                                    <div>Ticket subject/title</div>
                                </div>
                                <div class="table-row">
                                    <div>description</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>Initial ticket description</div>
                                </div>
                                <div class="table-row">
                                    <div>priority</div>
                                    <div>ENUM</div>
                                    <div>'low', 'normal', 'high', 'urgent'</div>
                                    <div>Ticket priority</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>ENUM</div>
                                    <div>'new', 'open', 'pending', 'resolved', 'closed'</div>
                                    <div>Ticket status</div>
                                </div>
                                <div class="table-row">
                                    <div>assigned_to</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → users(id), NULLABLE</div>
                                    <div>Assigned support agent</div>
                                </div>
                                <div class="table-row">
                                    <div>first_response_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When agent first responded (SLA tracking)</div>
                                </div>
                                <div class="table-row">
                                    <div>resolved_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When ticket was resolved</div>
                                </div>
                                <div class="table-row">
                                    <div>closed_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When ticket was closed</div>
                                </div>
                                <div class="table-row">
                                    <div>csat_score</div>
                                    <div>INTEGER</div>
                                    <div>CHECK (csat_score BETWEEN 1 AND 5), NULLABLE</div>
                                    <div>Customer satisfaction score (1-5 stars)</div>
                                </div>
                                <div class="table-row">
                                    <div>csat_feedback</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Customer feedback text</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW(), INDEX</div>
                                    <div>Ticket creation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>updated_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last update timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: conversations -->
                        <div class="db-table">
                            <div class="table-header">TABLE: conversations</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique message identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>ticket_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → support_tickets(id), INDEX</div>
                                    <div>Associated ticket</div>
                                </div>
                                <div class="table-row">
                                    <div>sender_type</div>
                                    <div>ENUM</div>
                                    <div>'customer', 'agent', 'system', 'beebot'</div>
                                    <div>Who sent the message</div>
                                </div>
                                <div class="table-row">
                                    <div>sender_id</div>
                                    <div>UUID</div>
                                    <div>NULLABLE</div>
                                    <div>User ID (customer or agent)</div>
                                </div>
                                <div class="table-row">
                                    <div>message</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>Message content</div>
                                </div>
                                <div class="table-row">
                                    <div>attachments</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Array of attachment URLs (S3 links)</div>
                                </div>
                                <div class="table-row">
                                    <div>is_internal</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Internal note (not visible to customer)</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW(), INDEX</div>
                                    <div>Message timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: faq_feedback -->
                        <div class="db-table">
                            <div class="table-header">TABLE: faq_feedback</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique feedback identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>article_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → kb_articles(id), INDEX</div>
                                    <div>Article being rated</div>
                                </div>
                                <div class="table-row">
                                    <div>customer_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → leads(id), NULLABLE</div>
                                    <div>Customer who gave feedback (if logged in)</div>
                                </div>
                                <div class="table-row">
                                    <div>is_helpful</div>
                                    <div>BOOLEAN</div>
                                    <div>NOT NULL</div>
                                    <div>Was article helpful? (thumbs up/down)</div>
                                </div>
                                <div class="table-row">
                                    <div>feedback_text</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Optional feedback comment</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW(), INDEX</div>
                                    <div>Feedback timestamp</div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">🛡️ SWIM LANE 5: GDPR COMPLIANCE & DATA PROTECTION</div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Support Data Processing</h3>
                                <div class="gdpr-section">
                                    <strong>Article 6(1)(b) - Contract Performance:</strong>
                                    <ul>
                                        <li>Support ticket processing necessary for customer service</li>
                                        <li>Legitimate interest: provide support as part of product/service</li>
                                        <li>Customer initiates contact (implied consent for support)</li>
                                        <li>Data minimization: only collect necessary support info</li>
                                    </ul>
                                    <strong>Article 6(1)(f) - Legitimate Interest:</strong>
                                    <ul>
                                        <li>Ticket history retained for quality assurance</li>
                                        <li>Analytics used to improve support experience</li>
                                        <li>Legitimate Interest Assessment (LIA) documented</li>
                                        <li>Customer rights balanced with business needs</li>
                                    </ul>
                                    <strong>Data Collected:</strong>
                                    <ul>
                                        <li>Name, email, phone (customer identification)</li>
                                        <li>Ticket content (support query + responses)</li>
                                        <li>Attachments (screenshots, logs for troubleshooting)</li>
                                        <li>CSAT feedback (service improvement)</li>
                                        <li>No sensitive data collected without explicit consent</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 6: Lawfulness of Processing<br>
                                    &nbsp;&nbsp; Section: Customer Support Data Processing
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Data Subject Rights</h3>
                                <div class="gdpr-section">
                                    <strong>Article 15 - Right of Access:</strong>
                                    <ul>
                                        <li>Customers can view all their support tickets</li>
                                        <li>API endpoint: GET /api/my-tickets (authenticated)</li>
                                        <li>Export all ticket history (conversations, attachments)</li>
                                        <li>Includes CSAT feedback, resolution times, agent names</li>
                                    </ul>
                                    <strong>Article 16 - Right to Rectification:</strong>
                                    <ul>
                                        <li>Customers can update contact info in support profile</li>
                                        <li>Correct inaccurate info in ticket descriptions</li>
                                        <li>API endpoint: PUT /api/tickets/:id/rectify</li>
                                    </ul>
                                    <strong>Article 17 - Right to Erasure:</strong>
                                    <ul>
                                        <li>Delete ticket after resolution (if no legal obligation to retain)</li>
                                        <li>Anonymize PII in tickets (replace name/email with [DELETED])</li>
                                        <li>Retain anonymized data for analytics (aggregate metrics)</li>
                                        <li>Attachments deleted from S3 immediately</li>
                                    </ul>
                                    <strong>Article 20 - Right to Data Portability:</strong>
                                    <ul>
                                        <li>Export all support tickets (JSON/CSV format)</li>
                                        <li>Includes conversations, attachments, CSAT scores</li>
                                        <li>Machine-readable format (structured data)</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Chapter 3: Data Subject Rights<br>
                                    &nbsp;&nbsp; Section: Support Ticket Management
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Data Retention & Security</h3>
                                <div class="gdpr-section">
                                    <strong>Article 5(1)(e) - Storage Limitation:</strong>
                                    <ul>
                                        <li><strong>Open Tickets:</strong> Retained while ticket is active</li>
                                        <li><strong>Resolved Tickets:</strong> Retained 90 days after resolution</li>
                                        <li><strong>Closed Tickets:</strong> Archived after 90 days, deleted after 2 years</li>
                                        <li><strong>Attachments:</strong> Deleted with ticket (same retention period)</li>
                                        <li><strong>Analytics Data:</strong> Anonymized and retained 3 years</li>
                                    </ul>
                                    <strong>Automated Deletion (Lambda Function):</strong>
                                    <ul>
                                        <li>Nightly job: archive resolved tickets >90 days</li>
                                        <li>Quarterly job: delete archived tickets >2 years</li>
                                        <li>Attachments moved to Glacier after 1 year, deleted after 2 years</li>
                                        <li>CloudWatch alarm if deletion job fails</li>
                                    </ul>
                                    <strong>Article 32 - Security of Processing:</strong>
                                    <ul>
                                        <li>Ticket data encrypted at rest (RDS encryption, AES-256)</li>
                                        <li>Attachments encrypted in S3 (SSE-S3)</li>
                                        <li>HTTPS/TLS 1.3 for all API communication</li>
                                        <li>RBAC: Only assigned agent can view ticket details</li>
                                        <li>Audit log: all ticket access logged for compliance</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 5(1)(e): Storage Limitation<br>
                                    &nbsp;&nbsp; Chapter 7: Security Measures
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Third-Party Processors</h3>
                                <div class="gdpr-section">
                                    <strong>Article 28 - Processor Agreements:</strong>
                                    <ul>
                                        <li><strong>OpenAI:</strong> DPA signed for BeeBot AI (GPT-4 API)</li>
                                        <li><strong>Google Translate:</strong> DPA signed for translation services</li>
                                        <li><strong>Twilio:</strong> DPA signed for SMS support</li>
                                        <li><strong>WhatsApp/Meta:</strong> DPA for WhatsApp Business API</li>
                                        <li><strong>AWS:</strong> AWS GDPR Data Processing Addendum in place</li>
                                        <li>All processors: EU/US Data Privacy Framework certified</li>
                                    </ul>
                                    <strong>Data Minimization with AI:</strong>
                                    <ul>
                                        <li>BeeBot AI receives only necessary context (message + FAQ)</li>
                                        <li>No PII sent to OpenAI (customer names/emails redacted)</li>
                                        <li>Conversation context stored in Redis (not sent to external APIs)</li>
                                        <li>AI responses reviewed before sending (quality + privacy check)</li>
                                    </ul>
                                    <strong>International Data Transfers:</strong>
                                    <ul>
                                        <li>Standard Contractual Clauses (SCCs) with all non-EU processors</li>
                                        <li>Transfer Impact Assessments (TIA) completed</li>
                                        <li>Option to restrict support to EU-only agents/systems</li>
                                        <li>Transparent disclosure of data transfers in privacy policy</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Chapter 8: Third-Party Data Processors<br>
                                    &nbsp;&nbsp; Section: AI & Translation Services
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 12 -->

            <!-- FRAME 13: SUPPORT & ESCALATION BUILDER - ESCALATION RULES ENGINE -->
            <div class="frame" id="frame13">
                <div class="frame-title">FRAME 13: SUPPORT & ESCALATION BUILDER - ESCALATION RULES ENGINE</div>
                <div class="frame-subtitle">Smart Escalation Rules | SLA Management | Priority Routing | Agent Assignment | Escalation Notifications</div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <span class="legend-color" style="background: #E8F5E9;"></span>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #E3F2FD;"></span>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #FFF3E0;"></span>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #F3E5F5;"></span>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #E0F2F1;"></span>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">👤 SWIM LANE 1: USER ACTIONS</div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Define Escalation Rules</h3>
                                <ul>
                                    <li><strong>Time-Based Escalation:</strong> Escalate if no response in 2 hours, no resolution in 24 hours</li>
                                    <li><strong>Priority Escalation:</strong> Urgent tickets auto-escalate to senior agents</li>
                                    <li><strong>Keyword Triggers:</strong> Escalate if ticket contains "angry", "lawsuit", "refund"</li>
                                    <li><strong>Sentiment Escalation:</strong> Escalate if customer sentiment is very negative</li>
                                    <li><strong>VIP Escalation:</strong> Enterprise customers get priority escalation</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Configure SLA Policies</h3>
                                <ul>
                                    <li><strong>First Response SLA:</strong> Low=4h, Normal=2h, High=1h, Urgent=15min</li>
                                    <li><strong>Resolution SLA:</strong> Low=48h, Normal=24h, High=8h, Urgent=4h</li>
                                    <li><strong>Business Hours:</strong> SLA applies only during business hours (9 AM - 6 PM Mon-Fri)</li>
                                    <li><strong>SLA Exceptions:</strong> Pause SLA when waiting for customer response</li>
                                    <li><strong>Breach Notifications:</strong> Alert agents 30min before SLA breach</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Set Up Agent Assignment</h3>
                                <ul>
                                    <li><strong>Round-Robin:</strong> Distribute tickets evenly across available agents</li>
                                    <li><strong>Skill-Based Routing:</strong> Route billing tickets to billing specialists</li>
                                    <li><strong>Load Balancing:</strong> Assign to agent with fewest open tickets</li>
                                    <li><strong>Availability Check:</strong> Only assign to online agents (active in last 5 min)</li>
                                    <li><strong>Reassignment Rules:</strong> Reassign if agent doesn't respond in 30 minutes</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Configure Escalation Notifications</h3>
                                <ul>
                                    <li><strong>Agent Alerts:</strong> Slack/email notification when ticket escalated</li>
                                    <li><strong>Manager Alerts:</strong> Notify support manager of urgent escalations</li>
                                    <li><strong>Customer Updates:</strong> Inform customer when ticket is escalated</li>
                                    <li><strong>SLA Warnings:</strong> Alert when ticket is 80% through SLA</li>
                                    <li><strong>Escalation Digest:</strong> Daily summary of all escalations to management</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">⚙️ SWIM LANE 2: BACKEND SERVICES (NestJS + TypeScript)</div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">

                            <div class="service-card">
                                <h3><span class="service-icon">⚡</span> Escalation Rules Engine</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/escalation/rules - Create escalation rule<br>
                                        • <strong>POST</strong> /api/escalation/evaluate - Evaluate ticket against rules<br>
                                        • <strong>POST</strong> /api/escalation/trigger - Manually trigger escalation<br>
                                        • <strong>GET</strong> /api/escalation/history/:ticketId - Get escalation history<br>
                                        • <strong>PUT</strong> /api/escalation/rules/:id - Update rule
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Escalation Logic:</div>
                                    <div class="section-content">
                                        • <strong>Time-Based:</strong> Check ticket age vs SLA thresholds<br>
                                        • <strong>Priority-Based:</strong> Urgent priority → immediate escalation to L2<br>
                                        • <strong>Keyword Detection:</strong> Regex/NLP to detect escalation triggers<br>
                                        • <strong>Sentiment Analysis:</strong> OpenAI API for sentiment scoring (very negative → escalate)<br>
                                        • <strong>Boolean Logic:</strong> Complex rules with AND/OR/NOT conditions<br>
                                        • <strong>Rule Priority:</strong> Higher priority rules evaluated first
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">⏱️</span> SLA Management Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/sla/policies - Create SLA policy<br>
                                        • <strong>GET</strong> /api/sla/status/:ticketId - Get SLA status for ticket<br>
                                        • <strong>POST</strong> /api/sla/pause - Pause SLA (waiting for customer)<br>
                                        • <strong>POST</strong> /api/sla/resume - Resume SLA timer<br>
                                        • <strong>GET</strong> /api/sla/violations - Get all SLA violations
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">SLA Calculations:</div>
                                    <div class="section-content">
                                        • <strong>First Response SLA:</strong> Time from ticket creation to first agent response<br>
                                        • <strong>Resolution SLA:</strong> Time from creation to ticket resolved status<br>
                                        • <strong>Business Hours Only:</strong> Count only business hours (9 AM - 6 PM Mon-Fri)<br>
                                        • <strong>Pause Conditions:</strong> Auto-pause when status = "pending" (waiting for customer)<br>
                                        • <strong>SLA Breach:</strong> Flag ticket if deadline exceeded<br>
                                        • <strong>Warning Threshold:</strong> Alert at 80% of SLA time
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">👥</span> Agent Assignment Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/assignment/auto-assign - Auto-assign ticket to agent<br>
                                        • <strong>POST</strong> /api/assignment/reassign - Reassign to different agent<br>
                                        • <strong>GET</strong> /api/assignment/available-agents - Get online agents<br>
                                        • <strong>GET</strong> /api/assignment/agent-workload - Get ticket count per agent<br>
                                        • <strong>POST</strong> /api/assignment/set-skills - Set agent skill tags
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Assignment Algorithms:</div>
                                    <div class="section-content">
                                        • <strong>Round-Robin:</strong> Cycle through agents sequentially<br>
                                        • <strong>Least Loaded:</strong> Assign to agent with fewest open tickets<br>
                                        • <strong>Skill-Based:</strong> Match ticket category to agent skill tags (billing, technical, account)<br>
                                        • <strong>Availability Check:</strong> Only assign to agents with status=online (last active <5 min)<br>
                                        • <strong>Fallback:</strong> If no skilled agent available, use round-robin<br>
                                        • <strong>Reassignment:</strong> If agent doesn't respond in 30 min, reassign automatically
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🔔</span> Notification Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/notifications/send - Send notification<br>
                                        • <strong>POST</strong> /api/notifications/configure - Set notification preferences<br>
                                        • <strong>GET</strong> /api/notifications/history - Get notification history<br>
                                        • <strong>POST</strong> /api/notifications/digest - Send daily digest
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Notification Channels:</div>
                                    <div class="section-content">
                                        • <strong>Email:</strong> AWS SES for email alerts<br>
                                        • <strong>Slack:</strong> Webhook integration for team notifications<br>
                                        • <strong>SMS:</strong> Twilio for urgent escalations<br>
                                        • <strong>Push Notifications:</strong> Mobile app notifications (Firebase Cloud Messaging)<br>
                                        • <strong>In-App:</strong> Real-time alerts in support dashboard (WebSocket)<br>
                                        • <strong>PagerDuty:</strong> Integration for on-call escalations
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📊</span> Escalation Analytics Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>GET</strong> /api/analytics/escalation-rate - % of tickets escalated<br>
                                        • <strong>GET</strong> /api/analytics/sla-compliance - SLA met vs breached<br>
                                        • <strong>GET</strong> /api/analytics/escalation-reasons - Why tickets escalated<br>
                                        • <strong>GET</strong> /api/analytics/agent-performance - Avg response/resolution time per agent
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Analytics Metrics:</div>
                                    <div class="section-content">
                                        • <strong>Escalation Rate:</strong> (escalated tickets / total tickets) × 100 (target <10%)<br>
                                        • <strong>SLA Compliance:</strong> (tickets met SLA / total tickets) × 100 (target >95%)<br>
                                        • <strong>Avg Response Time:</strong> Avg time to first response (target <2 hours)<br>
                                        • <strong>Avg Resolution Time:</strong> Avg time to resolution (target <24 hours)<br>
                                        • <strong>Escalation Reasons:</strong> SLA breach (40%), customer request (30%), sentiment (20%), keyword (10%)
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🤖</span> Smart Routing Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/routing/predict-category - AI-powered category prediction<br>
                                        • <strong>POST</strong> /api/routing/predict-priority - AI-powered priority prediction<br>
                                        • <strong>POST</strong> /api/routing/recommend-agent - Recommend best agent for ticket<br>
                                        • <strong>POST</strong> /api/routing/train-model - Retrain routing ML model
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">ML Features:</div>
                                    <div class="section-content">
                                        • <strong>Category Prediction:</strong> OpenAI GPT-4 analyzes ticket content, suggests category<br>
                                        • <strong>Priority Prediction:</strong> ML model predicts urgency based on keywords + sentiment<br>
                                        • <strong>Agent Recommendation:</strong> Historical data → which agent best suited for ticket type<br>
                                        • <strong>Resolution Time Prediction:</strong> Estimate resolution time based on similar tickets<br>
                                        • <strong>Model Training:</strong> Retrain models monthly on new ticket data
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">☁️ SWIM LANE 3: AWS INFRASTRUCTURE</div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS" class="aws-icon">
                                    ECS Fargate - Escalation Services
                                </h4>
                                <div class="section-content">
                                    <strong>Task Definition:</strong> escalation-engine, sla-service, assignment-service, notification-service<br>
                                    <strong>CPU/Memory:</strong> 1 vCPU, 2GB RAM per task<br>
                                    <strong>Auto Scaling:</strong> 3-12 tasks based on queue depth<br>
                                    <strong>Scaling Metric:</strong> SQS queue depth >50<br>
                                    <strong>Health Check:</strong> /health endpoint every 30s<br>
                                    <strong>Deployment:</strong> Rolling update, 50% minimum healthy
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS" class="aws-icon">
                                    RDS PostgreSQL 15.4 - Escalation Data
                                </h4>
                                <div class="section-content">
                                    <strong>Instance:</strong> db.r6g.xlarge (Multi-AZ for HA)<br>
                                    <strong>Storage:</strong> 500GB GP3 SSD (auto-scaling to 1TB)<br>
                                    <strong>Tables:</strong> escalation_rules, sla_policies, escalation_logs, agent_skills, agent_workload<br>
                                    <strong>Indexes:</strong> ticket_id, agent_id, rule_id, created_at<br>
                                    <strong>Partitioning:</strong> escalation_logs partitioned by month<br>
                                    <strong>Backup:</strong> Automated daily snapshots, 7-day retention
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache" class="aws-icon">
                                    ElastiCache Redis - Escalation Cache
                                </h4>
                                <div class="section-content">
                                    <strong>Node Type:</strong> cache.r6g.large (Cluster Mode enabled)<br>
                                    <strong>Use Cases:</strong><br>
                                    • Escalation rules cache (TTL 1 hour)<br>
                                    • SLA policies cache (TTL 1 hour)<br>
                                    • Agent availability status (TTL 5 min)<br>
                                    • Agent workload counter (real-time)<br>
                                    • Round-robin assignment state
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Queue-Service.svg" alt="SQS" class="aws-icon">
                                    SQS - Escalation Processing Queues
                                </h4>
                                <div class="section-content">
                                    <strong>escalation-evaluation-queue:</strong> Evaluate tickets against rules (retention 14 days)<br>
                                    <strong>sla-check-queue:</strong> Check SLA status for all open tickets<br>
                                    <strong>notification-queue:</strong> Send escalation notifications<br>
                                    <strong>Visibility Timeout:</strong> 2 minutes<br>
                                    <strong>Dead Letter Queue:</strong> 3 retries before DLQ<br>
                                    <strong>Throughput:</strong> ~500 messages/second peak
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Compute/Lambda.svg" alt="Lambda" class="aws-icon">
                                    Lambda Functions
                                </h4>
                                <div class="section-content">
                                    <strong>escalation-evaluator:</strong> Evaluate escalation rules (timeout 1min, 1GB RAM)<br>
                                    <strong>sla-monitor:</strong> Check SLA status hourly (timeout 5min, 2GB RAM)<br>
                                    <strong>auto-assigner:</strong> Auto-assign tickets to agents (timeout 30s, 512MB RAM)<br>
                                    <strong>notification-sender:</strong> Send escalation notifications (timeout 30s, 512MB RAM)<br>
                                    <strong>analytics-aggregator:</strong> Calculate escalation metrics daily (2GB RAM)<br>
                                    <strong>Runtime:</strong> Node.js 20.x, bundled with esbuild
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Notification-Service.svg" alt="SNS" class="aws-icon">
                                    SNS - Escalation Notifications
                                </h4>
                                <div class="section-content">
                                    <strong>escalation-alerts:</strong> Notify agents of escalated tickets<br>
                                    <strong>sla-breach-alerts:</strong> Critical SLA breach notifications<br>
                                    <strong>sla-warning-alerts:</strong> 80% SLA threshold warnings<br>
                                    <strong>manager-digest:</strong> Daily escalation summary to managers<br>
                                    <strong>Subscribers:</strong> Email, SMS (urgent), Slack, PagerDuty<br>
                                    <strong>Priority Routing:</strong> Urgent → SMS/PagerDuty, Normal → Email/Slack
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/EventBridge.svg" alt="EventBridge" class="aws-icon">
                                    EventBridge - Scheduled Jobs
                                </h4>
                                <div class="section-content">
                                    <strong>every-5min-sla-check:</strong> cron(*/5 * * * ? *) - Check SLA status<br>
                                    <strong>hourly-escalation-eval:</strong> cron(0 * * * ? *) - Evaluate escalation rules<br>
                                    <strong>daily-analytics:</strong> cron(0 8 * * ? *) - Calculate escalation metrics<br>
                                    <strong>daily-manager-digest:</strong> cron(0 17 * * ? *) - Send manager summary (5 PM)<br>
                                    <strong>monthly-model-training:</strong> cron(0 2 1 * ? *) - Retrain ML models<br>
                                    <strong>Target:</strong> Lambda functions → SQS queues<br>
                                    <strong>Retry Policy:</strong> 3 retries with exponential backoff
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Management-Governance/CloudWatch.svg" alt="CloudWatch" class="aws-icon">
                                    CloudWatch - Monitoring
                                </h4>
                                <div class="section-content">
                                    <strong>Metrics:</strong> Escalation rate, SLA compliance, agent workload, notification delivery<br>
                                    <strong>Alarms:</strong> Escalation rate >10%, SLA compliance <95%, queue depth >100<br>
                                    <strong>Logs:</strong> Escalation events, SLA calculations, rule evaluations, notifications<br>
                                    <strong>Dashboards:</strong> Escalation health, SLA compliance, agent performance<br>
                                    <strong>Retention:</strong> 90 days log retention<br>
                                    <strong>Insights:</strong> Query patterns to identify escalation trends
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/EventBridge.svg" alt="EventBridge" class="aws-icon">
                                    EventBridge - Real-Time Events
                                </h4>
                                <div class="section-content">
                                    <strong>Event Bus:</strong> custom-event-bus (escalation events)<br>
                                    <strong>Events:</strong><br>
                                    • ticket.created → Trigger auto-assignment<br>
                                    • ticket.escalated → Send escalation notifications<br>
                                    • sla.breach → Alert manager + escalate<br>
                                    • agent.response → Pause SLA if waiting for customer<br>
                                    <strong>Event Patterns:</strong> JSON pattern matching for routing<br>
                                    <strong>Targets:</strong> Lambda, SQS, SNS, Step Functions
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Secrets-Manager.svg" alt="Secrets Manager" class="aws-icon">
                                    Secrets Manager - Integration Keys
                                </h4>
                                <div class="section-content">
                                    <strong>Secrets Stored:</strong><br>
                                    • unifiedbeez/slack-webhook-url (Slack notifications)<br>
                                    • unifiedbeez/pagerduty-api-key (on-call escalations)<br>
                                    • unifiedbeez/twilio-credentials (SMS alerts)<br>
                                    • unifiedbeez/firebase-credentials (push notifications)<br>
                                    <strong>Encryption:</strong> KMS key (unifiedbeez-secrets-key)<br>
                                    <strong>Rotation:</strong> API keys rotated every 90 days<br>
                                    <strong>Access Control:</strong> IAM role-based (ECS tasks + Lambda only)
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">🗄️ SWIM LANE 4: DATABASE SCHEMA & RELATIONSHIPS</div>
                    <div class="lane-content lane-data">

                        <!-- TABLE: escalation_rules -->
                        <div class="db-table">
                            <div class="table-header">TABLE: escalation_rules</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique rule identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>tenant_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → tenants(id), INDEX</div>
                                    <div>Multi-tenancy isolation</div>
                                </div>
                                <div class="table-row">
                                    <div>name</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Rule name (e.g., "Urgent Priority Escalation", "2 Hour No Response")</div>
                                </div>
                                <div class="table-row">
                                    <div>description</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Rule description</div>
                                </div>
                                <div class="table-row">
                                    <div>trigger_type</div>
                                    <div>ENUM</div>
                                    <div>'time_based', 'priority_based', 'keyword', 'sentiment', 'manual'</div>
                                    <div>What triggers this escalation</div>
                                </div>
                                <div class="table-row">
                                    <div>conditions</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Rule conditions (e.g., {priority: 'urgent', time_threshold: 120})</div>
                                </div>
                                <div class="table-row">
                                    <div>escalate_to_tier</div>
                                    <div>ENUM</div>
                                    <div>'L1', 'L2', 'L3', 'manager'</div>
                                    <div>Which support tier to escalate to</div>
                                </div>
                                <div class="table-row">
                                    <div>escalate_to_user_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → users(id), NULLABLE</div>
                                    <div>Specific user to escalate to (optional)</div>
                                </div>
                                <div class="table-row">
                                    <div>priority</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Rule evaluation priority (higher = evaluated first)</div>
                                </div>
                                <div class="table-row">
                                    <div>is_active</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Rule status</div>
                                </div>
                                <div class="table-row">
                                    <div>notification_channels</div>
                                    <div>TEXT[]</div>
                                    <div>DEFAULT ARRAY['email']</div>
                                    <div>Array of notification channels (email, slack, sms, push)</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Rule creation timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: sla_policies -->
                        <div class="db-table">
                            <div class="table-header">TABLE: sla_policies</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique SLA policy identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>tenant_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → tenants(id), INDEX</div>
                                    <div>Multi-tenancy isolation</div>
                                </div>
                                <div class="table-row">
                                    <div>name</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Policy name (e.g., "Standard SLA", "Enterprise SLA")</div>
                                </div>
                                <div class="table-row">
                                    <div>priority</div>
                                    <div>ENUM</div>
                                    <div>'low', 'normal', 'high', 'urgent'</div>
                                    <div>Ticket priority this policy applies to</div>
                                </div>
                                <div class="table-row">
                                    <div>first_response_minutes</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL</div>
                                    <div>First response SLA in minutes (e.g., 120 = 2 hours)</div>
                                </div>
                                <div class="table-row">
                                    <div>resolution_minutes</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL</div>
                                    <div>Resolution SLA in minutes (e.g., 1440 = 24 hours)</div>
                                </div>
                                <div class="table-row">
                                    <div>business_hours_only</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Whether SLA applies only during business hours</div>
                                </div>
                                <div class="table-row">
                                    <div>business_hours_config</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Business hours config (e.g., {start: "09:00", end: "18:00", days: [1,2,3,4,5]})</div>
                                </div>
                                <div class="table-row">
                                    <div>pause_conditions</div>
                                    <div>TEXT[]</div>
                                    <div>DEFAULT ARRAY['pending']</div>
                                    <div>Ticket statuses that pause SLA (waiting for customer)</div>
                                </div>
                                <div class="table-row">
                                    <div>warning_threshold_percent</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 80</div>
                                    <div>Alert when SLA is X% through (e.g., 80 = alert at 80%)</div>
                                </div>
                                <div class="table-row">
                                    <div>is_default</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Default policy for all tickets</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Policy creation timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: escalation_logs -->
                        <div class="db-table">
                            <div class="table-header">TABLE: escalation_logs (Partitioned by month)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique escalation log identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>ticket_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → support_tickets(id), INDEX</div>
                                    <div>Escalated ticket</div>
                                </div>
                                <div class="table-row">
                                    <div>rule_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → escalation_rules(id), INDEX</div>
                                    <div>Rule that triggered escalation</div>
                                </div>
                                <div class="table-row">
                                    <div>escalation_reason</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>Why ticket was escalated (e.g., "SLA breach: no response in 2 hours")</div>
                                </div>
                                <div class="table-row">
                                    <div>escalated_from_tier</div>
                                    <div>ENUM</div>
                                    <div>'L1', 'L2', 'L3'</div>
                                    <div>Original support tier</div>
                                </div>
                                <div class="table-row">
                                    <div>escalated_to_tier</div>
                                    <div>ENUM</div>
                                    <div>'L1', 'L2', 'L3', 'manager'</div>
                                    <div>New support tier</div>
                                </div>
                                <div class="table-row">
                                    <div>escalated_from_user_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → users(id), NULLABLE</div>
                                    <div>Previous assigned agent</div>
                                </div>
                                <div class="table-row">
                                    <div>escalated_to_user_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → users(id), NULLABLE</div>
                                    <div>New assigned agent</div>
                                </div>
                                <div class="table-row">
                                    <div>escalation_type</div>
                                    <div>ENUM</div>
                                    <div>'automatic', 'manual'</div>
                                    <div>How escalation was triggered</div>
                                </div>
                                <div class="table-row">
                                    <div>triggered_by</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → users(id), NULLABLE</div>
                                    <div>User who manually triggered (if manual)</div>
                                </div>
                                <div class="table-row">
                                    <div>notifications_sent</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Array of notifications sent (channel, recipient, status)</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW(), INDEX, PARTITION KEY</div>
                                    <div>Escalation timestamp (partition by month)</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: agent_skills -->
                        <div class="db-table">
                            <div class="table-header">TABLE: agent_skills</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique skill mapping identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>user_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → users(id), INDEX</div>
                                    <div>Support agent</div>
                                </div>
                                <div class="table-row">
                                    <div>category_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → kb_categories(id), INDEX</div>
                                    <div>Category agent is skilled in</div>
                                </div>
                                <div class="table-row">
                                    <div>skill_level</div>
                                    <div>ENUM</div>
                                    <div>'beginner', 'intermediate', 'expert'</div>
                                    <div>Agent's skill level in this category</div>
                                </div>
                                <div class="table-row">
                                    <div>support_tier</div>
                                    <div>ENUM</div>
                                    <div>'L1', 'L2', 'L3'</div>
                                    <div>Agent's support tier</div>
                                </div>
                                <div class="table-row">
                                    <div>created_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Skill assignment timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>-</div>
                                    <div>-</div>
                                    <div>UNIQUE (user_id, category_id)</div>
                                    <div>One skill level per agent per category</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: agent_workload -->
                        <div class="db-table">
                            <div class="table-header">TABLE: agent_workload</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique workload record identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>user_id</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → users(id), UNIQUE, INDEX</div>
                                    <div>Support agent</div>
                                </div>
                                <div class="table-row">
                                    <div>open_tickets_count</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Number of open/assigned tickets</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>ENUM</div>
                                    <div>'online', 'offline', 'away', 'busy'</div>
                                    <div>Agent availability status</div>
                                </div>
                                <div class="table-row">
                                    <div>last_active_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>NOT NULL, INDEX</div>
                                    <div>Last activity timestamp (for availability check)</div>
                                </div>
                                <div class="table-row">
                                    <div>max_concurrent_tickets</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 10</div>
                                    <div>Max tickets agent can handle simultaneously</div>
                                </div>
                                <div class="table-row">
                                    <div>updated_at</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last update timestamp</div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">🛡️ SWIM LANE 5: GDPR COMPLIANCE & DATA PROTECTION</div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Escalation Data Processing</h3>
                                <div class="gdpr-section">
                                    <strong>Article 6(1)(f) - Legitimate Interest:</strong>
                                    <ul>
                                        <li>Escalation necessary for quality customer support</li>
                                        <li>SLA tracking ensures timely responses (customer benefit)</li>
                                        <li>Agent performance monitoring for service improvement</li>
                                        <li>Legitimate Interest Assessment (LIA) documented</li>
                                        <li>Customer rights balanced with support quality needs</li>
                                    </ul>
                                    <strong>Data Minimization:</strong>
                                    <ul>
                                        <li>Escalation logs only capture necessary info (ticket ID, reason, timestamps)</li>
                                        <li>No sensitive customer data in escalation rules (category/priority only)</li>
                                        <li>Agent workload data aggregated (no individual ticket content)</li>
                                        <li>Sentiment analysis results not stored permanently</li>
                                    </ul>
                                    <strong>Transparency:</strong>
                                    <ul>
                                        <li>Customers informed when ticket is escalated (email notification)</li>
                                        <li>Privacy policy explains escalation process and SLA tracking</li>
                                        <li>Customers can view escalation history for their tickets</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 6(1)(f): Legitimate Interest<br>
                                    &nbsp;&nbsp; Section: Support Escalation Processing
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Data Retention for Escalations</h3>
                                <div class="gdpr-section">
                                    <strong>Article 5(1)(e) - Storage Limitation:</strong>
                                    <ul>
                                        <li><strong>Escalation Logs:</strong> Retained 12 months (compliance audit + quality improvement)</li>
                                        <li><strong>SLA Policies:</strong> Retained while active (business requirement)</li>
                                        <li><strong>Agent Workload:</strong> Real-time data, no historical retention</li>
                                        <li><strong>Escalation Rules:</strong> Retained while active (operational necessity)</li>
                                        <li><strong>Analytics Data:</strong> Anonymized and retained 2 years (trend analysis)</li>
                                    </ul>
                                    <strong>Automated Deletion (Lambda Function):</strong>
                                    <ul>
                                        <li>Quarterly job: Delete escalation_logs older than 12 months</li>
                                        <li>Nightly job: Clean up orphaned escalation records (tickets deleted)</li>
                                        <li>CloudWatch alarm if deletion job fails</li>
                                        <li>Audit trail of deletions maintained (compliance proof)</li>
                                    </ul>
                                    <strong>Legal Basis for Retention:</strong>
                                    <ul>
                                        <li>Quality assurance (demonstrate SLA compliance)</li>
                                        <li>Training and improvement (identify escalation patterns)</li>
                                        <li>Regulatory compliance (consumer protection laws)</li>
                                        <li>Documented in privacy policy with clear retention periods</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 5(1)(e): Storage Limitation<br>
                                    &nbsp;&nbsp; Section: Escalation Log Retention
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Agent Data Protection</h3>
                                <div class="gdpr-section">
                                    <strong>Employee Data Processing (Agents):</strong>
                                    <ul>
                                        <li>Agent workload monitoring necessary for workload management (employment contract)</li>
                                        <li>Performance metrics (response time, resolution time) for fair evaluation</li>
                                        <li>Skill assignments based on training and certifications</li>
                                        <li>Availability tracking for shift management (legitimate business interest)</li>
                                        <li>Agents informed of monitoring in employment agreement</li>
                                    </ul>
                                    <strong>Agent Rights:</strong>
                                    <ul>
                                        <li><strong>Right of Access:</strong> Agents can view their performance metrics</li>
                                        <li><strong>Right to Rectification:</strong> Agents can update skill assignments</li>
                                        <li><strong>Right to Object:</strong> Agents can object to unfair performance metrics</li>
                                        <li>Manager reviews complaints and adjusts metrics if needed</li>
                                    </ul>
                                    <strong>Data Minimization for Agents:</strong>
                                    <ul>
                                        <li>Only track performance metrics relevant to job function</li>
                                        <li>No invasive monitoring (screen recording, keystroke logging)</li>
                                        <li>Workload data aggregated (ticket count, not content)</li>
                                        <li>Availability status agent-controlled (manual status updates)</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 88: Employee Data Processing<br>
                                    &nbsp;&nbsp; Section: Agent Performance Monitoring
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Third-Party Notification Services</h3>
                                <div class="gdpr-section">
                                    <strong>Article 28 - Processor Agreements:</strong>
                                    <ul>
                                        <li><strong>Slack:</strong> DPA signed for team notifications</li>
                                        <li><strong>Twilio:</strong> DPA signed for SMS escalation alerts</li>
                                        <li><strong>PagerDuty:</strong> DPA signed for on-call escalations</li>
                                        <li><strong>Firebase (Google):</strong> DPA for push notifications</li>
                                        <li><strong>AWS SNS/SES:</strong> AWS GDPR Data Processing Addendum in place</li>
                                        <li>All processors: EU/US Data Privacy Framework certified</li>
                                    </ul>
                                    <strong>Data Minimization in Notifications:</strong>
                                    <ul>
                                        <li>Notifications contain only necessary info (ticket ID, priority, SLA status)</li>
                                        <li>No customer PII in notification messages (name/email redacted)</li>
                                        <li>Agent names only visible to authorized team members</li>
                                        <li>Notification content encrypted in transit (TLS 1.3)</li>
                                    </ul>
                                    <strong>Security of Notifications:</strong>
                                    <ul>
                                        <li>Slack webhook URLs stored in Secrets Manager (encrypted)</li>
                                        <li>SMS notifications sent only to verified phone numbers</li>
                                        <li>Push notification tokens encrypted at rest</li>
                                        <li>Notification history retained 90 days (audit trail)</li>
                                    </ul>
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Chapter 8: Third-Party Data Processors<br>
                                    &nbsp;&nbsp; Section: Notification Services
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 13 -->

            <!-- FRAME 14: CAMPAIGN AUTOMATION - A/B TESTING & ADVANCED SEGMENTATION -->
            <div class="frame" id="frame14">
                <div class="frame-title">
                    FRAME 14: CAMPAIGN AUTOMATION - A/B TESTING & ADVANCED SEGMENTATION ENGINE
                </div>
                <div class="frame-subtitle">
                    A/B Testing | Multivariate Testing | Winner Detection | Advanced Segmentation | Audience Builder | Contact Filters | Smart Segments
                </div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #D4E9E2;"></div>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FFF9E6;"></div>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #B7E4C7;"></div>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">
                        👤 SWIM LANE 1: A/B TESTING & SEGMENTATION USER ACTIONS
                    </div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. Create A/B Test</h3>
                                <ul>
                                    <li>Select campaign to test</li>
                                    <li>Choose test type (A/B or multivariate)</li>
                                    <li>Define variants (subject line, content, send time)</li>
                                    <li>Set traffic split % (e.g., 50/50, 33/33/33)</li>
                                    <li>Set winning metric (open rate, click rate, conversion)</li>
                                    <li>Define test duration & sample size</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Build Advanced Segment</h3>
                                <ul>
                                    <li>Name segment (e.g., "High-value inactive users")</li>
                                    <li>Add filter conditions (demographics, behavior, engagement)</li>
                                    <li>Use Boolean logic (AND/OR/NOT groups)</li>
                                    <li>Set dynamic refresh (real-time, daily, weekly)</li>
                                    <li>Preview segment size</li>
                                    <li>Save & activate segment</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Monitor Test Results</h3>
                                <ul>
                                    <li>View real-time test performance</li>
                                    <li>Compare variant metrics (opens, clicks, conversions)</li>
                                    <li>Check statistical significance</li>
                                    <li>Declare manual winner OR auto-winner (confidence threshold)</li>
                                    <li>Send winning variant to remaining audience</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Apply Segment to Campaign</h3>
                                <ul>
                                    <li>Select saved segment</li>
                                    <li>View segment count (refreshed)</li>
                                    <li>Apply exclusions (unsubscribed, bounced)</li>
                                    <li>Launch targeted campaign</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">
                        ⚙️ SWIM LANE 2: A/B TESTING & SEGMENTATION BACKEND SERVICES
                    </div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">
                            <div class="service-card">
                                <h3><span class="service-icon">🧪</span> A/B Test Engine Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/ab-tests/create - Create new A/B test<br>
                                        • <strong>GET</strong> /api/ab-tests/:id - Get test details & results<br>
                                        • <strong>PUT</strong> /api/ab-tests/:id/variants - Add/edit variants<br>
                                        • <strong>POST</strong> /api/ab-tests/:id/start - Start test execution<br>
                                        • <strong>POST</strong> /api/ab-tests/:id/declare-winner - Manually declare winner<br>
                                        • <strong>GET</strong> /api/ab-tests/:id/significance - Calculate statistical significance
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Core Logic:</div>
                                    <div class="section-content">
                                        • Traffic splitting algorithm (weighted distribution)<br>
                                        • Variant assignment (consistent per contact)<br>
                                        • Test orchestration (queue variants to SQS)<br>
                                        • Test duration management (auto-end after X hours)
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📊</span> Variant Performance Tracker Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/variants/:id/track-send - Track variant sent<br>
                                        • <strong>POST</strong> /api/variants/:id/track-open - Track variant opened<br>
                                        • <strong>POST</strong> /api/variants/:id/track-click - Track variant clicked<br>
                                        • <strong>POST</strong> /api/variants/:id/track-conversion - Track variant conversion<br>
                                        • <strong>GET</strong> /api/variants/:id/metrics - Get variant performance metrics
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Metrics Tracked:</div>
                                    <div class="section-content">
                                        • Sent count, delivered count, bounced count<br>
                                        • Open rate, click rate, conversion rate<br>
                                        • Unsubscribe rate, spam complaint rate<br>
                                        • Revenue per variant (if e-commerce tracking enabled)
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🏆</span> Winner Detection Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/winner/calculate - Calculate statistical significance<br>
                                        • <strong>POST</strong> /api/winner/auto-declare - Auto-declare winner (confidence ≥95%)<br>
                                        • <strong>GET</strong> /api/winner/:testId/recommendation - Get winner recommendation
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Winner Logic:</div>
                                    <div class="section-content">
                                        • Chi-square test for statistical significance<br>
                                        • Confidence level calculation (90%, 95%, 99%)<br>
                                        • Minimum sample size validation (≥100 opens per variant)<br>
                                        • Auto-send winner to remaining 50% of audience<br>
                                        • Test results stored for learning & optimization
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🎯</span> Advanced Segmentation Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/segments/create - Create new segment<br>
                                        • <strong>GET</strong> /api/segments/:id - Get segment details & count<br>
                                        • <strong>PUT</strong> /api/segments/:id/rules - Update segment rules<br>
                                        • <strong>POST</strong> /api/segments/:id/preview - Preview segment contacts<br>
                                        • <strong>POST</strong> /api/segments/:id/refresh - Manually refresh segment<br>
                                        • <strong>GET</strong> /api/segments/list - List all segments
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Segment Types:</div>
                                    <div class="section-content">
                                        • <strong>Static:</strong> Fixed list (snapshot in time)<br>
                                        • <strong>Dynamic:</strong> Auto-refresh based on rules<br>
                                        • <strong>Behavioral:</strong> Based on engagement actions<br>
                                        • <strong>Demographic:</strong> Based on contact properties<br>
                                        • <strong>RFM:</strong> Recency, frequency, monetary value
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🔍</span> Audience Builder Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/audience/filter - Apply complex filters<br>
                                        • <strong>POST</strong> /api/audience/count - Count matching contacts<br>
                                        • <strong>POST</strong> /api/audience/export - Export filtered contacts<br>
                                        • <strong>GET</strong> /api/audience/filters/available - Get available filter fields
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Filter Capabilities:</div>
                                    <div class="section-content">
                                        • <strong>Contact Properties:</strong> Name, email, phone, company, location<br>
                                        • <strong>Tags:</strong> Has tag, does not have tag<br>
                                        • <strong>Engagement:</strong> Opened email, clicked link, submitted form<br>
                                        • <strong>Lifecycle:</strong> Lead stage, customer status, churn risk<br>
                                        • <strong>Date Ranges:</strong> Created date, last activity, birthday<br>
                                        • <strong>Boolean Logic:</strong> AND/OR/NOT condition groups
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">⚡</span> Smart Segment Auto-Refresh Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/segments/:id/schedule-refresh - Schedule auto-refresh<br>
                                        • <strong>GET</strong> /api/segments/:id/refresh-history - Get refresh logs<br>
                                        • <strong>POST</strong> /api/segments/refresh-all - Refresh all dynamic segments
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Refresh Strategy:</div>
                                    <div class="section-content">
                                        • <strong>Real-time:</strong> Refresh on every query (small segments <10K)<br>
                                        • <strong>Hourly:</strong> EventBridge cron every hour<br>
                                        • <strong>Daily:</strong> EventBridge cron at 3am UTC<br>
                                        • <strong>Weekly:</strong> EventBridge cron Monday 3am UTC<br>
                                        • Segment cache invalidation (Redis TTL)<br>
                                        • Incremental refresh (only changed contacts)
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">
                        ☁️ SWIM LANE 3: AWS INFRASTRUCTURE FOR A/B TESTING & SEGMENTATION
                    </div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">
                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS Fargate" class="aws-icon">
                                    ECS Fargate
                                </h4>
                                <div class="section-content">
                                    <strong>Services:</strong><br>
                                    • ab-test-service (NestJS)<br>
                                    • variant-tracker-service (NestJS)<br>
                                    • winner-detection-service (Python/FastAPI)<br>
                                    • segmentation-service (NestJS)<br>
                                    • audience-builder-service (NestJS)<br><br>
                                    <strong>Scaling:</strong> Auto-scale 2-20 tasks (CPU >70% trigger)<br>
                                    <strong>Resources:</strong> 2 vCPU, 4 GB RAM per task
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS PostgreSQL" class="aws-icon">
                                    RDS PostgreSQL 15.4
                                </h4>
                                <div class="section-content">
                                    <strong>Tables:</strong><br>
                                    • ab_tests (test definitions)<br>
                                    • test_variants (variant configurations)<br>
                                    • variant_metrics (performance data)<br>
                                    • variant_assignments (contact → variant mapping)<br>
                                    • segments (segment definitions)<br>
                                    • segment_rules (filter conditions)<br>
                                    • segment_contacts (junction table)<br>
                                    • segment_refresh_logs (audit trail)<br><br>
                                    <strong>Instance:</strong> db.r6g.xlarge (4 vCPU, 32 GB RAM)<br>
                                    <strong>Multi-AZ:</strong> Yes (failover support)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache Redis" class="aws-icon">
                                    ElastiCache Redis
                                </h4>
                                <div class="section-content">
                                    <strong>Cluster Mode:</strong> Enabled (sharding)<br>
                                    <strong>Use Cases:</strong><br>
                                    • Variant assignment cache (contact_id → variant_id)<br>
                                    • Segment count cache (segment_id → count, TTL 1h)<br>
                                    • Test results cache (test_id → metrics, TTL 5min)<br>
                                    • Audience filter cache (filter_hash → contact_ids, TTL 15min)<br><br>
                                    <strong>Instance:</strong> cache.r6g.large (2 vCPU, 13.07 GB RAM)<br>
                                    <strong>Replication:</strong> 2 read replicas
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Queue-Service.svg" alt="SQS" class="aws-icon">
                                    SQS Queues
                                </h4>
                                <div class="section-content">
                                    <strong>Queues:</strong><br>
                                    1. <strong>ab-test-variant-queue</strong> - Variant send jobs (FIFO)<br>
                                    2. <strong>variant-tracking-queue</strong> - Event tracking (Standard)<br>
                                    3. <strong>winner-calculation-queue</strong> - Winner detection jobs (Standard)<br>
                                    4. <strong>segment-refresh-queue</strong> - Segment refresh jobs (Standard)<br><br>
                                    <strong>Retention:</strong> 14 days<br>
                                    <strong>Dead Letter Queue:</strong> Yes (3 retry attempts)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Compute/Lambda.svg" alt="Lambda" class="aws-icon">
                                    Lambda Functions
                                </h4>
                                <div class="section-content">
                                    <strong>Functions:</strong><br>
                                    1. <strong>variant-assignment-function</strong> - Assign contacts to variants (512MB RAM)<br>
                                    2. <strong>winner-detector-function</strong> - Calculate statistical significance (1GB RAM)<br>
                                    3. <strong>auto-winner-sender-function</strong> - Send winner to remaining audience (1GB RAM)<br>
                                    4. <strong>segment-refresh-function</strong> - Refresh dynamic segments (2GB RAM, 5min timeout)<br>
                                    5. <strong>segment-cleanup-function</strong> - Delete expired segments (512MB RAM)<br><br>
                                    <strong>Runtime:</strong> Node.js 20.x (TypeScript)<br>
                                    <strong>Concurrency:</strong> Reserved 50 concurrent executions
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Notification-Service.svg" alt="SNS" class="aws-icon">
                                    SNS Topics
                                </h4>
                                <div class="section-content">
                                    <strong>Topics:</strong><br>
                                    1. <strong>ab-test-started</strong> - Test started notification<br>
                                    2. <strong>ab-test-winner-declared</strong> - Winner declared notification<br>
                                    3. <strong>segment-refreshed</strong> - Segment refresh completed<br>
                                    4. <strong>segment-error</strong> - Segment refresh failed<br><br>
                                    <strong>Subscribers:</strong><br>
                                    • Email (user notifications)<br>
                                    • SQS (downstream processing)<br>
                                    • Lambda (event handlers)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/EventBridge.svg" alt="EventBridge" class="aws-icon">
                                    EventBridge Scheduled Jobs
                                </h4>
                                <div class="section-content">
                                    <strong>Cron Schedules:</strong><br>
                                    • <strong>hourly-segment-refresh:</strong> cron(0 * * * ? *) - Refresh hourly segments<br>
                                    • <strong>daily-segment-refresh:</strong> cron(0 3 * * ? *) - Refresh daily segments (3am UTC)<br>
                                    • <strong>weekly-segment-refresh:</strong> cron(0 3 ? * MON *) - Refresh weekly segments<br>
                                    • <strong>auto-winner-check:</strong> cron(*/15 * * * ? *) - Check for auto-winners (every 15min)<br>
                                    • <strong>test-expiration-check:</strong> cron(0 * * * ? *) - End expired tests (hourly)<br>
                                    • <strong>segment-cleanup:</strong> cron(0 4 * * ? *) - Delete expired segments (4am UTC)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Management-Governance/CloudWatch.svg" alt="CloudWatch" class="aws-icon">
                                    CloudWatch Monitoring
                                </h4>
                                <div class="section-content">
                                    <strong>Metrics:</strong><br>
                                    • Active A/B tests count<br>
                                    • Variant send rate (per minute)<br>
                                    • Winner detection time (avg)<br>
                                    • Segment refresh duration (avg)<br>
                                    • Segment size (min/max/avg)<br>
                                    • Audience builder query time<br><br>
                                    <strong>Alarms:</strong><br>
                                    • Winner detection failure (SNS alert)<br>
                                    • Segment refresh failure (SNS alert)<br>
                                    • Large segment query timeout (>30s)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Secrets-Manager.svg" alt="Secrets Manager" class="aws-icon">
                                    Secrets Manager
                                </h4>
                                <div class="section-content">
                                    <strong>Secrets Stored:</strong><br>
                                    • Database connection strings (RDS)<br>
                                    • Redis connection string (ElastiCache)<br>
                                    • OpenAI API key (for BeeBot segment suggestions)<br>
                                    • External analytics API keys (Google Analytics, Mixpanel)<br><br>
                                    <strong>Encryption:</strong> AWS KMS (AES-256)<br>
                                    <strong>Rotation:</strong> Automatic every 90 days
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Storage/Simple-Storage-Service.svg" alt="S3" class="aws-icon">
                                    S3 Buckets
                                </h4>
                                <div class="section-content">
                                    <strong>Buckets:</strong><br>
                                    • <strong>segment-exports/</strong> - Exported segment contact lists (CSV, JSON)<br>
                                    • <strong>test-reports/</strong> - A/B test result reports (PDF, Excel)<br><br>
                                    <strong>Lifecycle Policy:</strong><br>
                                    • Transition to S3 Glacier after 90 days<br>
                                    • Delete after 2 years<br><br>
                                    <strong>Access:</strong> Pre-signed URLs (expiry 24h)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">
                        🗄️ SWIM LANE 4: DATABASE SCHEMA & RELATIONSHIPS
                    </div>
                    <div class="lane-content lane-data">

                        <!-- TABLE: ab_tests -->
                        <div class="db-table">
                            <div class="table-header">TABLE: ab_tests</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique test identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>campaignId</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → campaigns(id), NOT NULL</div>
                                    <div>Associated campaign being tested</div>
                                </div>
                                <div class="table-row">
                                    <div>testName</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Test name (e.g., "Subject Line Test - Welcome Email")</div>
                                </div>
                                <div class="table-row">
                                    <div>testType</div>
                                    <div>ENUM</div>
                                    <div>'ab', 'multivariate', NOT NULL</div>
                                    <div>Type of test (A/B or multivariate)</div>
                                </div>
                                <div class="table-row">
                                    <div>winningMetric</div>
                                    <div>ENUM</div>
                                    <div>'open_rate', 'click_rate', 'conversion_rate', 'revenue', NOT NULL</div>
                                    <div>Metric used to determine winner</div>
                                </div>
                                <div class="table-row">
                                    <div>trafficSplit</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Traffic split percentages (e.g., {"A": 50, "B": 50})</div>
                                </div>
                                <div class="table-row">
                                    <div>testDurationHours</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 24</div>
                                    <div>Test duration in hours (default 24h)</div>
                                </div>
                                <div class="table-row">
                                    <div>minSampleSize</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 100</div>
                                    <div>Minimum sample size per variant</div>
                                </div>
                                <div class="table-row">
                                    <div>confidenceThreshold</div>
                                    <div>DECIMAL(3,2)</div>
                                    <div>DEFAULT 0.95</div>
                                    <div>Confidence level for auto-winner (0.90, 0.95, 0.99)</div>
                                </div>
                                <div class="table-row">
                                    <div>autoSendWinner</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Auto-send winner to remaining audience</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>ENUM</div>
                                    <div>'draft', 'running', 'completed', 'cancelled', DEFAULT 'draft'</div>
                                    <div>Test status</div>
                                </div>
                                <div class="table-row">
                                    <div>winnerId</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → test_variants(id), NULLABLE</div>
                                    <div>Winning variant ID (NULL until winner declared)</div>
                                </div>
                                <div class="table-row">
                                    <div>startedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>Test start timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>endedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>Test end timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Test creation timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: test_variants -->
                        <div class="db-table">
                            <div class="table-header">TABLE: test_variants</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique variant identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>testId</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → ab_tests(id), NOT NULL, INDEX</div>
                                    <div>Parent test</div>
                                </div>
                                <div class="table-row">
                                    <div>variantName</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NOT NULL</div>
                                    <div>Variant name (e.g., "Variant A", "Control")</div>
                                </div>
                                <div class="table-row">
                                    <div>variantLetter</div>
                                    <div>VARCHAR(1)</div>
                                    <div>NOT NULL</div>
                                    <div>Variant letter (A, B, C, etc.)</div>
                                </div>
                                <div class="table-row">
                                    <div>isControl</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Is this the control variant?</div>
                                </div>
                                <div class="table-row">
                                    <div>subjectLine</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Email subject line (if testing subject)</div>
                                </div>
                                <div class="table-row">
                                    <div>preheaderText</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Email preheader (if testing preheader)</div>
                                </div>
                                <div class="table-row">
                                    <div>emailContentId</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → emails(id), NULLABLE</div>
                                    <div>Email content (if testing content)</div>
                                </div>
                                <div class="table-row">
                                    <div>sendTime</div>
                                    <div>TIME</div>
                                    <div>NULLABLE</div>
                                    <div>Send time (if testing send time)</div>
                                </div>
                                <div class="table-row">
                                    <div>fromName</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NULLABLE</div>
                                    <div>Sender name (if testing from name)</div>
                                </div>
                                <div class="table-row">
                                    <div>trafficPercentage</div>
                                    <div>DECIMAL(5,2)</div>
                                    <div>NOT NULL</div>
                                    <div>Traffic percentage allocated (e.g., 50.00)</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Variant creation timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: variant_metrics -->
                        <div class="db-table">
                            <div class="table-header">TABLE: variant_metrics (Partitioned by Month)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>BIGSERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique metric record ID</div>
                                </div>
                                <div class="table-row">
                                    <div>variantId</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → test_variants(id), NOT NULL, INDEX</div>
                                    <div>Variant being tracked</div>
                                </div>
                                <div class="table-row">
                                    <div>sentCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Total emails sent for this variant</div>
                                </div>
                                <div class="table-row">
                                    <div>deliveredCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Successfully delivered emails</div>
                                </div>
                                <div class="table-row">
                                    <div>bouncedCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Bounced emails</div>
                                </div>
                                <div class="table-row">
                                    <div>openedCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Unique opens</div>
                                </div>
                                <div class="table-row">
                                    <div>clickedCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Unique clicks</div>
                                </div>
                                <div class="table-row">
                                    <div>convertedCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Conversions (goal completions)</div>
                                </div>
                                <div class="table-row">
                                    <div>unsubscribedCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Unsubscribes from this variant</div>
                                </div>
                                <div class="table-row">
                                    <div>spamComplaintCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Spam complaints</div>
                                </div>
                                <div class="table-row">
                                    <div>revenue</div>
                                    <div>DECIMAL(10,2)</div>
                                    <div>DEFAULT 0.00</div>
                                    <div>Total revenue attributed to variant (if e-commerce)</div>
                                </div>
                                <div class="table-row">
                                    <div>openRate</div>
                                    <div>DECIMAL(5,2)</div>
                                    <div>GENERATED ALWAYS AS (CASE WHEN deliveredCount > 0 THEN (openedCount::DECIMAL / deliveredCount) * 100 ELSE 0 END) STORED</div>
                                    <div>Calculated open rate %</div>
                                </div>
                                <div class="table-row">
                                    <div>clickRate</div>
                                    <div>DECIMAL(5,2)</div>
                                    <div>GENERATED ALWAYS AS (CASE WHEN deliveredCount > 0 THEN (clickedCount::DECIMAL / deliveredCount) * 100 ELSE 0 END) STORED</div>
                                    <div>Calculated click rate %</div>
                                </div>
                                <div class="table-row">
                                    <div>conversionRate</div>
                                    <div>DECIMAL(5,2)</div>
                                    <div>GENERATED ALWAYS AS (CASE WHEN deliveredCount > 0 THEN (convertedCount::DECIMAL / deliveredCount) * 100 ELSE 0 END) STORED</div>
                                    <div>Calculated conversion rate %</div>
                                </div>
                                <div class="table-row">
                                    <div>lastUpdatedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last metric update timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Metric record creation (partition key for monthly partitions)</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: segments -->
                        <div class="db-table">
                            <div class="table-header">TABLE: segments</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique segment identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>userId</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → users(id), NOT NULL, INDEX</div>
                                    <div>Segment owner</div>
                                </div>
                                <div class="table-row">
                                    <div>segmentName</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Segment name (e.g., "High-value inactive users")</div>
                                </div>
                                <div class="table-row">
                                    <div>segmentType</div>
                                    <div>ENUM</div>
                                    <div>'static', 'dynamic', 'behavioral', 'demographic', 'rfm', NOT NULL</div>
                                    <div>Segment type</div>
                                </div>
                                <div class="table-row">
                                    <div>refreshStrategy</div>
                                    <div>ENUM</div>
                                    <div>'realtime', 'hourly', 'daily', 'weekly', 'manual', DEFAULT 'daily'</div>
                                    <div>How often segment refreshes</div>
                                </div>
                                <div class="table-row">
                                    <div>contactCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Current number of contacts in segment (cached)</div>
                                </div>
                                <div class="table-row">
                                    <div>isActive</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Is segment active?</div>
                                </div>
                                <div class="table-row">
                                    <div>lastRefreshedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>Last segment refresh timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Segment creation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>updatedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last segment update timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: segment_rules -->
                        <div class="db-table">
                            <div class="table-header">TABLE: segment_rules</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique rule identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>segmentId</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → segments(id) ON DELETE CASCADE, NOT NULL, INDEX</div>
                                    <div>Parent segment</div>
                                </div>
                                <div class="table-row">
                                    <div>groupIndex</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL, DEFAULT 0</div>
                                    <div>Rule group index (for AND/OR grouping)</div>
                                </div>
                                <div class="table-row">
                                    <div>groupLogic</div>
                                    <div>ENUM</div>
                                    <div>'AND', 'OR', DEFAULT 'AND'</div>
                                    <div>Logic within this group (AND/OR)</div>
                                </div>
                                <div class="table-row">
                                    <div>fieldName</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Contact field being filtered (e.g., "email", "tags", "lastActivityDate")</div>
                                </div>
                                <div class="table-row">
                                    <div>operator</div>
                                    <div>ENUM</div>
                                    <div>'equals', 'not_equals', 'contains', 'not_contains', 'starts_with', 'ends_with', 'greater_than', 'less_than', 'is_empty', 'is_not_empty', 'in', 'not_in', NOT NULL</div>
                                    <div>Comparison operator</div>
                                </div>
                                <div class="table-row">
                                    <div>filterValue</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Filter value (e.g., "VIP", "30", "2024-01-01")</div>
                                </div>
                                <div class="table-row">
                                    <div>filterValueType</div>
                                    <div>ENUM</div>
                                    <div>'string', 'number', 'date', 'boolean', 'array', NOT NULL</div>
                                    <div>Data type of filter value</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Rule creation timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: segment_contacts -->
                        <div class="db-table">
                            <div class="table-header">TABLE: segment_contacts (Junction Table)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>BIGSERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique junction record ID</div>
                                </div>
                                <div class="table-row">
                                    <div>segmentId</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → segments(id) ON DELETE CASCADE, NOT NULL, INDEX</div>
                                    <div>Segment</div>
                                </div>
                                <div class="table-row">
                                    <div>contactId</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → contacts(id) ON DELETE CASCADE, NOT NULL, INDEX</div>
                                    <div>Contact in segment</div>
                                </div>
                                <div class="table-row">
                                    <div>addedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>When contact was added to segment</div>
                                </div>
                                <div class="table-row">
                                    <div>CONSTRAINT</div>
                                    <div>UNIQUE</div>
                                    <div>UNIQUE(segmentId, contactId)</div>
                                    <div>Prevent duplicate segment memberships</div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">
                        🛡️ SWIM LANE 5: GDPR COMPLIANCE FOR A/B TESTING & SEGMENTATION
                    </div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">
                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> A/B Testing Data Processing</h3>
                                <div class="gdpr-section">
                                    <strong>Article 6(1)(f) - Legitimate Interest:</strong>
                                    <ul style="margin-top: 8px; padding-left: 20px;">
                                        <li><strong>Purpose:</strong> Optimize email campaign performance (legitimate business interest)</li>
                                        <li><strong>Transparency:</strong> Privacy policy discloses A/B testing practices</li>
                                        <li><strong>Contact Rights:</strong> Contacts can opt-out of marketing emails (unsubscribe)</li>
                                        <li><strong>Variant Assignment:</strong> Randomized, no discriminatory profiling</li>
                                        <li><strong>Balancing Test:</strong> Performance optimization vs. contact privacy (minimal impact)</li>
                                    </ul>
                                </div>
                                <div class="gdpr-section" style="margin-top: 15px;">
                                    <strong>Data Collected:</strong><br>
                                    • Variant assigned (A, B, C)<br>
                                    • Email engagement metrics (opens, clicks, conversions)<br>
                                    • Test performance data (aggregate metrics)
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 6: Lawful Basis for Processing<br>
                                    &nbsp;&nbsp; Section: Legitimate Interest (Line 850)
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Segmentation Data Retention</h3>
                                <div class="gdpr-section">
                                    <strong>Data Retention Policy:</strong>
                                    <ul style="margin-top: 8px; padding-left: 20px;">
                                        <li><strong>Active Segments:</strong> Retained while segment is active</li>
                                        <li><strong>Deleted Segments:</strong> Hard delete within 30 days (segment_contacts junction table)</li>
                                        <li><strong>Segment Rules:</strong> Retained for 90 days after segment deletion (audit trail)</li>
                                        <li><strong>Segment Refresh Logs:</strong> Retained for 90 days (troubleshooting)</li>
                                        <li><strong>A/B Test Results:</strong> Retained for 2 years (anonymized aggregate data)</li>
                                        <li><strong>Variant Assignments:</strong> Deleted after 180 days (individual contact data)</li>
                                    </ul>
                                </div>
                                <div class="gdpr-section" style="margin-top: 15px;">
                                    <strong>Automated Deletion:</strong><br>
                                    • Lambda function: <code>segment-cleanup-function</code> (daily at 4am UTC)<br>
                                    • Lambda function: <code>test-data-cleanup-function</code> (weekly)
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: Data Retention (Line 1678)
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Segmentation Export & Portability</h3>
                                <div class="gdpr-section">
                                    <strong>Article 20: Right to Data Portability:</strong>
                                    <ul style="margin-top: 8px; padding-left: 20px;">
                                        <li><strong>Export Segments:</strong> User can export segment definitions (JSON)</li>
                                        <li><strong>Export Contact Lists:</strong> Download contacts in segment (CSV, JSON)</li>
                                        <li><strong>Export A/B Test Results:</strong> Download test performance reports (PDF, Excel)</li>
                                        <li><strong>Segment Rules Export:</strong> All filter conditions & Boolean logic included</li>
                                        <li><strong>Format:</strong> Machine-readable (CSV, JSON) + human-readable (PDF)</li>
                                    </ul>
                                </div>
                                <div class="gdpr-section" style="margin-top: 15px;">
                                    <strong>Export Mechanism:</strong><br>
                                    • API endpoint: <code>POST /api/segments/:id/export</code><br>
                                    • Storage: S3 bucket <code>segment-exports/</code><br>
                                    • Access: Pre-signed URL (24h expiry)
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 20: Right to Data Portability
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Segmentation Deletion & Erasure</h3>
                                <div class="gdpr-section">
                                    <strong>Article 17: Right to Erasure:</strong>
                                    <ul style="margin-top: 8px; padding-left: 20px;">
                                        <li><strong>Delete Contact from Segment:</strong> Remove from segment_contacts table (instant)</li>
                                        <li><strong>Delete Entire Segment:</strong> Cascade delete segment_contacts (ON DELETE CASCADE)</li>
                                        <li><strong>Delete Contact Account:</strong> Remove from all segments automatically (CASCADE)</li>
                                        <li><strong>Anonymize A/B Test Data:</strong> Replace contact_id with NULL in variant_assignments</li>
                                        <li><strong>Preserve Aggregate Metrics:</strong> Test results anonymized (no PII)</li>
                                    </ul>
                                </div>
                                <div class="gdpr-section" style="margin-top: 15px;">
                                    <strong>Deletion Workflow:</strong><br>
                                    1. User requests deletion (Right to Erasure)<br>
                                    2. Remove contact from all segments (junction table)<br>
                                    3. Anonymize variant assignments (contact_id → NULL)<br>
                                    4. Preserve aggregate test metrics (no PII)
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 17: Right to Erasure<br>
                                    &nbsp;&nbsp; Section: Anonymization vs Deletion (Line 1340)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 14 -->

            <!-- FRAME 15: CAMPAIGN AUTOMATION - ANALYTICS & PERFORMANCE REPORTING -->
            <div class="frame" id="frame15">
                <div class="frame-title">
                    FRAME 15: CAMPAIGN AUTOMATION - ANALYTICS & PERFORMANCE REPORTING DASHBOARD
                </div>
                <div class="frame-subtitle">
                    Campaign Analytics | Performance Dashboards | Real-time Metrics | Report Generation | Data Aggregation | Export | Custom Dashboards | KPI Tracking
                </div>

                <!-- LEGEND -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>User Actions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #D4E9E2;"></div>
                        <span>Backend Services</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FFF9E6;"></div>
                        <span>AWS Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #B7E4C7;"></div>
                        <span>Data Storage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #E8F5E9;"></div>
                        <span>GDPR Compliance</span>
                    </div>
                </div>

                <!-- SWIM LANE 1: USER ACTIONS -->
                <div class="swim-lane">
                    <div class="lane-header lane-user">
                        👤 SWIM LANE 1: ANALYTICS & REPORTING USER ACTIONS
                    </div>
                    <div class="lane-content lane-user">
                        <div class="step-container">
                            <div class="step-box">
                                <h3>1. View Campaign Dashboard</h3>
                                <ul>
                                    <li>View overview dashboard (all campaigns)</li>
                                    <li>See real-time metrics (sent, delivered, opened, clicked)</li>
                                    <li>View campaign performance trends (last 7/30/90 days)</li>
                                    <li>Compare campaign performance (best/worst performers)</li>
                                    <li>View engagement heatmap (by time/day)</li>
                                    <li>Monitor active campaigns (live status)</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>2. Drill into Campaign Details</h3>
                                <ul>
                                    <li>Select specific campaign</li>
                                    <li>View detailed metrics (opens, clicks, conversions, revenue)</li>
                                    <li>See geographic distribution (clicks by location)</li>
                                    <li>View device breakdown (desktop, mobile, tablet)</li>
                                    <li>Analyze link performance (click map)</li>
                                    <li>View email client breakdown (Gmail, Outlook, Apple Mail)</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>3. Generate Custom Report</h3>
                                <ul>
                                    <li>Select report type (campaign, automation, contact engagement)</li>
                                    <li>Choose date range (custom or preset)</li>
                                    <li>Select metrics to include (open rate, click rate, ROI)</li>
                                    <li>Add filters (campaign type, tags, status)</li>
                                    <li>Preview report</li>
                                    <li>Generate & download (PDF, Excel, CSV)</li>
                                </ul>
                            </div>
                            <div class="step-box">
                                <h3>4. Create Custom Dashboard</h3>
                                <ul>
                                    <li>Name custom dashboard</li>
                                    <li>Add widgets (charts, tables, KPIs)</li>
                                    <li>Configure widget data sources</li>
                                    <li>Set refresh frequency (real-time, hourly, daily)</li>
                                    <li>Save & share dashboard with team</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 2: BACKEND SERVICES -->
                <div class="swim-lane">
                    <div class="lane-header lane-backend">
                        ⚙️ SWIM LANE 2: ANALYTICS & REPORTING BACKEND SERVICES
                    </div>
                    <div class="lane-content lane-backend">
                        <div class="service-grid">
                            <div class="service-card">
                                <h3><span class="service-icon">📊</span> Campaign Analytics Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>GET</strong> /api/analytics/dashboard - Get overview dashboard data<br>
                                        • <strong>GET</strong> /api/analytics/campaign/:id - Get campaign-specific analytics<br>
                                        • <strong>GET</strong> /api/analytics/campaigns/compare - Compare multiple campaigns<br>
                                        • <strong>GET</strong> /api/analytics/trends - Get performance trends (time series)<br>
                                        • <strong>GET</strong> /api/analytics/engagement-heatmap - Get engagement by time/day<br>
                                        • <strong>GET</strong> /api/analytics/top-performers - Get top/bottom performing campaigns
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Metrics Calculated:</div>
                                    <div class="section-content">
                                        • <strong>Delivery Metrics:</strong> Sent, delivered, bounced, failed<br>
                                        • <strong>Engagement Metrics:</strong> Open rate, click rate, CTOR (click-to-open rate)<br>
                                        • <strong>Conversion Metrics:</strong> Conversion rate, revenue, ROI<br>
                                        • <strong>Behavioral Metrics:</strong> Avg time to open, avg time to click<br>
                                        • <strong>Audience Metrics:</strong> Reach, frequency, unique contacts
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📈</span> Performance Dashboard Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>GET</strong> /api/dashboards/list - Get all user dashboards<br>
                                        • <strong>POST</strong> /api/dashboards/create - Create custom dashboard<br>
                                        • <strong>GET</strong> /api/dashboards/:id - Get dashboard configuration & data<br>
                                        • <strong>PUT</strong> /api/dashboards/:id/widgets - Update dashboard widgets<br>
                                        • <strong>DELETE</strong> /api/dashboards/:id - Delete dashboard<br>
                                        • <strong>POST</strong> /api/dashboards/:id/share - Share dashboard with team
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Widget Types:</div>
                                    <div class="section-content">
                                        • <strong>KPI Card:</strong> Single metric with trend indicator<br>
                                        • <strong>Line Chart:</strong> Time series performance trends<br>
                                        • <strong>Bar Chart:</strong> Compare campaigns or segments<br>
                                        • <strong>Pie Chart:</strong> Distribution (e.g., device breakdown)<br>
                                        • <strong>Table:</strong> Detailed campaign list with metrics<br>
                                        • <strong>Heatmap:</strong> Engagement by time/day<br>
                                        • <strong>Funnel Chart:</strong> Conversion funnel visualization<br>
                                        • <strong>Geographic Map:</strong> Click distribution by location
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">📄</span> Report Generation Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/reports/generate - Generate custom report<br>
                                        • <strong>GET</strong> /api/reports/:id - Get report status & download link<br>
                                        • <strong>GET</strong> /api/reports/templates - Get report templates<br>
                                        • <strong>POST</strong> /api/reports/schedule - Schedule recurring report<br>
                                        • <strong>GET</strong> /api/reports/scheduled - Get all scheduled reports<br>
                                        • <strong>DELETE</strong> /api/reports/scheduled/:id - Delete scheduled report
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Report Types:</div>
                                    <div class="section-content">
                                        • <strong>Campaign Summary:</strong> Overview of all campaigns (date range)<br>
                                        • <strong>Campaign Deep Dive:</strong> Detailed single campaign analysis<br>
                                        • <strong>A/B Test Report:</strong> Test performance comparison<br>
                                        • <strong>Automation Performance:</strong> All automation workflows<br>
                                        • <strong>Contact Engagement:</strong> Contact-level engagement metrics<br>
                                        • <strong>Revenue Report:</strong> E-commerce sales attribution<br>
                                        • <strong>Deliverability Report:</strong> Bounce/spam complaint analysis<br>
                                        • <strong>Executive Summary:</strong> High-level KPIs for leadership
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">⚡</span> Real-time Metrics Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>GET</strong> /api/metrics/realtime/campaign/:id - Get live campaign metrics<br>
                                        • <strong>GET</strong> /api/metrics/realtime/active-campaigns - All active campaigns<br>
                                        • <strong>WebSocket</strong> /ws/metrics/:campaignId - Stream real-time updates<br>
                                        • <strong>GET</strong> /api/metrics/live-dashboard - Live dashboard data (5s refresh)
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Real-time Data:</div>
                                    <div class="section-content">
                                        • <strong>Send Rate:</strong> Emails sent per minute (live graph)<br>
                                        • <strong>Open Rate:</strong> Opens in last 5 minutes (streaming)<br>
                                        • <strong>Click Rate:</strong> Clicks in last 5 minutes (streaming)<br>
                                        • <strong>Live Activity Feed:</strong> Recent opens/clicks (scrolling feed)<br>
                                        • <strong>Campaign Progress:</strong> % completion for active sends<br>
                                        • <strong>Server Health:</strong> Queue depth, processing rate
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">🔢</span> Data Aggregation Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/aggregation/campaign/:id/aggregate - Trigger manual aggregation<br>
                                        • <strong>GET</strong> /api/aggregation/status - Get aggregation job status<br>
                                        • <strong>GET</strong> /api/aggregation/history - Get aggregation history logs
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Aggregation Strategy:</div>
                                    <div class="section-content">
                                        • <strong>Hourly Aggregation:</strong> Roll up metrics every hour (campaign_metrics_hourly)<br>
                                        • <strong>Daily Aggregation:</strong> Daily summary at 3am UTC (campaign_metrics_daily)<br>
                                        • <strong>Monthly Aggregation:</strong> Monthly summary on 1st of month (campaign_metrics_monthly)<br>
                                        • <strong>Incremental Updates:</strong> Only process new events since last aggregation<br>
                                        • <strong>Lambda Function:</strong> Triggered by EventBridge (hourly, daily, monthly)<br>
                                        • <strong>Performance:</strong> Aggregation completes in <5min for 1M events
                                    </div>
                                </div>
                            </div>

                            <div class="service-card">
                                <h3><span class="service-icon">💾</span> Export Service</h3>
                                <div class="section">
                                    <div class="section-title">API Endpoints:</div>
                                    <div class="section-content">
                                        • <strong>POST</strong> /api/export/analytics - Export analytics data<br>
                                        • <strong>POST</strong> /api/export/campaign/:id - Export campaign data<br>
                                        • <strong>GET</strong> /api/export/:jobId/status - Get export job status<br>
                                        • <strong>GET</strong> /api/export/:jobId/download - Download exported file<br>
                                        • <strong>GET</strong> /api/export/history - Get export history
                                    </div>
                                </div>
                                <div class="section">
                                    <div class="section-title">Export Formats:</div>
                                    <div class="section-content">
                                        • <strong>CSV:</strong> Tabular data (metrics, campaign lists)<br>
                                        • <strong>Excel (XLSX):</strong> Multi-sheet reports with charts<br>
                                        • <strong>PDF:</strong> Formatted reports with branding<br>
                                        • <strong>JSON:</strong> Raw data for API integration<br>
                                        • <strong>Google Sheets:</strong> Direct export to Google Sheets (OAuth)<br>
                                        • <strong>Export Size Limit:</strong> 100MB per export (paginated for larger datasets)
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 3: AWS INFRASTRUCTURE -->
                <div class="swim-lane">
                    <div class="lane-header lane-aws">
                        ☁️ SWIM LANE 3: AWS INFRASTRUCTURE FOR ANALYTICS & REPORTING
                    </div>
                    <div class="lane-content lane-aws">
                        <div class="aws-grid">
                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Containers/Elastic-Container-Service.svg" alt="ECS Fargate" class="aws-icon">
                                    ECS Fargate
                                </h4>
                                <div class="section-content">
                                    <strong>Services:</strong><br>
                                    • campaign-analytics-service (NestJS)<br>
                                    • dashboard-service (NestJS)<br>
                                    • report-generation-service (NestJS + Puppeteer for PDF)<br>
                                    • realtime-metrics-service (NestJS + WebSocket)<br>
                                    • export-service (NestJS)<br><br>
                                    <strong>Scaling:</strong> Auto-scale 2-20 tasks (CPU >70% trigger)<br>
                                    <strong>Resources:</strong> 2 vCPU, 4 GB RAM per task (8 GB for report-generation)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/RDS.svg" alt="RDS PostgreSQL" class="aws-icon">
                                    RDS PostgreSQL 15.4
                                </h4>
                                <div class="section-content">
                                    <strong>Tables:</strong><br>
                                    • campaign_metrics_hourly (time-series aggregates, partitioned by month)<br>
                                    • campaign_metrics_daily (daily aggregates)<br>
                                    • campaign_metrics_monthly (monthly aggregates)<br>
                                    • custom_dashboards (user dashboard configurations)<br>
                                    • dashboard_widgets (widget definitions)<br>
                                    • scheduled_reports (recurring report configs)<br>
                                    • export_jobs (export job tracking)<br>
                                    • report_history (generated report metadata)<br><br>
                                    <strong>Read Replicas:</strong> 2 replicas for read-heavy analytics queries<br>
                                    <strong>Query Optimization:</strong> Materialized views for expensive aggregations
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Database/ElastiCache.svg" alt="ElastiCache Redis" class="aws-icon">
                                    ElastiCache Redis
                                </h4>
                                <div class="section-content">
                                    <strong>Cluster Mode:</strong> Enabled (sharding)<br>
                                    <strong>Use Cases:</strong><br>
                                    • Dashboard data cache (dashboard_id → data, TTL 5min)<br>
                                    • Real-time metrics cache (campaign_id → metrics, TTL 10s)<br>
                                    • Report preview cache (report_hash → preview_data, TTL 1h)<br>
                                    • Aggregation lock (prevent duplicate aggregation jobs)<br>
                                    • WebSocket connection pool (socket_id → user_id mapping)<br><br>
                                    <strong>Instance:</strong> cache.r6g.xlarge (4 vCPU, 26.32 GB RAM)<br>
                                    <strong>Replication:</strong> 2 read replicas (high availability)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Queue-Service.svg" alt="SQS" class="aws-icon">
                                    SQS Queues
                                </h4>
                                <div class="section-content">
                                    <strong>Queues:</strong><br>
                                    1. <strong>analytics-aggregation-queue</strong> - Aggregation jobs (Standard)<br>
                                    2. <strong>report-generation-queue</strong> - Report generation jobs (Standard)<br>
                                    3. <strong>export-processing-queue</strong> - Export jobs (Standard)<br>
                                    4. <strong>dashboard-refresh-queue</strong> - Dashboard data refresh (Standard)<br><br>
                                    <strong>Retention:</strong> 14 days<br>
                                    <strong>Dead Letter Queue:</strong> Yes (3 retry attempts)<br>
                                    <strong>Visibility Timeout:</strong> 15 minutes (long-running reports)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Compute/Lambda.svg" alt="Lambda" class="aws-icon">
                                    Lambda Functions
                                </h4>
                                <div class="section-content">
                                    <strong>Functions:</strong><br>
                                    1. <strong>hourly-aggregation-function</strong> - Hourly metric aggregation (2GB RAM, 5min timeout)<br>
                                    2. <strong>daily-aggregation-function</strong> - Daily metric aggregation (3GB RAM, 10min timeout)<br>
                                    3. <strong>monthly-aggregation-function</strong> - Monthly metric aggregation (3GB RAM, 10min timeout)<br>
                                    4. <strong>report-generator-function</strong> - Generate PDF/Excel reports (4GB RAM, 15min timeout)<br>
                                    5. <strong>export-processor-function</strong> - Process large data exports (4GB RAM, 15min timeout)<br>
                                    6. <strong>dashboard-snapshot-function</strong> - Create dashboard snapshots (1GB RAM)<br><br>
                                    <strong>Runtime:</strong> Node.js 20.x (TypeScript) + Chromium (Puppeteer for PDF)<br>
                                    <strong>Concurrency:</strong> Reserved 100 concurrent executions
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/Simple-Notification-Service.svg" alt="SNS" class="aws-icon">
                                    SNS Topics
                                </h4>
                                <div class="section-content">
                                    <strong>Topics:</strong><br>
                                    1. <strong>report-generated</strong> - Report generation completed<br>
                                    2. <strong>export-completed</strong> - Export job completed<br>
                                    3. <strong>aggregation-completed</strong> - Aggregation job completed<br>
                                    4. <strong>aggregation-failed</strong> - Aggregation job failed (alert)<br><br>
                                    <strong>Subscribers:</strong><br>
                                    • Email (user notifications for report downloads)<br>
                                    • SQS (downstream processing)<br>
                                    • Lambda (event handlers)<br>
                                    • Slack webhook (team notifications)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/App-Integration/EventBridge.svg" alt="EventBridge" class="aws-icon">
                                    EventBridge Scheduled Jobs
                                </h4>
                                <div class="section-content">
                                    <strong>Cron Schedules:</strong><br>
                                    • <strong>hourly-aggregation:</strong> cron(5 * * * ? *) - Run at :05 every hour<br>
                                    • <strong>daily-aggregation:</strong> cron(0 3 * * ? *) - Run at 3am UTC daily<br>
                                    • <strong>monthly-aggregation:</strong> cron(0 4 1 * ? *) - Run 1st of month at 4am UTC<br>
                                    • <strong>weekly-report-digest:</strong> cron(0 9 ? * MON *) - Monday 9am UTC<br>
                                    • <strong>dashboard-snapshot:</strong> cron(0 2 * * ? *) - Daily dashboard backups at 2am UTC<br>
                                    • <strong>export-cleanup:</strong> cron(0 5 * * ? *) - Delete expired exports (5am UTC)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Management-Governance/CloudWatch.svg" alt="CloudWatch" class="aws-icon">
                                    CloudWatch Monitoring
                                </h4>
                                <div class="section-content">
                                    <strong>Metrics:</strong><br>
                                    • Analytics query response time (avg, p95, p99)<br>
                                    • Dashboard load time (avg)<br>
                                    • Report generation time (avg)<br>
                                    • Export job duration (avg)<br>
                                    • Aggregation job duration (avg)<br>
                                    • Real-time WebSocket connections (active count)<br>
                                    • Cache hit rate (Redis)<br><br>
                                    <strong>Alarms:</strong><br>
                                    • Query timeout (>30s) → SNS alert<br>
                                    • Aggregation failure → SNS alert<br>
                                    • Report generation failure → SNS alert<br>
                                    • High Redis memory usage (>80%) → SNS alert
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Storage/Simple-Storage-Service.svg" alt="S3" class="aws-icon">
                                    S3 Buckets
                                </h4>
                                <div class="section-content">
                                    <strong>Buckets:</strong><br>
                                    • <strong>analytics-reports/</strong> - Generated reports (PDF, Excel, CSV)<br>
                                    • <strong>analytics-exports/</strong> - Data exports (CSV, JSON)<br>
                                    • <strong>dashboard-snapshots/</strong> - Dashboard backups (JSON)<br><br>
                                    <strong>Lifecycle Policy:</strong><br>
                                    • Reports: Transition to S3 Glacier after 90 days, delete after 2 years<br>
                                    • Exports: Delete after 30 days (user responsibility to download)<br>
                                    • Snapshots: Delete after 90 days<br><br>
                                    <strong>Access:</strong> Pre-signed URLs (expiry 24h for downloads)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Storage/Simple-Storage-Service.svg" alt="S3" class="aws-icon">
                                    CloudFront CDN
                                </h4>
                                <div class="section-content">
                                    <strong>Purpose:</strong> Accelerate report/export downloads globally<br>
                                    <strong>Origin:</strong> S3 buckets (analytics-reports, analytics-exports)<br>
                                    <strong>Cache Behavior:</strong><br>
                                    • TTL: 24 hours (reports are static once generated)<br>
                                    • Signed URLs: Yes (security)<br>
                                    • GZIP Compression: Enabled<br><br>
                                    <strong>Performance:</strong><br>
                                    • <100ms download start time globally<br>
                                    • Bandwidth optimization (cost savings)
                                </div>
                            </div>

                            <div class="aws-box">
                                <h4>
                                    <img src="https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Secrets-Manager.svg" alt="Secrets Manager" class="aws-icon">
                                    Secrets Manager
                                </h4>
                                <div class="section-content">
                                    <strong>Secrets Stored:</strong><br>
                                    • Database connection strings (RDS + read replicas)<br>
                                    • Redis connection string (ElastiCache)<br>
                                    • Google Sheets API credentials (OAuth tokens)<br>
                                    • Slack webhook URLs (notifications)<br>
                                    • External analytics API keys (Google Analytics, Mixpanel)<br><br>
                                    <strong>Encryption:</strong> AWS KMS (AES-256)<br>
                                    <strong>Rotation:</strong> Automatic every 90 days
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 4: DATA STORAGE -->
                <div class="swim-lane">
                    <div class="lane-header lane-data">
                        🗄️ SWIM LANE 4: DATABASE SCHEMA & RELATIONSHIPS
                    </div>
                    <div class="lane-content lane-data">

                        <!-- TABLE: campaign_metrics_hourly -->
                        <div class="db-table">
                            <div class="table-header">TABLE: campaign_metrics_hourly (Partitioned by Month)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>BIGSERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique record ID</div>
                                </div>
                                <div class="table-row">
                                    <div>campaignId</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → campaigns(id), NOT NULL, INDEX</div>
                                    <div>Campaign being tracked</div>
                                </div>
                                <div class="table-row">
                                    <div>hourBucket</div>
                                    <div>TIMESTAMP</div>
                                    <div>NOT NULL, INDEX</div>
                                    <div>Hour bucket (e.g., 2025-01-15 14:00:00)</div>
                                </div>
                                <div class="table-row">
                                    <div>sentCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Emails sent in this hour</div>
                                </div>
                                <div class="table-row">
                                    <div>deliveredCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Successfully delivered</div>
                                </div>
                                <div class="table-row">
                                    <div>bouncedCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Bounced emails</div>
                                </div>
                                <div class="table-row">
                                    <div>openedCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Unique opens</div>
                                </div>
                                <div class="table-row">
                                    <div>clickedCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Unique clicks</div>
                                </div>
                                <div class="table-row">
                                    <div>convertedCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Conversions</div>
                                </div>
                                <div class="table-row">
                                    <div>unsubscribedCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Unsubscribes</div>
                                </div>
                                <div class="table-row">
                                    <div>spamComplaintCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Spam complaints</div>
                                </div>
                                <div class="table-row">
                                    <div>revenue</div>
                                    <div>DECIMAL(12,2)</div>
                                    <div>DEFAULT 0.00</div>
                                    <div>Revenue attributed in this hour</div>
                                </div>
                                <div class="table-row">
                                    <div>openRate</div>
                                    <div>DECIMAL(5,2)</div>
                                    <div>GENERATED ALWAYS AS (CASE WHEN deliveredCount > 0 THEN (openedCount::DECIMAL / deliveredCount) * 100 ELSE 0 END) STORED</div>
                                    <div>Calculated open rate %</div>
                                </div>
                                <div class="table-row">
                                    <div>clickRate</div>
                                    <div>DECIMAL(5,2)</div>
                                    <div>GENERATED ALWAYS AS (CASE WHEN deliveredCount > 0 THEN (clickedCount::DECIMAL / deliveredCount) * 100 ELSE 0 END) STORED</div>
                                    <div>Calculated click rate %</div>
                                </div>
                                <div class="table-row">
                                    <div>CTOR</div>
                                    <div>DECIMAL(5,2)</div>
                                    <div>GENERATED ALWAYS AS (CASE WHEN openedCount > 0 THEN (clickedCount::DECIMAL / openedCount) * 100 ELSE 0 END) STORED</div>
                                    <div>Click-to-open rate (CTOR) %</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Record creation timestamp (partition key)</div>
                                </div>
                                <div class="table-row">
                                    <div>CONSTRAINT</div>
                                    <div>UNIQUE</div>
                                    <div>UNIQUE(campaignId, hourBucket)</div>
                                    <div>One record per campaign per hour</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: campaign_metrics_daily -->
                        <div class="db-table">
                            <div class="table-header">TABLE: campaign_metrics_daily</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>BIGSERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique record ID</div>
                                </div>
                                <div class="table-row">
                                    <div>campaignId</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → campaigns(id), NOT NULL, INDEX</div>
                                    <div>Campaign being tracked</div>
                                </div>
                                <div class="table-row">
                                    <div>date</div>
                                    <div>DATE</div>
                                    <div>NOT NULL, INDEX</div>
                                    <div>Date (e.g., 2025-01-15)</div>
                                </div>
                                <div class="table-row">
                                    <div>sentCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Total emails sent on this date</div>
                                </div>
                                <div class="table-row">
                                    <div>deliveredCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Successfully delivered</div>
                                </div>
                                <div class="table-row">
                                    <div>openedCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Unique opens</div>
                                </div>
                                <div class="table-row">
                                    <div>clickedCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Unique clicks</div>
                                </div>
                                <div class="table-row">
                                    <div>convertedCount</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>Conversions</div>
                                </div>
                                <div class="table-row">
                                    <div>revenue</div>
                                    <div>DECIMAL(12,2)</div>
                                    <div>DEFAULT 0.00</div>
                                    <div>Total revenue on this date</div>
                                </div>
                                <div class="table-row">
                                    <div>openRate</div>
                                    <div>DECIMAL(5,2)</div>
                                    <div>GENERATED ALWAYS AS (CASE WHEN deliveredCount > 0 THEN (openedCount::DECIMAL / deliveredCount) * 100 ELSE 0 END) STORED</div>
                                    <div>Calculated open rate %</div>
                                </div>
                                <div class="table-row">
                                    <div>clickRate</div>
                                    <div>DECIMAL(5,2)</div>
                                    <div>GENERATED ALWAYS AS (CASE WHEN deliveredCount > 0 THEN (clickedCount::DECIMAL / deliveredCount) * 100 ELSE 0 END) STORED</div>
                                    <div>Calculated click rate %</div>
                                </div>
                                <div class="table-row">
                                    <div>conversionRate</div>
                                    <div>DECIMAL(5,2)</div>
                                    <div>GENERATED ALWAYS AS (CASE WHEN deliveredCount > 0 THEN (convertedCount::DECIMAL / deliveredCount) * 100 ELSE 0 END) STORED</div>
                                    <div>Calculated conversion rate %</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Record creation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>CONSTRAINT</div>
                                    <div>UNIQUE</div>
                                    <div>UNIQUE(campaignId, date)</div>
                                    <div>One record per campaign per day</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: custom_dashboards -->
                        <div class="db-table">
                            <div class="table-header">TABLE: custom_dashboards</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique dashboard identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>userId</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → users(id), NOT NULL, INDEX</div>
                                    <div>Dashboard owner</div>
                                </div>
                                <div class="table-row">
                                    <div>dashboardName</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Dashboard name (e.g., "Q1 Campaign Performance")</div>
                                </div>
                                <div class="table-row">
                                    <div>description</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Dashboard description</div>
                                </div>
                                <div class="table-row">
                                    <div>layout</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Dashboard layout configuration (grid positions)</div>
                                </div>
                                <div class="table-row">
                                    <div>refreshFrequency</div>
                                    <div>ENUM</div>
                                    <div>'realtime', 'hourly', 'daily', DEFAULT 'hourly'</div>
                                    <div>Data refresh frequency</div>
                                </div>
                                <div class="table-row">
                                    <div>isShared</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT false</div>
                                    <div>Is dashboard shared with team?</div>
                                </div>
                                <div class="table-row">
                                    <div>sharedWith</div>
                                    <div>UUID[]</div>
                                    <div>NULLABLE</div>
                                    <div>Array of user IDs dashboard is shared with</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Dashboard creation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>updatedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last dashboard update timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: dashboard_widgets -->
                        <div class="db-table">
                            <div class="table-header">TABLE: dashboard_widgets</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique widget identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>dashboardId</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → custom_dashboards(id) ON DELETE CASCADE, NOT NULL, INDEX</div>
                                    <div>Parent dashboard</div>
                                </div>
                                <div class="table-row">
                                    <div>widgetType</div>
                                    <div>ENUM</div>
                                    <div>'kpi_card', 'line_chart', 'bar_chart', 'pie_chart', 'table', 'heatmap', 'funnel', 'map', NOT NULL</div>
                                    <div>Widget type</div>
                                </div>
                                <div class="table-row">
                                    <div>widgetTitle</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Widget title (e.g., "Open Rate Trend")</div>
                                </div>
                                <div class="table-row">
                                    <div>dataSource</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Data source configuration (query params, filters)</div>
                                </div>
                                <div class="table-row">
                                    <div>widgetConfig</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Widget-specific config (colors, axes, legends)</div>
                                </div>
                                <div class="table-row">
                                    <div>position</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Widget position & size on grid (x, y, width, height)</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Widget creation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>updatedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last widget update timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: scheduled_reports -->
                        <div class="db-table">
                            <div class="table-header">TABLE: scheduled_reports</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique scheduled report identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>userId</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → users(id), NOT NULL, INDEX</div>
                                    <div>Report owner</div>
                                </div>
                                <div class="table-row">
                                    <div>reportName</div>
                                    <div>VARCHAR(255)</div>
                                    <div>NOT NULL</div>
                                    <div>Report name (e.g., "Weekly Campaign Summary")</div>
                                </div>
                                <div class="table-row">
                                    <div>reportType</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NOT NULL</div>
                                    <div>Report type (e.g., "campaign_summary", "automation_performance")</div>
                                </div>
                                <div class="table-row">
                                    <div>reportConfig</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Report configuration (metrics, filters, date range)</div>
                                </div>
                                <div class="table-row">
                                    <div>schedule</div>
                                    <div>ENUM</div>
                                    <div>'daily', 'weekly', 'monthly', NOT NULL</div>
                                    <div>Report frequency</div>
                                </div>
                                <div class="table-row">
                                    <div>scheduleDay</div>
                                    <div>INTEGER</div>
                                    <div>NULLABLE</div>
                                    <div>Day of week (1-7) for weekly, day of month (1-31) for monthly</div>
                                </div>
                                <div class="table-row">
                                    <div>scheduleTime</div>
                                    <div>TIME</div>
                                    <div>NOT NULL</div>
                                    <div>Time to generate report (e.g., 09:00:00)</div>
                                </div>
                                <div class="table-row">
                                    <div>format</div>
                                    <div>ENUM</div>
                                    <div>'pdf', 'excel', 'csv', DEFAULT 'pdf'</div>
                                    <div>Report file format</div>
                                </div>
                                <div class="table-row">
                                    <div>recipients</div>
                                    <div>TEXT[]</div>
                                    <div>NOT NULL</div>
                                    <div>Array of email addresses to send report to</div>
                                </div>
                                <div class="table-row">
                                    <div>isActive</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT true</div>
                                    <div>Is scheduled report active?</div>
                                </div>
                                <div class="table-row">
                                    <div>lastGeneratedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>Last report generation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Scheduled report creation timestamp</div>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE: export_jobs -->
                        <div class="db-table">
                            <div class="table-header">TABLE: export_jobs</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column Name</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div>id</div>
                                    <div>UUID</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Unique export job identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>userId</div>
                                    <div>UUID</div>
                                    <div>FOREIGN KEY → users(id), NOT NULL, INDEX</div>
                                    <div>User who requested export</div>
                                </div>
                                <div class="table-row">
                                    <div>exportType</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NOT NULL</div>
                                    <div>Export type (e.g., "campaign_analytics", "contact_list")</div>
                                </div>
                                <div class="table-row">
                                    <div>exportConfig</div>
                                    <div>JSONB</div>
                                    <div>NOT NULL</div>
                                    <div>Export configuration (date range, filters)</div>
                                </div>
                                <div class="table-row">
                                    <div>format</div>
                                    <div>ENUM</div>
                                    <div>'csv', 'excel', 'json', DEFAULT 'csv'</div>
                                    <div>Export file format</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>ENUM</div>
                                    <div>'pending', 'processing', 'completed', 'failed', DEFAULT 'pending'</div>
                                    <div>Export job status</div>
                                </div>
                                <div class="table-row">
                                    <div>s3Key</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>S3 object key for exported file</div>
                                </div>
                                <div class="table-row">
                                    <div>downloadUrl</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Pre-signed S3 URL for download (24h expiry)</div>
                                </div>
                                <div class="table-row">
                                    <div>fileSize</div>
                                    <div>BIGINT</div>
                                    <div>NULLABLE</div>
                                    <div>File size in bytes</div>
                                </div>
                                <div class="table-row">
                                    <div>rowCount</div>
                                    <div>INTEGER</div>
                                    <div>NULLABLE</div>
                                    <div>Number of rows exported</div>
                                </div>
                                <div class="table-row">
                                    <div>errorMessage</div>
                                    <div>TEXT</div>
                                    <div>NULLABLE</div>
                                    <div>Error message if export failed</div>
                                </div>
                                <div class="table-row">
                                    <div>expiresAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>Export file expiration timestamp (30 days)</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Export job creation timestamp</div>
                                </div>
                                <div class="table-row">
                                    <div>completedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>Export job completion timestamp</div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="flow-arrow-down">↓</div>

                <!-- SWIM LANE 5: GDPR COMPLIANCE -->
                <div class="swim-lane">
                    <div class="lane-header lane-gdpr">
                        🛡️ SWIM LANE 5: GDPR COMPLIANCE FOR ANALYTICS & REPORTING
                    </div>
                    <div class="lane-content lane-gdpr">
                        <div class="gdpr-grid">
                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Analytics Data Processing</h3>
                                <div class="gdpr-section">
                                    <strong>Article 6(1)(f) - Legitimate Interest:</strong>
                                    <ul style="margin-top: 8px; padding-left: 20px;">
                                        <li><strong>Purpose:</strong> Business analytics & campaign optimization (legitimate interest)</li>
                                        <li><strong>Transparency:</strong> Privacy policy discloses analytics data collection</li>
                                        <li><strong>Aggregation:</strong> Analytics data aggregated hourly/daily (minimal PII exposure)</li>
                                        <li><strong>Anonymization:</strong> Contact-level data anonymized after 180 days</li>
                                        <li><strong>Access Control:</strong> Analytics restricted to authorized users only</li>
                                    </ul>
                                </div>
                                <div class="gdpr-section" style="margin-top: 15px;">
                                    <strong>Data Processing:</strong><br>
                                    • Campaign performance metrics (aggregate counts)<br>
                                    • Engagement trends (opens, clicks over time)<br>
                                    • Geographic distribution (country/region level, not precise location)<br>
                                    • Device/client statistics (aggregate, no device IDs)
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 6: Lawful Basis for Processing<br>
                                    &nbsp;&nbsp; Section: Legitimate Interest (Line 850)
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Analytics Data Retention</h3>
                                <div class="gdpr-section">
                                    <strong>Data Retention Policy:</strong>
                                    <ul style="margin-top: 8px; padding-left: 20px;">
                                        <li><strong>Hourly Aggregates:</strong> Retained for 90 days, then deleted (campaign_metrics_hourly)</li>
                                        <li><strong>Daily Aggregates:</strong> Retained for 2 years (campaign_metrics_daily)</li>
                                        <li><strong>Monthly Aggregates:</strong> Retained for 5 years (campaign_metrics_monthly)</li>
                                        <li><strong>Contact-level Data:</strong> Anonymized after 180 days (replace contact_id with NULL)</li>
                                        <li><strong>Generated Reports:</strong> Retained for 90 days in S3, then transitioned to Glacier</li>
                                        <li><strong>Exported Data:</strong> User responsibility to delete, auto-delete after 30 days</li>
                                        <li><strong>Dashboard Snapshots:</strong> Retained for 90 days (backup purposes)</li>
                                    </ul>
                                </div>
                                <div class="gdpr-section" style="margin-top: 15px;">
                                    <strong>Automated Cleanup:</strong><br>
                                    • Lambda function: <code>analytics-cleanup-function</code> (daily at 5am UTC)<br>
                                    • S3 lifecycle policies (automatic Glacier transition + deletion)
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Section: Data Retention (Line 1678)<br>
                                    &nbsp;&nbsp; Section: Anonymization (Line 1340)
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Report & Export Data Portability</h3>
                                <div class="gdpr-section">
                                    <strong>Article 20: Right to Data Portability:</strong>
                                    <ul style="margin-top: 8px; padding-left: 20px;">
                                        <li><strong>Export Analytics:</strong> Users can export campaign analytics (CSV, Excel, JSON)</li>
                                        <li><strong>Export Reports:</strong> Download generated reports (PDF, Excel)</li>
                                        <li><strong>Export Dashboards:</strong> Export custom dashboard configurations (JSON)</li>
                                        <li><strong>Format Options:</strong> Machine-readable (CSV, JSON) + human-readable (PDF, Excel)</li>
                                        <li><strong>Data Scope:</strong> All analytics data for user's campaigns (no cross-user data)</li>
                                        <li><strong>Export Availability:</strong> 30-day download window, then auto-delete</li>
                                    </ul>
                                </div>
                                <div class="gdpr-section" style="margin-top: 15px;">
                                    <strong>Export Mechanism:</strong><br>
                                    • API endpoint: <code>POST /api/export/analytics</code><br>
                                    • Storage: S3 bucket <code>analytics-exports/</code><br>
                                    • Access: Pre-signed CloudFront URL (24h expiry, renewable)
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 20: Right to Data Portability
                                </div>
                            </div>

                            <div class="gdpr-box">
                                <h3><span class="check">✅</span> Analytics Data Deletion & Anonymization</h3>
                                <div class="gdpr-section">
                                    <strong>Article 17: Right to Erasure:</strong>
                                    <ul style="margin-top: 8px; padding-left: 20px;">
                                        <li><strong>Delete User Account:</strong> All analytics data deleted or anonymized within 30 days</li>
                                        <li><strong>Anonymization Strategy:</strong> Replace identifiable fields (userId, campaignId) with NULL or pseudonymized IDs</li>
                                        <li><strong>Preserve Aggregate Metrics:</strong> Anonymized aggregates retained for business analytics (no PII)</li>
                                        <li><strong>Delete Reports:</strong> User-generated reports deleted from S3 within 30 days</li>
                                        <li><strong>Delete Dashboards:</strong> Custom dashboards deleted (cascade to widgets)</li>
                                        <li><strong>Export Job Cleanup:</strong> Export jobs & files deleted after 30 days</li>
                                    </ul>
                                </div>
                                <div class="gdpr-section" style="margin-top: 15px;">
                                    <strong>Deletion Workflow:</strong><br>
                                    1. User requests account deletion (Right to Erasure)<br>
                                    2. Anonymize analytics data (contact_id → NULL, user_id → NULL)<br>
                                    3. Delete custom dashboards & widgets (CASCADE)<br>
                                    4. Delete scheduled reports<br>
                                    5. Delete export jobs & S3 files<br>
                                    6. Preserve anonymized aggregate metrics (business intelligence)
                                </div>
                                <div class="reference">
                                    → COMPLETE_GDPR_COMPLIANCE_GUIDE.md<br>
                                    &nbsp;&nbsp; Article 17: Right to Erasure<br>
                                    &nbsp;&nbsp; Section: Anonymization vs Deletion (Line 1340)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- END FRAME 15 -->

        </div>
    </div>

    <!-- BACK TO TOP -->
    <a href="#" class="back-to-top">↑</a>

    <!-- NAVIGATION SCRIPT -->
    <script src="assets/navigation.js"></script>
</body>
</html>
