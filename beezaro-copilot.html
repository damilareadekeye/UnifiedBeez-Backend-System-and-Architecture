<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beezaro Copilot Architecture - UnifiedBeez</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #FFFBF5;
            min-height: 100vh;
        }

        .header-bar {
            background: linear-gradient(135deg, #1A4D2E 0%, #2D6A4F 50%, #52B788 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 60px;
            z-index: 998;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .header-bar h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .header-bar p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .controls-bar {
            background: white;
            padding: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 132px;
            z-index: 997;
        }

        .control-btn {
            padding: 10px 20px;
            background: #1A4D2E;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: #2D6A4F;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.4);
        }

        .zoom-level {
            padding: 10px 20px;
            background: #E8F5E9;
            color: #1A4D2E;
            border-radius: 8px;
            font-weight: 700;
        }

        .diagram-container {
            padding: 40px 20px;
            overflow-x: auto;
            background: white;
        }

        .diagram-wrapper {
            min-width: 1920px;
            width: max-content;
            transform-origin: top left;
            transition: transform 0.1s ease;
            margin: 0 auto;
        }

        /* FRAME STRUCTURE */
        .frame {
            background: white;
            border: 3px solid #1A4D2E;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
            width: 1920px;
        }

        .frame-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1A4D2E;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #E8F5E9 0%, #B7E4C7 100%);
            border-radius: 8px;
            margin-bottom: 30px;
            border: 2px solid #2D6A4F;
        }

        .frame-subtitle {
            font-size: 1.2rem;
            color: #2C3E50;
            text-align: center;
            margin-bottom: 30px;
        }

        /* BEEZARO-SPECIFIC STYLES */
        .beezaro-frame {
            border-color: #FB9C1D;
            background: linear-gradient(to bottom, #FFFEF9 0%, white 100%);
        }

        .beezaro-frame .frame-title {
            background: linear-gradient(135deg, #FFF9E6 0%, #FFE4A1 100%);
            border-color: #FB9C1D;
            color: #1A4D2E;
        }

        /* SWIM LANES */
        .swim-lane {
            margin: 20px 0;
            border: 3px solid #1A4D2E;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.2);
        }

        .lane-header {
            padding: 20px;
            font-weight: 700;
            font-size: 1.3rem;
            color: #1A4D2E;
            border-bottom: 3px solid #1A4D2E;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .lane-content {
            padding: 20px;
            min-height: auto;
        }

        /* LANE BACKGROUNDS */
        .lane-user { background: #E8F5E9; }
        .lane-backend { background: #D4E9E2; }
        .lane-aws { background: #FFF9E6; }
        .lane-data { background: #B7E4C7; }

        /* STEP CONTAINER AND CARDS */
        .step-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            align-items: stretch;
        }

        .step-card {
            background: white;
            border: 3px solid #2D6A4F;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.15);
            transition: all 0.3s ease;
        }

        .step-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(45, 106, 79, 0.3);
            border-color: #1A4D2E;
        }

        .step-card h4 {
            font-size: 1.05rem;
            color: #1A4D2E;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .step-number {
            background: #FB9C1D;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        /* SERVICE CARDS */
        .service-card {
            background: white;
            border: 3px solid #2D6A4F;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.15);
            margin-bottom: 20px;
        }

        .service-card h3 {
            font-size: 1.2rem;
            color: #1A4D2E;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .service-icon {
            font-size: 1.5rem;
        }

        .service-card .section {
            margin: 12px 0;
        }

        .section-title {
            font-weight: 700;
            color: #2C3E50;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .section-content {
            color: #2C3E50;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .copilot-service-card {
            border-left: 6px solid #FB9C1D;
        }

        /* DATABASE TABLE */
        .db-table {
            background: white;
            border: 3px solid #1A4D2E;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(26, 77, 46, 0.15);
            margin-bottom: 20px;
        }

        .table-header {
            background: linear-gradient(135deg, #1A4D2E 0%, #2D6A4F 50%, #52B788 100%);
            color: white;
            padding: 15px 20px;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .copilot-table .table-header {
            background: #FB9C1D;
            color: white;
        }

        .table-body {
            padding: 20px;
        }

        .table-row {
            display: grid;
            grid-template-columns: 200px 150px 250px 350px;
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.9rem;
        }

        .table-row:last-child {
            border-bottom: none;
        }

        .table-row.header-row {
            background: #E8F5E9;
            font-weight: 700;
            color: #1A4D2E;
        }

        .pk {
            color: #FB9C1D;
            font-weight: 700;
        }

        /* NOTE BOX */
        .note-box {
            background: #E8F5E9;
            border-left: 6px solid #2D6A4F;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }

        .note-box h3 {
            color: #1A4D2E;
            margin-bottom: 10px;
        }

        .note-box ul {
            margin-left: 20px;
            color: #2C3E50;
        }

        .note-box li {
            margin: 8px 0;
        }

        .note-box p {
            color: #2C3E50;
        }

        .note-title {
            font-weight: 700;
            color: #1A4D2E;
            margin-bottom: 10px;
        }

        .note-content {
            color: #2C3E50;
            line-height: 1.6;
        }

        /* ENDPOINT STYLING */
        .endpoint {
            background: #E8F5E9;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: #1A4D2E;
            font-size: 0.85rem;
        }

        @media print {
            .header-bar, .controls-bar {
                position: static;
            }
        }
    </style>

    <!-- Link to shared styles -->
    <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
    <!-- NAVIGATION BAR -->
    <nav class="architecture-nav">
        <a href="index.html">üè† Home</a>
        <a href="manual-onboarding.html">üìù Manual Onboarding</a>
        <a href="beezaro-copilot.html" class="active">ü§ñ Beezaro Copilot</a>
        <a href="side-by-side-comparison.html">‚ö° Side-by-Side</a>
    </nav>

    <!-- BREADCRUMB -->
    <div class="breadcrumb">
        <a href="index.html">üè† Home</a> <span>/</span> <span>ü§ñ Beezaro Copilot</span>
    </div>

    <!-- HEADER -->
    <div class="header-bar">
        <h1>ü§ñ Beezaro Copilot - Conversational Onboarding Architecture</h1>
        <p>AI-Powered Onboarding with Fallback to Manual Setup</p>
    </div>

    <!-- CONTROLS -->
    <div class="controls-bar">
        <button class="control-btn" onclick="zoomIn()">üîç Zoom In</button>
        <button class="control-btn" onclick="zoomOut()">üîç Zoom Out</button>
        <button class="control-btn" onclick="resetZoom()">‚Ü∫ Reset</button>
        <span class="zoom-level" id="zoomLevel">100%</span>
    </div>

    <!-- DIAGRAM CONTAINER -->
    <div class="diagram-container" id="diagramContainer">
        <div class="diagram-wrapper" id="diagramWrapper">

            <!-- SEE ALSO BOX at top -->
            <div class="see-also-box">
                <h4>üìã See Also: Manual Onboarding</h4>
                <ul>
                    <li><a href="manual-onboarding.html#frame1">Manual STEP 0: Sign Up & Verification</a></li>
                    <li><a href="manual-onboarding.html#frame2">Manual STEP 2: Business Information</a></li>
                    <li><a href="manual-onboarding.html">View Complete Manual Flow</a></li>
                    <li><a href="side-by-side-comparison.html">Side-by-Side Comparison</a></li>
                </ul>
            </div>

            <!-- FRAME 10: BEEZARO OVERVIEW -->
            <div class="frame beezaro-frame" id="frame10">
                <div class="frame-title">
                    ü§ñ BEEZARO CONVERSATIONAL ONBOARDING - OVERVIEW
                </div>

                <div class="frame-subtitle">
                    Alternative AI-Powered Chat Interface for User Onboarding (Mirrors Manual Steps 0-8)
                </div>

                <!-- Introduction Section -->
                <div class="note-box" style="background: #FFF9E6; border-left-color: #FB9C1D;">
                    <h3>üéØ What is Beezaro Copilot?</h3>
                    <p><strong>Beezaro is a conversational AI assistant</strong> that guides users through the entire onboarding process via natural language chat instead of traditional forms.</p>

                    <p style="margin-top: 15px;"><strong>Key Points:</strong></p>
                    <ul>
                        <li>‚úÖ <strong>Same data collected</strong> as Manual Onboarding - Different UX, same outcome</li>
                        <li>‚úÖ <strong>Natural Q&A interface</strong> - Users answer questions in chat, not forms</li>
                        <li>‚úÖ <strong>Smart recommendations</strong> - AI suggests settings based on plan tier & industry</li>
                        <li>‚úÖ <strong>Seamless fallback</strong> - When user says "No" or "Skip", opens corresponding manual screen</li>
                        <li>‚úÖ <strong>Progress tracking</strong> - Users can switch between copilot ‚Üî manual anytime</li>
                        <li>‚úÖ <strong>Multi-device responsive</strong> - Desktop, Mobile App, Web Responsive versions</li>
                    </ul>
                </div>

                <!-- Flow Comparison Diagram -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px;">
                    <!-- Manual Flow -->
                    <div style="background: #E8F5E9; padding: 25px; border-radius: 12px; border: 3px solid #2D6A4F;">
                        <h3 style="text-align: center; color: #1A4D2E; margin-bottom: 20px;">üìù MANUAL ONBOARDING</h3>
                        <div style="font-family: 'Courier New', monospace; font-size: 0.9rem; line-height: 1.8;">
                            1. Sign Up (Email/OAuth)<br>
                            2. Email Verification<br>
                            3. Plan Selection<br>
                            4. Business Information Form<br>
                            5. Team Setup Form<br>
                            6. AI Assistant Form<br>
                            7. Channel Integration Form<br>
                            8. Per-Channel Config Form<br>
                            9. Webchat Setup Form<br>
                            10. Automation Templates Form<br>
                            ‚úÖ Complete
                        </div>
                        <div style="margin-top: 15px; padding: 10px; background: white; border-radius: 6px;">
                            <strong>UX:</strong> Form-based, step-by-step wizard
                        </div>
                    </div>

                    <!-- Copilot Flow -->
                    <div style="background: #FFF9E6; padding: 25px; border-radius: 12px; border: 3px solid #FB9C1D;">
                        <h3 style="text-align: center; color: #1A4D2E; margin-bottom: 20px;">ü§ñ BEEZARO COPILOT</h3>
                        <div style="font-family: 'Courier New', monospace; font-size: 0.9rem; line-height: 1.8;">
                            1. Sign Up (Email/OAuth)<br>
                            2. Email Verification<br>
                            3. Plan Selection<br>
                            4. Chat: Business Identity<br>
                            5. Chat: Team Members<br>
                            6. Chat: Channels<br>
                            7. Chat: Fall-Back Logic<br>
                            8. Chat: AI Assistant<br>
                            9. Chat: Automation<br>
                            10. Review & Confirm<br>
                            ‚úÖ Complete
                        </div>
                        <div style="margin-top: 15px; padding: 10px; background: white; border-radius: 6px;">
                            <strong>UX:</strong> Conversational, guided chat
                        </div>
                    </div>
                </div>

                <!-- Critical Fallback Logic -->
                <div class="note-box" style="margin-top: 30px; background: #FFE4E1; border-left-color: #FF6B6B;">
                    <h3>üîÑ CRITICAL FALLBACK LOGIC (When User Says "No")</h3>
                    <div style="background: white; padding: 20px; border-radius: 8px; margin-top: 15px;">
                        <strong style="color: #1A4D2E; display: block; margin-bottom: 10px;">Example Workflow:</strong>

                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 15px; align-items: start;">
                            <div style="text-align: right; color: #FB9C1D; font-weight: 700;">1.</div>
                            <div>
                                <strong>Beezaro asks:</strong> "What's your business name?"<br>
                                <span style="color: #666;">User types: "No" or "Skip"</span>
                            </div>

                            <div style="text-align: right; color: #FB9C1D; font-weight: 700;">2.</div>
                            <div>
                                <strong>System detects fallback trigger</strong><br>
                                <span style="color: #666;">‚Üí Logs to `copilot_fallback_triggers` table</span><br>
                                <span style="color: #666;">‚Üí Updates `onboarding_state.onboardingMode = 'manual'`</span>
                            </div>

                            <div style="text-align: right; color: #FB9C1D; font-weight: 700;">3.</div>
                            <div>
                                <strong>Redirects to Manual Screen</strong><br>
                                <span style="color: #666;">‚Üí Opens: Manual STEP 2 - Business Name input screen</span><br>
                                <span style="color: #666;">‚Üí Shows "Return to Beezaro" button at top</span>
                            </div>

                            <div style="text-align: right; color: #FB9C1D; font-weight: 700;">4.</div>
                            <div>
                                <strong>User completes field manually</strong><br>
                                <span style="color: #666;">‚Üí Enters: "GreenLeaf Pharmacy"</span><br>
                                <span style="color: #666;">‚Üí Saves to `organizations.business_name`</span><br>
                                <span style="color: #666;">‚Üí Updates `onboarding_state.collectedData`</span>
                            </div>

                            <div style="text-align: right; color: #FB9C1D; font-weight: 700;">5.</div>
                            <div>
                                <strong>Returns to Beezaro chat</strong><br>
                                <span style="color: #666;">‚Üí User clicks "Return to Beezaro"</span><br>
                                <span style="color: #666;">‚Üí Updates `onboarding_state.onboardingMode = 'copilot'`</span><br>
                                <span style="color: #666;">‚Üí Beezaro: "Great! I see you entered GreenLeaf Pharmacy. Next question..."</span>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 15px; padding: 15px; background: #FFF9E6; border-radius: 6px; border-left: 4px solid #FB9C1D;">
                        <strong>üéØ Key Insight:</strong> User has complete control. Can switch between chat and forms anytime. All data syncs automatically via `onboarding_state` table.
                    </div>
                </div>

                <!-- Beezaro Steps Overview -->
                <div style="margin-top: 30px;">
                    <h3 style="color: #1A4D2E; margin-bottom: 20px;">üìã Beezaro Onboarding Steps (6 Steps)</h3>
                    <div class="step-container" style="grid-template-columns: repeat(3, 1fr);">
                        <!-- Step 1 -->
                        <div class="step-card">
                            <div class="step-number">1</div>
                            <h4>Business Identity</h4>
                            <p><strong>Questions:</strong></p>
                            <ul style="font-size: 0.9rem; margin-left: 20px;">
                                <li>Confirm plan selection</li>
                                <li>Business name</li>
                                <li>Industry</li>
                                <li>Business description</li>
                                <li>Upload logo</li>
                                <li>Knowledge base files/URL</li>
                            </ul>
                            <div style="margin-top: 10px; padding: 8px; background: #E8F5E9; border-radius: 4px; font-size: 0.85rem;">
                                <strong>Fallback:</strong> Opens Manual STEP 2
                            </div>
                        </div>

                        <!-- Step 2 -->
                        <div class="step-card">
                            <div class="step-number">2</div>
                            <h4>Team Members</h4>
                            <p><strong>Questions:</strong></p>
                            <ul style="font-size: 0.9rem; margin-left: 20px;">
                                <li>Add team members?</li>
                                <li>How many?</li>
                                <li>Enter emails</li>
                                <li>Assign roles per member</li>
                            </ul>
                            <div style="margin-top: 10px; padding: 8px; background: #E8F5E9; border-radius: 4px; font-size: 0.85rem;">
                                <strong>Fallback:</strong> Opens Manual STEP 3
                            </div>
                        </div>

                        <!-- Step 3 -->
                        <div class="step-card">
                            <div class="step-number">3</div>
                            <h4>Channels</h4>
                            <p><strong>Questions:</strong></p>
                            <ul style="font-size: 0.9rem; margin-left: 20px;">
                                <li>Select channels (grid)</li>
                                <li>Configure now or defaults?</li>
                                <li>Per-channel settings</li>
                            </ul>
                            <div style="margin-top: 10px; padding: 8px; background: #E8F5E9; border-radius: 4px; font-size: 0.85rem;">
                                <strong>Fallback:</strong> Opens Manual STEP 5
                            </div>
                        </div>

                        <!-- Step 4 -->
                        <div class="step-card">
                            <div class="step-number">4</div>
                            <h4>Fall-Back Logic</h4>
                            <p><strong>Questions:</strong></p>
                            <ul style="font-size: 0.9rem; margin-left: 20px;">
                                <li>What if no reply?</li>
                                <li>Wait / Escalate / Follow-up</li>
                                <li>Delay configuration</li>
                            </ul>
                            <div style="margin-top: 10px; padding: 8px; background: #E8F5E9; border-radius: 4px; font-size: 0.85rem;">
                                <strong>Fallback:</strong> Opens Manual STEP 6
                            </div>
                        </div>

                        <!-- Step 5 -->
                        <div class="step-card">
                            <div class="step-number">5</div>
                            <h4>AI Assistant</h4>
                            <p><strong>Questions:</strong></p>
                            <ul style="font-size: 0.9rem; margin-left: 20px;">
                                <li>Single or multiple?</li>
                                <li>AI name</li>
                                <li>Tone selection</li>
                                <li>Personality type</li>
                            </ul>
                            <div style="margin-top: 10px; padding: 8px; background: #E8F5E9; border-radius: 4px; font-size: 0.85rem;">
                                <strong>Fallback:</strong> Opens Manual STEP 4
                            </div>
                        </div>

                        <!-- Step 6 -->
                        <div class="step-card">
                            <div class="step-number">6</div>
                            <h4>Automation</h4>
                            <p><strong>Questions:</strong></p>
                            <ul style="font-size: 0.9rem; margin-left: 20px;">
                                <li>Add starter automation?</li>
                                <li>Which category?</li>
                                <li>Select template</li>
                                <li>Activate?</li>
                            </ul>
                            <div style="margin-top: 10px; padding: 8px; background: #E8F5E9; border-radius: 4px; font-size: 0.85rem;">
                                <strong>Fallback:</strong> Opens Manual STEP 8
                            </div>
                        </div>
                    </div>
                </div>

                <!-- UI Components Reference -->
                <div class="note-box" style="margin-top: 30px;">
                    <h3>üé® Beezaro UI Components (From 226 UI Screens)</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 15px;">
                        <div>
                            <h4 style="color: #1A4D2E; margin-bottom: 10px;">Core Components</h4>
                            <ul style="margin-left: 20px;">
                                <li><strong>Chat Interface:</strong> Left panel (animated Beezaro bee), Right panel (conversation)</li>
                                <li><strong>Progress Stepper:</strong> Visual indicator across top (6 steps)</li>
                                <li><strong>Quick Response Buttons:</strong> Inline option cards with radio buttons</li>
                                <li><strong>Preview Modal:</strong> Review collected data before confirming</li>
                                <li><strong>Fallback CTA:</strong> "View in manual setup" button (always visible)</li>
                                <li><strong>Exit Button:</strong> Save progress and return later</li>
                            </ul>
                        </div>
                        <div>
                            <h4 style="color: #1A4D2E; margin-bottom: 10px;">Device Variants</h4>
                            <ul style="margin-left: 20px;">
                                <li><strong>Desktop:</strong> Side-by-side chat + preview (58 screens)</li>
                                <li><strong>Mobile App:</strong> Full-screen chat, modal previews (84 screens)</li>
                                <li><strong>Web Responsive:</strong> Adaptive layout (84 screens)</li>
                                <li><strong>iPad:</strong> Hybrid layout</li>
                            </ul>
                            <div style="margin-top: 15px; padding: 10px; background: #FFF9E6; border-radius: 6px;">
                                <strong>Total UI Screens:</strong> 226 screens across all devices
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- END FRAME 10 -->


            <!-- FRAME 11: BEEZARO BACKEND SERVICES -->
            <div class="frame beezaro-frame" id="frame11">
                <div class="frame-title">
                    ü§ñ BEEZARO BACKEND SERVICES & API ENDPOINTS
                </div>

                <!-- SWIM LANE 1: NEW SERVICES -->
                <div class="swim-lane lane-backend">
                    <div class="lane-header">
                        üíª SWIM LANE 1: BEEZARO BACKEND SERVICES (3 New Services)
                    </div>
                    <div class="lane-content">
                        <!-- Service 1: Beezaro Conversational Service -->
                        <div class="service-card copilot-service-card">
                            <h3><span class="service-icon">üí¨</span> Beezaro Conversational Service</h3>
                            <div class="section">
                                <div class="section-title">Purpose:</div>
                                <div class="section-content">
                                    Handle all conversational onboarding interactions via natural language chat interface
                                </div>
                            </div>
                            <div class="section">
                                <div class="section-title">Core Features:</div>
                                <div class="section-content">
                                    ‚Ä¢ <strong>Natural Language Understanding (NLU):</strong> Parse user text input using OpenAI GPT-4<br>
                                    ‚Ä¢ <strong>Intent Detection:</strong> Classify user response (provide_info | skip | fallback | need_help | confirm)<br>
                                    ‚Ä¢ <strong>Entity Extraction:</strong> Extract structured data from unstructured text (e.g., business name from "My company is GreenLeaf")<br>
                                    ‚Ä¢ <strong>Context Management:</strong> Maintain conversation state across multiple messages<br>
                                    ‚Ä¢ <strong>Step Routing:</strong> Determine next question based on current step & user responses<br>
                                    ‚Ä¢ <strong>Fallback Detection:</strong> Trigger redirect to manual when user says "No", "Skip", or unclear input<br>
                                    ‚Ä¢ <strong>Session Persistence:</strong> Save/resume conversations (user can leave and return)
                                </div>
                            </div>
                            <div class="section">
                                <div class="section-title">AI Integration:</div>
                                <div class="section-content">
                                    ‚Ä¢ <strong>Provider:</strong> OpenAI GPT-4 (gpt-4-turbo-preview)<br>
                                    ‚Ä¢ <strong>System Prompt:</strong> "You are Beezaro, a friendly AI assistant helping users set up UnifiedBeez..."<br>
                                    ‚Ä¢ <strong>Context Window:</strong> Include last 10 messages + user profile + current step<br>
                                    ‚Ä¢ <strong>Structured Output:</strong> JSON format {intent, extracted_data, next_question, confidence}<br>
                                    ‚Ä¢ <strong>Few-Shot Examples:</strong> Provide examples for each onboarding step
                                </div>
                            </div>
                            <div class="section">
                                <div class="section-title">API Endpoints:</div>
                                <div class="section-content">
                                    <strong>Session Management:</strong><br>
                                    ‚Ä¢ <span class="endpoint">POST /api/copilot/start</span> - Start new Beezaro session<br>
                                    &nbsp;&nbsp;<span style="color: #666;">Body: {userId, organizationId, deviceType}</span><br>
                                    &nbsp;&nbsp;<span style="color: #666;">Returns: {sessionId, firstQuestion, currentStep}</span><br><br>

                                    <strong>Conversation:</strong><br>
                                    ‚Ä¢ <span class="endpoint">POST /api/copilot/message</span> - Send user message & get Beezaro response<br>
                                    &nbsp;&nbsp;<span style="color: #666;">Body: {sessionId, message, timestamp}</span><br>
                                    &nbsp;&nbsp;<span style="color: #666;">Returns: {beezaroResponse, intent, extractedData, nextStep}</span><br><br>

                                    ‚Ä¢ <span class="endpoint">GET /api/copilot/conversation/:sessionId</span> - Get full conversation history<br>
                                    &nbsp;&nbsp;<span style="color: #666;">Returns: {messages[], currentStep, progressPercentage}</span><br><br>

                                    <strong>Step Control:</strong><br>
                                    ‚Ä¢ <span class="endpoint">POST /api/copilot/skip-step</span> - Skip current step<br>
                                    &nbsp;&nbsp;<span style="color: #666;">Body: {sessionId, stepName, reason}</span><br>
                                    &nbsp;&nbsp;<span style="color: #666;">Returns: {nextStep, nextQuestion}</span><br><br>

                                    <strong>Fallback:</strong><br>
                                    ‚Ä¢ <span class="endpoint">POST /api/copilot/trigger-fallback</span> - Trigger manual screen redirect<br>
                                    &nbsp;&nbsp;<span style="color: #666;">Body: {sessionId, fromStep, reason}</span><br>
                                    &nbsp;&nbsp;<span style="color: #666;">Returns: {manualScreenUrl, returnToken}</span><br><br>

                                    <strong>Resume:</strong><br>
                                    ‚Ä¢ <span class="endpoint">POST /api/copilot/resume/:sessionId</span> - Resume paused session<br>
                                    &nbsp;&nbsp;<span style="color: #666;">Returns: {conversationHistory, currentStep, lastMessage}</span><br><br>

                                    <strong>Progress:</strong><br>
                                    ‚Ä¢ <span class="endpoint">GET /api/copilot/progress/:userId</span> - Get onboarding completion status<br>
                                    &nbsp;&nbsp;<span style="color: #666;">Returns: {completedSteps[], currentStep, progressPercentage, collectedData}</span>
                                </div>
                            </div>
                            <div class="section">
                                <div class="section-title">Technology Stack:</div>
                                <div class="section-content">
                                    ‚Ä¢ <strong>Framework:</strong> NestJS (TypeScript)<br>
                                    ‚Ä¢ <strong>AI SDK:</strong> OpenAI Node.js SDK<br>
                                    ‚Ä¢ <strong>Validation:</strong> class-validator + class-transformer<br>
                                    ‚Ä¢ <strong>Caching:</strong> Redis (conversation context cache, 5-minute TTL)<br>
                                    ‚Ä¢ <strong>Queue:</strong> BullMQ (async AI processing)
                                </div>
                            </div>
                        </div>

                        <!-- Service 2: Onboarding State Management Service -->
                        <div class="service-card copilot-service-card">
                            <h3><span class="service-icon">üìä</span> Onboarding State Management Service</h3>
                            <div class="section">
                                <div class="section-title">Purpose:</div>
                                <div class="section-content">
                                    Track user progress across BOTH manual and copilot onboarding modes. Enable seamless switching.
                                </div>
                            </div>
                            <div class="section">
                                <div class="section-title">Core Features:</div>
                                <div class="section-content">
                                    ‚Ä¢ <strong>Unified State Tracking:</strong> Single source of truth for onboarding progress<br>
                                    ‚Ä¢ <strong>Mode Switching:</strong> Handle copilot ‚Üî manual transitions without data loss<br>
                                    ‚Ä¢ <strong>Progress Calculation:</strong> Real-time % completion across all steps<br>
                                    ‚Ä¢ <strong>Data Synchronization:</strong> Merge data collected in either mode<br>
                                    ‚Ä¢ <strong>Partial Completion:</strong> Save incomplete steps, resume later<br>
                                    ‚Ä¢ <strong>Step Validation:</strong> Verify required data collected before marking step complete
                                </div>
                            </div>
                            <div class="section">
                                <div class="section-title">API Endpoints:</div>
                                <div class="section-content">
                                    <strong>State Retrieval:</strong><br>
                                    ‚Ä¢ <span class="endpoint">GET /api/onboarding/state/:userId</span> - Get current onboarding state<br>
                                    &nbsp;&nbsp;<span style="color: #666;">Returns: {mode, stepsCompleted[], currentStep, collectedData, progressPercentage}</span><br><br>

                                    <strong>State Updates:</strong><br>
                                    ‚Ä¢ <span class="endpoint">PATCH /api/onboarding/state/:userId</span> - Update state<br>
                                    &nbsp;&nbsp;<span style="color: #666;">Body: {stepName, data, isComplete}</span><br>
                                    &nbsp;&nbsp;<span style="color: #666;">Returns: {updatedState, progressPercentage}</span><br><br>

                                    <strong>Mode Switching:</strong><br>
                                    ‚Ä¢ <span class="endpoint">POST /api/onboarding/switch-mode</span> - Switch between copilot ‚Üî manual<br>
                                    &nbsp;&nbsp;<span style="color: #666;">Body: {userId, fromMode, toMode, reason}</span><br>
                                    &nbsp;&nbsp;<span style="color: #666;">Returns: {newMode, redirectUrl, syncedData}</span><br><br>

                                    <strong>Resume:</strong><br>
                                    ‚Ä¢ <span class="endpoint">GET /api/onboarding/resume/:userId</span> - Get where to resume<br>
                                    &nbsp;&nbsp;<span style="color: #666;">Returns: {currentMode, currentStep, nextAction}</span><br><br>

                                    <strong>Completion:</strong><br>
                                    ‚Ä¢ <span class="endpoint">POST /api/onboarding/complete/:userId</span> - Mark onboarding complete<br>
                                    &nbsp;&nbsp;<span style="color: #666;">Body: {finalVerification: true}</span><br>
                                    &nbsp;&nbsp;<span style="color: #666;">Returns: {isComplete: true, completedAt, redirectToDashboard}</span>
                                </div>
                            </div>
                            <div class="section">
                                <div class="section-title">State Synchronization Logic:</div>
                                <div class="section-content">
                                    <strong>Scenario: User switches from Copilot to Manual</strong><br>
                                    1. User in copilot, completes Business Identity<br>
                                    2. User says "No" to Team Members question<br>
                                    3. <span style="color: #FB9C1D; font-weight: 600;">System triggers fallback</span><br>
                                    &nbsp;&nbsp;‚Üí Update `onboarding_state.onboardingMode = 'manual'`<br>
                                    &nbsp;&nbsp;‚Üí Update `onboarding_state.lastSwitchedAt = NOW()`<br>
                                    &nbsp;&nbsp;‚Üí Redirect to Manual STEP 3 (Team Setup)<br>
                                    4. Manual screen loads, reads `onboarding_state.collectedData`<br>
                                    &nbsp;&nbsp;‚Üí Pre-fills any data already collected<br>
                                    5. User completes manual form, saves to DB<br>
                                    &nbsp;&nbsp;‚Üí Update `onboarding_state.collectedData` with new data<br>
                                    &nbsp;&nbsp;‚Üí Update `onboarding_state.stepsCompleted[]` add "team_members"<br>
                                    6. User clicks "Return to Beezaro"<br>
                                    &nbsp;&nbsp;‚Üí Update `onboarding_state.onboardingMode = 'copilot'`<br>
                                    &nbsp;&nbsp;‚Üí Resume copilot session, continue to next step
                                </div>
                            </div>
                        </div>

                        <!-- Service 3: AI Response Generation Service -->
                        <div class="service-card copilot-service-card">
                            <h3><span class="service-icon">üß†</span> AI Response Generation Service</h3>
                            <div class="section">
                                <div class="section-title">Purpose:</div>
                                <div class="section-content">
                                    Generate dynamic, context-aware Beezaro responses personalized to user's plan tier, industry, and conversation history
                                </div>
                            </div>
                            <div class="section">
                                <div class="section-title">Core Features:</div>
                                <div class="section-content">
                                    ‚Ä¢ <strong>Personalized Greetings:</strong> "Hi [Name], I'm Beezaro!"<br>
                                    ‚Ä¢ <strong>Context-Aware Questions:</strong> Adjust based on plan tier (e.g., Business plan users get team questions, Individual plan skips)<br>
                                    ‚Ä¢ <strong>Confirmation Messages:</strong> "Got it! Your business name is [Name]"<br>
                                    ‚Ä¢ <strong>Recommendations:</strong> "I recommend Multiple Assistants by Channel for your Business plan"<br>
                                    ‚Ä¢ <strong>Error Handling:</strong> "I didn't catch that. Could you try again or type 'skip'?"<br>
                                    ‚Ä¢ <strong>Progress Updates:</strong> "Great! We're 60% done. Next up: Team Members"<br>
                                    ‚Ä¢ <strong>Industry-Specific Suggestions:</strong> "Since you're in E-commerce, I recommend these automations..."
                                </div>
                            </div>
                            <div class="section">
                                <div class="section-title">API Endpoints:</div>
                                <div class="section-content">
                                    ‚Ä¢ <span class="endpoint">POST /api/copilot/generate-response</span> - Generate Beezaro's next message<br>
                                    &nbsp;&nbsp;<span style="color: #666;">Body: {sessionId, userMessage, currentStep, context}</span><br>
                                    &nbsp;&nbsp;<span style="color: #666;">Returns: {beezaroMessage, intent, suggestedActions[]}</span><br><br>

                                    ‚Ä¢ <span class="endpoint">POST /api/copilot/validate-input</span> - Validate user input against schema<br>
                                    &nbsp;&nbsp;<span style="color: #666;">Body: {stepName, userInput, expectedType}</span><br>
                                    &nbsp;&nbsp;<span style="color: #666;">Returns: {isValid, extractedValue, errorMessage}</span>
                                </div>
                            </div>
                            <div class="section">
                                <div class="section-title">AI Prompt Templates (Per Step):</div>
                                <div class="section-content">
                                    <strong>Step 1: Business Identity</strong><br>
                                    <div style="background: #f9f9f9; padding: 10px; border-radius: 4px; margin: 8px 0; font-family: 'Courier New', monospace; font-size: 0.85rem;">
                                    System: You are Beezaro asking for business name.<br>
                                    User plan: {plan_tier}<br>
                                    Context: This is step 1 of 6.<br>
                                    If user says unclear input, ask politely to clarify.<br>
                                    If user says "No" or "Skip", respond: "No problem! Let's open the manual form for you."
                                    </div>

                                    <strong>Step 2: Team Members</strong><br>
                                    <div style="background: #f9f9f9; padding: 10px; border-radius: 4px; margin: 8px 0; font-family: 'Courier New', monospace; font-size: 0.85rem;">
                                    System: You are Beezaro asking about team setup.<br>
                                    User plan: {plan_tier} (Team feature available: {true/false})<br>
                                    If Individual plan, skip this step automatically.<br>
                                    If Business/Premium/Organization plan, ask: "Would you like to add team members?"
                                    </div>

                                    <em style="color: #666;">...and 4 more step-specific templates</em>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SWIM LANE 2: REUSED SERVICES -->
                <div class="swim-lane lane-backend" style="opacity: 0.7;">
                    <div class="lane-header">
                        ‚ôªÔ∏è SWIM LANE 2: REUSED SERVICES FROM MANUAL ONBOARDING
                    </div>
                    <div class="lane-content">
                        <div class="note-box">
                            <div class="note-title">‚úÖ Services That Copilot Reuses (No Changes Needed)</div>
                            <div class="note-content">
                                <strong>All data-saving services are reused:</strong><br>
                                ‚Ä¢ Organization Service (save business info)<br>
                                ‚Ä¢ Team Invitation Service (save team members)<br>
                                ‚Ä¢ Channel Integration Services (connect channels)<br>
                                ‚Ä¢ AI Assistant Configuration Service (create Beebots)<br>
                                ‚Ä¢ Automation Library Service (activate templates)<br>
                                ‚Ä¢ File Upload Service (logo, knowledge base files)<br><br>

                                <strong>Copilot calls same APIs:</strong><br>
                                ‚Ä¢ POST /organizations - Save business name, industry, description<br>
                                ‚Ä¢ POST /teams/invite - Add team members<br>
                                ‚Ä¢ POST /channels - Connect channels<br>
                                ‚Ä¢ POST /ai-assistants - Create AI assistant<br>
                                ‚Ä¢ POST /automations/activate/:templateId - Activate automation<br><br>

                                <strong>Benefit:</strong> No duplication. Copilot is a different UI layer on top of existing APIs.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- END FRAME 11 -->

            <!-- INSERT FRAMES 12-15 FROM PART 2 -->
            <!-- FRAME 12: BEEZARO DATABASE SCHEMA -->
            <div class="frame beezaro-frame" id="frame12">
                <div class="frame-title">
                    ü§ñ BEEZARO DATABASE SCHEMA (4 New Tables)
                </div>

                <!-- SWIM LANE 4: DATABASE -->
                <div class="swim-lane lane-data">
                    <div class="lane-header">
                        üóÑÔ∏è SWIM LANE 4: BEEZARO DATABASE TABLES
                    </div>
                    <div class="lane-content">
                        <!-- Table 1: copilot_sessions -->
                        <div class="db-table copilot-table">
                            <div class="table-header">üìù TABLE: copilot_sessions (Conversation Sessions)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Session identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>userId</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL, FK ‚Üí users.id</div>
                                    <div>Which user owns this session</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>NULLABLE, FK ‚Üí organizations.id</div>
                                    <div>Associated organization (created during session)</div>
                                </div>
                                <div class="table-row">
                                    <div>sessionId</div>
                                    <div>UUID</div>
                                    <div>UNIQUE NOT NULL</div>
                                    <div>Public session identifier (for API calls)</div>
                                </div>
                                <div class="table-row">
                                    <div>currentStep</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>business_identity | team_members | channels | fallback_logic | ai_assistant | automation</div>
                                </div>
                                <div class="table-row">
                                    <div>status</div>
                                    <div>VARCHAR(20)</div>
                                    <div>DEFAULT 'active'</div>
                                    <div>active | paused | completed | abandoned</div>
                                </div>
                                <div class="table-row">
                                    <div>startedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>When session began</div>
                                </div>
                                <div class="table-row">
                                    <div>lastActiveAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last message timestamp (for detecting abandonment)</div>
                                </div>
                                <div class="table-row">
                                    <div>completedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When onboarding finished</div>
                                </div>
                                <div class="table-row">
                                    <div>deviceType</div>
                                    <div>VARCHAR(20)</div>
                                    <div>NULLABLE</div>
                                    <div>desktop | mobile | tablet</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Record creation time</div>
                                </div>
                                <div class="table-row">
                                    <div>updatedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last update time</div>
                                </div>
                            </div>
                            <div style="background: #FFF9E6; padding: 15px; border-radius: 6px; margin-top: 15px;">
                                <strong>üí° Usage Example:</strong><br>
                                When user clicks "Let Beezaro Set Everything Up For Me":<br>
                                ‚Üí Create new row: {userId: 123, sessionId: "uuid-...", currentStep: "business_identity", status: "active"}<br>
                                ‚Üí Return sessionId to frontend for all subsequent API calls
                            </div>
                            <div style="background: #E8F5E9; padding: 15px; border-radius: 6px; margin-top: 10px;">
                                <strong>üìä Indexes:</strong><br>
                                ‚Ä¢ idx_copilot_user (userId) - Find user's sessions<br>
                                ‚Ä¢ idx_copilot_session (sessionId) - Fast lookup by session<br>
                                ‚Ä¢ idx_copilot_status (status, lastActiveAt) - Find abandoned sessions
                            </div>
                        </div>

                        <!-- Table 2: copilot_conversation_history -->
                        <div class="db-table copilot-table">
                            <div class="table-header">üí¨ TABLE: copilot_conversation_history (Message Log)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Message identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>sessionId</div>
                                    <div>UUID</div>
                                    <div>NOT NULL, FK ‚Üí copilot_sessions.sessionId</div>
                                    <div>Which conversation this belongs to</div>
                                </div>
                                <div class="table-row">
                                    <div>messageType</div>
                                    <div>VARCHAR(20)</div>
                                    <div>NOT NULL</div>
                                    <div>beezaro | user | system</div>
                                </div>
                                <div class="table-row">
                                    <div>messageContent</div>
                                    <div>TEXT</div>
                                    <div>NOT NULL</div>
                                    <div>Actual message text</div>
                                </div>
                                <div class="table-row">
                                    <div>stepContext</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NULLABLE</div>
                                    <div>Which step this message belongs to</div>
                                </div>
                                <div class="table-row">
                                    <div>intent</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NULLABLE</div>
                                    <div>provide_info | skip | fallback | confirm | need_help</div>
                                </div>
                                <div class="table-row">
                                    <div>extractedData</div>
                                    <div>JSONB</div>
                                    <div>NULLABLE</div>
                                    <div>Structured data extracted from user message</div>
                                </div>
                                <div class="table-row">
                                    <div>timestamp</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>When message was sent</div>
                                </div>
                            </div>
                            <div style="background: #FFF9E6; padding: 15px; border-radius: 6px; margin-top: 15px;">
                                <strong>üí° Usage Example:</strong><br>
                                <strong>Beezaro message:</strong><br>
                                {sessionId, messageType: "beezaro", messageContent: "What's your business name?", stepContext: "business_identity"}<br><br>
                                <strong>User response:</strong><br>
                                {sessionId, messageType: "user", messageContent: "GreenLeaf Pharmacy", stepContext: "business_identity", intent: "provide_info", extractedData: {businessName: "GreenLeaf Pharmacy"}}
                            </div>
                            <div style="background: #E8F5E9; padding: 15px; border-radius: 6px; margin-top: 10px;">
                                <strong>üìä Indexes:</strong><br>
                                ‚Ä¢ idx_conversation_session (sessionId, timestamp) - Retrieve conversation in order<br>
                                ‚Ä¢ idx_conversation_step (stepContext) - Filter by step
                            </div>
                        </div>

                        <!-- Table 3: onboarding_state -->
                        <div class="db-table copilot-table">
                            <div class="table-header">üìä TABLE: onboarding_state (Unified Progress Tracking)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>State identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>userId</div>
                                    <div>INTEGER</div>
                                    <div>UNIQUE NOT NULL, FK ‚Üí users.id</div>
                                    <div>One state per user</div>
                                </div>
                                <div class="table-row">
                                    <div>organizationId</div>
                                    <div>INTEGER</div>
                                    <div>NULLABLE, FK ‚Üí organizations.id</div>
                                    <div>Associated organization</div>
                                </div>
                                <div class="table-row">
                                    <div>onboardingMode</div>
                                    <div>VARCHAR(20)</div>
                                    <div>DEFAULT 'copilot'</div>
                                    <div>copilot | manual (current mode)</div>
                                </div>
                                <div class="table-row">
                                    <div>stepsCompleted</div>
                                    <div>JSONB</div>
                                    <div>DEFAULT '[]'</div>
                                    <div>Array of completed step names</div>
                                </div>
                                <div class="table-row">
                                    <div>currentStep</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NULLABLE</div>
                                    <div>What step user is currently on</div>
                                </div>
                                <div class="table-row">
                                    <div>collectedData</div>
                                    <div>JSONB</div>
                                    <div>DEFAULT '{}'</div>
                                    <div>All data collected so far (from either mode)</div>
                                </div>
                                <div class="table-row">
                                    <div>lastSwitchedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When user last switched between copilot ‚Üî manual</div>
                                </div>
                                <div class="table-row">
                                    <div>progressPercentage</div>
                                    <div>INTEGER</div>
                                    <div>DEFAULT 0</div>
                                    <div>0-100 completion percentage</div>
                                </div>
                                <div class="table-row">
                                    <div>isCompleted</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT FALSE</div>
                                    <div>Has user finished entire onboarding?</div>
                                </div>
                                <div class="table-row">
                                    <div>startedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>When onboarding began</div>
                                </div>
                                <div class="table-row">
                                    <div>completedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When onboarding finished</div>
                                </div>
                                <div class="table-row">
                                    <div>createdAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Record creation</div>
                                </div>
                                <div class="table-row">
                                    <div>updatedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>Last update</div>
                                </div>
                            </div>
                            <div style="background: #FFF9E6; padding: 15px; border-radius: 6px; margin-top: 15px;">
                                <strong>üí° Usage Example (Mode Switching):</strong><br>
                                <strong>Initial State (Copilot):</strong><br>
                                {userId: 123, onboardingMode: "copilot", currentStep: "business_identity", stepsCompleted: [], collectedData: {}}<br><br>

                                <strong>After completing Business Identity in copilot:</strong><br>
                                {onboardingMode: "copilot", currentStep: "team_members", stepsCompleted: ["business_identity"], collectedData: {businessName: "GreenLeaf", industry: "Healthcare"}}<br><br>

                                <strong>User says "No" to team question ‚Üí Switches to manual:</strong><br>
                                {onboardingMode: "manual", currentStep: "team_members", lastSwitchedAt: NOW()}<br><br>

                                <strong>After completing team in manual ‚Üí Returns to copilot:</strong><br>
                                {onboardingMode: "copilot", currentStep: "channels", stepsCompleted: ["business_identity", "team_members"], collectedData: {...team data added...}}
                            </div>
                            <div style="background: #E8F5E9; padding: 15px; border-radius: 6px; margin-top: 10px;">
                                <strong>üìä Index:</strong><br>
                                ‚Ä¢ idx_onboarding_user (userId) - One state per user
                            </div>
                        </div>

                        <!-- Table 4: copilot_fallback_triggers -->
                        <div class="db-table copilot-table">
                            <div class="table-header">üîÑ TABLE: copilot_fallback_triggers (Manual Redirect Log)</div>
                            <div class="table-body">
                                <div class="table-row header-row">
                                    <div>Column</div>
                                    <div>Type</div>
                                    <div>Constraints</div>
                                    <div>Purpose</div>
                                </div>
                                <div class="table-row">
                                    <div class="pk">id</div>
                                    <div>SERIAL</div>
                                    <div>PRIMARY KEY</div>
                                    <div>Trigger identifier</div>
                                </div>
                                <div class="table-row">
                                    <div>sessionId</div>
                                    <div>UUID</div>
                                    <div>NOT NULL, FK ‚Üí copilot_sessions.sessionId</div>
                                    <div>Which session triggered fallback</div>
                                </div>
                                <div class="table-row">
                                    <div>userId</div>
                                    <div>INTEGER</div>
                                    <div>NOT NULL, FK ‚Üí users.id</div>
                                    <div>Which user</div>
                                </div>
                                <div class="table-row">
                                    <div>triggerReason</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>user_said_no | user_skipped | validation_failed | complex_input | unclear_response</div>
                                </div>
                                <div class="table-row">
                                    <div>fromStep</div>
                                    <div>VARCHAR(50)</div>
                                    <div>NOT NULL</div>
                                    <div>Which copilot step triggered fallback</div>
                                </div>
                                <div class="table-row">
                                    <div>toManualScreen</div>
                                    <div>VARCHAR(100)</div>
                                    <div>NOT NULL</div>
                                    <div>Which manual screen to open (e.g., "STEP 2 - Business Name")</div>
                                </div>
                                <div class="table-row">
                                    <div>returnedToChat</div>
                                    <div>BOOLEAN</div>
                                    <div>DEFAULT FALSE</div>
                                    <div>Did user complete manual and return to copilot?</div>
                                </div>
                                <div class="table-row">
                                    <div>triggeredAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>DEFAULT NOW()</div>
                                    <div>When fallback occurred</div>
                                </div>
                                <div class="table-row">
                                    <div>resolvedAt</div>
                                    <div>TIMESTAMP</div>
                                    <div>NULLABLE</div>
                                    <div>When user returned to copilot (or abandoned)</div>
                                </div>
                            </div>
                            <div style="background: #FFF9E6; padding: 15px; border-radius: 6px; margin-top: 15px;">
                                <strong>üí° Usage Example:</strong><br>
                                <strong>Trigger:</strong><br>
                                Beezaro: "What's your business name?"<br>
                                User: "No"<br>
                                ‚Üí Create row: {sessionId, userId, triggerReason: "user_said_no", fromStep: "business_identity", toManualScreen: "STEP 2 - Business Name", triggeredAt: NOW()}<br><br>

                                <strong>Resolution:</strong><br>
                                User completes manual form, clicks "Return to Beezaro"<br>
                                ‚Üí Update row: {returnedToChat: TRUE, resolvedAt: NOW()}
                            </div>
                            <div style="background: #E8F5E9; padding: 15px; border-radius: 6px; margin-top: 10px;">
                                <strong>üìä Analytics Use:</strong><br>
                                ‚Ä¢ Count how often users fallback to manual (UX improvement insights)<br>
                                ‚Ä¢ Which steps cause most fallbacks (identify problem questions)<br>
                                ‚Ä¢ Return rate (do users come back to copilot after manual?)
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- END FRAME 12 -->

            <!-- FRAME 13: COPILOT-TO-MANUAL MAPPING -->
            <div class="frame beezaro-frame" id="frame13">
                <div class="frame-title">
                    üîÑ BEEZARO ‚Üî MANUAL ONBOARDING MAPPING
                </div>

                <div class="frame-subtitle">
                    Complete Question-to-Screen Mapping with Fallback Logic
                </div>

                <!-- Mapping Table -->
                <div style="background: white; padding: 25px; border-radius: 12px; border: 3px solid #FB9C1D; margin-top: 30px;">
                    <h3 style="color: #1A4D2E; text-align: center; margin-bottom: 25px;">üìä COMPLETE STEP MAPPING</h3>

                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #FFF9E6; border-bottom: 3px solid #FB9C1D;">
                                <th style="padding: 12px; text-align: left; width: 10%;">Beezaro Step</th>
                                <th style="padding: 12px; text-align: left; width: 25%;">Copilot Question</th>
                                <th style="padding: 12px; text-align: left; width: 25%;">Manual Screen</th>
                                <th style="padding: 12px; text-align: left; width: 20%;">Database Field</th>
                                <th style="padding: 12px; text-align: left; width: 20%;">Fallback Trigger</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Step 1: Business Identity -->
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 12px; font-weight: 700; color: #FB9C1D;" rowspan="6">STEP 1<br>Business<br>Identity</td>
                                <td style="padding: 12px;">"Confirm you selected [Business Plan]"</td>
                                <td style="padding: 12px;">Manual STEP 1 - Plan Selection</td>
                                <td style="padding: 12px;">subscriptions.plan_id</td>
                                <td style="padding: 12px;">User says "No, Change plan"</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 12px;">"What's your business name?"</td>
                                <td style="padding: 12px;">Manual STEP 2 - Business Name</td>
                                <td style="padding: 12px;">organizations.business_name</td>
                                <td style="padding: 12px;">User says "No" or "Skip"</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 12px;">"What industry is your business based?"</td>
                                <td style="padding: 12px;">Manual STEP 2 - Industry Dropdown</td>
                                <td style="padding: 12px;">organizations.industry</td>
                                <td style="padding: 12px;">User unclear or says "Skip"</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 12px;">"Tell us about your business"</td>
                                <td style="padding: 12px;">Manual STEP 2 - Description</td>
                                <td style="padding: 12px;">organizations.business_description</td>
                                <td style="padding: 12px;">User says "No"</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 12px;">"Upload your business logo"</td>
                                <td style="padding: 12px;">Manual STEP 2 - Logo Upload</td>
                                <td style="padding: 12px;">organizations.logo_url + S3</td>
                                <td style="padding: 12px;">User says "Skip" or upload fails</td>
                            </tr>
                            <tr style="border-bottom: 2px solid #FB9C1D;">
                                <td style="padding: 12px;">"Knowledge base files or website URL?"</td>
                                <td style="padding: 12px;">Manual STEP 2 - Knowledge+Files</td>
                                <td style="padding: 12px;">knowledge_base_documents</td>
                                <td style="padding: 12px;">User says "Skip"</td>
                            </tr>

                            <!-- Step 2: Team Members -->
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 12px; font-weight: 700; color: #FB9C1D;" rowspan="3">STEP 2<br>Team<br>Members</td>
                                <td style="padding: 12px;">"Would you like to add team members?"</td>
                                <td style="padding: 12px;">Manual STEP 3 - Team Setup</td>
                                <td style="padding: 12px;">team_members table</td>
                                <td style="padding: 12px;">User says "No" (skip entire step)</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 12px;">"Enter team member emails"</td>
                                <td style="padding: 12px;">Manual STEP 3 - Email Input</td>
                                <td style="padding: 12px;">team_members.email</td>
                                <td style="padding: 12px;">User says "Do it manually"</td>
                            </tr>
                            <tr style="border-bottom: 2px solid #FB9C1D;">
                                <td style="padding: 12px;">"Select role for each member"</td>
                                <td style="padding: 12px;">Manual STEP 3 - Role Dropdown</td>
                                <td style="padding: 12px;">team_members.role</td>
                                <td style="padding: 12px;">User unclear on roles</td>
                            </tr>

                            <!-- Step 3: Channels -->
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 12px; font-weight: 700; color: #FB9C1D;" rowspan="2">STEP 3<br>Channels</td>
                                <td style="padding: 12px;">"Let's connect your channels! Select from grid"</td>
                                <td style="padding: 12px;">Manual STEP 5 - Channel Grid</td>
                                <td style="padding: 12px;">channels.channelType</td>
                                <td style="padding: 12px;">User says "Configure manually"</td>
                            </tr>
                            <tr style="border-bottom: 2px solid #FB9C1D;">
                                <td style="padding: 12px;">"Configure now or use defaults?"</td>
                                <td style="padding: 12px;">Manual STEP 5 - Per-Channel Settings</td>
                                <td style="padding: 12px;">channels.configuration JSONB</td>
                                <td style="padding: 12px;">User says "Configure now"</td>
                            </tr>

                            <!-- Step 4: Fall-Back Logic -->
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 12px; font-weight: 700; color: #FB9C1D;" rowspan="2">STEP 4<br>Fall-Back<br>Logic</td>
                                <td style="padding: 12px;">"What if no one replies to a customer?"</td>
                                <td style="padding: 12px;">Manual STEP 6 - Escalation Rules</td>
                                <td style="padding: 12px;">escalation_rules table</td>
                                <td style="padding: 12px;">User says "Set up manually"</td>
                            </tr>
                            <tr style="border-bottom: 2px solid #FB9C1D;">
                                <td style="padding: 12px;">"Send follow-up after delay?"</td>
                                <td style="padding: 12px;">Manual STEP 6 - Follow-Up Triggers</td>
                                <td style="padding: 12px;">follow_up_rules table</td>
                                <td style="padding: 12px;">User says "Skip"</td>
                            </tr>

                            <!-- Step 5: AI Assistant -->
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 12px; font-weight: 700; color: #FB9C1D;" rowspan="2">STEP 5<br>AI<br>Assistant</td>
                                <td style="padding: 12px;">"Single or multiple AI assistants?"</td>
                                <td style="padding: 12px;">Manual STEP 4 - AI Creation</td>
                                <td style="padding: 12px;">ai_assistants table</td>
                                <td style="padding: 12px;">User says "Configure manually"</td>
                            </tr>
                            <tr style="border-bottom: 2px solid #FB9C1D;">
                                <td style="padding: 12px;">"AI name, tone, personality?"</td>
                                <td style="padding: 12px;">Manual STEP 4 - AI Settings</td>
                                <td style="padding: 12px;">ai_assistants.name/tone/personality</td>
                                <td style="padding: 12px;">User says "Skip"</td>
                            </tr>

                            <!-- Step 6: Automation -->
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 12px; font-weight: 700; color: #FB9C1D;" rowspan="2">STEP 6<br>Automation</td>
                                <td style="padding: 12px;">"Create starter automation?"</td>
                                <td style="padding: 12px;">Manual STEP 8 - Template Library</td>
                                <td style="padding: 12px;">automation_templates</td>
                                <td style="padding: 12px;">User says "No, skip"</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px;">"Select template category"</td>
                                <td style="padding: 12px;">Manual STEP 8 - Category Filter</td>
                                <td style="padding: 12px;">user_automations.templateId</td>
                                <td style="padding: 12px;">User says "Browse manually"</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Fallback Workflow Diagram -->
                <div style="margin-top: 30px;">
                    <h3 style="color: #1A4D2E; margin-bottom: 20px;">üîÑ Fallback Workflow (Detailed)</h3>
                    <div style="background: #f9f9f9; padding: 25px; border-radius: 12px; border: 2px solid #2D6A4F;">
                        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; text-align: center;">
                            <div style="background: #FFF9E6; padding: 15px; border-radius: 8px; border: 2px solid #FB9C1D;">
                                <div style="font-size: 2rem;">üí¨</div>
                                <strong>Copilot Asks</strong>
                                <div style="font-size: 0.85rem; margin-top: 8px; color: #666;">
                                    Beezaro: "What's your business name?"
                                </div>
                            </div>
                            <div style="font-size: 2rem; display: flex; align-items: center; justify-content: center;">‚Üí</div>
                            <div style="background: #FFE4E1; padding: 15px; border-radius: 8px; border: 2px solid #FF6B6B;">
                                <div style="font-size: 2rem;">üö´</div>
                                <strong>User Says No</strong>
                                <div style="font-size: 0.85rem; margin-top: 8px; color: #666;">
                                    User: "No" or "Skip"
                                </div>
                            </div>
                            <div style="font-size: 2rem; display: flex; align-items: center; justify-content: center;">‚Üí</div>
                            <div style="background: #E8F5E9; padding: 15px; border-radius: 8px; border: 2px solid #2D6A4F;">
                                <div style="font-size: 2rem;">üìù</div>
                                <strong>Opens Manual</strong>
                                <div style="font-size: 0.85rem; margin-top: 8px; color: #666;">
                                    Redirect to STEP 2 screen
                                </div>
                            </div>
                        </div>
                        <div style="text-align: center; margin: 15px 0; font-size: 1.5rem; color: #2D6A4F;">‚Üì</div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; text-align: center;">
                            <div style="background: #E8F5E9; padding: 15px; border-radius: 8px; border: 2px solid #2D6A4F;">
                                <div style="font-size: 2rem;">‚úÖ</div>
                                <strong>User Completes</strong>
                                <div style="font-size: 0.85rem; margin-top: 8px; color: #666;">
                                    Enters "GreenLeaf Pharmacy"<br>
                                    Saves to DB
                                </div>
                            </div>
                            <div style="font-size: 2rem; display: flex; align-items: center; justify-content: center;">‚Üí</div>
                            <div style="background: #FFF9E6; padding: 15px; border-radius: 8px; border: 2px solid #FB9C1D;">
                                <div style="font-size: 2rem;">üîô</div>
                                <strong>Returns to Chat</strong>
                                <div style="font-size: 0.85rem; margin-top: 8px; color: #666;">
                                    Clicks "Return to Beezaro"<br>
                                    Resumes from next question
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- END FRAME 13 -->


            <!-- FRAME 14: WEBSOCKET & REAL-TIME -->
            <div class="frame beezaro-frame" id="frame14">
                <div class="frame-title">
                    üåê BEEZARO REAL-TIME COMMUNICATION (WebSocket)
                </div>

                <div class="note-box" style="background: #FFF9E6; border-left-color: #FB9C1D;">
                    <h3>‚ôªÔ∏è Reuses Existing Socket.IO Infrastructure</h3>
                    <p>Beezaro leverages the same <strong>Socket.IO + Redis Pub/Sub</strong> infrastructure documented in Manual Onboarding STEP 6.</p>
                    <p style="margin-top: 10px;"><strong>Reference:</strong> See ADDENDUM_OPERATIONAL_ARCHITECTURE_DECISIONS.md ‚Üí Decision #22: WebSocket Scaling</p>
                </div>

                <!-- WebSocket Events -->
                <div style="margin-top: 30px;">
                    <h3 style="color: #1A4D2E; margin-bottom: 20px;">üì° Beezaro-Specific Socket.IO Events</h3>

                    <div class="service-card copilot-service-card">
                        <h3><span class="service-icon">üîå</span> WebSocket Event Specifications</h3>
                        <div class="section">
                            <div class="section-title">Event 1: copilot:message:send (Client ‚Üí Server)</div>
                            <div class="section-content">
                                <strong>Triggered:</strong> User types message and clicks send<br>
                                <strong>Payload:</strong>
                                <pre style="background: #f9f9f9; padding: 10px; border-radius: 4px; margin-top: 8px; font-size: 0.85rem;">{
  sessionId: "uuid-...",
  message: "GreenLeaf Pharmacy",
  timestamp: "2025-10-22T10:30:45Z"
}</pre>
                                <strong>Server Action:</strong><br>
                                1. Save message to copilot_conversation_history<br>
                                2. Process with OpenAI (extract intent + data)<br>
                                3. Generate Beezaro response<br>
                                4. Emit copilot:message:receive
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">Event 2: copilot:message:receive (Server ‚Üí Client)</div>
                            <div class="section-content">
                                <strong>Triggered:</strong> After processing user message<br>
                                <strong>Payload:</strong>
                                <pre style="background: #f9f9f9; padding: 10px; border-radius: 4px; margin-top: 8px; font-size: 0.85rem;">{
  sessionId: "uuid-...",
  beezaroMessage: "Great! Your business name is GreenLeaf Pharmacy. Next question...",
  messageType: "beezaro",
  stepContext: "business_identity",
  nextAction: "ask_industry",
  timestamp: "2025-10-22T10:30:47Z"
}</pre>
                                <strong>Client Action:</strong> Display Beezaro message in chat
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">Event 3: copilot:typing (Server ‚Üí Client)</div>
                            <div class="section-content">
                                <strong>Triggered:</strong> While OpenAI is processing<br>
                                <strong>Payload:</strong>
                                <pre style="background: #f9f9f9; padding: 10px; border-radius: 4px; margin-top: 8px; font-size: 0.85rem;">{
  sessionId: "uuid-...",
  isTyping: true
}</pre>
                                <strong>Client Action:</strong> Show "Beezaro is typing..." indicator with animated dots
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">Event 4: copilot:step:complete (Server ‚Üí Client)</div>
                            <div class="section-content">
                                <strong>Triggered:</strong> When a step is marked complete<br>
                                <strong>Payload:</strong>
                                <pre style="background: #f9f9f9; padding: 10px; border-radius: 4px; margin-top: 8px; font-size: 0.85rem;">{
  sessionId: "uuid-...",
  completedStep: "business_identity",
  nextStep: "team_members",
  progressPercentage: 17 // (1/6 steps done)
}</pre>
                                <strong>Client Action:</strong> Update progress stepper visual (checkmark on completed step)
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">Event 5: copilot:fallback:trigger (Server ‚Üí Client)</div>
                            <div class="section-content">
                                <strong>Triggered:</strong> When user says "No" or validation fails<br>
                                <strong>Payload:</strong>
                                <pre style="background: #f9f9f9; padding: 10px; border-radius: 4px; margin-top: 8px; font-size: 0.85rem;">{
  sessionId: "uuid-...",
  reason: "user_said_no",
  fromStep: "business_identity",
  manualScreenUrl: "/onboarding/manual/step-2/business-name",
  returnToken: "token-for-return" // Used to resume copilot later
}</pre>
                                <strong>Client Action:</strong> Redirect to manual screen URL with return token in query params
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Connection Management -->
                <div style="margin-top: 30px;">
                    <h3 style="color: #1A4D2E; margin-bottom: 20px;">üîß Connection Management</h3>
                    <div class="note-box">
                        <div class="note-title">Copilot Session Lifecycle</div>
                        <div class="note-content">
                            <strong>1. Connection Establishment:</strong><br>
                            ‚Ä¢ User clicks "Let Beezaro Set Everything Up For Me"<br>
                            ‚Ä¢ Frontend establishes WebSocket connection<br>
                            ‚Ä¢ Backend creates copilot_sessions record<br>
                            ‚Ä¢ Emit copilot:message:receive with welcome message<br><br>

                            <strong>2. Active Conversation:</strong><br>
                            ‚Ä¢ User types ‚Üí copilot:message:send<br>
                            ‚Ä¢ Server shows copilot:typing while processing<br>
                            ‚Ä¢ Server responds with copilot:message:receive<br>
                            ‚Ä¢ Update copilot_sessions.lastActiveAt on every message<br><br>

                            <strong>3. Idle Detection:</strong><br>
                            ‚Ä¢ Cron job checks lastActiveAt every 5 minutes<br>
                            ‚Ä¢ If inactive > 30 minutes ‚Üí Update status to 'paused'<br>
                            ‚Ä¢ Send email: "You have an incomplete onboarding. Resume?"<br><br>

                            <strong>4. Reconnection:</strong><br>
                            ‚Ä¢ User returns, clicks "Continue Onboarding"<br>
                            ‚Ä¢ Load copilot_sessions by sessionId<br>
                            ‚Ä¢ Load copilot_conversation_history (last 10 messages)<br>
                            ‚Ä¢ Resume from currentStep
                        </div>
                    </div>
                </div>
            </div>
            <!-- END FRAME 14 -->


            <!-- FRAME 15: INFRASTRUCTURE REUSE -->
            <div class="frame beezaro-frame" id="frame15">
                <div class="frame-title">
                    ‚òÅÔ∏è BEEZARO AWS INFRASTRUCTURE (Reuses Existing)
                </div>

                <div class="note-box" style="background: #E8F5E9; border-left-color: #2D6A4F;">
                    <h3>‚ôªÔ∏è No New Infrastructure Required</h3>
                    <p><strong>Beezaro leverages 100% of the existing AWS infrastructure</strong> documented in the Manual Onboarding sections.</p>
                    <p style="margin-top: 15px;"><strong>Key Point:</strong> Copilot is a different UI/UX layer on top of the same backend services and infrastructure. No additional AWS resources needed.</p>
                </div>

                <!-- Infrastructure Reuse Table -->
                <div style="margin-top: 30px;">
                    <h3 style="color: #1A4D2E; margin-bottom: 20px;">‚òÅÔ∏è AWS Components Reused</h3>
                    <table style="width: 100%; border-collapse: collapse; background: white; border: 2px solid #2D6A4F; border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #E8F5E9 0%, #B7E4C7 100%);">
                                <th style="padding: 15px; text-align: left; border-bottom: 2px solid #2D6A4F;">AWS Service</th>
                                <th style="padding: 15px; text-align: left; border-bottom: 2px solid #2D6A4F;">How Beezaro Uses It</th>
                                <th style="padding: 15px; text-align: left; border-bottom: 2px solid #2D6A4F;">Changes Needed</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 12px;"><strong>ECS Fargate</strong></td>
                                <td style="padding: 12px;">Hosts NestJS backend (including Beezaro services)</td>
                                <td style="padding: 12px; color: #2D6A4F;">‚úÖ None - Same containers</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 12px;"><strong>RDS PostgreSQL</strong></td>
                                <td style="padding: 12px;">Stores 4 new Beezaro tables + existing tables</td>
                                <td style="padding: 12px; color: #FB9C1D;">‚ö†Ô∏è Add 4 tables via migration</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 12px;"><strong>ElastiCache Redis</strong></td>
                                <td style="padding: 12px;">Cache conversation context (5-min TTL) + Socket.IO pub/sub</td>
                                <td style="padding: 12px; color: #2D6A4F;">‚úÖ None - Same instance</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 12px;"><strong>S3</strong></td>
                                <td style="padding: 12px;">Store uploaded logos & knowledge base files (same as manual)</td>
                                <td style="padding: 12px; color: #2D6A4F;">‚úÖ None - Same buckets</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 12px;"><strong>API Gateway</strong></td>
                                <td style="padding: 12px;">Route copilot API calls (/api/copilot/*)</td>
                                <td style="padding: 12px; color: #2D6A4F;">‚úÖ None - Auto-configured</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 12px;"><strong>CloudWatch</strong></td>
                                <td style="padding: 12px;">Monitor copilot sessions, message latency, fallback triggers</td>
                                <td style="padding: 12px; color: #FB9C1D;">‚ö†Ô∏è Add copilot-specific metrics</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 12px;"><strong>Secrets Manager</strong></td>
                                <td style="padding: 12px;">Store OpenAI API key</td>
                                <td style="padding: 12px; color: #FB9C1D;">‚ö†Ô∏è Add 1 new secret (OpenAI)</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px;"><strong>Lambda</strong></td>
                                <td style="padding: 12px;">Cleanup abandoned sessions (cron job)</td>
                                <td style="padding: 12px; color: #FB9C1D;">‚ö†Ô∏è Add 1 new Lambda function</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- OpenAI Integration -->
                <div style="margin-top: 30px;">
                    <h3 style="color: #1A4D2E; margin-bottom: 20px;">üß† OpenAI API Integration (New)</h3>
                    <div class="service-card copilot-service-card">
                        <h3><span class="service-icon">ü§ñ</span> OpenAI GPT-4 Configuration</h3>
                        <div class="section">
                            <div class="section-title">API Specification:</div>
                            <div class="section-content">
                                ‚Ä¢ <strong>Model:</strong> gpt-4-turbo-preview (128K context window)<br>
                                ‚Ä¢ <strong>Endpoint:</strong> https://api.openai.com/v1/chat/completions<br>
                                ‚Ä¢ <strong>Authentication:</strong> Bearer token (from AWS Secrets Manager)<br>
                                ‚Ä¢ <strong>Rate Limit:</strong> 10,000 requests/day (OpenAI tier 2)<br>
                                ‚Ä¢ <strong>Timeout:</strong> 30 seconds max per request
                            </div>
                        </div>
                        <div class="section">
                            <div class="section-title">Cost Estimation:</div>
                            <div class="section-content">
                                <strong>Per Conversation:</strong><br>
                                ‚Ä¢ Average messages per onboarding: 20 messages<br>
                                ‚Ä¢ Input tokens per message: ~500 tokens (context + question)<br>
                                ‚Ä¢ Output tokens per message: ~200 tokens (Beezaro response)<br>
                                ‚Ä¢ Total tokens per onboarding: (500 + 200) √ó 20 = 14,000 tokens<br>
                                ‚Ä¢ Cost per onboarding: $0.14 (at $0.01/1K input + $0.03/1K output)<br><br>

                                <strong>Monthly Cost (Year 1):</strong><br>
                                ‚Ä¢ Estimated copilot users: 200/month (50% adoption)<br>
                                ‚Ä¢ Monthly OpenAI cost: 200 √ó $0.14 = $28/month<br>
                                ‚Ä¢ Annual cost: $336/year<br><br>

                                <strong>At Scale (Year 3):</strong><br>
                                ‚Ä¢ 2,000 copilot users/month<br>
                                ‚Ä¢ Monthly cost: $280/month = $3,360/year
                            </div>
                        </div>
                        <div class="section">
                            <div class="section-title">Secrets Management:</div>
                            <div class="section-content">
                                ‚Ä¢ Store in AWS Secrets Manager: <code>unifiedbeez/openai/api-key</code><br>
                                ‚Ä¢ Rotation: Manual (on key compromise)<br>
                                ‚Ä¢ Access: ECS task role only
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lambda Function for Cleanup -->
                <div style="margin-top: 30px;">
                    <h3 style="color: #1A4D2E; margin-bottom: 20px;">‚ö° Lambda: Abandoned Session Cleanup</h3>
                    <div class="service-card copilot-service-card">
                        <h3><span class="service-icon">üßπ</span> Session Cleanup Lambda</h3>
                        <div class="section">
                            <div class="section-title">Function Purpose:</div>
                            <div class="section-content">
                                Detect and handle abandoned copilot sessions (users who started but didn't finish)
                            </div>
                        </div>
                        <div class="section">
                            <div class="section-title">Trigger:</div>
                            <div class="section-content">
                                ‚Ä¢ <strong>Schedule:</strong> EventBridge cron (every 5 minutes)<br>
                                ‚Ä¢ <strong>Query:</strong> Find copilot_sessions WHERE status='active' AND lastActiveAt < NOW() - 30 minutes
                            </div>
                        </div>
                        <div class="section">
                            <div class="section-title">Actions:</div>
                            <div class="section-content">
                                1. Update copilot_sessions.status = 'paused'<br>
                                2. Send email notification: "You have an incomplete onboarding. Resume here: [link]"<br>
                                3. Log to CloudWatch for analytics
                            </div>
                        </div>
                        <div class="section">
                            <div class="section-title">Cost:</div>
                            <div class="section-content">
                                ‚Ä¢ Runtime: Node.js 18<br>
                                ‚Ä¢ Memory: 128MB<br>
                                ‚Ä¢ Avg execution time: 2 seconds<br>
                                ‚Ä¢ Invocations/month: 8,640 (every 5 min)<br>
                                ‚Ä¢ Cost: ~$0.20/month (within free tier)
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- END FRAME 15 -->

        </div>
    </div>

    <!-- BACK TO TOP -->
    <a href="#" class="back-to-top">‚Üë</a>

    <!-- ZOOM SCRIPT -->
    <script>
        let zoomLevel = 1.0;
        const zoomStep = 0.1;
        const minZoom = 0.5;
        const maxZoom = 2.0;

        function zoomIn() {
            if (zoomLevel < maxZoom) {
                zoomLevel += zoomStep;
                applyZoom();
            }
        }

        function zoomOut() {
            if (zoomLevel > minZoom) {
                zoomLevel -= zoomStep;
                applyZoom();
            }
        }

        function resetZoom() {
            zoomLevel = 1.0;
            applyZoom();
        }

        function applyZoom() {
            const wrapper = document.getElementById('diagramWrapper');
            wrapper.style.transform = `scale(${zoomLevel})`;
            document.getElementById('zoomLevel').textContent = Math.round(zoomLevel * 100) + '%';
        }

        // Scroll zoom
        document.getElementById('diagramContainer').addEventListener('wheel', (e) => {
            if (e.ctrlKey) {
                e.preventDefault();
                if (e.deltaY < 0) {
                    zoomIn();
                } else {
                    zoomOut();
                }
            }
        });
    </script>

    <!-- NAVIGATION SCRIPT -->
    <script src="assets/navigation.js"></script>
</body>
</html>
